     1                                  ; ****************************************************************************
     2                                  ; TMP3PLAY.PRG - Tiny MP3 PLAYER v1.0 for TRDOS 386 Operating System
     3                                  ; ----------------------------------------------------------------------------
     4                                  ; Based on 
     5                                  ; NOCASH MP3PLAY.EXE 1.4 (Windows) ASM source code (Martin Korth, 20/09/2024)
     6                                  ;
     7                                  ; 15/02/2025
     8                                  ;
     9                                  ; [ Last Modification: 18/02/2025 ]
    10                                  ;
    11                                  ; Modified from 'mp3play6.s' (14/02/2025) and 'twavply3.s' (10/02/2025)
    12                                  ;
    13                                  ; ----------------------------------------------------------------------------
    14                                  ; Modified from on MP3PLAY.ASM (for Windows console) source code - 17/10/2024
    15                                  ; ****************************************************************************
    16                                  ; Modified from Martin Korth's 'mp3play.asm' (TASM32) source code... (v1.4)
    17                                  ; Applied development method:
    18                                  ;         Disassembling 'mp3play.exe' v1.4 by using HEX-RAYS disassembler;
    19                                  ;         then... converting disassembled code to FASM syntax,
    20                                  ;                 adding '.idata' code (by help of FASM examples) to the raw
    21                                  ;                        asm file. Converting 'proc' procedures to labels.
    22                                  ;               and Finally: assembling mp3play.asm (single) file by using
    23                                  ;                           'fasm mp3play.asm' command.
    24                                  ;
    25                                  ; NOTE:
    26                                  ; Martin Korth's MP3PLAY.EXE (v1.4, 20/09/2024) file size is 45056 bytes.
    27                                  ; (This) modified MP3PLAY.EXE (v1.4.0, 17/10/2024) is 37888 bytes.
    28                                  ;
    29                                  ; ---------------------------------------------------------------------------
    30                                  ; Assembler: NASM (v2.15)
    31                                  ; ------------------------------------------------
    32                                  ; nasm tmp3play.s -l  tmp3play.txt -o TMP3PLAY.PRG
    33                                  
    34                                  ; 13/01/2025 (mp3play3.s)
    35                                  ; Interpolated sample rate playing method for non-VRA AC97 codecs.
    36                                  
    37                                  ; ===========================================================================
    38                                  ;  TRDOS 386 Operating System Specific Procedures - Erdogan Tan - 20/10/2024
    39                                  ; ===========================================================================
    40                                  
    41                                  ; 20/10/2024
    42                                  ; 20/08/2024 ; TRDOS 386 v2.0.9
    43                                  ; TRDOS 386 system calls
    44                                  _ver 	equ 0
    45                                  _exit 	equ 1
    46                                  _fork 	equ 2
    47                                  _read 	equ 3
    48                                  _write	equ 4
    49                                  _open	equ 5
    50                                  _close 	equ 6
    51                                  _wait 	equ 7
    52                                  _creat 	equ 8
    53                                  _rename equ 9
    54                                  _delete equ 10
    55                                  _exec	equ 11
    56                                  _chdir	equ 12
    57                                  _time 	equ 13
    58                                  _mkdir 	equ 14
    59                                  _chmod	equ 15
    60                                  _rmdir	equ 16
    61                                  _break	equ 17
    62                                  _drive	equ 18
    63                                  _seek	equ 19
    64                                  _tell 	equ 20
    65                                  _mem	equ 21
    66                                  _prompt	equ 22
    67                                  _path	equ 23
    68                                  _env	equ 24
    69                                  _stime	equ 25
    70                                  _quit	equ 26
    71                                  _intr	equ 27
    72                                  _dir	equ 28
    73                                  _emt 	equ 29
    74                                  _ldvrt 	equ 30
    75                                  _video 	equ 31
    76                                  _audio	equ 32
    77                                  _timer	equ 33
    78                                  _sleep	equ 34
    79                                  _msg    equ 35
    80                                  _geterr	equ 36
    81                                  _fpsave	equ 37
    82                                  _pri	equ 38
    83                                  _rele	equ 39
    84                                  _fff	equ 40
    85                                  _fnf	equ 41
    86                                  _alloc	equ 42
    87                                  _dalloc equ 43
    88                                  _calbac equ 44
    89                                  _dma	equ 45
    90                                  _stdio  equ 46	;  TRDOS 386 v2.0.9
    91                                  
    92                                  ; ---------------------------------------------------------------------------
    93                                  ; 'sys' macro
    94                                  ; ---------------------------------------------------------------------------
    95                                  ; 09/01/2025
    96                                  
    97                                  %macro sys 1-4
    98                                      ; 29/04/2016 - TRDOS 386 (TRDOS v2.0)
    99                                      ; 03/09/2015
   100                                      ; 13/04/2015
   101                                      ; Retro UNIX 386 v1 system call.
   102                                      %if %0 >= 2
   103                                          mov ebx, %2
   104                                          %if %0 >= 3
   105                                              mov ecx, %3
   106                                              %if %0 = 4
   107                                                 mov edx, %4
   108                                              %endif
   109                                          %endif
   110                                      %endif
   111                                      mov eax, %1
   112                                      ;int 30h
   113                                      int 40h ; TRDOS 386 (TRDOS v2.0)
   114                                  %endmacro
   115                                  
   116                                  ; ===========================================================================
   117                                  ; CODE
   118                                  ; ===========================================================================
   119                                  
   120                                  		[BITS 32] ; 32-bit intructions
   121                                  
   122                                  		[ORG 0]
   123                                  
   124                                  ; ===========================================================================
   125                                  
   126                                  		; 15/02/2025
   127                                  start:
   128                                  		; 15/02/2025
   129                                  		sys	_msg, txt_hello, 255, 0Bh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00000000 BB[B4AE0000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00000005 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 0000000A BA0B000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000000F B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00000014 CD40                <1>  int 40h
   130                                  
   131                                  		; 21/10/2024
   132 00000016 E89A400000              		call	set_break	; set and clear bss section
   133                                  					; also set stream_start position
   134                                  
   135                                  		; 15/02/2025
   136                                  		sys	_msg, txt_bdate, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000001B BB[E8AE0000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00000020 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00000025 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000002A B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000002F CD40                <1>  int 40h
   137                                  		sys	_msg, txt_original,255,07h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00000031 BB[E8B00000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00000036 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 0000003B BA07000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00000040 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00000045 CD40                <1>  int 40h
   138                                  
   139                                  		;;;
   140                                  		; 11/01/2025
   141 00000047 E836410000              		call	detect_enable_audio_device
   142                                  		; 15/02/2025
   143 0000004C 731B                    		jnc     short GetFileName
   144                                  _dev_not_ready:
   145                                  		; couldn't find the audio device!
   146                                  		sys	_msg, noDevMsg, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000004E BB[D9B10000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00000053 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00000058 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000005D B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00000062 CD40                <1>  int 40h
   147 00000064 E910410000              		jmp     ExitP@
   148                                  
   149                                  		; ---------------------------------------------------
   150                                  
   151                                  		; 15/02/2025 - tmp3play.s
   152                                  		; 10/02/2025 - twavply3.s
   153                                  GetFileName:
   154                                  		; (TRDOS 386 -Retro UNIX 386- argument transfer method)
   155                                  		; (stack: argc,argv0addr,argv1addr,argv2addr ..
   156                                  		;			.. argv0text, argv1text ..) 
   157                                  		; ---- argc, argv[] ----
   158 00000069 89E6                    		mov	esi, esp
   159 0000006B AD                      		lodsd
   160 0000006C 83F802                  		cmp	eax, 2 ; two arguments 
   161 0000006F 7302                    		jnb	short _x
   162 00000071 EB4E                    		jmp	pmsg_usage
   163                                  
   164                                  _x:
   165 00000073 AD                      		lodsd	; skip program (PRG) file name
   166 00000074 8B36                    		mov	esi, [esi] ; MP3 file name 
   167                                  
   168                                  		;mov	edi, wav_file_name
   169                                  		; 15/02/2025
   170 00000076 BF[F05B0500]            		mov	edi, mp3_file_name
   171 0000007B 31C9                    		xor	ecx, ecx ; 0
   172                                  ScanName:       
   173 0000007D AC                      		lodsb
   174                                  
   175 0000007E 3C0D                    		cmp	al, 0Dh	; CR
   176 00000080 7633                    		jna	short a_4
   177                                  _y:
   178 00000082 3C20                    		cmp	al, 20h
   179 00000084 74F7                    		je	short ScanName	; scan start of name.
   180 00000086 AA                      		stosb
   181 00000087 B4FF                    		mov	ah, 0FFh
   182                                  a_0:	
   183 00000089 FEC4                    		inc	ah
   184                                  a_1:
   185 0000008B 41                      		inc	ecx
   186 0000008C AC                      		lodsb
   187 0000008D AA                      		stosb
   188 0000008E 3C2E                    		cmp	al, '.'
   189 00000090 74F7                    		je	short a_0
   190 00000092 3C20                    		cmp	al, 20h
   191 00000094 7611                    		jna	short a_3
   192 00000096 20E4                    		and	ah, ah
   193 00000098 7406                    		jz	short a_2
   194                                  
   195 0000009A 3C5C                    		cmp	al, '\'
   196 0000009C 7502                    		jne	short a_2
   197 0000009E B400                    		mov	ah, 0
   198                                  a_2:
   199 000000A0 80F94B                  		cmp	cl, 75	; 64+8+'.'+3 -> offset 75 is the last chr
   200 000000A3 72E6                    		jb	short a_1
   201 000000A5 EB0E                    		jmp	short a_4
   202                                  a_3:
   203 000000A7 4F                      		dec	edi
   204 000000A8 08E4                    		or	ah, ah		; if period NOT found,
   205 000000AA 7509                    		jnz	short a_4 	; then add a .mp3 extension.
   206                                  SetExt:
   207                                  		; 15/02/2025
   208 000000AC C7072E6D7033            		mov	dword [edi], '.mp3'
   209                                  		;mov	dword [edi], '.WAV' ; ! 64+12 is DOS limit
   210                                  					    ;   but writing +4 must not
   211                                  					    ;   destroy the following data
   212                                  					; so, 80 bytes path + 0 is possible here
   213 000000B2 83C704                  		add	edi, 4
   214                                  a_4:	
   215 000000B5 C60700                  		mov	byte [edi], 0
   216                                  	
   217 000000B8 803D[F05B0500]20        		cmp	byte [mp3_file_name], 20h
   218 000000BF 771B                    		ja	short mp3_filename_chk
   219                                  
   220                                  pmsg_usage: 
   221                                  		sys	_msg, txt_help, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000000C1 BB[C9B00000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 000000C6 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 000000CB BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000000D0 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 000000D5 CD40                <1>  int 40h
   222                                  
   223 000000D7 E99D400000              		jmp	ExitP@
   224                                  
   225                                  		; ---------------------------------------------------
   226                                  
   227                                  mp3_filename_chk:
   228 000000DC 8B47FC                  		mov	eax, [edi-4]
   229 000000DF 25FFDFDFFF              		and	eax, 0FFDFDFFFh
   230 000000E4 3D2E4D5033              		cmp	eax, '.MP3'
   231 000000E9 751E                    		jne	short not_valid_mp3
   232                                  
   233                                  		; ---------------------------------------------------
   234                                  		
   235 000000EB 31ED                     		xor	ebp, ebp
   236 000000ED E8013F0000              		call	mp3_init
   237 000000F2 E8D53F0000              		call	open_and_mmap_the_file
   238                                  		;jc	.exit
   239                                  		; 26/01/2025
   240 000000F7 0F827C400000            		jc	ExitP@
   241                                  
   242                                  		; 13/02/2025
   243 000000FD E82A500000              		call	write_audio_dev_info
   244                                  		
   245                                  		; 15/02/2025
   246 00000102 E8453F0000              		call	mp3_check_1st_frame
   247 00000107 731B                    		jnc	short mp3_file_ready
   248                                  
   249                                  not_valid_mp3:
   250                                  		; not a proper/valid mp3 file !
   251                                  		sys	_msg, not_valid_mp3f, 255, 0Ch
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00000109 BB[27B20000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 0000010E B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00000113 BA0C000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00000118 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000011D CD40                <1>  int 40h
   252                                  
   253 0000011F E955400000              		jmp	ExitP@
   254                                  
   255                                  		; ---------------------------------------------------
   256                                  
   257                                  mp3_file_ready:
   258                                  		; 13/02/2025
   259                                  		; 22/01/2025
   260                                  		; Forward/Backward position change parameters (*)
   261 00000124 A1[E0510500]            		mov	eax, [stream_pos]
   262 00000129 A3[58B20000]            		mov	[stream_begin], eax ; *
   263 0000012E A1[E4510500]            		mov	eax, [bytes_left]
   264 00000133 A3[54B20000]            		mov	[stream_size], eax ; *
   265                                  
   266                                  		; 15/02/2025
   267 00000138 E84C540000              		call	SetTotalTime
   268                                  
   269                                  		; 15/02/2025
   270 0000013D E8C4540000              		call	write_mp3_file_info
   271                                  
   272                                  		sys	_msg, msgPressAKey, 255, 07h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00000142 BB[7EB10000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00000147 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 0000014C BA07000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00000151 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00000156 CD40                <1>  int 40h
   273                                  
   274 00000158 30E4                    		xor	ah, ah
   275 0000015A CD32                    		int	32h	; TRDOS 386 keyboard interrupt
   276                                  				; getchar (wait for keystroke)
   277                                  
   278                                  		;cmp	al, 1Bh ; ESC
   279                                  		;je	ExitP@
   280                                  		; 13/02/2025
   281 0000015C E870530000              		call	check4keyboardstop.p_4
   282 00000161 0F8212400000            		jc	ExitP@
   283                                  
   284                                  		; ---------------------------------------------------
   285                                  
   286                                  		; 17/02/2025
   287                                  		;	[mp3_bytes_per_sample] = 2
   288                                  		; 15/02/2025 (tmp3play.s)
   289                                  		; 10/02/2025 (twavply3.s)
   290                                  		; 13/02/2025 (mp3play6.s)
   291                                  		; 26/01/2025 (mp3play5.s)
   292                                  		;;;;
   293 00000167 B800010000              		mov	eax, 256
   294 0000016C B201                    		mov	dl, 1
   295 0000016E 3815[78B20000]          		cmp	byte [audio_hardware], dl ; 1
   296 00000174 7714                    		ja	short .stolp_s16 ; AC97
   297                                  
   298 00000176 BA[44580000]            		mov	edx, get_sb16_sound_data
   299                                  		; SB16		
   300 0000017B 3815[BCC20000]          		cmp	byte [mp3_num_channels], dl ; 1
   301 00000181 7707                    		ja	short .stolp_s ; stereo
   302                                  .stolp_m:
   303                                  		;mov	ebx, sdc_8bit_mono
   304                                  		;cmp	byte [mp3_bytes_per_sample], dl ; 1
   305                                  		;jna	short .stolp_ok	; 8bit, mono
   306 00000183 BB[68580000]            		mov	ebx, sdc_16bit_mono
   307 00000188 EB09                    		jmp	short .stolp_m16 ; 16bit, mono
   308                                  .stolp_s:
   309                                  		;mov	ebx, sdc_8bit_stereo
   310                                  		;cmp	byte [mp3_bytes_per_sample], dl ; 1
   311                                  		;jna	short .stolp_s8 ; 8bit, stereo
   312                                  		; 16bit, stereo
   313                                  		;mov	ebx, sdc_16bit_stereo
   314                                  .stolp_s16:
   315 0000018A 31DB                    		xor	ebx, ebx ; (not necessary)
   316 0000018C BA[2C580000]            		mov	edx, get_ac97_sound_data ; (**)
   317                                  				; also for sb16, 16bit, stereo
   318 00000191 D1E0                    		shl	eax, 1
   319                                  .stolp_s8:
   320                                  .stolp_m16:
   321 00000193 D1E0                    		shl	eax, 1
   322                                  .stolp_ok:
   323 00000195 A3[60B20000]            		mov	[sd_count], eax
   324 0000019A 891D[00100600]          		mov	[sounddata_copy], ebx
   325 000001A0 8915[04100600]          		mov	[get_sound_data], edx
   326                                  		;;;;
   327                                  
   328                                  		; 15/02/2025
   329                                  		; ---------------------------------------------------
   330                                  		
   331                                  		; 13/02/2025
   332                                  		; 30/12/2024 (cgaplay.s)
   333                                  		;;;
   334                                  		; DIRECT VGA MEMORY ACCESS
   335                                  		; bl = 0, bh = 5
   336                                  		; Direct access/map to VGA memory (0A0000h)
   337                                  
   338                                  		sys	_video, 0500h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000001A6 BB00050000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000001AB B81F000000          <1>  mov eax, %1
   112                              <1> 
   113 000001B0 CD40                <1>  int 40h
   339 000001B2 3D00000A00              		cmp	eax, 0A0000h
   340 000001B7 7405                    		je	short .vimem_map_ok
   341                                  		; 30/12/2024
   342 000001B9 E9C2000000              		jmp	trdos386_error
   343                                  .vimem_map_ok:
   344                                  		;;;;
   345                                  
   346                                  		; ---------------------------------------------------
   347                                  setgraphmode:
   348                                  		; set VGA 640x480x16 graphics mode
   349 000001BE 66B81200                		mov	ax, 12h
   350 000001C2 CD31                    		int	31h	; TRDOS 386 Video Interrupt
   351                                  				; Set video mode
   352 000001C4 66BAC003                		mov	dx, 3C0h
   353 000001C8 30C0                    		xor	al, al
   354                                  setgraphmodel0:
   355                                  		;out	dx, al
   356 000001CA B401                    		mov	ah, 1	; outb
   357 000001CC CD34                    		int	34h	; TRDOS 386 IOCTL Interrupt
   358                                  		;out	dx, al
   359                                  		;mov	ah, 1	; outb
   360 000001CE CD34                    		int	34h
   361 000001D0 FEC0                    		inc	al
   362 000001D2 3C10                    		cmp	al, 10h
   363 000001D4 72F4                    		jb	short setgraphmodel0
   364 000001D6 B020                    		mov	al, 20h
   365                                  		;out	dx, al
   366                                  		;mov	ah, 1	; outb
   367 000001D8 CD34                    		int	34h
   368                                  		;;;;
   369                                  
   370                                  		; ---------------------------------------------------
   371                                  
   372                                  		; 17/02/2025
   373 000001DA B900010000              		mov	ecx, 256
   374 000001DF 31DB                    		xor	ebx, ebx
   375 000001E1 BF[F0510500]            		mov	edi, RowOfs
   376                                  MakeOfs:
   377 000001E6 89D8                    		mov	eax, ebx
   378 000001E8 C1E007                  		shl	eax, 7 ; * 128
   379 000001EB B050                    		mov	al, 80
   380 000001ED F6E4                    		mul	ah
   381 000001EF 66AB                    		stosw
   382 000001F1 43                      		inc	ebx
   383 000001F2 E2F2                    		loop	MakeOfs
   384                                  
   385                                  		; ---------------------------------------------------
   386                                  
   387                                  		; 25/01/2025
   388                                  		; 21/12/2024
   389                                  		;;; ---------------------------
   390 000001F4 E8A9560000              		call	drawplayingscreen
   391                                  		;;; ---------------------------
   392                                  
   393                                  		; 15/02/2025
   394 000001F9 B003                    		mov	al, 3	; 0 = max, 31 = min
   395 000001FB E86B410000              		call	SetMasterVolume
   396                                  
   397                                  		;;; ---------------------------
   398                                  
   399                                  		; 16/02/2025		
   400                                  replay:
   401                                  		; 17/02/2025
   402                                  		; 15/02/2025
   403                                  		; 13/01/2025 (interpolation procs for non-VRA AC97 codecs)
   404                                  		;;;; --------------------------
   405                                  		;mov	byte [interpolation], 0
   406 00000200 B002                    		mov	al, 2
   407 00000202 3805[78B20000]          		cmp	[audio_hardware], al ; 2
   408 00000208 7241                    		jb	short .direct ; SB16	; 17/02/2025
   409                                  		; AC97
   410                                  		;mov	dword [get_sound_data], get_ac97_sound_data ; (**)
   411                                  .chk_frq:
   412 0000020A 813D[B0C20000]80BB-     		cmp	dword [mp3_sample_rate], 48000 ; 48 kHZ
   412 00000212 0000               
   413 00000214 7212                    		jb	short .chk_vra
   414 00000216 803D[BCC20000]02        		cmp	byte [mp3_num_channels], 2
   415                                  		; 17/02/2025
   416                                  		;jb	short .convert	; mono (8bit or 16bit)
   417                                  		
   418                                  		;cmp	byte [mp3_bytes_per_sample], al ; 2
   419                                  		;jnb	short .direct ; 16bit, stereo
   420                                  		; 17/02/2025
   421 0000021D 732C                    		jnb	short .direct
   422                                  .convert:
   423                                  		; 8bit m/s or 16bit mono
   424 0000021F C605[8CB20000]01        		mov	byte [interpolation], 1 ; convert (to 16 bit stereo)
   425 00000226 EB42                    		jmp	short .indirect ; 21/01/2025
   426                                  .chk_vra:
   427 00000228 A2[8CB20000]            		mov	[interpolation], al ; 2 = interpolation
   428 0000022D 803D[79B20000]01        		cmp	byte [vra], 1
   429 00000234 7234                    		jb	short .indirect ; 21/01/2025
   430 00000236 FE0D[8CB20000]          		dec	byte [interpolation] ; 1 = convert (to 16 bit stereo)
   431 0000023C 803D[BCC20000]02        		cmp	byte [mp3_num_channels], 2
   432 00000243 7225                    		jb	short .indirect ; 8 bit ; 21/01/2025
   433                                  		; 17/02/2025
   434                                  		;cmp	byte [mp3_bytes_per_sample], al ; 2
   435                                  		;jb	short .indirect ; mono ; 21/01/2025	
   436                                  
   437                                  		; 14/01/2025
   438 00000245 FE0D[8CB20000]          		dec	byte [interpolation] ; 0
   439                                  .direct:
   440                                  		;;;; --------------------------
   441                                  
   442                                  		;;; 
   443                                  		; 20/10/2024
   444                                  		;call	detect_enable_audio_device
   445                                  		;jc	.exit
   446 0000024B E80B400000              		call	audio_system_init
   447                                  		;jc	.exit
   448 00000250 7207                    		jc	short .exit@ ; 15/01/2025
   449                                  		;;;
   450                                  
   451 00000252 E82E410000                              call	mp3_cast_to_speaker
   452                                  
   453                                  		; 15/02/2025
   454                                  		; 13/01/2025
   455 00000257 EB1D                    		jmp	short .decode_done
   456                                  
   457                                  		; 15/01/2025
   458                                  .exit@:
   459                                  		; Disable audio device
   460                                  		sys	_audio, 0C00h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00000259 BB000C0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000025E B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00000263 CD40                <1>  int 40h
   461                                  		;jmp	ExitProcess
   462                                  		; 27/01/2025
   463 00000265 E9113F0000              		jmp	ExitProcess@
   464                                  
   465                                  .indirect:
   466 0000026A E834420000              		call	audio_system_init_x
   467 0000026F 72E8                    		jc	short .exit@ ; 15/01/2025
   468 00000271 E82D440000              		call	mp3_cast_to_speaker_x
   469                                  		;;;; --------------------------
   470                                  
   471                                  		; 15/02/2025
   472                                  		; 22/01/2025
   473                                  .decode_done:
   474                                  		; set video mode to 03h again (clear screen)
   475                                  		;mov	ax, 03h
   476                                  		;int	31h ; TRDOS 386 - Video interrupt
   477                                  		; 25/01/2025
   478 00000276 E807530000              		call	set_text_mode
   479                                  .exit:
   480                                  		;push   0               ; uExitCode
   481                                                  ;call   ExitProcess
   482                                  		;jmp	ExitProcess
   483                                  		; 27/01/2025
   484 0000027B E9FB3E0000              		jmp	ExitProcess@
   485                                  
   486                                  		; 13/02/2025
   487                                  		; 25/01/2025
   488                                  trdos386_error:
   489                                  		sys	_msg, trdos386_err_msg, 255, 0Eh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00000280 BB[B9B10000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00000285 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 0000028A BA0E000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000028F B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00000294 CD40                <1>  int 40h
   490 00000296 BBFFFFFFFF              		mov	ebx, -1	; (not necessary) -error exit example-
   491 0000029B E9DB3E0000              		jmp	ExitProcess@
   492                                  
   493                                  
   494                                  ; =============== S U B R O U T I N E =======================================
   495                                  
   496                                  bswap_eax:
   497 000002A0 86E0                                    xchg    al, ah
   498 000002A2 C1C810                                  ror     eax, 10h
   499 000002A5 86E0                                    xchg    al, ah
   500 000002A7 C3                                      retn
   501                                  
   502                                  ; =============== S U B R O U T I N E =======================================
   503                                  
   504                                  mp3_recollect_bits:
   505 000002A8 F7C601000000                            test    esi, 1
   506 000002AE 7510                                    jnz     short .odd
   507 000002B0 668B2E                                  mov     bp, [esi]
   508 000002B3 83C602                                  add     esi, 2
   509 000002B6 66C1CD08                                ror     bp, 8
   510 000002BA C1E510                                  shl     ebp, 16
   511 000002BD B500                                    mov     ch, 0
   512 000002BF C3                                      retn
   513                                  
   514                                  .odd:
   515 000002C0 0FB62E                                  movzx   ebp, byte [esi]
   516 000002C3 46                                      inc     esi
   517 000002C4 C1E510                                  shl     ebp, 16
   518 000002C7 668B2E                                  mov     bp, [esi]
   519 000002CA 83C602                                  add     esi, 2
   520 000002CD 66C1CD08                                ror     bp, 8
   521 000002D1 C1E508                                  shl     ebp, 8
   522 000002D4 B508                                    mov     ch, 8
   523 000002D6 C3                                      retn
   524                                  
   525                                  ; =============== S U B R O U T I N E =======================================
   526                                  
   527                                  
   528                                  mp3_get_bits:
   529 000002D7 89E8                                    mov     eax, ebp
   530 000002D9 D3E5                                    shl     ebp, cl
   531 000002DB D3C0                                    rol     eax, cl
   532 000002DD 31E8                                    xor     eax, ebp
   533 000002DF 28CD                                    sub     ch, cl
   534 000002E1 7801                                    js      short mp3_collect_more
   535 000002E3 C3                                      retn
   536                                  
   537                                  mp3_collect_more:
   538 000002E4 88E9                                    mov     cl, ch
   539 000002E6 80C510                                  add     ch, 10h
   540 000002E9 D3C5                                    rol     ebp, cl
   541 000002EB 668B2E                                  mov     bp, [esi]
   542 000002EE 83C602                                  add     esi, 2
   543 000002F1 66C1CD08                                ror     bp, 8
   544 000002F5 D3CD                                    ror     ebp, cl
   545 000002F7 C3                                      retn
   546                                  
   547                                  ; =============== S U B R O U T I N E =======================================
   548                                  
   549                                  
   550                                  mp3_uncollect_bits:
   551 000002F8 83EE02                                  sub     esi, 2
   552 000002FB C0ED03                                  shr     ch, 3
   553 000002FE 0FB6CD                                  movzx   ecx, ch
   554 00000301 29CE                                    sub     esi, ecx
   555 00000303 C3                                      retn
   556                                  
   557                                  ; =============== S U B R O U T I N E =======================================
   558                                  
   559                                  
   560                                  mp3_search_get_header:
   561                                  		; 16/02/2025
   562 00000304 C705[90190100]0000-                     mov	dword [mp3_extra_bytes], 0
   562 0000030C 0000               
   563                                  
   564                                  .retry_header:
   565 0000030E 833D[8C190100]04                        cmp	dword [mp3_src_remain], 4
   566 00000315 0F8276010000                            jb      .fail_no_header
   567 0000031B 803EFF                                  cmp     byte [esi], 0FFh
   568 0000031E 7516                                    jnz     short .bad_header
   569 00000320 8A4601                                  mov     al, [esi+1]
   570 00000323 24E6                                    and     al, 0E6h
   571 00000325 3CE2                                    cmp     al, 0E2h
   572 00000327 750D                                    jnz     short .bad_header
   573 00000329 8A4602                                  mov     al, [esi+2]
   574 0000032C 3CF0                                    cmp     al, 0F0h
   575 0000032E 7306                                    jnb     short .bad_header
   576 00000330 240C                                    and     al, 0Ch
   577 00000332 3C0C                                    cmp     al, 0Ch
   578 00000334 7519                                    jnz     short .good_header
   579                                  
   580                                  .bad_header:
   581 00000336 46                                      inc	esi
   582 00000337 FF0D[8C190100]                          dec	dword [mp3_src_remain]
   583 0000033D FF05[90190100]                          inc	dword [mp3_extra_bytes]
   584 00000343 C705[90C20000]-                         mov	dword [main_data_pool_wr_ptr], main_data_pool_start
   584 00000349 [90B20000]         
   585 0000034D EBBF                                    jmp	short .retry_header
   586                                  
   587                                  .good_header:
   588 0000034F 8B06                                    mov	eax, [esi]
   589 00000351 E84AFFFFFF                              call	bswap_eax
   590 00000356 A3[A0C20000]                            mov	[mp3_hdr_32bit_header], eax
   591 0000035B C705[D4C20000]0000-                     mov	dword [mp3_hdr_flag_lsf], 0
   591 00000363 0000               
   592 00000365 C705[A8C20000]0000-                     mov	dword [mp3_hdr_flag_mpeg25], 0
   592 0000036D 0000               
   593 0000036F C705[9C190100]0200-                     mov	dword [mp3_nb_granules], 2
   593 00000377 0000               
   594 00000379 A900000800                              test	eax, 80000h
   595 0000037E 7525                                    jnz	short .lsf_this
   596 00000380 C705[D4C20000]0100-                     mov	dword [mp3_hdr_flag_lsf], 1
   596 00000388 0000               
   597 0000038A C705[9C190100]0100-                     mov	dword [mp3_nb_granules], 1
   597 00000392 0000               
   598 00000394 A900001000                              test	eax, 100000h
   599 00000399 750A                                    jnz	short .lsf_this
   600 0000039B C705[A8C20000]0100-                     mov	dword [mp3_hdr_flag_mpeg25], 1
   600 000003A3 0000               
   601                                  
   602                                  .lsf_this:
   603 000003A5 C1E80A                                  shr     eax, 10
   604 000003A8 83E003                                  and     eax, 3
   605 000003AB 8B0D[D4C20000]                          mov     ecx, [mp3_hdr_flag_lsf]
   606 000003B1 030D[A8C20000]                          add     ecx, [mp3_hdr_flag_mpeg25]
   607 000003B7 0FB79400[A09C0000]                      movzx   edx, word [mp3_freq_tab+eax*2]
   608 000003BF D3EA                                    shr     edx, cl
   609 000003C1 8D0C49                                  lea     ecx, [ecx+ecx*2]
   610 000003C4 01C8                                    add     eax, ecx
   611 000003C6 A3[B4C20000]                            mov     [mp3_hdr_sample_rate_index], eax
   612 000003CB 8915[B0C20000]                          mov     [mp3_sample_rate], edx
   613                                  
   614                                  		; 15/02/2025
   615 000003D1 A1[A0C20000]                            mov     eax, [mp3_hdr_32bit_header]
   616 000003D6 C1E810                                  shr     eax, 10h
   617 000003D9 F7D0                                    not     eax
   618 000003DB 83E001                                  and     eax, 1
   619 000003DE A3[A4C20000]                            mov     [mp3_hdr_flag_crc], eax
   620 000003E3 A1[A0C20000]                            mov     eax, [mp3_hdr_32bit_header]
   621 000003E8 C1E809                                  shr     eax, 9
   622 000003EB 83E001                                  and     eax, 1
   623 000003EE A3[ACC20000]                            mov     [mp3_hdr_flag_padding], eax
   624 000003F3 A1[A0C20000]                            mov     eax, [mp3_hdr_32bit_header]
   625 000003F8 C1E80C                                  shr     eax, 12
   626 000003FB 83E00F                                  and     eax, 0Fh
   627 000003FE 7512                                    jnz     short .not_free_format
   628 00000400 E8DE380000                              call    mp3_detect_free_format_block_size
   629 00000405 0F822BFFFFFF                            jb      .bad_header
   630 0000040B A1[E0180100]                            mov     eax, [mp3_free_format_frame_size]
   631 00000410 EB34                                    jmp     short .this_frame_size_plus_padding
   632                                  
   633                                  .not_free_format:
   634 00000412 8B15[D4C20000]                          mov     edx, [mp3_hdr_flag_lsf]
   635 00000418 C1E204                                  shl     edx, 4
   636 0000041B 01D0                                    add     eax, edx
   637 0000041D 0FB78400[609C0000]                      movzx   eax, word [mp3_bitrate_tab+eax*2] ; kbit/s
   638 00000425 69C0E8030000                            imul    eax, 1000       ; bit/s
   639 0000042B A3[B8C20000]                            mov     [mp3_bit_rate], eax
   640 00000430 69C090000000                            imul    eax, 144        ; 144=90h=8*18
   641 00000436 31D2                                    xor     edx, edx
   642 00000438 F735[B0C20000]                          div     dword [mp3_sample_rate]
   643 0000043E 8B0D[D4C20000]                          mov     ecx, [mp3_hdr_flag_lsf]
   644 00000444 D3E8                                    shr     eax, cl
   645                                  
   646                                  .this_frame_size_plus_padding:
   647 00000446 0305[ACC20000]                          add     eax, [mp3_hdr_flag_padding]
   648 0000044C A3[98C20000]                            mov     [mp3_src_frame_size], eax
   649 00000451 01F0                                    add     eax, esi
   650 00000453 A3[9CC20000]                            mov     [mp3_src_frame_end], eax
   651 00000458 A1[A0C20000]                            mov     eax, [mp3_hdr_32bit_header]
   652 0000045D C1E806                                  shr     eax, 6
   653 00000460 83E003                                  and     eax, 3
   654 00000463 A3[CCC20000]                            mov     [mp3_hdr_mode_val], eax
   655 00000468 BA01000000                              mov     edx, 1
   656                                  
   657 0000046D 3C03                    		cmp     al, 3
   658 0000046F 7401                                    jz      short .this_channels
   659                                  
   660                                                  ;mov    edx, 2
   661                                  		; 10/01/2025
   662 00000471 42                      		inc	edx
   663                                  .this_channels:
   664 00000472 8915[BCC20000]                          mov	[mp3_num_channels], edx
   665                                   		
   666                                  		; 15/02/2025
   667                                  .allow_stereo:
   668                                  		;imul	edx, [mp3_bytes_per_sample]
   669                                                  ; 17/02/2025
   670 00000478 D1E2                    		shl	edx, 1 ; [mp3_bytes_per_sample] = 2 
   671 0000047A 8915[78190100]          		mov     [mp3_samples_dst_step], edx
   672 00000480 A1[A0C20000]                            mov     eax, [mp3_hdr_32bit_header]
   673 00000485 C1E804                                  shr     eax, 4
   674 00000488 83E003                                  and     eax, 3
   675 0000048B A3[D0C20000]                            mov     [mp3_hdr_mode_ext], eax
   676                                  		; 16/02/2025
   677                                  .no_rdtsc_supported@:
   678                                  		;clc
   679 00000490 C3                                      retn
   680                                  
   681                                  .fail_no_header:
   682                                  		; 16/02/2025
   683                                  .no_rdtsc_supported@@:
   684 00000491 C705[98C20000]0000-                     mov     dword [mp3_src_frame_size], 0
   684 00000499 0000               
   685 0000049B F9                                      stc
   686 0000049C C3                                      retn
   687                                  
   688                                  
   689                                  ; =============== S U B R O U T I N E =======================================
   690                                  
   691                                  
   692                                  mp3_bitstream_read_header_extra:
   693                                                  ; 16/02/2025
   694                                  
   695                                  .no_rdtsc_supported:
   696 0000049D 833D[A4C20000]00                        cmp     dword [mp3_hdr_flag_crc], 0
   697 000004A4 7422                                    jz      short .without_crc
   698 000004A6 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 16
   699 000004A8 C1E510                                  shl     ebp, 10h
   700 000004AB C1C010                                  rol     eax, 10h
   701 000004AE 31E8                                    xor     eax, ebp
   702 000004B0 80ED10                                  sub     ch, 10h
   703 000004B3 7913                                    jns     short .without_crc
   704 000004B5 88E9                                    mov     cl, ch          ; mp3mac_collect_more
   705 000004B7 80C510                                  add     ch, 10h
   706 000004BA D3C5                                    rol     ebp, cl
   707 000004BC 668B2E                                  mov     bp, [esi]
   708 000004BF 83C602                                  add     esi, 2
   709 000004C2 66C1CD08                                ror     bp, 8
   710 000004C6 D3CD                                    ror     ebp, cl
   711                                  
   712                                  .without_crc:
   713 000004C8 833D[D4C20000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
   714 000004CF 745B                                    jz      short .pre_lsf_zero
   715 000004D1 C705[98190100]0900-                     mov     dword [mp3_num_compress_bits], 9
   715 000004D9 0000               
   716 000004DB 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 8
   717 000004DD C1E508                                  shl     ebp, 8
   718 000004E0 C1C008                                  rol     eax, 8
   719 000004E3 31E8                                    xor     eax, ebp
   720 000004E5 80ED08                                  sub     ch, 8
   721 000004E8 7913                                    jns     short .without_crc@
   722 000004EA 88E9                                    mov     cl, ch
   723 000004EC 80C510                                  add     ch, 10h
   724 000004EF D3C5                                    rol     ebp, cl
   725 000004F1 668B2E                                  mov     bp, [esi]
   726 000004F4 83C602                                  add     esi, 2
   727 000004F7 66C1CD08                                ror     bp, 8
   728 000004FB D3CD                                    ror     ebp, cl
   729                                  
   730                                  .without_crc@:
   731 000004FD A3[94190100]                            mov     [mp3_main_data_begin], eax
   732 00000502 8A0D[BCC20000]                          mov     cl, byte [mp3_num_channels]
   733 00000508 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
   734 0000050A D3E5                                    shl     ebp, cl
   735 0000050C D3C0                                    rol     eax, cl
   736 0000050E 31E8                                    xor     eax, ebp
   737 00000510 28CD                                    sub     ch, cl
   738 00000512 7913                                    jns     short .without_crc@@
   739 00000514 88E9                                    mov     cl, ch
   740 00000516 80C510                                  add     ch, 10h
   741 00000519 D3C5                                    rol     ebp, cl
   742 0000051B 668B2E                                  mov     bp, [esi]
   743 0000051E 83C602                                  add     esi, 2
   744 00000521 66C1CD08                                ror     bp, 8
   745 00000525 D3CD                                    ror     ebp, cl
   746                                  
   747                                  .without_crc@@:
   748 00000527 E9A1000000                              jmp     .pre_lsf_done
   749                                  
   750                                  .pre_lsf_zero:
   751 0000052C C705[98190100]0400-                     mov     dword [mp3_num_compress_bits], 4
   751 00000534 0000               
   752 00000536 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 9
   753 00000538 C1E509                                  shl     ebp, 9
   754 0000053B C1C009                                  rol     eax, 9
   755 0000053E 31E8                                    xor     eax, ebp
   756 00000540 80ED09                                  sub     ch, 9
   757 00000543 7913                                    jns     short .without_crc@@@
   758 00000545 88E9                                    mov     cl, ch
   759 00000547 80C510                                  add     ch, 10h
   760 0000054A D3C5                                    rol     ebp, cl
   761 0000054C 668B2E                                  mov     bp, [esi]
   762 0000054F 83C602                                  add     esi, 2
   763 00000552 66C1CD08                                ror     bp, 8
   764 00000556 D3CD                                    ror     ebp, cl
   765                                  
   766                                  .without_crc@@@:
   767 00000558 A3[94190100]                            mov     [mp3_main_data_begin], eax
   768 0000055D 8A0D[BCC20000]                          mov     cl, byte [mp3_num_channels]
   769 00000563 D0E1                                    shl     cl, 1           ; 1,2 --> 2,4
   770 00000565 80F107                                  xor     cl, 7           ;     --> 5,3
   771 00000568 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
   772 0000056A D3E5                                    shl     ebp, cl
   773 0000056C D3C0                                    rol     eax, cl
   774 0000056E 31E8                                    xor     eax, ebp
   775 00000570 28CD                                    sub     ch, cl
   776 00000572 7913                                    jns     short .without_crc@@@@
   777 00000574 88E9                                    mov     cl, ch
   778 00000576 80C510                                  add     ch, 10h
   779 00000579 D3C5                                    rol     ebp, cl
   780 0000057B 668B2E                                  mov     bp, [esi]
   781 0000057E 83C602                                  add     esi, 2
   782 00000581 66C1CD08                                ror     bp, 8
   783 00000585 D3CD                                    ror     ebp, cl
   784                                  
   785                                  .without_crc@@@@:
   786 00000587 8B15[BCC20000]                          mov     edx, [mp3_num_channels]
   787 0000058D BB[A0190100]                            mov     ebx, mp3_granules
   788                                  
   789                                  .pre_channel_lop:
   790 00000592 C7432800000000                          mov     dword [ebx+40], 0 ; [ebx+$mp3gr_scfsi]
   791 00000599 81C3A0090000                            add     ebx, 2464       ; $mp3gr_entrysiz
   792 0000059F 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 4
   793 000005A1 C1E504                                  shl     ebp, 4
   794 000005A4 C1C004                                  rol     eax, 4
   795 000005A7 31E8                                    xor     eax, ebp
   796 000005A9 80ED04                                  sub     ch, 4
   797 000005AC 7913                                    jns     short .without_crc@@@@@
   798 000005AE 88E9                                    mov     cl, ch
   799 000005B0 80C510                                  add     ch, 10h
   800 000005B3 D3C5                                    rol     ebp, cl
   801 000005B5 668B2E                                  mov     bp, [esi]
   802 000005B8 83C602                                  add     esi, 2
   803 000005BB 66C1CD08                                ror     bp, 8
   804 000005BF D3CD                                    ror     ebp, cl
   805                                  
   806                                  .without_crc@@@@@:
   807 000005C1 894328                                  mov     [ebx+28h], eax  ; [ebx+$mp3gr_scfsi]
   808 000005C4 81C3A0090000                            add     ebx, 2464       ; $mp3gr_entrysiz
   809 000005CA 4A                                      dec     edx
   810 000005CB 75C5                                    jnz     short .pre_channel_lop
   811                                  
   812                                  .pre_lsf_done:
   813 000005CD A1[9C190100]            		mov     eax, [mp3_nb_granules]
   814 000005D2 6BC012                  		imul    eax, 12h
   815 000005D5 A3[C8C20000]            		mov     [mp3_nb_frames], eax
   816                                  		; 14/01/2025
   817                                  		;mov	eax, [mp3_nb_frames]
   818                                  		; 16/02/2025
   819 000005DA 0FAF05[BCC20000]        		imul    eax, [mp3_num_channels]
   820                                  		;imul   eax, [mp3_bytes_per_sample]
   821                                  		;shl    eax, 5
   822                                  		; 17/02/2025
   823                                  		; [mp3_bytes_per_sample] = 2
   824 000005E1 C1E006                  		shl	eax, 6 ; (eax*2) << 5
   825                                     		; 15/02/2025
   826 000005E4 A3[74190100]            		mov	[mp3_samples_output_size], eax
   827                                  		
   828                                  		; 16/02/2025
   829                                  
   830                                  .no_rdtsc_supported@:
   831 000005E9 C3                                      retn
   832                                  
   833                                  
   834                                  ; =============== S U B R O U T I N E =======================================
   835                                  
   836                                  
   837                                  mp3_bitstream_read_granules:
   838                                  		; 16/02/2025
   839                                  
   840                                  .no_rdtsc_supported:
   841 000005EA 8925[94440500]                          mov	[_@@saved_sp], esp
   842 000005F0 C705[98440500]0000-                     mov	dword [mp3_main_data_siz], 0
   842 000005F8 0000               
   843 000005FA C705[80190100]0000-                     mov	dword [mp3_curr_granule], 0
   843 00000602 0000               
   844 00000604 BB[A0190100]                            mov	ebx, mp3_granules
   845                                  
   846                                  .hdr_granule_lop:
   847 00000609 53                                      push    ebx
   848 0000060A C705[7C190100]0000-                     mov     dword [mp3_curr_channel], 0
   848 00000612 0000               
   849                                  
   850                                  .hdr_channel_lop:
   851 00000614 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 12
   852 00000616 C1E50C                                  shl     ebp, 12
   853 00000619 C1C00C                                  rol     eax, 12
   854 0000061C 31E8                                    xor     eax, ebp
   855 0000061E 80ED0C                                  sub     ch, 12
   856 00000621 7913                                    jns     short .without_crc
   857 00000623 88E9                                    mov     cl, ch
   858 00000625 80C510                                  add     ch, 16
   859 00000628 D3C5                                    rol     ebp, cl
   860 0000062A 668B2E                                  mov     bp, [esi]
   861 0000062D 83C602                                  add     esi, 2
   862 00000630 66C1CD08                                ror     bp, 8
   863 00000634 D3CD                                    ror     ebp, cl
   864                                  
   865                                  .without_crc:
   866 00000636 8B15[98440500]                          mov     edx, [mp3_main_data_siz]
   867 0000063C 8903                                    mov     [ebx], eax
   868 0000063E 895304                                  mov     [ebx+4], edx
   869 00000641 01D0                                    add     eax, edx
   870 00000643 894308                                  mov     [ebx+8], eax
   871 00000646 A3[98440500]                            mov     [mp3_main_data_siz], eax
   872 0000064B 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 9
   873 0000064D C1E509                                  shl     ebp, 9
   874 00000650 C1C009                                  rol     eax, 9
   875 00000653 31E8                                    xor     eax, ebp
   876 00000655 80ED09                                  sub     ch, 9
   877 00000658 7913                                    jns     short .without_crc@
   878 0000065A 88E9                                    mov     cl, ch
   879 0000065C 80C510                                  add     ch, 10h
   880 0000065F D3C5                                    rol     ebp, cl
   881 00000661 668B2E                                  mov     bp, [esi]
   882 00000664 83C602                                  add     esi, 2
   883 00000667 66C1CD08                                ror     bp, 8
   884 0000066B D3CD                                    ror     ebp, cl
   885                                  
   886                                  .without_crc@:
   887 0000066D 89430C                                  mov     [ebx+12], eax   ; [ebx+$mp3gr_big_values]
   888 00000670 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 8
   889 00000672 C1E508                                  shl     ebp, 8
   890 00000675 C1C008                                  rol     eax, 8
   891 00000678 31E8                                    xor     eax, ebp
   892 0000067A 80ED08                                  sub     ch, 8
   893 0000067D 7913                                    jns     short .without_crc@@
   894 0000067F 88E9                                    mov     cl, ch
   895 00000681 80C510                                  add     ch, 10h
   896 00000684 D3C5                                    rol     ebp, cl
   897 00000686 668B2E                                  mov     bp, [esi]
   898 00000689 83C602                                  add     esi, 2
   899 0000068C 66C1CD08                                ror     bp, 8
   900 00000690 D3CD                                    ror     ebp, cl
   901                                  
   902                                  .without_crc@@:
   903 00000692 05BE000000                              add	eax, 190        ; 400-210
   904 00000697 833D[CCC20000]01                        cmp	dword [mp3_hdr_mode_val], 1
   905 0000069E 750F                                    jnz	short .not_ms_stereo
   906 000006A0 F705[D0C20000]0200-                     test	dword [mp3_hdr_mode_ext], 2
   906 000006A8 0000               
   907 000006AA 7403                                    jz	short .not_ms_stereo
   908 000006AC 83E802                                  sub	eax, 2
   909                                  
   910                                  .not_ms_stereo:
   911 000006AF 894310                                  mov     [ebx+16], eax   ; [ebx+$mp3gr_global_gain]
   912 000006B2 8A0D[98190100]                          mov     cl, byte [mp3_num_compress_bits]
   913 000006B8 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
   914 000006BA D3E5                                    shl     ebp, cl
   915 000006BC D3C0                                    rol     eax, cl
   916 000006BE 31E8                                    xor     eax, ebp
   917 000006C0 28CD                                    sub     ch, cl
   918 000006C2 7913                                    jns     short .without_crc@@@
   919 000006C4 88E9                                    mov     cl, ch
   920 000006C6 80C510                                  add     ch, 10h
   921 000006C9 D3C5                                    rol     ebp, cl
   922 000006CB 668B2E                                  mov     bp, [esi]
   923 000006CE 83C602                                  add     esi, 2
   924 000006D1 66C1CD08                                ror     bp, 8
   925 000006D5 D3CD                                    ror     ebp, cl
   926                                  
   927                                  .without_crc@@@:
   928 000006D7 894314                                  mov     [ebx+20], eax   ; [ebx+$mp3gr_scalefac_compress]
   929 000006DA FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
   930                                                                          ; dec mp3_colNN
   931 000006DC D1E5                                    shl     ebp, 1          ; shl mp3_col32,1 ; cy=data
   932 000006DE 0F834F010000                            jnb     .no_blocksplit
   933 000006E4 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 2
   934 000006E6 C1E502                                  shl     ebp, 2
   935 000006E9 C1C002                                  rol     eax, 2
   936 000006EC 31E8                                    xor     eax, ebp
   937 000006EE 80ED02                                  sub     ch, 2
   938 000006F1 7913                                    jns     short .without_crc@@@@
   939 000006F3 88E9                                    mov     cl, ch
   940 000006F5 80C510                                  add     ch, 10h
   941 000006F8 D3C5                                    rol     ebp, cl
   942 000006FA 668B2E                                  mov     bp, [esi]
   943 000006FD 83C602                                  add     esi, 2
   944 00000700 66C1CD08                                ror     bp, 8
   945 00000704 D3CD                                    ror     ebp, cl
   946                                  
   947                                  .without_crc@@@@:
   948 00000706 83F800                                  cmp     eax, 0
   949 00000709 0F8463030000                            jz      .error
   950 0000070F 89432C                                  mov     [ebx+44], eax   ; [ebx+$mp3gr_block_type]
   951 00000712 83F802                                  cmp     eax, 2
   952 00000715 B812000000                              mov     eax, 18         ; 36/2 ; region_size (default)
   953 0000071A 741C                                    jz      short .this_region_size
   954 0000071C 833D[B4C20000]02                        cmp     dword [mp3_hdr_sample_rate_index], 2
   955 00000723 7613                                    jbe     short .this_region_size
   956 00000725 B81B000000                              mov     eax, 27         ; 54/2 ; region_size
   957 0000072A 833D[B4C20000]08                        cmp     dword [mp3_hdr_sample_rate_index], 8
   958 00000731 7505                                    jnz     short .this_region_size
   959 00000733 B836000000                              mov     eax, 54         ; 108/2 ; region_size (for rate=8)
   960                                  
   961                                  .this_region_size:
   962 00000738 894350                                  mov     [ebx+80], eax   ; [ebx+$mp3gr_region_size+0*4]
   963 0000073B C7435420010000                          mov     dword [ebx+84], 288 ; [ebx+$mp3gr_region_size+1*4],576/2
   964 00000742 C7435820010000                          mov     dword [ebx+88], 288 ; [ebx+$mp3gr_region_size+2*4],576/2
   965 00000749 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
   966 0000074B D1E5                                    shl     ebp, 1
   967 0000074D D1C0                                    rol     eax, 1
   968 0000074F 31E8                                    xor     eax, ebp
   969 00000751 80ED01                                  sub     ch, 1
   970 00000754 7913                                    jns     short .without_crc@@@@@
   971 00000756 88E9                                    mov     cl, ch
   972 00000758 80C510                                  add     ch, 10h
   973 0000075B D3C5                                    rol     ebp, cl
   974 0000075D 668B2E                                  mov     bp, [esi]
   975 00000760 83C602                                  add     esi, 2
   976 00000763 66C1CD08                                ror     bp, 8
   977 00000767 D3CD                                    ror     ebp, cl
   978                                  
   979                                  .without_crc@@@@@:
   980 00000769 894330                                  mov     [ebx+48], eax   ; [ebx+$mp3gr_switch_point]
   981 0000076C 89E8                                    mov     eax, ebp        ; IRP nn,0,1 ; only 0..1 for blocksplit
   982 0000076E C1E505                                  shl     ebp, 5          ; mp3mac_get_n_bits 5
   983 00000771 C1C005                                  rol     eax, 5
   984 00000774 31E8                                    xor     eax, ebp
   985 00000776 80ED05                                  sub     ch, 5
   986 00000779 7913                                    jns     short .without_crc@@@@@@
   987 0000077B 88E9                                    mov     cl, ch
   988 0000077D 80C510                                  add     ch, 10h
   989 00000780 D3C5                                    rol     ebp, cl
   990 00000782 668B2E                                  mov     bp, [esi]
   991 00000785 83C602                                  add     esi, 2
   992 00000788 66C1CD08                                ror     bp, 8
   993 0000078C D3CD                                    ror     ebp, cl
   994                                  
   995                                  .without_crc@@@@@@:
   996 0000078E 894338                                  mov     [ebx+56], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=0
   997 00000791 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 5
   998 00000793 C1E505                                  shl     ebp, 5
   999 00000796 C1C005                                  rol     eax, 5
  1000 00000799 31E8                                    xor     eax, ebp
  1001 0000079B 80ED05                                  sub     ch, 5
  1002 0000079E 7913                                    jns     short .without_crc_@@@@
  1003 000007A0 88E9                                    mov     cl, ch
  1004 000007A2 80C510                                  add     ch, 10h
  1005 000007A5 D3C5                                    rol     ebp, cl
  1006 000007A7 668B2E                                  mov     bp, [esi]
  1007 000007AA 83C602                                  add     esi, 2
  1008 000007AD 66C1CD08                                ror     bp, 8
  1009 000007B1 D3CD                                    ror     ebp, cl
  1010                                  
  1011                                  .without_crc_@@@@:
  1012 000007B3 89433C                                  mov     [ebx+60], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=1
  1013 000007B6 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 5
  1014 000007B8 C1E503                                  shl     ebp, 3          ; IRP nn,0,1,2
  1015 000007BB C1C003                                  rol     eax, 3          ; mp3mac_get_n_bits 3
  1016 000007BE 31E8                                    xor     eax, ebp
  1017 000007C0 80ED03                                  sub     ch, 3
  1018 000007C3 7913                                    jns     short .without_crc_@@@@@
  1019 000007C5 88E9                                    mov     cl, ch
  1020 000007C7 80C510                                  add     ch, 10h
  1021 000007CA D3C5                                    rol     ebp, cl
  1022 000007CC 668B2E                                  mov     bp, [esi]
  1023 000007CF 83C602                                  add     esi, 2
  1024 000007D2 66C1CD08                                ror     bp, 8
  1025 000007D6 D3CD                                    ror     ebp, cl
  1026                                  
  1027                                  .without_crc_@@@@@:
  1028 000007D8 C1E003                                  shl     eax, 3
  1029 000007DB 894344                                  mov     [ebx+68], eax   ; [ebx+$mp3gr_subblock_gain+nn*4] ; nn=0
  1030 000007DE 89E8                                    mov     eax, ebp
  1031 000007E0 C1E503                                  shl     ebp, 3
  1032 000007E3 C1C003                                  rol     eax, 3
  1033 000007E6 31E8                                    xor     eax, ebp
  1034 000007E8 80ED03                                  sub     ch, 3
  1035 000007EB 7913                                    jns     short .without_crc_@@@@@@
  1036 000007ED 88E9                                    mov     cl, ch
  1037 000007EF 80C510                                  add     ch, 10h
  1038 000007F2 D3C5                                    rol     ebp, cl
  1039 000007F4 668B2E                                  mov     bp, [esi]
  1040 000007F7 83C602                                  add     esi, 2
  1041 000007FA 66C1CD08                                ror     bp, 8
  1042 000007FE D3CD                                    ror     ebp, cl
  1043                                  
  1044                                  .without_crc_@@@@@@:
  1045 00000800 C1E003                                  shl     eax, 3
  1046 00000803 894348                                  mov     [ebx+72], eax   ; [ebx+$mp3gr_subblock_gain+nn*4] ; nn=1
  1047 00000806 89E8                                    mov     eax, ebp
  1048 00000808 C1E503                                  shl     ebp, 3
  1049 0000080B C1C003                                  rol     eax, 3
  1050 0000080E 31E8                                    xor     eax, ebp
  1051 00000810 80ED03                                  sub     ch, 3
  1052 00000813 7913                                    jns     short .without_crc_@@@@@@@
  1053 00000815 88E9                                    mov     cl, ch
  1054 00000817 80C510                                  add     ch, 10h
  1055 0000081A D3C5                                    rol     ebp, cl
  1056 0000081C 668B2E                                  mov     bp, [esi]
  1057 0000081F 83C602                                  add     esi, 2
  1058 00000822 66C1CD08                                ror     bp, 8
  1059 00000826 D3CD                                    ror     ebp, cl
  1060                                  
  1061                                  .without_crc_@@@@@@@:
  1062 00000828 C1E003                                  shl     eax, 3
  1063 0000082B 89434C                                  mov     [ebx+76], eax   ; [ebx+$mp3gr_subblock_gain+nn*4] ; nn=2
  1064 0000082E E910010000                              jmp     .blocksplit_done
  1065                                  
  1066                                  .no_blocksplit:                       
  1067 00000833 C7432C00000000                          mov     dword [ebx+44], 0 ; [ebx+$mp3gr_block_type]
  1068 0000083A C7433000000000                          mov     dword [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
  1069 00000841 89E8                                    mov     eax, ebp        ; IRP nn,0,1,2 ; range 0..2 when non-blocksplit
  1070 00000843 C1E505                                  shl     ebp, 5          ; mp3mac_get_n_bits 5
  1071 00000846 C1C005                                  rol     eax, 5
  1072 00000849 31E8                                    xor     eax, ebp
  1073 0000084B 80ED05                                  sub     ch, 5
  1074 0000084E 7913                                    jns     short .@_without_crc
  1075 00000850 88E9                                    mov     cl, ch
  1076 00000852 80C510                                  add     ch, 10h
  1077 00000855 D3C5                                    rol     ebp, cl
  1078 00000857 668B2E                                  mov     bp, [esi]
  1079 0000085A 83C602                                  add     esi, 2
  1080 0000085D 66C1CD08                                ror     bp, 8
  1081 00000861 D3CD                                    ror     ebp, cl
  1082                                  
  1083                                  .@_without_crc:
  1084 00000863 894338                                  mov     [ebx+56], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=0
  1085 00000866 89E8                                    mov     eax, ebp
  1086 00000868 C1E505                                  shl     ebp, 5
  1087 0000086B C1C005                                  rol     eax, 5
  1088 0000086E 31E8                                    xor     eax, ebp
  1089 00000870 80ED05                                  sub     ch, 5
  1090 00000873 7913                                    jns     short .@_without_crc_@
  1091 00000875 88E9                                    mov     cl, ch
  1092 00000877 80C510                                  add     ch, 10h
  1093 0000087A D3C5                                    rol     ebp, cl
  1094 0000087C 668B2E                                  mov     bp, [esi]
  1095 0000087F 83C602                                  add     esi, 2
  1096 00000882 66C1CD08                                ror     bp, 8
  1097 00000886 D3CD                                    ror     ebp, cl
  1098                                  
  1099                                  .@_without_crc_@:
  1100 00000888 89433C                                  mov     [ebx+60], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=1
  1101 0000088B 89E8                                    mov     eax, ebp
  1102 0000088D C1E505                                  shl     ebp, 5
  1103 00000890 C1C005                                  rol     eax, 5
  1104 00000893 31E8                                    xor     eax, ebp
  1105 00000895 80ED05                                  sub     ch, 5
  1106 00000898 7913                                    jns     short .@_without_crc_@@
  1107 0000089A 88E9                                    mov     cl, ch
  1108 0000089C 80C510                                  add     ch, 10h
  1109 0000089F D3C5                                    rol     ebp, cl
  1110 000008A1 668B2E                                  mov     bp, [esi]
  1111 000008A4 83C602                                  add     esi, 2
  1112 000008A7 66C1CD08                                ror     bp, 8
  1113 000008AB D3CD                                    ror     ebp, cl
  1114                                  
  1115                                  .@_without_crc_@@:
  1116 000008AD 894340                                  mov     [ebx+64], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=2
  1117 000008B0 89E8                                    mov     eax, ebp
  1118 000008B2 C1E504                                  shl     ebp, 4
  1119 000008B5 C1C004                                  rol     eax, 4
  1120 000008B8 31E8                                    xor     eax, ebp
  1121 000008BA 80ED04                                  sub     ch, 4
  1122 000008BD 7913                                    jns     short .@_without_crc@@@
  1123 000008BF 88E9                                    mov     cl, ch
  1124 000008C1 80C510                                  add     ch, 10h
  1125 000008C4 D3C5                                    rol     ebp, cl
  1126 000008C6 668B2E                                  mov     bp, [esi]
  1127 000008C9 83C602                                  add     esi, 2
  1128 000008CC 66C1CD08                                ror     bp, 8
  1129 000008D0 D3CD                                    ror     ebp, cl
  1130                                  
  1131                                  .@_without_crc@@@:
  1132 000008D2 40                                      inc     eax
  1133 000008D3 A3[8C440500]                            mov     [_@@region_address0], eax
  1134 000008D8 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 3
  1135 000008DA C1E503                                  shl     ebp, 3
  1136 000008DD C1C003                                  rol     eax, 3
  1137 000008E0 31E8                                    xor     eax, ebp
  1138 000008E2 80ED03                                  sub     ch, 3
  1139 000008E5 7913                                    jns     short .@_without_crc@@@@
  1140 000008E7 88E9                                    mov     cl, ch
  1141 000008E9 80C510                                  add     ch, 10h
  1142 000008EC D3C5                                    rol     ebp, cl
  1143 000008EE 668B2E                                  mov     bp, [esi]
  1144 000008F1 83C602                                  add     esi, 2
  1145 000008F4 66C1CD08                                ror     bp, 8
  1146 000008F8 D3CD                                    ror     ebp, cl
  1147                                  
  1148                                  .@_without_crc@@@@:
  1149 000008FA 40                                      inc     eax
  1150 000008FB 0305[8C440500]                          add     eax, [_@@region_address0]
  1151 00000901 A3[90440500]                            mov     [_@@region_address1], eax
  1152 00000906 A1[B4C20000]                            mov     eax, [mp3_hdr_sample_rate_index]
  1153 0000090B C1E005                                  shl     eax, 5
  1154 0000090E 0305[8C440500]                          add     eax, [_@@region_address0]
  1155 00000914 0FB78400[A0FC0100]                      movzx   eax, word [mp3_band_index_long+eax*2]
  1156 0000091C D1E8                                    shr     eax, 1
  1157 0000091E 894350                                  mov     [ebx+80], eax   ; [ebx+$mp3gr_region_size+0*4]
  1158 00000921 A1[B4C20000]                            mov     eax, [mp3_hdr_sample_rate_index]
  1159 00000926 C1E005                                  shl     eax, 5
  1160 00000929 0305[90440500]                          add     eax, [_@@region_address1]
  1161 0000092F 0FB78400[A0FC0100]                      movzx   eax, word [mp3_band_index_long+eax*2]
  1162 00000937 D1E8                                    shr     eax, 1
  1163 00000939 894354                                  mov     [ebx+84], eax   ; [ebx+$mp3gr_region_size+1*4]
  1164 0000093C C7435820010000                          mov     dword [ebx+88], 288 ; [ebx+$mp3gr_region_size+2*4],576/2
  1165                                  
  1166                                  .blocksplit_done:
  1167 00000943 8D7B50                                  lea     edi, [ebx+80]   ; [ebx+$mp3gr_region_size+0]
  1168 00000946 31D2                                    xor     edx, edx
  1169 00000948 B103                                    mov     cl, 3
  1170                                  
  1171                                  .trunc_region_size_lop:
  1172 0000094A 8B07                                    mov     eax, [edi]
  1173 0000094C 3B430C                                  cmp     eax, [ebx+12]   ; [ebx+$mp3gr_big_values]
  1174 0000094F 7603                                    jbe     short .trunc_region_size_this
  1175 00000951 8B430C                                  mov     eax, [ebx+12]
  1176                                  
  1177                                  .trunc_region_size_this:
  1178 00000954 29D0                                    sub     eax, edx
  1179 00000956 8907                                    mov     [edi], eax
  1180 00000958 01C2                                    add     edx, eax
  1181 0000095A 83C704                                  add     edi, 4
  1182 0000095D FEC9                                    dec     cl
  1183 0000095F 75E9                                    jnz     short .trunc_region_size_lop
  1184 00000961 C7431C0D000000                          mov     dword [ebx+28], 13 ; [ebx+$mp3gr_short_start]
  1185 00000968 C7432016000000                          mov     dword [ebx+32], 22 ; [ebx+$mp3gr_long_end]
  1186 0000096F 837B2C02                                cmp     dword [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  1187 00000973 7549                                    jnz     short .these_band_indices
  1188 00000975 C7431C00000000                          mov     dword [ebx+28], 0 ; [ebx+$mp3gr_short_start]
  1189 0000097C C7432000000000                          mov     dword [ebx+32], 0 ; [ebx+$mp3gr_long_end]
  1190 00000983 837B3000                                cmp     dword [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
  1191 00000987 7435                                    jz      short .these_band_indices
  1192 00000989 C7431C02000000                          mov     dword [ebx+28], 2 ; [ebx+$mp3gr_short_start]
  1193 00000990 C7432004000000                          mov     dword [ebx+32], 4 ; [ebx+$mp3gr_long_end]
  1194 00000997 833D[B4C20000]08                        cmp     dword [mp3_hdr_sample_rate_index], 8
  1195 0000099E 741E                                    jz      short .these_band_indices
  1196 000009A0 833D[B4C20000]02                        cmp     dword [mp3_hdr_sample_rate_index], 2
  1197 000009A7 C7431C03000000                          mov     dword [ebx+28], 3 ; [ebx+$mp3gr_short_start]
  1198 000009AE C7432008000000                          mov     dword [ebx+32], 8 ; [ebx+$mp3gr_long_end]
  1199 000009B5 7607                                    jbe     short .these_band_indices
  1200 000009B7 C7432006000000                          mov     dword [ebx+32], 6 ; [ebx+$mp3gr_long_end]
  1201                                  
  1202                                  .these_band_indices:
  1203 000009BE 31C0                                    xor     eax, eax
  1204 000009C0 833D[D4C20000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
  1205 000009C7 7520                                    jnz     short .no_preflag
  1206 000009C9 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
  1207 000009CB D1E5                                    shl     ebp, 1
  1208 000009CD D1C0                                    rol     eax, 1
  1209 000009CF 31E8                                    xor     eax, ebp
  1210 000009D1 80ED01                                  sub     ch, 1
  1211 000009D4 7913                                    jns     short .no_preflag
  1212 000009D6 88E9                                    mov     cl, ch
  1213 000009D8 80C510                                  add     ch, 10h
  1214 000009DB D3C5                                    rol     ebp, cl
  1215 000009DD 668B2E                                  mov     bp, [esi]
  1216 000009E0 83C602                                  add     esi, 2
  1217 000009E3 66C1CD08                                ror     bp, 8
  1218 000009E7 D3CD                                    ror     ebp, cl
  1219                                  
  1220                                  .no_preflag:
  1221 000009E9 894318                                  mov     [ebx+24], eax   ; [ebx+$mp3gr_preflag]
  1222 000009EC 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
  1223 000009EE D1E5                                    shl     ebp, 1
  1224 000009F0 D1C0                                    rol     eax, 1
  1225 000009F2 31E8                                    xor     eax, ebp
  1226 000009F4 80ED01                                  sub     ch, 1
  1227 000009F7 7913                                    jns     short .@_without_crc@@@@@
  1228 000009F9 88E9                                    mov     cl, ch
  1229 000009FB 80C510                                  add     ch, 10h
  1230 000009FE D3C5                                    rol     ebp, cl
  1231 00000A00 668B2E                                  mov     bp, [esi]
  1232 00000A03 83C602                                  add     esi, 2
  1233 00000A06 66C1CD08                                ror     bp, 8
  1234 00000A0A D3CD                                    ror     ebp, cl
  1235                                  
  1236                                  .@_without_crc@@@@@:
  1237 00000A0C 40                                      inc     eax
  1238 00000A0D 894334                                  mov     [ebx+52], eax   ; [ebx+$mp3gr_scalefac_scale]
  1239 00000A10 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
  1240 00000A12 D1E5                                    shl     ebp, 1
  1241 00000A14 D1C0                                    rol     eax, 1
  1242 00000A16 31E8                                    xor     eax, ebp
  1243 00000A18 80ED01                                  sub     ch, 1
  1244 00000A1B 7913                                    jns     short .@_without_crc@@@@@@
  1245 00000A1D 88E9                                    mov     cl, ch
  1246 00000A1F 80C510                                  add     ch, 10h
  1247 00000A22 D3C5                                    rol     ebp, cl
  1248 00000A24 668B2E                                  mov     bp, [esi]
  1249 00000A27 83C602                                  add     esi, 2
  1250 00000A2A 66C1CD08                                ror     bp, 8
  1251 00000A2E D3CD                                    ror     ebp, cl
  1252                                  
  1253                                  .@_without_crc@@@@@@: 
  1254 00000A30 83C010                                  add     eax, 10h        ; table 10h..11h (quad_vlc)
  1255 00000A33 894324                                  mov     [ebx+36], eax   ; [ebx+$mp3gr_count1table_select]
  1256 00000A36 81C340130000                            add     ebx, 4928       ; $mp3gr_entrysiz*2
  1257 00000A3C FF05[7C190100]                          inc     dword [mp3_curr_channel]
  1258 00000A42 A1[7C190100]                            mov     eax, [mp3_curr_channel]
  1259 00000A47 3B05[BCC20000]          		cmp     eax, [mp3_num_channels]
  1260 00000A4D 0F82C1FBFFFF                            jb      .hdr_channel_lop
  1261 00000A53 5B                                      pop     ebx
  1262 00000A54 81C3A0090000                            add     ebx, 2464       ; $mp3gr_entrysiz
  1263 00000A5A FF05[80190100]                          inc     dword [mp3_curr_granule]
  1264 00000A60 A1[80190100]                            mov     eax, [mp3_curr_granule]
  1265 00000A65 3B05[9C190100]                          cmp     eax, [mp3_nb_granules]
  1266 00000A6B 0F8298FBFFFF                            jb      .hdr_granule_lop
  1267                                  	
  1268                                  		; 16/02/2025
  1269                                  .no_rdtsc_supported@:
  1270                                                  ;clc
  1271 00000A71 C3                                      retn
  1272                                  
  1273                                  .error:
  1274                                  		; 16/02/2025
  1275                                  .no_rdtsc_supported@@:
  1276 00000A72 8B25[94440500]                          mov     esp, [_@@saved_sp]
  1277 00000A78 F9                                      stc
  1278 00000A79 C3                                      retn
  1279                                  
  1280                                  
  1281                                  ; =============== S U B R O U T I N E =======================================
  1282                                  
  1283                                  
  1284                                  mp3_bitstream_append_to_main_data_pool:
  1285                                                	; 16/02/2025
  1286                                  
  1287                                  .no_rdtsc_supported:
  1288 00000A7A 8B0D[9CC20000]                          mov     ecx, [mp3_src_frame_end]
  1289 00000A80 29F1                                    sub     ecx, esi
  1290 00000A82 0F8221020000                            jb      fatalunexpected
  1291 00000A88 8B3D[90C20000]                          mov     edi, [main_data_pool_wr_ptr]
  1292 00000A8E 8D040F                                  lea     eax, [edi+ecx]
  1293 00000A91 3D[90C20000]                            cmp     eax, main_data_pool_wr_ptr
  1294 00000A96 7616                                    jbe     short .pool_inrange
  1295 00000A98 51                                      push    ecx
  1296 00000A99 56                                      push    esi
  1297 00000A9A 8DB700FEFFFF                            lea     esi, [edi-200h]
  1298 00000AA0 BF[90B20000]                            mov     edi, main_data_pool_start
  1299 00000AA5 B980000000                              mov     ecx, 128
  1300 00000AAA F3A5                                    rep movsd
  1301 00000AAC 5E                                      pop     esi
  1302 00000AAD 59                                      pop     ecx
  1303                                  
  1304                                  .pool_inrange:
  1305 00000AAE 89F8                                    mov     eax, edi
  1306 00000AB0 2B05[94190100]                          sub     eax, [mp3_main_data_begin]
  1307 00000AB6 F3A4                                    rep movsb
  1308 00000AB8 893D[90C20000]                          mov     [main_data_pool_wr_ptr], edi
  1309 00000ABE 3D[90B20000]                            cmp     eax, main_data_pool_start
  1310 00000AC3 7811                                    js      short .below_pool_start
  1311 00000AC5 A3[88190100]                            mov     [mp3_bitstream_start], eax
  1312                                                  ; 22/10/2024
  1313                                  		;mov    eax, 0
  1314 00000ACA 8B35[88190100]                          mov     esi, [mp3_bitstream_start] ; mp3mac_bitstream_set_position
  1315                                                  ;mov    cl, al
  1316                                                  ;shr    eax, 3
  1317                                                  ;and    cl, 7
  1318                                                  ;add    esi, eax
  1319 00000AD0 E8D3F7FFFF                              call    mp3_recollect_bits
  1320                                                  ;mov    eax, ebp        ; mp3mac_get_n_bits cl
  1321                                                  ;shl    ebp, cl
  1322                                                  ;rol    eax, cl
  1323                                                  ;xor    eax, ebp
  1324                                                  ;sub    ch, cl
  1325                                                  ;jns    short .cont
  1326                                                  ;mov    cl, ch          ; mp3mac_collect_more
  1327                                                  ;add    ch, 10h
  1328                                                  ;rol    ebp, cl
  1329                                                  ;mov    bp, [esi]
  1330                                                  ;add    esi, 2
  1331                                                  ;ror    bp, 8
  1332                                                  ;ror    ebp, cl
  1333                                  
  1334                                  .cont:
  1335                                  		; 16/02/2025
  1336                                  		; clc ; not needed
  1337                                  
  1338                                  .no_rdtsc_supported@:
  1339 00000AD5 C3                                      retn
  1340                                  
  1341                                  .below_pool_start:
  1342 00000AD6 C705[74190100]0000-                     mov     dword [mp3_samples_output_size], 0
  1342 00000ADE 0000               
  1343 00000AE0 EBF3                                    jmp     short .cont
  1344                                  
  1345                                  
  1346                                  ; =============== S U B R O U T I N E =======================================
  1347                                  
  1348                                  
  1349                                  mp3_bitstream_read_scalefacs:
  1350                                  		; 16/02/2025
  1351                                  
  1352                                  .no_rdtsc_supported:
  1353 00000AE2 8D7B70                                  lea     edi, [ebx+112]  ; [ebx+$mp3gr_scale_factors]
  1354 00000AE5 833D[D4C20000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
  1355 00000AEC 0F850D010000                            jnz     .body_lsf_nonzero
  1356 00000AF2 8B4314                                  mov     eax, [ebx+20]   ; [ebx+$mp3gr_scalefac_compress]
  1357 00000AF5 668B9400[D89E0000]                      mov     dx, [mp3_slen_table+eax*2] ; slen[0,1]
  1358 00000AFD 837B2C02                                cmp     dword [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  1359 00000B01 757F                                    jnz     short .body_lsf_zero_non_type2
  1360 00000B03 53                                      push    ebx
  1361 00000B04 B012                                    mov     al, 18
  1362 00000B06 2A4330                                  sub     al, [ebx+48]    ; [ebx+$mp3gr_switch_point]
  1363 00000B09 88C3                                    mov     bl, al          ; @@get_bl_scalefacs_with_dl_bits 0
  1364 00000B0B 80FA00                                  cmp     dl, 0
  1365 00000B0E 7428                                    jz      short .quickfill
  1366                                  
  1367                                  .scalefac_get_lop:
  1368 00000B10 88D1                                    mov     cl, dl          ; LSB of edx, slen[i]
  1369 00000B12 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1370 00000B14 D3E5                                    shl     ebp, cl
  1371 00000B16 D3C0                                    rol     eax, cl
  1372 00000B18 31E8                                    xor     eax, ebp
  1373 00000B1A 28CD                                    sub     ch, cl
  1374 00000B1C 7913                                    jns     short .cont@
  1375 00000B1E 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1376 00000B20 80C510                                  add     ch, 10h
  1377 00000B23 D3C5                                    rol     ebp, cl
  1378 00000B25 668B2E                                  mov     bp, [esi]
  1379 00000B28 83C602                                  add     esi, 2
  1380 00000B2B 66C1CD08                                ror     bp, 8
  1381 00000B2F D3CD                                    ror     ebp, cl
  1382                                  
  1383                                  .cont@:
  1384 00000B31 AA                                      stosb
  1385 00000B32 FECB                                    dec     bl
  1386 00000B34 75DA                                    jnz     short .scalefac_get_lop
  1387 00000B36 EB09                                    jmp     short .skip_quickfill
  1388                                  
  1389                                  .quickfill:
  1390 00000B38 51                                      push    ecx
  1391 00000B39 0FB6CB                                  movzx   ecx, bl
  1392 00000B3C B000                                    mov     al, 0           ; NO_INTENSITY_FLAG
  1393 00000B3E F3AA                                    rep stosb
  1394 00000B40 59                                      pop     ecx
  1395                                  
  1396                                  .skip_quickfill:
  1397 00000B41 C1EA08                                  shr     edx, 8
  1398 00000B44 B312                                    mov     bl, 18
  1399 00000B46 80FA00                                  cmp     dl, 0           ; @@get_bl_scalefacs_with_dl_bits 0
  1400 00000B49 7428                                    jz      short .quickfill@
  1401                                  
  1402                                  .scalefac_get_lop@:
  1403 00000B4B 88D1                                    mov     cl, dl
  1404 00000B4D 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1405 00000B4F D3E5                                    shl     ebp, cl
  1406 00000B51 D3C0                                    rol     eax, cl
  1407 00000B53 31E8                                    xor     eax, ebp
  1408 00000B55 28CD                                    sub     ch, cl
  1409 00000B57 7913                                    jns     short .cont@@
  1410 00000B59 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1411 00000B5B 80C510                                  add     ch, 10h
  1412 00000B5E D3C5                                    rol     ebp, cl
  1413 00000B60 668B2E                                  mov     bp, [esi]
  1414 00000B63 83C602                                  add     esi, 2
  1415 00000B66 66C1CD08                                ror     bp, 8
  1416 00000B6A D3CD                                    ror     ebp, cl
  1417                                  
  1418                                  .cont@@:
  1419 00000B6C AA                                      stosb
  1420 00000B6D FECB                                    dec     bl
  1421 00000B6F 75DA                                    jnz     short .scalefac_get_lop@
  1422 00000B71 EB09                                    jmp     short .skip_quickfill@
  1423                                  
  1424                                  .quickfill@:
  1425 00000B73 51                                      push    ecx
  1426 00000B74 0FB6CB                                  movzx   ecx, bl
  1427 00000B77 B000                                    mov     al, 0
  1428 00000B79 F3AA                                    rep stosb
  1429 00000B7B 59                                      pop     ecx
  1430                                  
  1431                                  .skip_quickfill@:
  1432 00000B7C 5B                                      pop     ebx
  1433 00000B7D E914010000                              jmp     .body_lsf_zeropad
  1434                                  
  1435                                  .body_lsf_zero_non_type2:
  1436 00000B82 53                                      push    ebx
  1437 00000B83 C1CA08                                  ror     edx, 8
  1438 00000B86 88D6                                    mov     dh, dl          ; slen[0,1,2,3] = slen[0,0,1,1]
  1439 00000B88 C1C210                                  rol     edx, 16
  1440 00000B8B 88F2                                    mov     dl, dh
  1441 00000B8D 8A4328                                  mov     al, [ebx+40]    ; [ebx+$mp3gr_scfsi]
  1442 00000B90 C0E004                                  shl     al, 4           ; move to upper 4bit
  1443 00000B93 A2[9C440500]                            mov     byte [_@@scfsi], al
  1444 00000B98 BB06050505                              mov     ebx, 5050506h   ; num[0..3]
  1445                                  
  1446                                  .body_lsf_zero_non_type2_lop:
  1447 00000B9D D025[9C440500]                          shl     byte [_@@scfsi], 1
  1448 00000BA3 7238                                    jb      short .body_lsf_zero_non_type2_copy
  1449 00000BA5 80FA00                                  cmp     dl, 0           ; @@get_bl_scalefacs_with_dl_bits 0
  1450 00000BA8 7428                                    jz      short .quickfill@@
  1451                                  
  1452                                  .scalefac_get_lop@@:
  1453 00000BAA 88D1                                    mov     cl, dl
  1454 00000BAC 89E8                                    mov     eax, ebp
  1455 00000BAE D3E5                                    shl     ebp, cl
  1456 00000BB0 D3C0                                    rol     eax, cl
  1457 00000BB2 31E8                                    xor     eax, ebp
  1458 00000BB4 28CD                                    sub     ch, cl
  1459 00000BB6 7913                                    jns     short .cont@@@
  1460 00000BB8 88E9                                    mov     cl, ch
  1461 00000BBA 80C510                                  add     ch, 10h
  1462 00000BBD D3C5                                    rol     ebp, cl
  1463 00000BBF 668B2E                                  mov     bp, [esi]
  1464 00000BC2 83C602                                  add     esi, 2
  1465 00000BC5 66C1CD08                                ror     bp, 8
  1466 00000BC9 D3CD                                    ror     ebp, cl
  1467                                  
  1468                                  .cont@@@:
  1469 00000BCB AA                                      stosb
  1470 00000BCC FECB                                    dec     bl
  1471 00000BCE 75DA                                    jnz     short .scalefac_get_lop@@
  1472 00000BD0 EB09                                    jmp     short .skip_quickfill@@
  1473                                  
  1474                                  .quickfill@@:
  1475 00000BD2 51                                      push    ecx
  1476 00000BD3 0FB6CB                                  movzx   ecx, bl
  1477 00000BD6 B000                                    mov     al, 0
  1478 00000BD8 F3AA                                    rep stosb
  1479 00000BDA 59                                      pop     ecx
  1480                                  
  1481                                  .skip_quickfill@@:
  1482 00000BDB EB11                                    jmp     short .body_lsf_zero_non_type2_next
  1483                                  
  1484                                  .body_lsf_zero_non_type2_copy:
  1485 00000BDD 51                                      push    ecx
  1486 00000BDE 89F0                                    mov     eax, esi
  1487 00000BE0 0FB6CB                                  movzx   ecx, bl         ; copy
  1488 00000BE3 8DB760F6FFFF                            lea     esi, [edi-2464] ; [edi-$mp3gr_entrysiz] ; src=granule[0] ; from
  1489 00000BE9 F3A4                                    rep movsb               ; prev
  1490 00000BEB 89C6                                    mov     esi, eax
  1491 00000BED 59                                      pop     ecx
  1492                                  
  1493                                  .body_lsf_zero_non_type2_next:
  1494 00000BEE C1EA08                                  shr     edx, 8          ; dl=next slen
  1495 00000BF1 C1EB08                                  shr     ebx, 8          ; bl=next numfacs
  1496 00000BF4 75A7                                    jnz     short .body_lsf_zero_non_type2_lop
  1497 00000BF6 5B                                      pop     ebx
  1498 00000BF7 B000                                    mov     al, 0
  1499 00000BF9 AA                                      stosb
  1500 00000BFA E9A9000000                              jmp     .body_lsf_done
  1501                                  
  1502                                  .body_lsf_nonzero:
  1503 00000BFF 8B5314                                  mov     edx, [ebx+14h]  ; [ebx+$mp3gr_scalefac_compress]
  1504 00000C02 F705[D0C20000]0100-                     test    dword [mp3_hdr_mode_ext], 1 ; MODE_EXT_I_STEREO
  1504 00000C0A 0000               
  1505 00000C0C 740F                                    jz      short .normal_scalefac
  1506 00000C0E 833D[7C190100]00                        cmp     dword [mp3_curr_channel], 0
  1507 00000C15 7406                                    jz      short .normal_scalefac
  1508 00000C17 81C200020000                            add     edx, 512        ; for 2nd channel of intensity_stereo
  1509                                  
  1510                                  .normal_scalefac:
  1511 00000C1D 8A04D5[91240500]                        mov     al, [(mp3_lsf_sf_expand_exploded_table+5)+edx*8]
  1512 00000C24 084318                                  or      [ebx+24], al    ; [ebx+$mp3gr_preflag]
  1513 00000C27 53                                      push    ebx
  1514 00000C28 0FB604D5[90240500]                      movzx   eax, byte [(mp3_lsf_sf_expand_exploded_table+4)+edx*8]
  1515 00000C30 837B2C02                                cmp     dword [ebx+44], 2 ;  [ebx+$mp3gr_block_type]
  1516 00000C34 7507                                    jnz     short .this_tindex1
  1517 00000C36 8B5B30                                  mov     ebx, [ebx+48]   ; [ebx+$mp3gr_switch_point]
  1518 00000C39 8D449804                                lea     eax, [eax+ebx*4+4]
  1519                                  
  1520                                  .this_tindex1:
  1521 00000C3D 8B98[F89E0000]                          mov     ebx, [mp3_lsf_nsf_table+eax]
  1522 00000C43 8B14D5[8C240500]                        mov     edx, dword [mp3_lsf_sf_expand_exploded_table+edx*8]
  1523                                  
  1524                                  .scalefax_outer_lop:
  1525 00000C4A 80FA00                                  cmp     dl, 0           ; @@get_bl_scalefacs_with_dl_bits 1
  1526 00000C4D 7435                                    jz      short .@quickfil
  1527                                  
  1528                                  .@scalefac_get_lop:
  1529 00000C4F 88D1                                    mov     cl, dl
  1530 00000C51 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1531 00000C53 D3E5                                    shl     ebp, cl
  1532 00000C55 D3C0                                    rol     eax, cl
  1533 00000C57 31E8                                    xor     eax, ebp
  1534 00000C59 28CD                                    sub     ch, cl
  1535 00000C5B 7913                                    jns     short .cont
  1536 00000C5D 88E9                                    mov     cl, ch
  1537 00000C5F 80C510                                  add     ch, 10h
  1538 00000C62 D3C5                                    rol     ebp, cl
  1539 00000C64 668B2E                                  mov     bp, [esi]
  1540 00000C67 83C602                                  add     esi, 2
  1541 00000C6A 66C1CD08                                ror     bp, 8
  1542 00000C6E D3CD                                    ror     ebp, cl
  1543                                  
  1544                                  .cont:
  1545 00000C70 88D1                                    mov     cl, dl          ; numbits
  1546 00000C72 88C4                                    mov     ah, al
  1547 00000C74 FEC4                                    inc     ah              ; val+1
  1548 00000C76 D2EC                                    shr     ah, cl          ; bit0=is.max.value
  1549 00000C78 C0E407                                  shl     ah, 7           ; bit7=is.max.value
  1550 00000C7B 08E0                                    or      al, ah          ; apply NO_INTENSITY_FLAG
  1551 00000C7D AA                                      stosb
  1552 00000C7E FECB                                    dec     bl
  1553 00000C80 75CD                                    jnz     short .@scalefac_get_lop
  1554 00000C82 EB09                                    jmp     short .@skip_quickfill
  1555                                  
  1556                                  .@quickfil:
  1557 00000C84 51                                      push    ecx
  1558 00000C85 0FB6CB                                  movzx   ecx, bl
  1559 00000C88 B080                                    mov     al, 80h
  1560 00000C8A F3AA                                    rep stosb
  1561 00000C8C 59                                      pop     ecx
  1562                                  
  1563                                  .@skip_quickfill:
  1564 00000C8D C1EA08                                  shr     edx, 8
  1565 00000C90 C1EB08                                  shr     ebx, 8
  1566 00000C93 75B5                                    jnz     short .scalefax_outer_lop
  1567 00000C95 5B                                      pop     ebx
  1568                                  
  1569                                  .body_lsf_zeropad:
  1570 00000C96 89CA                                    mov     edx, ecx
  1571 00000C98 8D8B98000000                            lea     ecx, [ebx+152]  ; [ebx+$mp3gr_scale_factors+40]
  1572 00000C9E 29F9                                    sub     ecx, edi
  1573                                                  ;jb     short fatal_scalefactors
  1574                                  		; 21/10/2024
  1575 00000CA0 7207                    		jb	short fatalunexpected
  1576 00000CA2 B000                                    mov     al, 0
  1577 00000CA4 F3AA                                    rep stosb
  1578 00000CA6 89D1                                    mov     ecx, edx
  1579                                  
  1580                                  .body_lsf_done:
  1581                                  		; 16/02/2025
  1582                                  		; clc ; not needed
  1583                                  
  1584                                  .no_rdtsc_supported@@@:
  1585 00000CA8 C3                                      retn
  1586                                  
  1587                                  		; 21/10/2024
  1588                                  ;fatal_scalefactors:
  1589                                                  ;jmp    fatalunexpected
  1590                                  
  1591                                  ; ---------------------------------------------------------------------------
  1592                                  
  1593                                  		; 21/10/2024
  1594                                  fatalunexpected:                       
  1595 00000CA9 F735[2AA90000]                          div	dword [zero]
  1596                                  hang:
  1597 00000CAF EBFE                                    jmp     short hang
  1598                                  
  1599                                  
  1600                                  ; =============== S U B R O U T I N E =======================================
  1601                                  
  1602                                  
  1603                                  mp3_get_exponents_from_scale_factors:
  1604                                  		; 16/02/2025
  1605                                  
  1606                                  .no_rdtsc_supported:
  1607 00000CB1 51                                      push    ecx             ; mp3mac_push_bitstream
  1608 00000CB2 55                                      push    ebp
  1609 00000CB3 56                                      push    esi
  1610 00000CB4 C705[AC440500]0000-                     mov     dword [_@@rle_point], 0
  1610 00000CBC 0000               
  1611 00000CBE 8A4B34                                  mov     cl, [ebx+52]    ; [ebx+$mp3gr_scalefac_scale]
  1612 00000CC1 BF[20400100]                            mov     edi, mp3_exponents
  1613 00000CC6 31D2                                    xor     edx, edx
  1614 00000CC8 3B5320                                  cmp     edx, [ebx+32]   ; [ebx+$mp3gr_long_end]
  1615 00000CCB 7345                                    jnb     short .long_done
  1616 00000CCD A1[B4C20000]                            mov     eax, [mp3_hdr_sample_rate_index]
  1617 00000CD2 6BC016                                  imul    eax, 22
  1618 00000CD5 8DA8[08A50000]                          lea     ebp, [mp3_band_size_long+eax]
  1619 00000CDB 8B4318                                  mov     eax, [ebx+24]   ; [ebx+$mp3gr_preflag]
  1620 00000CDE 6BC016                                  imul    eax, 22
  1621 00000CE1 8DB0[58A60000]                          lea     esi, [mp3_pretab+eax]
  1622                                  
  1623                                  .long_lop:
  1624 00000CE7 0FB6441370                              movzx   eax, byte [ebx+edx+112] ; [ebx+$mp3gr_scale_factors+edx]
  1625 00000CEC 247F                                    and     al, 7Fh         ; strip NO_INTENSITY_FLAG
  1626 00000CEE 020416                                  add     al, [esi+edx]
  1627 00000CF1 D3E0                                    shl     eax, cl
  1628 00000CF3 F7D8                                    neg     eax
  1629 00000CF5 034310                                  add     eax, [ebx+16]   ; [ebx+$mp3gr_global_gain]
  1630 00000CF8 C1E010                                  shl     eax, 16
  1631 00000CFB 8A441500                                mov     al, [ebp+edx+0]
  1632 00000CFF 0305[AC440500]                          add     eax, [_@@rle_point]
  1633 00000D05 66A3[AC440500]                          mov     word [_@@rle_point], ax
  1634 00000D0B AB                                      stosd
  1635 00000D0C 42                                      inc     edx
  1636 00000D0D 3B5320                                  cmp     edx, [ebx+32]   ; [ebx+$mp3gr_long_end]
  1637 00000D10 72D5                                    jb      short .long_lop
  1638                                  
  1639                                  .long_done:
  1640 00000D12 8B531C                                  mov     edx, [ebx+28]   ; [ebx+$mp3gr_short_start]
  1641 00000D15 83FA0D                                  cmp     edx, 13
  1642 00000D18 0F83AA000000                            jnb     .skip_shorts
  1643 00000D1E A1[B4C20000]                            mov     eax, [mp3_hdr_sample_rate_index]
  1644 00000D23 6BC00D                                  imul    eax, 13
  1645 00000D26 8DA8[D8A50000]                          lea     ebp, [mp3_band_size_short+eax]
  1646 00000D2C 8B7320                                  mov     esi, [ebx+32]   ; [ebx+$mp3gr_long_end]
  1647 00000D2F 8B4310                                  mov     eax, [ebx+16]   ; [ebx+$mp3gr_global_gain]
  1648                                                                          ; IRP nn,0,1,2
  1649 00000D32 2B4344                                  sub     eax, [ebx+68]   ; [ebx+$mp3gr_subblock_gain+nn*4]
  1650 00000D35 A3[A0440500]                            mov     [_@@gains], eax ; [@@gains+nn*4]
  1651 00000D3A 8B4310                                  mov     eax, [ebx+16]
  1652 00000D3D 2B4348                                  sub     eax, [ebx+72]
  1653 00000D40 A3[A4440500]                            mov     [_@@gains+4], eax ; [@@gains+nn*4]
  1654 00000D45 8B4310                                  mov     eax, [ebx+16]
  1655 00000D48 2B434C                                  sub     eax, [ebx+76]   ; [ebx+$mp3gr_subblock_gain+nn*4]
  1656 00000D4B A3[A8440500]                            mov     [_@@gains+8], eax ; [@@gains+nn*4]
  1657                                  
  1658                                  .short_lop:
  1659 00000D50 0FB6443370                              movzx   eax, byte [ebx+esi+112] ; [ebx+$mp3gr_scale_factors+esi]
  1660                                                                          ; IRP nn,0,1,2
  1661 00000D55 247F                                    and     al, 7Fh         ; strip NO_INTENSITY_FLAG
  1662 00000D57 46                                      inc     esi
  1663 00000D58 D3E0                                    shl     eax, cl
  1664 00000D5A F7D8                                    neg     eax
  1665 00000D5C 0305[A0440500]                          add     eax, [_@@gains] ; [@@gains+nn*4] ; nn=0
  1666 00000D62 C1E010                                  shl     eax, 16
  1667 00000D65 8A441500                                mov     al, [ebp+edx+0] ; bstab[edx]
  1668 00000D69 0305[AC440500]                          add     eax, [_@@rle_point]
  1669 00000D6F 66A3[AC440500]                          mov     word [_@@rle_point], ax
  1670 00000D75 AB                                      stosd                   ; msw=val, lsw=point
  1671 00000D76 0FB6443370                              movzx   eax, byte [ebx+esi+112] ; [ebx+$mp3gr_scalefac_scale]
  1672 00000D7B 247F                                    and     al, 7Fh
  1673 00000D7D 46                                      inc     esi
  1674 00000D7E D3E0                                    shl     eax, cl
  1675 00000D80 F7D8                                    neg     eax
  1676 00000D82 0305[A4440500]                          add     eax, [_@@gains+4] ; [@@gains+nn*4] ; nn = 1
  1677 00000D88 C1E010                                  shl     eax, 16
  1678 00000D8B 8A441500                                mov     al, [ebp+edx+0]
  1679 00000D8F 0305[AC440500]                          add     eax, [_@@rle_point]
  1680 00000D95 66A3[AC440500]                          mov     word [_@@rle_point], ax
  1681 00000D9B AB                                      stosd
  1682 00000D9C 0FB6443370                              movzx   eax, byte [ebx+esi+70h]
  1683 00000DA1 247F                                    and     al, 7Fh
  1684 00000DA3 46                                      inc     esi
  1685 00000DA4 D3E0                                    shl     eax, cl
  1686 00000DA6 F7D8                                    neg     eax
  1687 00000DA8 0305[A8440500]                          add     eax, [_@@gains+8] ; [@@gains+nn*4] ; nn=2
  1688 00000DAE C1E010                                  shl     eax, 10h
  1689 00000DB1 8A441500                                mov     al, [ebp+edx+0]
  1690 00000DB5 0305[AC440500]                          add     eax, [_@@rle_point]
  1691 00000DBB 66A3[AC440500]                          mov     word [_@@rle_point], ax
  1692 00000DC1 AB                                      stosd
  1693 00000DC2 42                                      inc     edx
  1694 00000DC3 83FA0D                                  cmp     edx, 13
  1695 00000DC6 7288                                    jb      short .short_lop
  1696                                  
  1697                                  .skip_shorts:
  1698 00000DC8 5E                                      pop     esi             ; mp3mac_pop_bitstream
  1699 00000DC9 5D                                      pop     ebp
  1700 00000DCA 59                                      pop     ecx
  1701                                  
  1702                                  		; 16/02/2025 
  1703                                  
  1704                                  .no_rdtsc_supported@:
  1705 00000DCB C3                                      retn
  1706                                  
  1707                                  
  1708                                  ; =============== S U B R O U T I N E =======================================
  1709                                  
  1710                                  
  1711                                  mp3_huffman_decode:
  1712                                  		; 16/02/2025
  1713                                  
  1714                                  .no_rdtsc_supported:
  1715 00000DCC 8B4308                                  mov	eax, [ebx+8]    ; [ebx+$mp3gr_part2_3_end]
  1716 00000DCF C1E803                                  shr	eax, 3
  1717 00000DD2 0305[88190100]                          add	eax, [mp3_bitstream_start]
  1718 00000DD8 A3[C0440500]                            mov	[_@@coarse_end], eax
  1719 00000DDD 31FF                                    xor	edi, edi
  1720 00000DDF C705[C8440500]-                         mov	dword [_@@rle_ptr], mp3_exponents
  1720 00000DE5 [20400100]         
  1721 00000DE9 C705[C4440500]0000-                     mov	dword [_@rle_point], 0
  1721 00000DF1 0000               
  1722 00000DF3 C705[B0440500]0000-                     mov	dword [_@@III], 0  ; i=0
  1722 00000DFB 0000               
  1723                                  
  1724                                  .low_freq_lop_i:
  1725 00000DFD 8B15[B0440500]                          mov     edx, [_@@III] ; for i=0 to 2
  1726                                                                          ; low frequencies (called big_values)...
  1727 00000E03 8B449350                                mov     eax, [ebx+edx*4+80] ; [ebx+$mp3gr_region_size+edx*4]
  1728 00000E07 83F800                                  cmp     eax, 0
  1729 00000E0A 0F84D9020000                            jz      .low_freq_next_i
  1730 00000E10 A3[B4440500]                            mov     [_@@JJJ], eax
  1731 00000E15 8B549338                                mov     edx, [ebx+edx*4+56] ; [ebx+$mp3gr_table_select+edx*4]
  1732                                                                          ; select vlc table
  1733 00000E19 0FB68412[C8A40000]                      movzx   eax, byte [mp3_huff_data+edx*2] ; get huff.table number
  1734 00000E21 83F800                                  cmp     eax, 0          ; huff.table
  1735 00000E24 7528                                    jnz     short .low_freq_nonzero
  1736 00000E26 51                                      push    ecx
  1737 00000E27 57                                      push    edi
  1738 00000E28 8DBCBBA0000000                          lea     edi, [ebx+edi*4+160] ; [ebx+$mp3gr_sb_hybrid+edi*4]
  1739 00000E2F 8B0D[B4440500]                          mov     ecx, [_@@JJJ]
  1740 00000E35 D1E1                                    shl     ecx, 1
  1741 00000E37 31C0                                    xor     eax, eax        ; when huff.table=0,
  1742                                                                          ; simply set NUM*2 entries to zero
  1743 00000E39 F3AB                                    rep stosd
  1744 00000E3B 5F                                      pop     edi
  1745 00000E3C 59                                      pop     ecx
  1746 00000E3D 033D[B4440500]                          add     edi, [_@@JJJ] ; raise index accordingly (by num*2)
  1747 00000E43 033D[B4440500]                          add     edi, [_@@JJJ]
  1748 00000E49 E99B020000                              jmp     .low_freq_next_i
  1749                                  
  1750                                  .low_freq_nonzero:
  1751 00000E4E A3[BC440500]                            mov     [_@@vlc_table], eax ; =1..15
  1752 00000E53 83F80E                                  cmp     eax, 14         ; only table 14..15 have linbits
  1753 00000E56 0F83FA000000                            jnb     .with_linbits  ; so table 0..13 can use faster code...
  1754                                  
  1755                                  .low_freq_lop_j_small:
  1756 00000E5C 3B35[C0440500]                          cmp     esi, [_@@coarse_end] ; loop @@JJJ times..
  1757 00000E62 0F87CF000000                            ja      .small_near_end
  1758                                  
  1759                                  .small_not_end:
  1760 00000E68 3B3D[C4440500]                          cmp     edi, [_@rle_point] ; @@get_runlength small
  1761 00000E6E 0F8386030000                            jnb     .rle_fetch_next_small
  1762                                  
  1763                                  .rle_back_small:
  1764 00000E74 8B15[BC440500]                          mov     edx, [_@@vlc_table] ; get huffcode
  1765                                  
  1766                                  .get_child_lop:
  1767 00000E7A 8A0C95[A2440100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; mp3mac_get_huffcode
  1768                                                                          ; in: edx=table, out: eax=data
  1769                                                                          ; bits (table size) (-7..-1)
  1770 00000E81 668B1495[A0440100]                      mov     dx, word [huff_tree_buf+edx*4] ; code (child table)
  1771 00000E89 89E8                                    mov     eax, ebp        ; mov eax,mp3_col32 ; peek bitstream
  1772 00000E8B D3E8                                    shr     eax, cl
  1773 00000E8D 01C2                                    add     edx, eax
  1774 00000E8F 8A0C95[A2440100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; bits (of entry)
  1775 00000E96 80F900                                  cmp     cl, 0
  1776 00000E99 7823                                    js      short .got_child
  1777 00000E9B 0FB70495[A0440100]                      movzx   eax, word [huff_tree_buf+edx*4] ; return data value
  1778 00000EA3 D3E5                                    shl     ebp, cl         ; shl mp3_col32,cl ; discard cl bits
  1779 00000EA5 28CD                                    sub     ch, cl          ; sub mp3_colNN,cl
  1780 00000EA7 7932                                    jns     short .got_done
  1781 00000EA9 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1782                                                                          ; mov cl,mp3_colNN ; byte ptr [mp3_numbits_collected]
  1783 00000EAB 80C510                                  add     ch, 16          ; byte ptr [mp3_numbits_collected]
  1784 00000EAE D3C5                                    rol     ebp, cl         ; dword ptr [mp3_collected_data]
  1785 00000EB0 668B2E                                  mov     bp, [esi]
  1786 00000EB3 83C602                                  add     esi, 2
  1787 00000EB6 66C1CD08                                ror     bp, 8           ; ror mp3_col16,8 ; endianess
  1788 00000EBA D3CD                                    ror     ebp, cl         ; ror mp3_col32,cl ; dword ptr [mp3_collected_data]
  1789 00000EBC EB1D                                    jmp     short .got_done
  1790                                  
  1791                                  .got_child:
  1792 00000EBE C1E509                                  shl     ebp, 9          ; shl mp3_col32,CHILD_BITS
  1793                                                                          ; discard 7 bits
  1794                                                                          ; (assuming that parents are always 7bit wide)
  1795 00000EC1 80ED09                                  sub     ch, 9
  1796 00000EC4 79B4                                    jns     short .get_child_lop
  1797 00000EC6 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1798 00000EC8 80C510                                  add     ch, 10h
  1799 00000ECB D3C5                                    rol     ebp, cl
  1800 00000ECD 668B2E                                  mov     bp, [esi]
  1801 00000ED0 83C602                                  add     esi, 2
  1802 00000ED3 66C1CD08                                ror     bp, 8
  1803 00000ED7 D3CD                                    ror     ebp, cl
  1804 00000ED9 EB9F                                    jmp     short .get_child_lop
  1805                                  
  1806                                  .got_done:
  1807 00000EDB 50                                      push    eax
  1808 00000EDC C1E804                                  shr     eax, 4          ; x
  1809 00000EDF 7417                                    jz      short .this_sign ; @@getexpval 0 ; @@getexpval macro has_linbits
  1810                                                                          ; eax=0 (without sign) ; when x=0
  1811 00000EE1 8B15[D0440500]                          mov     edx, [_@@rle_val_x_40h]
  1812 00000EE7 8B8482[0C880400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1813 00000EEE FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
  1814                                                                          ; ;jnc short @@this_sign
  1815                                                                          ; ;neg  eax
  1816 00000EF0 D1E5                                    shl     ebp, 1          ; dec mp3_colNN ; shl mp3_col32,1 ; cy=data
  1817 00000EF2 19D2                                    sbb     edx, edx        ; cy=0,1 --> 0,FFFFFFFF
  1818 00000EF4 31D0                                    xor     eax, edx        ; invert if cy was 1 ; get sign (negate if sign=1)
  1819 00000EF6 29D0                                    sub     eax, edx        ; add 1 if cy was 1
  1820                                  
  1821                                  .this_sign:
  1822 00000EF8 8984BBA0000000                          mov     [ebx+edi*4+160], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+0]
  1823 00000EFF 58                                      pop     eax
  1824 00000F00 83E00F                                  and     eax, 0Fh        ; y
  1825 00000F03 7417                                    jz      short .this_sign@ ; @@getexpval 0
  1826 00000F05 8B15[D0440500]                          mov     edx, [_@@rle_val_x_40h]
  1827 00000F0B 8B8482[0C880400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1828 00000F12 FECD                                    dec     ch
  1829 00000F14 D1E5                                    shl     ebp, 1
  1830 00000F16 19D2                                    sbb     edx, edx
  1831 00000F18 31D0                                    xor     eax, edx
  1832 00000F1A 29D0                                    sub     eax, edx
  1833                                  
  1834                                  .this_sign@:
  1835 00000F1C 8984BBA4000000                          mov     [ebx+edi*4+164], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+4]
  1836 00000F23 83C702                                  add     edi, 2
  1837 00000F26 FF0D[B4440500]                          dec     dword [_@@JJJ]
  1838 00000F2C 0F852AFFFFFF                            jnz     .low_freq_lop_j_small
  1839 00000F32 E9B2010000                              jmp     .low_freq_next_i
  1840                                  
  1841                                  .small_near_end:
  1842 00000F37 89F0                                    mov     eax, esi        ; mp3mac_bitstream_get_position
  1843 00000F39 2B05[88190100]                          sub     eax, [mp3_bitstream_start]
  1844 00000F3F 0FBED5                                  movsx   edx, ch         ; mp3_colNN
  1845 00000F42 F7DA                                    neg     edx
  1846 00000F44 8D44C2F0                                lea     eax, [edx+eax*8-16]
  1847 00000F48 3B4308                                  cmp     eax, [ebx+8]    ; [ebx+$mp3gr_part2_3_end]
  1848 00000F4B 0F8217FFFFFF                            jb      .small_not_end
  1849 00000F51 E993010000                              jmp     .low_freq_next_i
  1850                                  
  1851                                  .with_linbits:
  1852 00000F56 0FB68412[C9A40000]                      movzx   eax, byte [(mp3_huff_data+1)+edx*2]
  1853 00000F5E A3[B8440500]                            mov     [_@@linbits], eax
  1854                                  
  1855                                  .low_freq_lop_j:
  1856 00000F63 3B35[C0440500]                          cmp     esi, [_@@coarse_end] ; mp3mac_bitstream_get_position
  1857                                                                          ; loop @@JJJ times...
  1858 00000F69 0F870D030000                            ja      .lop_j_near_end
  1859                                  
  1860                                  .small_not_end@:
  1861 00000F6F 3B3D[C4440500]                          cmp     edi, [_@rle_point] ; @@get_runlength small
  1862 00000F75 0F83AD020000                            jnb     .rle_fetch_next_full
  1863                                  
  1864                                  .rle_back_full:
  1865 00000F7B 8B15[BC440500]                          mov     edx, [_@@vlc_table] ; get huffcode
  1866                                  
  1867                                  .get_child_lop@:
  1868 00000F81 8A0C95[A2440100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; mp3mac_get_huffcode
  1869                                                                          ; in: edx=table, out: eax=data
  1870                                                                          ; bits (table size) (-7..-1)
  1871 00000F88 668B1495[A0440100]                      mov     dx, word [huff_tree_buf+edx*4] ; code (child table)
  1872 00000F90 89E8                                    mov     eax, ebp
  1873 00000F92 D3E8                                    shr     eax, cl
  1874 00000F94 01C2                                    add     edx, eax
  1875 00000F96 8A0C95[A2440100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; bits (of entry)
  1876 00000F9D 80F900                                  cmp     cl, 0
  1877 00000FA0 7823                                    js      short .got_child@
  1878 00000FA2 0FB70495[A0440100]                      movzx   eax, word [huff_tree_buf+edx*4] ; return data value
  1879 00000FAA D3E5                                    shl     ebp, cl         ; discard cl bits
  1880 00000FAC 28CD                                    sub     ch, cl
  1881 00000FAE 7932                                    jns     short .got_done@
  1882 00000FB0 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1883 00000FB2 80C510                                  add     ch, 10h
  1884 00000FB5 D3C5                                    rol     ebp, cl
  1885 00000FB7 668B2E                                  mov     bp, [esi]
  1886 00000FBA 83C602                                  add     esi, 2
  1887 00000FBD 66C1CD08                                ror     bp, 8
  1888 00000FC1 D3CD                                    ror     ebp, cl
  1889 00000FC3 EB1D                                    jmp     short .got_done@
  1890                                  
  1891                                  .got_child@:
  1892 00000FC5 C1E509                                  shl     ebp, 9
  1893 00000FC8 80ED09                                  sub     ch, 9
  1894 00000FCB 79B4                                    jns     short .get_child_lop@
  1895 00000FCD 88E9                                    mov     cl, ch
  1896 00000FCF 80C510                                  add     ch, 10h
  1897 00000FD2 D3C5                                    rol     ebp, cl
  1898 00000FD4 668B2E                                  mov     bp, [esi]
  1899 00000FD7 83C602                                  add     esi, 2
  1900 00000FDA 66C1CD08                                ror     bp, 8
  1901 00000FDE D3CD                                    ror     ebp, cl
  1902 00000FE0 EB9F                                    jmp     short .get_child_lop@
  1903                                  
  1904                                  .got_done@:
  1905 00000FE2 50                                      push    eax
  1906 00000FE3 C1E804                                  shr     eax, 4          ; x
  1907 00000FE6 746F                                    jz      short .@this_sign ; @@getexpval 1
  1908 00000FE8 8B15[CC440500]                          mov     edx, [_@@rle_val]
  1909 00000FEE 83F80F                                  cmp     eax, 15
  1910 00000FF1 7250                                    jb      short .small    ; when x=1..14
  1911 00000FF3 8A0D[B8440500]                          mov     cl, byte [_@@linbits] ; =0..13 ; when x=15, with linbits
  1912 00000FF9 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl ; value = 0..1FFFh
  1913 00000FFB D3E5                                    shl     ebp, cl         ; mp3mac_collect_more
  1914 00000FFD D3C0                                    rol     eax, cl
  1915 00000FFF 31E8                                    xor     eax, ebp
  1916 00001001 28CD                                    sub     ch, cl
  1917 00001003 7913                                    jns     short .cont
  1918 00001005 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1919 00001007 80C510                                  add     ch, 16
  1920 0000100A D3C5                                    rol     ebp, cl
  1921 0000100C 668B2E                                  mov     bp, [esi]
  1922 0000100F 83C602                                  add     esi, 2
  1923 00001012 66C1CD08                                ror     bp, 8
  1924 00001016 D3CD                                    ror     ebp, cl
  1925                                  
  1926                                  .cont:
  1927 00001018 88D1                                    mov     cl, dl          ; exponent.lsb
  1928 0000101A 80E103                                  and     cl, 3           ; exponent.lsb
  1929 0000101D C1EA02                                  shr     edx, 2          ; exponent.msb
  1930 00001020 8D04853C000000                          lea     eax, [eax*4+60] ; (value+15)*4
  1931 00001027 08C8                                    or      al, cl          ; exponent.lsb+(value+15)*4
  1932 00001029 8A88[E0FE0100]                          mov     cl, [mp3_table_4_3_exp+eax]
  1933 0000102F 8B0485[1C7F0200]                        mov     eax, [mp3_table_4_3_value+eax*4]
  1934 00001036 28D1                                    sub     cl, dl          ; sub exponent.msb
  1935 00001038 D3E8                                    shr     eax, cl
  1936 0000103A 80F91F                                  cmp     cl, 31
  1937 0000103D 760E                                    jbe     short .get_sign
  1938 0000103F 31C0                                    xor     eax, eax
  1939 00001041 EB0A                                    jmp     short .get_sign
  1940                                  
  1941                                  .small:
  1942 00001043 C1E206                                  shl     edx, 6          ; shl edx,4+2 ; mul16*4 ; when x<15 aka x=1..14
  1943 00001046 8B8482[0C880400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1944                                  
  1945                                  .get_sign:
  1946 0000104D FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
  1947 0000104F D1E5                                    shl     ebp, 1
  1948 00001051 19D2                                    sbb     edx, edx        ; get sign (negate if sign=1)
  1949 00001053 31D0                                    xor     eax, edx
  1950 00001055 29D0                                    sub     eax, edx
  1951                                  
  1952                                  .@this_sign:
  1953 00001057 8984BBA0000000                          mov     [ebx+edi*4+160], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+0]
  1954 0000105E 58                                      pop     eax
  1955 0000105F 83E00F                                  and     eax, 0Fh        ; y
  1956 00001062 746F                                    jz      short .@this_sign@ ; @@getexpval 1
  1957 00001064 8B15[CC440500]                          mov     edx, [_@@rle_val]
  1958 0000106A 83F80F                                  cmp     eax, 0Fh
  1959 0000106D 7250                                    jb      short .small@
  1960 0000106F 8A0D[B8440500]                          mov     cl, byte [_@@linbits]
  1961 00001075 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1962 00001077 D3E5                                    shl     ebp, cl
  1963 00001079 D3C0                                    rol     eax, cl
  1964 0000107B 31E8                                    xor     eax, ebp
  1965 0000107D 28CD                                    sub     ch, cl
  1966 0000107F 7913                                    jns     short .cont@
  1967 00001081 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1968 00001083 80C510                                  add     ch, 10h
  1969 00001086 D3C5                                    rol     ebp, cl
  1970 00001088 668B2E                                  mov     bp, [esi]
  1971 0000108B 83C602                                  add     esi, 2
  1972 0000108E 66C1CD08                                ror     bp, 8
  1973 00001092 D3CD                                    ror     ebp, cl
  1974                                  
  1975                                  .cont@:
  1976 00001094 88D1                                    mov     cl, dl
  1977 00001096 80E103                                  and     cl, 3
  1978 00001099 C1EA02                                  shr     edx, 2
  1979 0000109C 8D04853C000000                          lea     eax, [eax*4+60]
  1980 000010A3 08C8                                    or      al, cl
  1981 000010A5 8A88[E0FE0100]                          mov     cl, [mp3_table_4_3_exp+eax]
  1982 000010AB 8B0485[1C7F0200]                        mov     eax, [mp3_table_4_3_value+eax*4]
  1983 000010B2 28D1                                    sub     cl, dl
  1984 000010B4 D3E8                                    shr     eax, cl
  1985 000010B6 80F91F                                  cmp     cl, 31
  1986 000010B9 760E                                    jbe     short .get_sign@
  1987 000010BB 31C0                                    xor     eax, eax
  1988 000010BD EB0A                                    jmp     short .get_sign@
  1989                                  
  1990                                  .small@:
  1991 000010BF C1E206                                  shl     edx, 6
  1992 000010C2 8B8482[0C880400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1993                                  
  1994                                  .get_sign@:                           
  1995 000010C9 FECD                                    dec     ch              ; dec mp3_colNN
  1996 000010CB D1E5                                    shl     ebp, 1          ; shl mp3_col32,1 ; cy=data
  1997 000010CD 19D2                                    sbb     edx, edx        ; cy=0,1 --> 0,FFFFFFFF
  1998 000010CF 31D0                                    xor     eax, edx        ; invert if cy was 1
  1999 000010D1 29D0                                    sub     eax, edx        ; add 1 if cy was 1
  2000                                  
  2001                                  .@this_sign@:
  2002 000010D3 8984BBA4000000                          mov	[ebx+edi*4+164], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+4]
  2003 000010DA 83C702                                  add	edi, 2          ; next j
  2004 000010DD FF0D[B4440500]                          dec	dword [_@@JJJ]
  2005 000010E3 0F857AFEFFFF                            jnz	.low_freq_lop_j
  2006                                  
  2007                                  .low_freq_next_i:
  2008 000010E9 FF05[B0440500]                          inc	dword [_@@III]	; next i
  2009 000010EF 833D[B0440500]03                        cmp	dword [_@@III], 3
  2010 000010F6 0F8201FDFFFF                            jb	.low_freq_lop_i
  2011 000010FC 81FF3C020000                            cmp	edi, 572	; aka 576-4 ; skip if less than 4 entries left
  2012 00001102 0F87DA000000                            ja	.high_freq_done
  2013                                  
  2014                                  .high_freq_lop:
  2015 00001108 3B35[C0440500]                          cmp     esi, [_@@coarse_end]
  2016 0000110E 7629                                    jbe     short .high_freq_inrange
  2017 00001110 89F0                                    mov     eax, esi        ; mp3mac_bitstream_get_position
  2018 00001112 2B05[88190100]                          sub     eax, [mp3_bitstream_start]
  2019 00001118 0FBED5                                  movsx   edx, ch         ; mp3_colNN
  2020 0000111B F7DA                                    neg     edx
  2021 0000111D 8D44C2F0                                lea     eax, [edx+eax*8-16]
  2022 00001121 3B4308                                  cmp     eax, [ebx+8]    ; [ebx+$mp3gr_part2_3_end] ; check end
  2023 00001124 7213                                    jb      short .high_freq_inrange ; not yet end
  2024 00001126 0F84B6000000                            jz      .high_freq_done ; okay, exact end
  2025 0000112C 83FF04                                  cmp     edi, 4
  2026 0000112F 7203                                    jb      short .high_freq_cannot_stepback
  2027 00001131 83EF04                                  sub     edi, 4          ; stepback, s_index-4 ; dst stepback
  2028                                  
  2029                                  .high_freq_cannot_stepback:
  2030 00001134 E9A9000000                              jmp     .high_freq_done
  2031                                  
  2032                                  .high_freq_inrange:
  2033 00001139 8B5324                                  mov     edx, [ebx+24h]  ; [ebx+$mp3gr_count1table_select]
  2034                                                                          ; get huffcode (quad_vlc)
  2035                                  
  2036                                  .get_child_lop@@:
  2037 0000113C 8A0C95[A2440100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; mp3mac_get_huffcode
  2038 00001143 668B1495[A0440100]                      mov     dx, word [huff_tree_buf+edx*4]
  2039 0000114B 89E8                                    mov     eax, ebp
  2040 0000114D D3E8                                    shr     eax, cl
  2041 0000114F 01C2                                    add     edx, eax
  2042 00001151 8A0C95[A2440100]                        mov     cl, [(huff_tree_buf+2)+edx*4]
  2043 00001158 80F900                                  cmp     cl, 0
  2044 0000115B 7823                                    js      short .got_child@@
  2045 0000115D 0FB70495[A0440100]                      movzx   eax, word [huff_tree_buf+edx*4]
  2046 00001165 D3E5                                    shl     ebp, cl
  2047 00001167 28CD                                    sub     ch, cl
  2048 00001169 7932                                    jns     short .got_done@@
  2049 0000116B 88E9                                    mov     cl, ch
  2050 0000116D 80C510                                  add     ch, 10h
  2051 00001170 D3C5                                    rol     ebp, cl
  2052 00001172 668B2E                                  mov     bp, [esi]
  2053 00001175 83C602                                  add     esi, 2
  2054 00001178 66C1CD08                                ror     bp, 8
  2055 0000117C D3CD                                    ror     ebp, cl
  2056 0000117E EB1D                                    jmp     short .got_done@@
  2057                                  
  2058                                  .got_child@@:
  2059 00001180 C1E509                                  shl     ebp, 9
  2060 00001183 80ED09                                  sub     ch, 9
  2061 00001186 79B4                                    jns     short .get_child_lop@@
  2062 00001188 88E9                                    mov     cl, ch
  2063 0000118A 80C510                                  add     ch, 10h
  2064 0000118D D3C5                                    rol     ebp, cl
  2065 0000118F 668B2E                                  mov     bp, [esi]
  2066 00001192 83C602                                  add     esi, 2
  2067 00001195 66C1CD08                                ror     bp, 8
  2068 00001199 D3CD                                    ror     ebp, cl
  2069 0000119B EB9F                                    jmp     short .get_child_lop@@
  2070                                  
  2071                                  .got_done@@:
  2072 0000119D 88C2                                    mov     dl, al          ; flags
  2073 0000119F C0E204                                  shl     dl, 4           ; flags, to upper 4bit
  2074 000011A2 B604                                    mov     dh, 4           ; lopcount
  2075                                  
  2076                                  .high_freq_flag_lop:
  2077 000011A4 31C0                                    xor     eax, eax
  2078 000011A6 D0E2                                    shl     dl, 1           ; flag
  2079 000011A8 7320                                    jnb     short .high_freq_flag_this
  2080 000011AA 3B3D[C4440500]                          cmp     edi, [_@rle_point] ; @@get_runlength quads
  2081 000011B0 0F83A0000000                            jnb     .rle_fetch_next_quads
  2082                                  
  2083                                  .rle_back_quads:
  2084 000011B6 A1[CC440500]                            mov     eax, [_@@rle_val]
  2085 000011BB 8B0485[0C800400]                        mov     eax, [mp3_exp_table+eax*4] ; xlat and get sign
  2086 000011C2 FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
  2087 000011C4 D1E5                                    shl     ebp, 1
  2088 000011C6 7302                                    jnb     short .high_freq_flag_this ;
  2089                                                                          ; sbb edx, edx ; cy=0,1 --> 0,FFFFFFFF
  2090                                                                          ; xor eax, edx ; invert if cy was 1
  2091                                                                          ; sub eax, edx ; add 1 if cy was 1
  2092 000011C8 F7D8                                    neg     eax
  2093                                  
  2094                                  .high_freq_flag_this:
  2095 000011CA 8984BBA0000000                          mov     [ebx+edi*4+160], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+0]
  2096 000011D1 47                                      inc     edi
  2097 000011D2 FECE                                    dec     dh
  2098 000011D4 75CE                                    jnz     short .high_freq_flag_lop
  2099 000011D6 81FF3C020000                            cmp     edi, 572        ; aka 576-4 ; loop while space for another 4 values
  2100 000011DC 0F8626FFFFFF                            jbe     .high_freq_lop
  2101                                  
  2102                                  .high_freq_done:
  2103 000011E2 897B5C                                  mov     [ebx+92], edi   ; [ebx+$mp3gr_num_nonzero_hybrids]
  2104 000011E5 51                                      push    ecx
  2105 000011E6 B940020000                              mov     ecx, 576        ; end
  2106 000011EB 29F9                                    sub     ecx, edi        ; remain = end-curr
  2107                                                                          ; zeropad remaining entries (can be 0 or 2 dwords,
  2108                                                                          ; or more. If above loop was aborted)
  2109 000011ED 8DBCBBA0000000                          lea     edi, [ebx+edi*4+160] ; [ebx+$mp3gr_sb_hybrid+edi*4]
  2110 000011F4 31C0                                    xor     eax, eax
  2111 000011F6 F3AB                                    rep stosd
  2112 000011F8 59                                      pop     ecx
  2113                                  
  2114                                  		; 16/02/2025
  2115                                  .no_rdtsc_supported@:
  2116                                                  ;clc			; out: cy=0=okay
  2117 000011F9 C3                                      retn
  2118                                  
  2119                                  .rle_fetch_next_small:
  2120 000011FA A1[C8440500]                            mov     eax, [_@@rle_ptr] ; @@next_runlength small
  2121 000011FF 8305[C8440500]04                        add     dword [_@@rle_ptr], 4
  2122 00001206 8B00                                    mov     eax, [eax]
  2123 00001208 6639C7                                  cmp     di, ax
  2124 0000120B 73ED                                    jnb     short .rle_fetch_next_small
  2125 0000120D 66A3[C4440500]                          mov     word [_@rle_point], ax
  2126 00001213 C1E810                                  shr     eax, 16
  2127 00001216 A3[CC440500]                            mov     [_@@rle_val], eax
  2128 0000121B C1E006                                  shl     eax, 6
  2129 0000121E A3[D0440500]                            mov     [_@@rle_val_x_40h], eax
  2130 00001223 E94CFCFFFF                              jmp     .rle_back_small
  2131                                  
  2132                                  .rle_fetch_next_full:
  2133 00001228 A1[C8440500]                            mov     eax, [_@@rle_ptr] ; @@next_runlength full
  2134 0000122D 8305[C8440500]04                        add	dword [_@@rle_ptr], 4
  2135 00001234 8B00                                    mov     eax, [eax]
  2136 00001236 6639C7                                  cmp     di, ax
  2137 00001239 73ED                                    jnb     short .rle_fetch_next_full
  2138 0000123B 66A3[C4440500]                          mov     word [_@rle_point], ax
  2139 00001241 C1E810                                  shr     eax, 16
  2140 00001244 A3[CC440500]                            mov     [_@@rle_val], eax
  2141 00001249 C1E006                                  shl     eax, 6
  2142 0000124C A3[D0440500]                            mov     [_@@rle_val_x_40h], eax
  2143 00001251 E925FDFFFF                              jmp     .rle_back_full
  2144                                  
  2145                                  .rle_fetch_next_quads:
  2146 00001256 A1[C8440500]                            mov	eax, [_@@rle_ptr] ; msw=val, lsw=point
  2147 0000125B 8305[C8440500]04                        add	dword [_@@rle_ptr], 4 ; 2+2
  2148 00001262 8B00                                    mov	eax, [eax]
  2149 00001264 6639C7                                  cmp	di, ax          ; needed if rle fetching was skipped
  2150 00001267 73ED                                    jnb	short .rle_fetch_next_quads
  2151 00001269 66A3[C4440500]                          mov	word [_@rle_point], ax
  2152 0000126F C1E810                                  shr	eax, 16
  2153 00001272 A3[CC440500]                            mov	[_@@rle_val], eax
  2154 00001277 E93AFFFFFF                              jmp	.rle_back_quads
  2155                                  
  2156                                  .lop_j_near_end:
  2157 0000127C 89F0                                    mov     eax, esi
  2158 0000127E 2B05[88190100]                          sub     eax, [mp3_bitstream_start]
  2159 00001284 0FBED5                                  movsx   edx, ch
  2160 00001287 F7DA                                    neg     edx
  2161 00001289 8D44C2F0                                lea     eax, [edx+eax*8-16]
  2162 0000128D 3B4308                                  cmp     eax, [ebx+8]
  2163 00001290 0F82D9FCFFFF                            jb      .small_not_end@
  2164 00001296 E94EFEFFFF                              jmp     .low_freq_next_i
  2165                                  
  2166                                  
  2167                                  ; =============== S U B R O U T I N E =======================================
  2168                                  
  2169                                  
  2170                                  mp3_compute_stereo:
  2171                                  		; 16/02/2025
  2172 0000129B 833D[BCC20000]02                        cmp	dword [mp3_num_channels], 2 ; in: ebx=granule(s)
  2173 000012A2 7515                                    jnz	short .no_stereo
  2174 000012A4 833D[D0C20000]02                        cmp	dword [mp3_hdr_mode_ext], 2 ; MODE_EXT_MS_STEREO
  2175                                                                          ; only MS stereo
  2176 000012AB 740D                                    jz	short mp3_compute_ms_stereo
  2177 000012AD F705[D0C20000]0100-                     test	dword [mp3_hdr_mode_ext], 1 ; MODE_EXT_I_STEREO
  2177 000012B5 0000               
  2178                                                                          ; intensity stereo (optionally with MS stereo)
  2179 000012B7 7539                                    jnz	short mp3_compute_i_stereo
  2180                                  
  2181                                  .no_stereo:
  2182 000012B9 C3                                      retn
  2183                                  
  2184                                  mp3_compute_ms_stereo:
  2185                                  		; 16/02/2025
  2186                                  
  2187                                  .no_rdtsc_supported:
  2188 000012BA 8DBBE0130000                            lea     edi, [ebx+5088] ; [ebx+$mp3gr_sb_hybrid+$mp3gr_entrysiz*2]
  2189                                                                          ; for ch1 (2nd channel)
  2190 000012C0 8B4B5C                                  mov     ecx, [ebx+92]   ; [ebx+$mp3gr_num_nonzero_hybrids] ; ch0
  2191 000012C3 8B839C130000                            mov     eax, [ebx+5020] ; [ebx+$mp3gr_num_nonzero_hybrids+($mp3gr_entrysiz*2)] ; ch1
  2192 000012C9 39C1                                    cmp     ecx, eax
  2193 000012CB 7702                                    ja      short .this_len
  2194 000012CD 89C1                                    mov     ecx, eax
  2195                                  
  2196                                  .this_len:
  2197 000012CF E320                                    jecxz   .ms_stereo_done
  2198 000012D1 894B5C                                  mov     [ebx+92], ecx   ; [ebx+$mp3gr_num_nonzero_hybrids] ; ch0
  2199 000012D4 898B9C130000                            mov     [ebx+5020], ecx ; [ebx+$mp3gr_num_nonzero_hybrids+($mp3gr_entrysiz*2)] ; ch1
  2200                                  
  2201                                  .ms_stereo_lop:
  2202 000012DA 8B87C0ECFFFF                            mov     eax, [edi-4928] ; for i=0 to 576-1
  2203                                                                          ; [edi+@@ch0]
  2204                                                                          ; @@ch0 equ (-$mp3gr_entrysiz*2) ; granule for channel=0
  2205                                                                          ; tmp0 = granule.ch0.sb_hybrid[i]
  2206 000012E0 8B17                                    mov     edx, [edi]      ; @@ch1 equ 0 ; granule for channel=1
  2207                                                                          ; [edi+@@ch1]
  2208                                                                          ; tmp1 = granule.ch1.sb_hybrid[i]
  2209 000012E2 29D0                                    sub     eax, edx        ; tmp0 - tmp1
  2210 000012E4 8D1450                                  lea     edx, [eax+edx*2] ; tmp0 + tmp1
  2211 000012E7 8997C0ECFFFF                            mov     [edi-4928], edx ; [edi+@@ch0]
  2212                                                                          ; granule.ch0.sb_hybrid[i] = tmp0 + tmp1
  2213 000012ED AB                                      stosd                   ; [edi+@@ch1]
  2214                                                                          ; granule.ch1.sb_hybrid[i] = tmp0 - tmp1
  2215 000012EE 49                                      dec     ecx
  2216 000012EF 75E9                                    jnz     short .ms_stereo_lop
  2217                                  
  2218                                  .ms_stereo_done:
  2219                                  		; 16/02/2025
  2220                                  
  2221                                  .no_rdtsc_supported@:
  2222 000012F1 C3                                      retn
  2223                                  
  2224                                  mp3_compute_i_stereo:
  2225                                  		; 16/02/2025
  2226                                  
  2227                                  .no_rdtsc_supported@@@:
  2228 000012F2 C7435C40020000                          mov     dword [ebx+92], 576 ; ch0
  2229                                                                          ; [ebx+$mp3gr_num_nonzero_hybrids]
  2230 000012F9 C7839C130000400200-                     mov     dword [ebx+5020], 576 ; ch1
  2230 00001302 00                 
  2231                                                                          ; [ebx+$mp3gr_num_nonzero_hybrids+($mp3gr_entrysiz*2)]
  2232 00001303 8B4320                                  mov     eax, [ebx+32]   ; [ebx+$mp3gr_long_end]
  2233 00001306 A3[0C450500]                            mov     [_@@n_long_sfb], eax
  2234 0000130B B80D000000                              mov     eax, 13         ; 39/3
  2235 00001310 2B431C                                  sub     eax, [ebx+28]   ; [ebx+$mp3gr_short_start]
  2236 00001313 8D0440                                  lea     eax, [eax+eax*2] ; mul3
  2237 00001316 A3[10450500]                            mov     [_@@n_short_sfb], eax
  2238 0000131B 0305[0C450500]                          add     eax, [_@@n_long_sfb]
  2239 00001321 A3[14450500]                            mov     [_@@n_sfb], eax ;
  2240                                                                          ; n_sfb = gr->n_long_sfb + gr->n_short_sfb;
  2241 00001326 803D[10450500]00                        cmp     byte [_@@n_short_sfb], 0
  2242 0000132D B801000000                              mov     eax, 1
  2243 00001332 7405                                    jz      short .without_short
  2244 00001334 B803000000                              mov     eax, 3          ; max_blocks = gr->n_short_sfb ? 3 : 1;
  2245                                  
  2246                                  .without_short:
  2247 00001339 A3[D8440500]                            mov     [_@@max_blocks], eax
  2248 0000133E BF[E0440500]                            mov     edi, _@@sfb_array
  2249 00001343 A1[B4C20000]                            mov     eax, [mp3_hdr_sample_rate_index] ; bstab
  2250 00001348 6BC016                                  imul    eax, 22
  2251 0000134B 8DB0[08A50000]                          lea     esi, [mp3_band_size_long+eax]
  2252 00001351 8B0D[0C450500]                          mov     ecx, [_@@n_long_sfb]
  2253 00001357 F3A4                                    rep movsb
  2254 00001359 A1[B4C20000]                            mov     eax, [mp3_hdr_sample_rate_index]
  2255 0000135E 6BC00D                                  imul    eax, 13
  2256 00001361 8DB0[D8A50000]                          lea     esi, [mp3_band_size_short+eax] ; merge lieff-style
  2257 00001367 8B0D[10450500]                          mov     ecx, [_@@n_short_sfb]
  2258 0000136D E30C                                    jecxz   .make_sfb_done ; doing that here is a bit slow,
  2259                                                                          ; it would be better to pre-compute
  2260                                                                          ; all merged-combinations
  2261 0000136F 03731C                                  add     esi, [ebx+28]   ; [ebx+$mp3gr_short_start]
  2262                                  
  2263                                  .make_sfb_lop:
  2264 00001372 AC                                      lodsb
  2265 00001373 AA                                      stosb
  2266 00001374 AA                                      stosb
  2267 00001375 AA                                      stosb
  2268 00001376 83E903                                  sub     ecx, 3
  2269 00001379 75F7                                    jnz     short .make_sfb_lop
  2270                                  
  2271                                  .make_sfb_done:
  2272 0000137B E871000000                              call    _@@find_top_bands ;
  2273                                                                          ; L3_stereo_top_band(left+576,gr->sfbtab,n_sfb,max_band);
  2274 00001380 803D[0C450500]00                        cmp     byte [_@@n_long_sfb], 0
  2275 00001387 7420                                    jz      short .without_long
  2276 00001389 A1[D4440500]                            mov     eax, dword [_@@max_bands]
  2277 0000138E 38C4                                    cmp     ah, al          ; if (gr->n_long_sfb)
  2278 00001390 7F02                                    jg      short .not_max1 ; max_band[0] = max_band[1] = max_band[2] = MINIMP3_MAX
  2279                                                                          ; (MINIMP3_MAX(max_band[0], max_band[1]), max_band[2]);
  2280 00001392 88C4                                    mov     ah, al
  2281                                  
  2282                                  .not_max1:
  2283 00001394 C1E808                                  shr     eax, 8
  2284 00001397 38C4                                    cmp     ah, al
  2285 00001399 7F02                                    jg      short .not_max2
  2286 0000139B 88C4                                    mov     ah, al
  2287                                  
  2288                                  .not_max2:
  2289 0000139D 88E0                                    mov     al, ah
  2290 0000139F C1E008                                  shl     eax, 8
  2291 000013A2 88E0                                    mov     al, ah
  2292 000013A4 A3[D4440500]                            mov     dword [_@@max_bands], eax
  2293                                  
  2294                                  .without_long:
  2295 000013A9 31ED                                    xor     ebp, ebp        ; blk
  2296                                  
  2297                                  .adjust_last_prev_lop:
  2298 000013AB 8B15[14450500]                          mov     edx, [_@@n_sfb]
  2299 000013B1 2B15[D8440500]                          sub     edx, [_@@max_blocks] ; itop = n_sfb - max_blocks + blk
  2300 000013B7 01EA                                    add     edx, ebp
  2301 000013B9 89D1                                    mov     ecx, edx
  2302 000013BB 2B0D[D8440500]                          sub     ecx, [_@@max_blocks] ; prev = itop - max_blocks;
  2303 000013C1 A1[D4C20000]                            mov     eax, [mp3_hdr_flag_lsf]
  2304 000013C6 8D0440                                  lea     eax, [eax+eax*2] ; 0,1 --> 0,3
  2305                                                                          ; default_pos = HDR_TEST_MPEG1(hdr) ? 3
  2306 000013C9 3403                                    xor     al, 3           ; 0,3 --> 3,0
  2307 000013CB 363A8D[D4440500]                        cmp     cl, [ss:_@@max_bands+ebp]
  2308 000013D2 7E07                                    jle     short .use_default_pos ; ist_pos[itop] = max_band[blk] >=
  2309                                                                          ; prev ? default_pos : ist_pos[prev]
  2310 000013D4 8A840BB0130000                          mov     al, [ebx+ecx+5040] ; [ebx+@@right+$mp3gr_scale_factors+ecx]
  2311                                  
  2312                                  .use_default_pos:
  2313 000013DB 888413B0130000                          mov     [ebx+edx+5040], al ; [ebx+@@right+$mp3gr_scale_factors+edx]
  2314 000013E2 45                                      inc     ebp             ; blk
  2315 000013E3 3B2D[D8440500]                          cmp     ebp, [_@@max_blocks]
  2316 000013E9 72C0                                    jb      short .adjust_last_prev_lop
  2317 000013EB E850000000                              call    _@@apply_i_stereo
  2318                                  
  2319                                  		; 16/02/2025
  2320                                  
  2321                                  .no_rdtsc_supported@@@@:
  2322 000013F0 C3                                      retn
  2323                                  
  2324                                  
  2325                                  ; =============== S U B R O U T I N E =======================================
  2326                                  
  2327                                  
  2328                                  _@@find_top_bands:
  2329 000013F1 C705[D4440500]FFFF-                     mov     dword [_@@max_bands], 0FFFFFFh ; set maxband[0..2]=(-1)
  2329 000013F9 FF00               
  2330 000013FB 8DB3E0130000                            lea     esi, [ebx+5088] ; [ebx+@@right+$mp3gr_sb_hybrid]
  2331 00001401 31D2                                    xor     edx, edx
  2332                                  
  2333                                  .find_top_lop_iii:                    
  2334 00001403 31C9                                    xor     ecx, ecx        ; for (i = 0; i < nbands; i++)
  2335                                  
  2336                                  .find_top_lop_kkk:                    
  2337 00001405 8B048E                                  mov     eax, [esi+ecx*4] ; for (k = 0; k < sfb[i]; k += 2)
  2338 00001408 0B448E04                                or      eax, [esi+ecx*4+4]
  2339 0000140C 750D                                    jnz     short .found_nonzero
  2340 0000140E 83C102                                  add     ecx, 2
  2341 00001411 3A8A[E0440500]                          cmp     cl, [_@@sfb_array+edx]
  2342 00001417 72EC                                    jb      short .find_top_lop_kkk
  2343 00001419 EB11                                    jmp     short .find_top_next
  2344                                  
  2345                                  .found_nonzero:
  2346 0000141B 89D0                                    mov     eax, edx
  2347 0000141D F635[B0AE0000]                          div     byte [_@@const_3]
  2348 00001423 0FB6C4                                  movzx   eax, ah         ; remainder (mod 3)
  2349 00001426 8890[D4440500]                          mov     [_@@max_bands+eax], dl ; max_bands[0..2]=i
  2350                                  
  2351                                  .find_top_next:
  2352 0000142C 0FB682[E0440500]                        movzx   eax, byte [_@@sfb_array+edx]
  2353 00001433 8D3486                                  lea     esi, [esi+eax*4]
  2354 00001436 42                                      inc     edx             ; next
  2355 00001437 3B15[14450500]                          cmp     edx, [_@@n_sfb]
  2356 0000143D 72C4                                    jb      short .find_top_lop_iii
  2357 0000143F C3                                      retn
  2358                                  
  2359                                  ; =============== S U B R O U T I N E =======================================
  2360                                  
  2361                                  
  2362                                  _@@apply_i_stereo:
  2363 00001440 B8[C8A80000]                            mov     eax, mp3_is_table_normal
  2364 00001445 B907000000                              mov     ecx, 7
  2365 0000144A 833D[D4C20000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
  2366 00001451 7425                                    jz      short .this_lsf
  2367 00001453 8B8354130000                            mov     eax, [ebx+4948] ; [ebx+@@right+$mp3gr_scalefac_compress]
  2368 00001459 83E001                                  and     eax, 1          ; bit0
  2369 0000145C F705[D0C20000]0200-                     test    dword [mp3_hdr_mode_ext], 2 ; MODE_EXT_MS_STEREO
  2369 00001464 0000               
  2370 00001466 7403                                    jz      short .no_ms
  2371 00001468 83C802                                  or      eax, 2          ; bit1=mul_1.414
  2372                                  
  2373                                  .no_ms:
  2374 0000146B C1E009                                  shl     eax, 9          ; N*40h*2*4
  2375 0000146E 05[8C0C0500]                            add     eax, mp3_is_table_lsf
  2376 00001473 B940000000                              mov     ecx, 64         ; max (must be below NO_INTENSITY_FLAG)
  2377                                  
  2378                                  .this_lsf:
  2379 00001478 890D[DC440500]                          mov     [_@@max_pos], ecx ; 7 or 64
  2380 0000147E A3[08450500]                            mov     [_@@is_tab], eax ; table
  2381 00001483 8DB3A0000000                            lea     esi, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid]
  2382 00001489 31C9                                    xor     ecx, ecx        ; iii ; for (i = 0; sfb[i]; i++)
  2383                                  
  2384                                  .apply_lop_i:
  2385 0000148B 0FB6A9[E0440500]                        movzx   ebp, byte [_@@sfb_array+ecx] ; if ((int)i > max_band[i % 3]
  2386                                                                          ; && ipos < max_pos)
  2387 00001492 89C8                                    mov     eax, ecx
  2388 00001494 F635[B0AE0000]                          div     byte [_@@const_3] ; max_band[i % 3]
  2389 0000149A 0FB6C4                                  movzx   eax, ah         ; remainder (mod 3)
  2390 0000149D 3A88[D4440500]                          cmp     cl, [_@@max_bands+eax] ; iii,max_bands[0..2];
  2391 000014A3 7E38                                    jle     short .apply_ms_stereo
  2392 000014A5 0FB6BC0BB0130000                        movzx   edi, byte [ebx+ecx+5040] ; [ebx+@@right+$mp3gr_scale_factors+ecx]
  2393                                                                          ; @@right = $mp3gr_entrysiz*2 = 4928
  2394                                                                          ; $mp3gr_scale_factors = 112
  2395 000014AD 3B3D[DC440500]                          cmp     edi, [_@@max_pos] ; check ipos
  2396 000014B3 7328                                    jnb     short .apply_ms_stereo
  2397 000014B5 C1E703                                  shl     edi, 3          ; mul 2*4
  2398 000014B8 033D[08450500]                          add     edi, [_@@is_tab]
  2399                                  
  2400                                  .apply_pan_lop:
  2401 000014BE 8B06                                    mov     eax, [esi]      ; tmp = granule.ch0.sb_hybrid
  2402 000014C0 C1E002                                  shl     eax, 2
  2403 000014C3 F76F04                                  imul    dword [edi+4] ; v1
  2404 000014C6 899640130000                            mov     [esi+4928], edx ; [esi+@@right]
  2405                                                                          ; granule.ch1.sb_hybrid = tmp*v1
  2406 000014CC 8B06                                    mov     eax, [esi]      ; tmp = granule.ch0.sb_hybrid
  2407 000014CE C1E002                                  shl     eax, 2
  2408 000014D1 F72F                                    imul    dword [edi] ; v0
  2409 000014D3 8916                                    mov     [esi], edx      ; granule.ch0.sb_hybrid = tmp*v0
  2410 000014D5 83C604                                  add     esi, 4
  2411 000014D8 4D                                      dec     ebp
  2412 000014D9 75E3                                    jnz     short .apply_pan_lop
  2413 000014DB EB2C                                    jmp     short .apply_next
  2414                                  
  2415                                  .apply_ms_stereo:
  2416 000014DD F705[D0C20000]0200-                     test	dword [mp3_hdr_mode_ext], 2 ; MODE_EXT_MS_STEREO
  2416 000014E5 0000               
  2417 000014E7 741D                                    jz	short .apply_none
  2418                                  
  2419                                  .ms_stereo_lop:
  2420 000014E9 8B06                                    mov     eax, [esi]      ; tmp0 = granule.ch0.sb_hybrid[i]
  2421 000014EB 8B9640130000                            mov     edx, [esi+4928] ; [esi+@@right]
  2422                                                                          ; tmp1 = granule.ch1.sb_hybrid[i]
  2423 000014F1 29D0                                    sub     eax, edx        ; tmp0 - tmp1
  2424 000014F3 8D1450                                  lea     edx, [eax+edx*2] ; tmp0 + tmp1
  2425 000014F6 8916                                    mov     [esi], edx      ; granule.ch0.sb_hybrid[i] = tmp0 + tmp1
  2426 000014F8 898640130000                            mov     [esi+4928], eax ; [esi+@@right]
  2427                                                                          ; granule.ch1.sb_hybrid[i] = tmp0 - tmp1
  2428 000014FE 83C604                                  add     esi, 4
  2429 00001501 4D                                      dec     ebp
  2430 00001502 75E5                                    jnz     short .ms_stereo_lop
  2431 00001504 EB03                                    jmp     short .apply_next
  2432                                  
  2433                                  .apply_none:
  2434 00001506 8D34AE                                  lea     esi, [esi+ebp*4] ; skip, keep unchanged
  2435                                  
  2436                                  .apply_next:
  2437 00001509 41                                      inc     ecx             ; iii
  2438 0000150A 3B0D[14450500]                          cmp     ecx, [_@@n_sfb]
  2439 00001510 0F8275FFFFFF                            jb      .apply_lop_i   ; next
  2440 00001516 C3                                      retn
  2441                                  
  2442                                  ; =============== S U B R O U T I N E =======================================
  2443                                  
  2444                                  
  2445                                  mp3_reorder_block:
  2446                                  		; 16/02/2025
  2447                                  
  2448                                  .no_rdtsc_supported:
  2449 00001517 807B2C02                                cmp	byte [ebx+44], 2 ; ebx+$mp3gr_block_type] ; only for type 2
  2450 0000151B 7565                                    jnz	short .no_reorder
  2451 0000151D 8DB3A0000000                            lea	esi, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid] ; ptr+0
  2452 00001523 807B3000                                cmp	byte [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
  2453 00001527 7412                                    jz	short .this_src
  2454 00001529 81C690000000                            add	esi, 144        ; 36*4 ; ptr+36*4
  2455 0000152F 833D[B4C20000]08                        cmp	dword [mp3_hdr_sample_rate_index], 8
  2456 00001536 7503                                    jnz	short .this_src
  2457 00001538 83C630                                  add	esi, 48         ; 12*4 ; additionally to above 36*4 ; ptr+48*4
  2458                                  
  2459                                  .this_src:
  2460 0000153B 8B531C                                  mov     edx, [ebx+28]   ; [ebx+$mp3gr_short_start] ; can be 13
  2461 0000153E 83FA0D                                  cmp     edx, 13
  2462 00001541 733F                                    jnb     short .no_reorder
  2463 00001543 C7435C40020000                          mov     dword [ebx+92], 576 ; [ebx+$mp3gr_num_nonzero_hybrids]
  2464                                  
  2465                                  .outer_lop:
  2466 0000154A A1[B4C20000]                            mov     eax, [mp3_hdr_sample_rate_index]
  2467 0000154F 6BC00D                                  imul    eax, 13         ; X*13
  2468 00001552 0FB68C10[D8A50000]                      movzx   ecx, byte [mp3_band_size_short+eax+edx] ; [X*13+Y]
  2469 0000155A BF[18450500]                            mov     edi, _@@tmp
  2470 0000155F 60                                      pusha
  2471 00001560 89CA                                    mov     edx, ecx        ; step=len (4..44) ; copy LEN*3 dwords to tmp
  2472                                  
  2473                                  .inner_lop:
  2474 00001562 8B06                                    mov     eax, [esi]
  2475 00001564 AB                                      stosd
  2476 00001565 8B0496                                  mov     eax, [esi+edx*4] ; copy 3 dwords
  2477 00001568 AB                                      stosd
  2478 00001569 8B04D6                                  mov     eax, [esi+edx*8]
  2479 0000156C AB                                      stosd
  2480 0000156D 83C604                                  add     esi, 4
  2481 00001570 E2F0                                    loop    .inner_lop
  2482 00001572 61                                      popa
  2483 00001573 8D0C49                                  lea     ecx, [ecx+ecx*2] ; len*3
  2484 00001576 87FE                                    xchg    esi, edi        ; copy LEN*3 dwords back from tmp
  2485 00001578 F3A5                                    rep movsd
  2486 0000157A 87FE                                    xchg    esi, edi
  2487 0000157C 42                                      inc     edx
  2488 0000157D 83FA0D                                  cmp     edx, 13
  2489 00001580 72C8                                    jb      short .outer_lop ; next
  2490                                  
  2491                                  .no_reorder:
  2492                                  		; 16/02/2025
  2493                                  
  2494                                  .no_rdtsc_supported@:
  2495 00001582 C3                                      retn
  2496                                  
  2497                                  
  2498                                  ; =============== S U B R O U T I N E =======================================
  2499                                  
  2500                                  
  2501                                  mp3_compute_antialias:
  2502                                  		; 16/02/2025
  2503                                  
  2504                                  .no_rdtsc_supported:
  2505 00001583 8B435C                                  mov     eax, [ebx+92]   ; [ebx+$mp3gr_num_nonzero_hybrids]
  2506 00001586 83C008                                  add     eax, 8          ; 9-1 ; 0..576+8
  2507 00001589 31D2                                    xor     edx, edx
  2508 0000158B B909000000                              mov     ecx, 9
  2509 00001590 F7F1                                    div     ecx             ; (num/9) ; 0..64
  2510 00001592 894360                                  mov     [ebx+60h], eax
  2511 00001595 D1E8                                    shr     eax, 1          ; (num/18) ; 0..32
  2512 00001597 0F84B8010000                            jz      .no_antialias  ; 0 (when num/9 = 0..1)
  2513 0000159D 89C1                                    mov     ecx, eax        ; 1..32
  2514 0000159F C1E805                                  shr     eax, 5          ; 0..1
  2515 000015A2 29C1                                    sub     ecx, eax        ; 1..31 ; len excluding zeropadding
  2516 000015A4 807B2C02                                cmp     byte [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  2517 000015A8 750F                                    jnz     short .this_len ; antialias only "long" bands
  2518 000015AA 807B3000                                cmp     byte [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
  2519 000015AE 0F84A1010000                            jz      .no_antialias
  2520 000015B4 B901000000                              mov     ecx, 1          ; check this for 8000Hz case
  2521                                  
  2522                                  .this_len:
  2523 000015B9 8D440901                                lea     eax, [1+ecx*2]
  2524 000015BD 394360                                  cmp     [ebx+96], eax   ; [ebx+$mp3gr_num_nonzero_hybrids_div9]
  2525 000015C0 7703                                    ja      short .is_bigger
  2526 000015C2 894360                                  mov     [ebx+96], eax   ; opdate highest
  2527                                                                          ; (nonzero required for l3-si_huff.bit)
  2528                                  
  2529                                  .is_bigger:
  2530 000015C5 53                                      push    ebx
  2531 000015C6 8D9BA0000000                            lea     ebx, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid]
  2532                                  
  2533                                  .lop:
  2534 000015CC 83C348                                  add     ebx, 72         ; 18*4
  2535 000015CF 8B73FC                                  mov     esi, [ebx-4]    ; IRP nn,0,1,2,3,4,5,6,7 ; INT_AA(nn=0..7)
  2536 000015D2 8B3B                                    mov     edi, [ebx]      ; @@def_csa macro nn,cs,ca
  2537                                                                          ;   mp3_csa_&nn&_cs equ cs
  2538                                                                          ;   mp3_csa_&nn&_ca equ ca
  2539                                                                          ;  endm
  2540                                                                          ; constants for mp3_csa_table
  2541 000015D4 C1E602                                  shl     esi, 2          ; tmp0 = ptr[-nn-1]*4
  2542 000015D7 C1E702                                  shl     edi, 2          ; tmp1 = ptr[+nn]*4
  2543 000015DA 8D043E                                  lea     eax, [esi+edi]  ; tmp2 = tmp0+tmp1
  2544 000015DD BD032AE136                              mov     ebp, 36E12A03h  ; @@def_csa 0,36E12A03h,-20ED7F9Ah  ;-0.6
  2545                                                                          ; mp3_csa_&nn&_cs
  2546 000015E2 F7ED                                    imul    ebp             ; tmp2 = (tmp2*csa[0])
  2547 000015E4 89D5                                    mov     ebp, edx
  2548 000015E6 B8635631A8                              mov     eax, -57CEA99Dh ; mp3_csa_&nn&_ca-mp3_csa_&nn&_cs
  2549 000015EB F7EE                                    imul    esi             ; tmp0 = (tmp2+(tmp0*csa[3]))
  2550 000015ED 01EA                                    add     edx, ebp
  2551 000015EF 8913                                    mov     [ebx], edx      ; [ebx+(nn)*4]
  2552 000015F1 B869AAF315                              mov     eax, 15F3AA69h  ; mp3_csa_&nn&_ca+mp3_csa_&nn&_cs
  2553 000015F6 F7EF                                    imul    edi             ; tmp1 = (tmp2-(tmp1*csa[2]))
  2554 000015F8 29D5                                    sub     ebp, edx
  2555 000015FA 896BFC                                  mov     [ebx-4], ebp    ; [ebx-(nn+1)*4]
  2556 000015FD 8B73F8                                  mov     esi, [ebx-8]
  2557 00001600 8B7B04                                  mov     edi, [ebx+4]
  2558 00001603 C1E602                                  shl     esi, 2
  2559 00001606 C1E702                                  shl     edi, 2
  2560 00001609 8D043E                                  lea     eax, [esi+edi]
  2561 0000160C BDFD756E38                              mov     ebp, 386E75FDh  ; @@def_csa 1,386E75FDh,-1E30DB48h  ;-0.535
  2562 00001611 F7ED                                    imul    ebp
  2563 00001613 89D5                                    mov     ebp, edx
  2564 00001615 B8BBAE60A9                              mov     eax, -569F5145h
  2565 0000161A F7EE                                    imul    esi
  2566 0000161C 01EA                                    add     edx, ebp
  2567 0000161E 895304                                  mov     [ebx+4], edx    ; [ebx+(nn)*4]
  2568 00001621 B8B59A3D1A                              mov     eax, 1A3D9AB5h
  2569 00001626 F7EF                                    imul    edi
  2570 00001628 29D5                                    sub     ebp, edx
  2571 0000162A 896BF8                                  mov     [ebx-8], ebp    ; [ebx-(nn+1)*4]
  2572 0000162D 8B73F4                                  mov     esi, [ebx-12]
  2573 00001630 8B7B08                                  mov     edi, [ebx+8]
  2574 00001633 C1E602                                  shl     esi, 2
  2575 00001636 C1E702                                  shl     edi, 2
  2576 00001639 8D043E                                  lea     eax, [esi+edi]
  2577 0000163C BD3EB7C63C                              mov     ebp, 3CC6B73Eh  ;  @@def_csa 2,3CC6B73Eh,-140E604Fh  ;-0.33
  2578 00001641 F7ED                                    imul    ebp
  2579 00001643 89D5                                    mov     ebp, edx
  2580 00001645 B873E82AAF                              mov     eax, -50D5178Dh
  2581 0000164A F7EE                                    imul    esi
  2582 0000164C 01EA                                    add     edx, ebp
  2583 0000164E 895308                                  mov     [ebx+8], edx    ; [ebx+(nn)*4]
  2584 00001651 B8EF56B828                              mov     eax, 28B856EFh
  2585 00001656 F7EF                                    imul    edi
  2586 00001658 29D5                                    sub     ebp, edx
  2587 0000165A 896BF4                                  mov     [ebx-12], ebp   ; [ebx-(nn+1)*4]
  2588 0000165D 8B73F0                                  mov     esi, [ebx-16]
  2589 00001660 8B7B0C                                  mov     edi, [ebx+12]
  2590 00001663 C1E602                                  shl     esi, 2
  2591 00001666 C1E702                                  shl     edi, 2
  2592 00001669 8D043E                                  lea     eax, [esi+edi]
  2593 0000166C BD55A0EE3E                              mov     ebp, 3EEEA055h  ; @@def_csa 3,3EEEA055h,-0BA47742h  ;-0.185
  2594 00001671 F7ED                                    imul    ebp
  2595 00001673 89D5                                    mov     ebp, edx
  2596 00001675 B869E86CB5                              mov     eax, -4A931797h
  2597 0000167A F7EE                                    imul    esi
  2598 0000167C 01EA                                    add     edx, ebp
  2599 0000167E 89530C                                  mov     [ebx+12], edx   ; [ebx+(nn)*4]
  2600 00001681 B813294A33                              mov     eax, 334A2913h
  2601 00001686 F7EF                                    imul    edi
  2602 00001688 29D5                                    sub     ebp, edx
  2603 0000168A 896BF0                                  mov     [ebx-16], ebp   ; [ebx-(nn+1)*4]
  2604 0000168D 8B73EC                                  mov     esi, [ebx-20]   ; ebx-(nn+1)*4] ; tmp0 = ptr[-nn-1]
  2605 00001690 8B7B10                                  mov     edi, [ebx+16]   ; [ebx+(nn)*4] ; tmp1 = ptr[+nn]
  2606 00001693 C1E602                                  shl     esi, 2
  2607 00001696 C1E702                                  shl     edi, 2
  2608 00001699 8D043E                                  lea     eax, [esi+edi]  ; tmp2 = tmp0+tmp1
  2609 0000169C BD5C90B63F                              mov     ebp, 3FB6905Ch  ; @@def_csa 4,3FB6905Ch,-060D80E9h  ;-0.095
  2610 000016A1 F7ED                                    imul    ebp             ; tmp2 = (tmp2*csa[0])
  2611 000016A3 89D5                                    mov     ebp, edx
  2612 000016A5 B8BBEE3BBA                              mov     eax, -45C41145h
  2613 000016AA F7EE                                    imul    esi             ; tmp0 = (tmp2+(tmp0*csa[3]))
  2614 000016AC 01EA                                    add     edx, ebp
  2615 000016AE 895310                                  mov     [ebx+16], edx   ; [ebx+(nn)*4]
  2616 000016B1 B8730FA939                              mov     eax, 39A90F73h
  2617 000016B6 F7EF                                    imul    edi             ; tmp1 = (tmp2-(tmp1*csa[2]))
  2618 000016B8 29D5                                    sub     ebp, edx
  2619 000016BA 896BEC                                  mov     [ebx-20], ebp   ; [ebx-(nn+1)*4]
  2620 000016BD 8B73E8                                  mov     esi, [ebx-24]
  2621 000016C0 8B7B14                                  mov     edi, [ebx+20]
  2622 000016C3 C1E602                                  shl     esi, 2
  2623 000016C6 C1E702                                  shl     edi, 2
  2624 000016C9 8D043E                                  lea     eax, [esi+edi]
  2625 000016CC BD213FF23F                              mov     ebp, 3FF23F21h  ; @@def_csa 5,3FF23F21h,-029F2E1Bh  ;-0.041
  2626 000016D1 F7ED                                    imul    ebp
  2627 000016D3 89D5                                    mov     ebp, edx
  2628 000016D5 B8C4926EBD                              mov     eax, -42916D3Ch
  2629 000016DA F7EE                                    imul    esi
  2630 000016DC 01EA                                    add     edx, ebp
  2631 000016DE 895314                                  mov     [ebx+20], edx   ; [ebx+(nn)*4]
  2632 000016E1 B80611533D                              mov     eax, 3D531106h
  2633 000016E6 F7EF                                    imul    edi
  2634 000016E8 29D5                                    sub     ebp, edx
  2635 000016EA 896BE8                                  mov     [ebx-24], ebp   ; [ebx-(nn+1)*4]
  2636 000016ED 8B73E4                                  mov     esi, [ebx-28]
  2637 000016F0 8B7B18                                  mov     edi, [ebx+24]
  2638 000016F3 C1E602                                  shl     esi, 2
  2639 000016F6 C1E702                                  shl     edi, 2
  2640 000016F9 8D043E                                  lea     eax, [esi+edi]
  2641 000016FC BD3259FE3F                              mov     ebp, 3FFE5932h  ; @@def_csa 6,3FFE5932h,-00E8A11Ch  ;-0.0142
  2642 00001701 F7ED                                    imul    ebp
  2643 00001703 89D5                                    mov     ebp, edx
  2644 00001705 B8B20519BF                              mov     eax, -40E6FA4Eh
  2645 0000170A F7EE                                    imul    esi
  2646 0000170C 01EA                                    add     edx, ebp
  2647 0000170E 895318                                  mov     [ebx+24], edx   ; [ebx+(nn)*4]
  2648 00001711 B816B8153F                              mov     eax, 3F15B816h
  2649 00001716 F7EF                                    imul    edi
  2650 00001718 29D5                                    sub     ebp, edx
  2651 0000171A 896BE4                                  mov     [ebx-28], ebp   ; [ebx-(nn+1)*4]
  2652 0000171D 8B73E0                                  mov     esi, [ebx-32]
  2653 00001720 8B7B1C                                  mov     edi, [ebx+28]
  2654 00001723 C1E602                                  shl     esi, 2
  2655 00001726 C1E702                                  shl     edi, 2
  2656 00001729 8D043E                                  lea     eax, [esi+edi]
  2657 0000172C BD4BE3FF3F                              mov     ebp, 3FFFE34Bh  ; @@def_csa 7,3FFFE34Bh,-003C9ED1h  ;-0.0037
  2658 00001731 F7ED                                    imul    ebp
  2659 00001733 89D5                                    mov     ebp, edx
  2660 00001735 B8E47DC3BF                              mov     eax, -403C821Ch
  2661 0000173A F7EE                                    imul    esi
  2662 0000173C 01EA                                    add     edx, ebp
  2663 0000173E 89531C                                  mov     [ebx+28], edx   ; [ebx+(nn)*4]
  2664 00001741 B87A44C33F                              mov     eax, 3FC3447Ah
  2665 00001746 F7EF                                    imul    edi
  2666 00001748 29D5                                    sub     ebp, edx
  2667 0000174A 896BE0                                  mov     [ebx-32], ebp   ; [ebx-(nn+1)*4]
  2668 0000174D 49                                      dec     ecx
  2669 0000174E 0F8578FEFFFF                            jnz     .lop
  2670 00001754 5B                                      pop     ebx
  2671                                  
  2672                                  .no_antialias:
  2673                                  		; 16/02/2025
  2674                                  
  2675                                  .no_rdtsc_supported@:
  2676 00001755 C3                                      retn
  2677                                  
  2678                                  
  2679                                  ; =============== S U B R O U T I N E =======================================
  2680                                  
  2681                                  
  2682                                  mp3_imdct36:
  2683 00001756 8B06                                    mov     eax, [esi]      ; in: esi=src (sb_hybrid)
  2684                                                                          ; in: edi=dst (sb_samples)
  2685                                                                          ; in: ebx=buf (mdct_buf)
  2686                                                                          ; in: ebp=win (mdct_win)
  2687                                                                          ;
  2688                                                                          ; [esi+0*4]
  2689 00001758 8B5604                                  mov     edx, [esi+4]    ; IRP i,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17
  2690 0000175B 01D0                                    add     eax, edx        ; IF i AND 1 (*) ; mov edx,[esi+i*4] ; val[i]
  2691                                                                          ;  add val[i-1]
  2692 0000175D 894604                                  mov     [esi+4], eax    ;  IF i GT 1
  2693                                                                          ;   add  ecx,eax ; add val[i-2]
  2694                                                                          ;   mov  [esi+(i)*4],ecx
  2695                                                                          ;  ELSE
  2696                                                                          ;   mov  [esi+(i)*4],eax
  2697 00001760 89C1                                    mov     ecx, eax        ;  memorize as val[i-2]
  2698 00001762 8B4608                                  mov     eax, [esi+8]    ; ELSE (*) ; [esi+i*4] ; val[i]
  2699 00001765 01C2                                    add     edx, eax        ;  add val[i-1]
  2700 00001767 895608                                  mov     [esi+8], edx    ; [esi+(i)*4
  2701 0000176A 8B560C                                  mov     edx, [esi+12]
  2702 0000176D 01D0                                    add     eax, edx
  2703 0000176F 01C1                                    add     ecx, eax
  2704 00001771 894E0C                                  mov     [esi+12], ecx
  2705 00001774 89C1                                    mov     ecx, eax
  2706 00001776 8B4610                                  mov     eax, [esi+16]
  2707 00001779 01C2                                    add     edx, eax
  2708 0000177B 895610                                  mov     [esi+16], edx
  2709 0000177E 8B5614                                  mov     edx, [esi+20]
  2710 00001781 01D0                                    add     eax, edx
  2711 00001783 01C1                                    add     ecx, eax
  2712 00001785 894E14                                  mov     [esi+20], ecx
  2713 00001788 89C1                                    mov     ecx, eax
  2714 0000178A 8B4618                                  mov     eax, [esi+24]
  2715 0000178D 01C2                                    add     edx, eax
  2716 0000178F 895618                                  mov     [esi+24], edx
  2717 00001792 8B561C                                  mov     edx, [esi+28]
  2718 00001795 01D0                                    add     eax, edx
  2719 00001797 01C1                                    add     ecx, eax
  2720 00001799 894E1C                                  mov     [esi+28], ecx
  2721 0000179C 89C1                                    mov     ecx, eax
  2722 0000179E 8B4620                                  mov     eax, [esi+32]
  2723 000017A1 01C2                                    add     edx, eax
  2724 000017A3 895620                                  mov     [esi+32], edx
  2725 000017A6 8B5624                                  mov     edx, [esi+36]
  2726 000017A9 01D0                                    add     eax, edx
  2727 000017AB 01C1                                    add     ecx, eax
  2728 000017AD 894E24                                  mov     [esi+36], ecx
  2729 000017B0 89C1                                    mov     ecx, eax
  2730 000017B2 8B4628                                  mov     eax, [esi+40]
  2731 000017B5 01C2                                    add     edx, eax
  2732 000017B7 895628                                  mov     [esi+40], edx
  2733 000017BA 8B562C                                  mov     edx, [esi+44]
  2734 000017BD 01D0                                    add     eax, edx
  2735 000017BF 01C1                                    add     ecx, eax
  2736 000017C1 894E2C                                  mov     [esi+44], ecx
  2737 000017C4 89C1                                    mov     ecx, eax
  2738 000017C6 8B4630                                  mov     eax, [esi+48]
  2739 000017C9 01C2                                    add     edx, eax
  2740 000017CB 895630                                  mov     [esi+48], edx
  2741 000017CE 8B5634                                  mov     edx, [esi+52]
  2742 000017D1 01D0                                    add     eax, edx
  2743 000017D3 01C1                                    add     ecx, eax
  2744 000017D5 894E34                                  mov     [esi+52], ecx
  2745 000017D8 89C1                                    mov     ecx, eax
  2746 000017DA 8B4638                                  mov     eax, [esi+56]
  2747 000017DD 01C2                                    add     edx, eax
  2748 000017DF 895638                                  mov     [esi+56], edx
  2749 000017E2 8B563C                                  mov     edx, [esi+60]
  2750 000017E5 01D0                                    add     eax, edx
  2751 000017E7 01C1                                    add     ecx, eax
  2752 000017E9 894E3C                                  mov     [esi+60], ecx
  2753 000017EC 89C1                                    mov     ecx, eax
  2754 000017EE 8B4640                                  mov     eax, [esi+64]
  2755 000017F1 01C2                                    add     edx, eax
  2756 000017F3 895640                                  mov     [esi+64], edx
  2757 000017F6 8B5644                                  mov     edx, [esi+68]
  2758 000017F9 01D0                                    add     eax, edx
  2759 000017FB 01C1                                    add     ecx, eax
  2760 000017FD 894E44                                  mov     [esi+68], ecx
  2761 00001800 89C1                                    mov     ecx, eax
  2762 00001802 53                                      push    ebx
  2763 00001803 55                                      push    ebp
  2764 00001804 57                                      push    edi
  2765 00001805 8B0E                                    mov     ecx, [esi]      ; IRP j,0,1
  2766 00001807 8B5E30                                  mov     ebx, [esi+48]   ; t1 = [esi+(0*2+j)*4], t0 = [esi+(6*2+j)*4]
  2767 0000180A 8B7E20                                  mov     edi, [esi+32]   ; t2 = [esi+(4*2+j)*4]
  2768 0000180D 037E40                                  add     edi, [esi+64]   ; + [esi+(8*2+j)*4]
  2769 00001810 2B7E10                                  sub     edi, [esi+16]   ; - [esi+(2*2+j)*4]
  2770 00001813 8D2C4B                                  lea     ebp, [ebx+ecx*2] ; t2 = src[4*2+j] + src[8*2+j] - src[2*2+j]
  2771                                                                          ; t3 = [t1*2+t0]
  2772 00001816 D1FD                                    sar     ebp, 1          ; sar @@t3,1
  2773 00001818 29D9                                    sub     ecx, ebx        ; sub @@t1,@@t0
  2774 0000181A 89C8                                    mov     eax, ecx        ; @@SUM [@@tmp+(16+j)*4],@@t1,add,@@t2
  2775 0000181C 01F8                                    add     eax, edi
  2776 0000181E A3[644E0500]                            mov     [_@@@tmp+40h], eax ; [@@tmp+(16+j)*4]
  2777 00001823 D1FF                                    sar     edi, 1          ; sar @@t2,1
  2778 00001825 89C8                                    mov     eax, ecx        ; @@SUM [@@tmp+(6+j)*4],@@t1,sub,@@t2
  2779 00001827 29F8                                    sub     eax, edi
  2780 00001829 A3[3C4E0500]                            mov     [_@@@tmp+18h], eax ; [@@tmp+(6+j)*4]
  2781 0000182E 8B4610                                  mov     eax, [esi+16]   ; [esi+(4*2+j)*4]
  2782 00001831 034620                                  add     eax, [esi+32]   ; [esi+(2*2+j)*4]
  2783 00001834 D1E0                                    shl     eax, 1
  2784 00001836 BA0AD94778                              mov     edx, 7847D90Ah  ; C2
  2785 0000183B F7EA                                    imul    edx
  2786 0000183D 89D3                                    mov     ebx, edx
  2787 0000183F 8B4620                                  mov     eax, [esi+32]
  2788 00001842 2B4640                                  sub     eax, [esi+64]
  2789 00001845 BA04CB8BD3                              mov     edx, 0D38BCB04h ; negC8
  2790 0000184A F7EA                                    imul    edx
  2791 0000184C 89D1                                    mov     ecx, edx
  2792 0000184E 8B4610                                  mov     eax, [esi+16]
  2793 00001851 034640                                  add     eax, [esi+64]
  2794 00001854 D1E0                                    shl     eax, 1
  2795 00001856 BA7541F29D                              mov     edx, 9DF24175h  ; negC4
  2796 0000185B F7EA                                    imul    edx
  2797 0000185D 89E8                                    mov     eax, ebp
  2798 0000185F 01D8                                    add     eax, ebx
  2799 00001861 01C8                                    add     eax, ecx
  2800 00001863 A3[2C4E0500]                            mov     [_@@@tmp+8], eax
  2801 00001868 89E8                                    mov     eax, ebp
  2802 0000186A 29D8                                    sub     eax, ebx
  2803 0000186C 29D0                                    sub     eax, edx
  2804 0000186E A3[4C4E0500]                            mov     [_@@@tmp+28h], eax
  2805 00001873 89E8                                    mov     eax, ebp
  2806 00001875 01D0                                    add     eax, edx
  2807 00001877 29C8                                    sub     eax, ecx
  2808 00001879 A3[5C4E0500]                            mov     [_@@@tmp+38h], eax
  2809 0000187E 8B4628                                  mov     eax, [esi+40]
  2810 00001881 034638                                  add     eax, [esi+56]
  2811 00001884 2B4608                                  sub     eax, [esi+8]
  2812 00001887 D1E0                                    shl     eax, 1
  2813 00001889 BA5F142691                              mov     edx, 9126145Fh  ; negC3
  2814 0000188E F7EA                                    imul    edx
  2815 00001890 8915[344E0500]                          mov     [_@@@tmp+10h], edx
  2816 00001896 8B4608                                  mov     eax, [esi+8]
  2817 00001899 034628                                  add     eax, [esi+40]
  2818 0000189C D1E0                                    shl     eax, 1
  2819 0000189E BA332E0E7E                              mov     edx, 7E0E2E33h  ; C1
  2820 000018A3 F7EA                                    imul    edx
  2821 000018A5 89D7                                    mov     edi, edx
  2822 000018A7 8B4628                                  mov     eax, [esi+40]
  2823 000018AA 2B4638                                  sub     eax, [esi+56]
  2824 000018AD BA2E5E71A8                              mov     edx, 0A8715E2Eh ; negC7
  2825 000018B2 F7EA                                    imul    edx
  2826 000018B4 89D5                                    mov     ebp, edx
  2827 000018B6 8B4608                                  mov     eax, [esi+8]
  2828 000018B9 034638                                  add     eax, [esi+56]
  2829 000018BC D1E0                                    shl     eax, 1
  2830 000018BE BAB822B9AD                              mov     edx, 0ADB922B8h ; negC5
  2831 000018C3 F7EA                                    imul    edx
  2832 000018C5 89D1                                    mov     ecx, edx
  2833 000018C7 8B4618                                  mov     eax, [esi+24]
  2834 000018CA D1E0                                    shl     eax, 1
  2835 000018CC BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  2836 000018D1 F7EA                                    imul    edx
  2837 000018D3 89E8                                    mov     eax, ebp
  2838 000018D5 01F8                                    add     eax, edi
  2839 000018D7 01D0                                    add     eax, edx
  2840 000018D9 A3[244E0500]                            mov     [_@@@tmp], eax
  2841 000018DE 89E8                                    mov     eax, ebp
  2842 000018E0 29C8                                    sub     eax, ecx
  2843 000018E2 29D0                                    sub     eax, edx
  2844 000018E4 A3[444E0500]                            mov     [_@@@tmp+20h], eax
  2845 000018E9 89F8                                    mov     eax, edi
  2846 000018EB 01C8                                    add     eax, ecx
  2847 000018ED 29D0                                    sub     eax, edx
  2848 000018EF A3[544E0500]                            mov     [_@@@tmp+30h], eax
  2849 000018F4 8B4E04                                  mov     ecx, [esi+4]
  2850 000018F7 8B5E34                                  mov     ebx, [esi+52]
  2851 000018FA 8B7E24                                  mov     edi, [esi+36]
  2852 000018FD 037E44                                  add     edi, [esi+68]
  2853 00001900 2B7E14                                  sub     edi, [esi+20]
  2854 00001903 8D2C4B                                  lea     ebp, [ebx+ecx*2]
  2855 00001906 D1FD                                    sar     ebp, 1
  2856 00001908 29D9                                    sub     ecx, ebx
  2857 0000190A 89C8                                    mov     eax, ecx
  2858 0000190C 01F8                                    add     eax, edi
  2859 0000190E A3[684E0500]                            mov     [_@@@tmp+44h], eax
  2860 00001913 D1FF                                    sar     edi, 1
  2861 00001915 89C8                                    mov     eax, ecx
  2862 00001917 29F8                                    sub     eax, edi
  2863 00001919 A3[404E0500]                            mov     [_@@@tmp+1Ch], eax
  2864 0000191E 8B4614                                  mov     eax, [esi+20]   ; t0 = MULH(2*(src[2*2+j]+src[4*2+j]),C2)
  2865 00001921 034624                                  add     eax, [esi+36]
  2866 00001924 D1E0                                    shl     eax, 1
  2867 00001926 BA0AD94778                              mov     edx, 7847D90Ah  ; C2
  2868 0000192B F7EA                                    imul    edx
  2869 0000192D 89D3                                    mov     ebx, edx
  2870 0000192F 8B4624                                  mov     eax, [esi+36]   ; t1 = MULH(src[4*2+j]-src[8*2+j],negC8)
  2871 00001932 2B4644                                  sub     eax, [esi+68]
  2872 00001935 BA04CB8BD3                              mov     edx, 0D38BCB04h ; negC8
  2873 0000193A F7EA                                    imul    edx
  2874 0000193C 89D1                                    mov     ecx, edx
  2875 0000193E 8B4614                                  mov     eax, [esi+20]   ; t2 = MULH(2*(src[2*2+j]+src[8*2+j]),negC4)
  2876 00001941 034644                                  add     eax, [esi+68]
  2877 00001944 D1E0                                    shl     eax, 1
  2878 00001946 BA7541F29D                              mov     edx, 9DF24175h  ; negC4
  2879 0000194B F7EA                                    imul    edx
  2880 0000194D 89E8                                    mov     eax, ebp        ; tmp[2+j] = t3+t0+t1
  2881 0000194F 01D8                                    add     eax, ebx
  2882 00001951 01C8                                    add     eax, ecx
  2883 00001953 A3[304E0500]                            mov     [_@@@tmp+0Ch], eax
  2884 00001958 89E8                                    mov     eax, ebp        ; tmp[10+j] = t3-t0-t2
  2885 0000195A 29D8                                    sub     eax, ebx
  2886 0000195C 29D0                                    sub     eax, edx
  2887 0000195E A3[504E0500]                            mov     [_@@@tmp+2Ch], eax
  2888 00001963 89E8                                    mov     eax, ebp        ; tmp[14+j] = t3+t2-t1
  2889 00001965 01D0                                    add     eax, edx
  2890 00001967 29C8                                    sub     eax, ecx
  2891 00001969 A3[604E0500]                            mov     [_@@@tmp+3Ch], eax
  2892 0000196E 8B462C                                  mov     eax, [esi+44]   ; tmp[4+j] = MULH(2*(src[5*2+j]+src[7*2+j]-src[1*2+j]),negC3)
  2893 00001971 03463C                                  add     eax, [esi+60]
  2894 00001974 2B460C                                  sub     eax, [esi+12]
  2895 00001977 D1E0                                    shl     eax, 1
  2896 00001979 BA5F142691                              mov     edx, 9126145Fh  ; negC3
  2897 0000197E F7EA                                    imul    edx
  2898 00001980 8915[384E0500]                          mov     [_@@@tmp+14h], edx
  2899 00001986 8B460C                                  mov     eax, [esi+12]   ; @@MULH @@t2,[esi+(1*2+j)*4],add,[esi+(5*2+j)*4],-,-              ,1,C1,-
  2900                                                                          ; t2 = MULH(2*(src[1*2+j],add,src[5*2+j]),-,-,1,C1)
  2901 00001989 03462C                                  add     eax, [esi+44]
  2902 0000198C D1E0                                    shl     eax, 1
  2903 0000198E BA332E0E7E                              mov     edx, 7E0E2E33h  ; C1
  2904 00001993 F7EA                                    imul    edx
  2905 00001995 89D7                                    mov     edi, edx
  2906 00001997 8B462C                                  mov     eax, [esi+44]   ; @@MULH @@t3,[esi+(5*2+j)*4],sub,[esi+(7*2+j)*4],-,-,
  2907                                                                          ; ,0,negC7,-
  2908                                                                          ;
  2909                                                                          ; t3 = MULH( src[5*2+j],sub,src[7*2+j],-,-,0,negC7)
  2910 0000199A 2B463C                                  sub     eax, [esi+60]
  2911 0000199D BA2E5E71A8                              mov     edx, 0A8715E2Eh ; negC7
  2912 000019A2 F7EA                                    imul    edx
  2913 000019A4 89D5                                    mov     ebp, edx
  2914 000019A6 8B460C                                  mov     eax, [esi+12]   ; t1 = MULH(2*(src[1*2+j],add,src[7*2+j]),-,-,1,negC5)
  2915 000019A9 03463C                                  add     eax, [esi+60]
  2916 000019AC D1E0                                    shl     eax, 1          ; shift = 1
  2917 000019AE BAB822B9AD                              mov     edx, 0ADB922B8h ; negC5
  2918 000019B3 F7EA                                    imul    edx
  2919 000019B5 89D1                                    mov     ecx, edx
  2920 000019B7 8B461C                                  mov     eax, [esi+28]   ; t0 = MULH(2*src[3*2+j],-,-,-,-,1,C3)
  2921 000019BA D1E0                                    shl     eax, 1
  2922 000019BC BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  2923 000019C1 F7EA                                    imul    edx
  2924 000019C3 89E8                                    mov     eax, ebp
  2925 000019C5 01F8                                    add     eax, edi
  2926 000019C7 01D0                                    add     eax, edx
  2927 000019C9 A3[284E0500]                            mov     [_@@@tmp+4], eax
  2928 000019CE 89E8                                    mov     eax, ebp
  2929 000019D0 29C8                                    sub     eax, ecx
  2930 000019D2 29D0                                    sub     eax, edx
  2931 000019D4 A3[484E0500]                            mov     [_@@@tmp+24h], eax
  2932 000019D9 89F8                                    mov     eax, edi        ; @@SUM [@@tmp+(12+j)*4],@@t2,add,@@t1,sub,edx
  2933 000019DB 01C8                                    add     eax, ecx
  2934 000019DD 29D0                                    sub     eax, edx
  2935 000019DF A3[584E0500]                            mov     [_@@@tmp+34h], eax
  2936 000019E4 5F                                      pop     edi
  2937 000019E5 5D                                      pop     ebp
  2938 000019E6 5B                                      pop     ebx
  2939 000019E7 56                                      push    esi             ; IRP j,0,1,2,3 ; j = 0
  2940 000019E8 8B15[244E0500]                          mov     edx, [_@@@tmp] ; t0 = [@@tmp+(j*4+0)*4]
  2941 000019EE 8B35[284E0500]                          mov     esi, [_@@@tmp+4] ; t1 = [@@tmp+(j*4+1)*4]
  2942 000019F4 A1[2C4E0500]                            mov     eax, [_@@@tmp+8] ; t2 = [@@tmp+(j*4+2)*4]
  2943 000019F9 8B0D[304E0500]                          mov     ecx, [_@@@tmp+0Ch] ; t2 = [@@tmp+(j*4+3)*4]
  2944 000019FF 29D0                                    sub     eax, edx        ; s2 = t2 - t0
  2945 00001A01 8D1450                                  lea     edx, [eax+edx*2] ; s0 = t2 + t0
  2946 00001A04 A3[1C4E0500]                            mov     [_@@s2], eax ; @@MULH esi,eax ,-,-,-,-,1,icos36h_&j,-
  2947                                                                          ; s2 = MULH(s2*2, icos36h[j])
  2948 00001A09 8915[184E0500]                          mov     [_@@s0], edx
  2949 00001A0F 29F1                                    sub     ecx, esi
  2950 00001A11 8D0471                                  lea     eax, [ecx+esi*2]
  2951 00001A14 D1E0                                    shl     eax, 1
  2952 00001A16 BA90953E40                              mov     edx, 403E9590h  ; icos36h_0
  2953 00001A1B F7EA                                    imul    edx
  2954 00001A1D 89D6                                    mov     esi, edx
  2955 00001A1F 89C8                                    mov     eax, ecx        ; @@MULH @@s3,ecx,-,-,-,-,shift_for_8minus&j,icos36h_8minus&j,-
  2956                                                                          ; s3 = MULL(s3,icos36[8-j]) ; <-- "MULL" with "icos36"
  2957 00001A21 C1E004                                  shl     eax, 4
  2958 00001A24 BA2C2ACA5B                              mov     edx, 5BCA2A2Ch  ; icos36h_8 (8-0)
  2959 00001A29 F7EA                                    imul    edx
  2960 00001A2B 8915[204E0500]                          mov     [_@@s3], edx
  2961 00001A31 8B0D[184E0500]                          mov     ecx, [_@@s0]
  2962 00001A37 29F1                                    sub     ecx, esi
  2963 00001A39 8D3471                                  lea     esi, [ecx+esi*2]
  2964 00001A3C 8B4524                                  mov     eax, [ebp+36]   ; @@MULH [edi+(9+j)*SBLIMIT*4],[ebp+(9+j)*4],
  2965                                                                          ; -,-,-,-,0,ecx,[ebx+(9+j)*4]
  2966                                                                          ; out[(9+j)*SBLIMIT] = MULH(t0, win[9+j])+buf[9+j]
  2967 00001A3F F7E9                                    imul    ecx
  2968 00001A41 035324                                  add     edx, [ebx+36]   ; [ebx+(9+j)*4]
  2969 00001A44 899780040000                            mov     [edi+1152], edx ; SBLIMIT=32 ; 9*SBLIMIT*4 = 1152
  2970 00001A4A 8B4520                                  mov     eax, [ebp+32]   ; @@MULH [edi+(8-j)*SBLIMIT*4],[ebp+(8-j)*4]
  2971                                                                          ; ,-,-,-,-,0,ecx,[ebx+(8-j)*4]
  2972 00001A4D F7E9                                    imul    ecx
  2973 00001A4F 035320                                  add     edx, [ebx+32]
  2974 00001A52 899700040000                            mov     [edi+1024], edx ; SBLIMIT=32 ; 8*SBLIMIT*4 = 1024
  2975 00001A58 8B456C                                  mov     eax, [ebp+108]
  2976 00001A5B F7EE                                    imul    esi
  2977 00001A5D 895324                                  mov     [ebx+36], edx
  2978 00001A60 8B4568                                  mov     eax, [ebp+104]  ; @@MULH [ebx+(8-j)*4],[ebp+(8-j+18)*4],-,-,-,-,0,esi,-
  2979 00001A63 F7EE                                    imul    esi
  2980 00001A65 895320                                  mov     [ebx+32], edx
  2981 00001A68 8B0D[1C4E0500]                          mov     ecx, [_@@s2]
  2982 00001A6E 8B35[204E0500]                          mov     esi, [_@@s3]
  2983 00001A74 29F1                                    sub     ecx, esi        ; t2 = s2 - s3
  2984 00001A76 8D3471                                  lea     esi, [ecx+esi*2] ; t3 = s2 + s3
  2985 00001A79 8B4500                                  mov     eax, [ebp+0]    ; @@MULH [edi+(0+j)*SBLIMIT*4],[ebp+(0+j)*4],
  2986                                                                          ; -,-,-,-,0,ecx,[ebx+(0+j)*4]
  2987 00001A7C F7E9                                    imul    ecx
  2988 00001A7E 0313                                    add     edx, [ebx]
  2989 00001A80 8917                                    mov     [edi], edx
  2990 00001A82 8B4544                                  mov     eax, [ebp+68]   ; @@MULH [edi+(17-j)*SBLIMIT*4],[ebp+(17-j)*4]
  2991                                                                          ; ,-,-,-,-,0,ecx,[ebx+(17-j)*4]
  2992 00001A85 F7E9                                    imul    ecx
  2993 00001A87 035344                                  add     edx, [ebx+68]
  2994 00001A8A 899780080000                            mov     [edi+2176], edx ; 17*SBLIMIT*4 = 2176
  2995 00001A90 8B4548                                  mov     eax, [ebp+72]   ; @@MULH [ebx+(0+j)*4],[ebp+(0+j+18)*4],-,-,-,-,0,esi,-
  2996 00001A93 F7EE                                    imul    esi
  2997 00001A95 8913                                    mov     [ebx], edx
  2998 00001A97 8B858C000000                            mov     eax, [ebp+140]  ; @@MULH [ebx+(17-j)*4],[ebp+(17-j+18)*4],-,-,-,-,0,esi,-
  2999 00001A9D F7EE                                    imul    esi
  3000 00001A9F 895344                                  mov     [ebx+68], edx
  3001 00001AA2 8B15[344E0500]                          mov     edx, [_@@@tmp+10h] ; IRP j,0,1,2,3 ; j = 1
  3002 00001AA8 8B35[384E0500]                          mov     esi, [_@@@tmp+14h]
  3003 00001AAE A1[3C4E0500]                            mov     eax, [_@@@tmp+18h]
  3004 00001AB3 8B0D[404E0500]                          mov     ecx, [_@@@tmp+1Ch]
  3005 00001AB9 29D0                                    sub     eax, edx
  3006 00001ABB 8D1450                                  lea     edx, [eax+edx*2]
  3007 00001ABE A3[1C4E0500]                            mov     [_@@s2], eax
  3008 00001AC3 8915[184E0500]                          mov     [_@@s0], edx
  3009 00001AC9 29F1                                    sub     ecx, esi
  3010 00001ACB 8D0471                                  lea     eax, [ecx+esi*2]
  3011 00001ACE D1E0                                    shl     eax, 1
  3012 00001AD0 BA07F74142                              mov     edx, 4241F707h  ; icos36h_1
  3013 00001AD5 F7EA                                    imul    edx
  3014 00001AD7 89D6                                    mov     esi, edx
  3015 00001AD9 89C8                                    mov     eax, ecx
  3016 00001ADB C1E002                                  shl     eax, 2
  3017 00001ADE BA1E75A37B                              mov     edx, 7BA3751Eh  ; icos36h_7 (8-1)
  3018 00001AE3 F7EA                                    imul    edx
  3019 00001AE5 8915[204E0500]                          mov     [_@@s3], edx
  3020 00001AEB 8B0D[184E0500]                          mov     ecx, [_@@s0]
  3021 00001AF1 29F1                                    sub     ecx, esi
  3022 00001AF3 8D3471                                  lea     esi, [ecx+esi*2]
  3023 00001AF6 8B4528                                  mov     eax, [ebp+40]
  3024 00001AF9 F7E9                                    imul    ecx
  3025 00001AFB 035328                                  add     edx, [ebx+40]
  3026 00001AFE 899700050000                            mov     [edi+1280], edx
  3027 00001B04 8B451C                                  mov     eax, [ebp+28]
  3028 00001B07 F7E9                                    imul    ecx
  3029 00001B09 03531C                                  add     edx, [ebx+28]
  3030 00001B0C 899780030000                            mov     [edi+896], edx
  3031 00001B12 8B4570                                  mov     eax, [ebp+112]
  3032 00001B15 F7EE                                    imul    esi
  3033 00001B17 895328                                  mov     [ebx+40], edx
  3034 00001B1A 8B4564                                  mov     eax, [ebp+100]
  3035 00001B1D F7EE                                    imul    esi
  3036 00001B1F 89531C                                  mov     [ebx+28], edx
  3037 00001B22 8B0D[1C4E0500]                          mov     ecx, [_@@s2]
  3038 00001B28 8B35[204E0500]                          mov     esi, [_@@s3]
  3039 00001B2E 29F1                                    sub     ecx, esi
  3040 00001B30 8D3471                                  lea     esi, [ecx+esi*2]
  3041 00001B33 8B4504                                  mov     eax, [ebp+4]
  3042 00001B36 F7E9                                    imul    ecx
  3043 00001B38 035304                                  add     edx, [ebx+4]
  3044 00001B3B 899780000000                            mov     [edi+128], edx
  3045 00001B41 8B4540                                  mov     eax, [ebp+64]
  3046 00001B44 F7E9                                    imul    ecx
  3047 00001B46 035340                                  add     edx, [ebx+64]
  3048 00001B49 899700080000                            mov     [edi+2048], edx
  3049 00001B4F 8B454C                                  mov     eax, [ebp+76]
  3050 00001B52 F7EE                                    imul    esi
  3051 00001B54 895304                                  mov     [ebx+4], edx
  3052 00001B57 8B8588000000                            mov     eax, [ebp+136]
  3053 00001B5D F7EE                                    imul    esi
  3054 00001B5F 895340                                  mov     [ebx+64], edx
  3055 00001B62 8B15[444E0500]                          mov     edx, [_@@@tmp+20h] ; IRP j,0,1,2,3 ; j = 2
  3056 00001B68 8B35[484E0500]                          mov     esi, [_@@@tmp+24h]
  3057 00001B6E A1[4C4E0500]                            mov     eax, [_@@@tmp+28h]
  3058 00001B73 8B0D[504E0500]                          mov     ecx, [_@@@tmp+2Ch]
  3059 00001B79 29D0                                    sub     eax, edx
  3060 00001B7B 8D1450                                  lea     edx, [eax+edx*2]
  3061 00001B7E A3[1C4E0500]                            mov     [_@@s2], eax
  3062 00001B83 8915[184E0500]                          mov     [_@@s0], edx
  3063 00001B89 29F1                                    sub     ecx, esi
  3064 00001B8B 8D0471                                  lea     eax, [ecx+esi*2]
  3065 00001B8E D1E0                                    shl     eax, 1
  3066 00001B90 BA6CBE9D46                              mov     edx, 469DBE6Ch  ; icos36h_2
  3067 00001B95 F7EA                                    imul    edx
  3068 00001B97 89D6                                    mov     esi, edx
  3069 00001B99 89C8                                    mov     eax, ecx
  3070 00001B9B C1E002                                  shl     eax, 2
  3071 00001B9E BA62ECB74B                              mov     edx, 4BB7EC62h  ; icos36h_6 (8-2)
  3072 00001BA3 F7EA                                    imul    edx
  3073 00001BA5 8915[204E0500]                          mov     [_@@s3], edx
  3074 00001BAB 8B0D[184E0500]                          mov     ecx, [_@@s0]
  3075 00001BB1 29F1                                    sub     ecx, esi
  3076 00001BB3 8D3471                                  lea     esi, [ecx+esi*2]
  3077 00001BB6 8B452C                                  mov     eax, [ebp+44]
  3078 00001BB9 F7E9                                    imul    ecx
  3079 00001BBB 03532C                                  add     edx, [ebx+44]
  3080 00001BBE 899780050000                            mov     [edi+1408], edx
  3081 00001BC4 8B4518                                  mov     eax, [ebp+24]
  3082 00001BC7 F7E9                                    imul    ecx
  3083 00001BC9 035318                                  add     edx, [ebx+24]
  3084 00001BCC 899700030000                            mov     [edi+768], edx
  3085 00001BD2 8B4574                                  mov     eax, [ebp+116]
  3086 00001BD5 F7EE                                    imul    esi
  3087 00001BD7 89532C                                  mov     [ebx+44], edx
  3088 00001BDA 8B4560                                  mov     eax, [ebp+96]
  3089 00001BDD F7EE                                    imul    esi
  3090 00001BDF 895318                                  mov     [ebx+24], edx
  3091 00001BE2 8B0D[1C4E0500]                          mov     ecx, [_@@s2]
  3092 00001BE8 8B35[204E0500]                          mov     esi, [_@@s3]
  3093 00001BEE 29F1                                    sub     ecx, esi
  3094 00001BF0 8D3471                                  lea     esi, [ecx+esi*2]
  3095 00001BF3 8B4508                                  mov     eax, [ebp+8]
  3096 00001BF6 F7E9                                    imul    ecx
  3097 00001BF8 035308                                  add     edx, [ebx+8]
  3098 00001BFB 899700010000                            mov     [edi+256], edx
  3099 00001C01 8B453C                                  mov     eax, [ebp+60]
  3100 00001C04 F7E9                                    imul    ecx
  3101 00001C06 03533C                                  add     edx, [ebx+60]
  3102 00001C09 899780070000                            mov     [edi+1920], edx
  3103 00001C0F 8B4550                                  mov     eax, [ebp+80]
  3104 00001C12 F7EE                                    imul    esi
  3105 00001C14 895308                                  mov     [ebx+8], edx
  3106 00001C17 8B8584000000                            mov     eax, [ebp+132]
  3107 00001C1D F7EE                                    imul    esi
  3108 00001C1F 89533C                                  mov     [ebx+60], edx
  3109 00001C22 8B15[544E0500]                          mov     edx, [_@@@tmp+30h] ; IRP j,0,1,2,3 ; j = 3
  3110 00001C28 8B35[584E0500]                          mov     esi, [_@@@tmp+34h]
  3111 00001C2E A1[5C4E0500]                            mov     eax, [_@@@tmp+38h]
  3112 00001C33 8B0D[604E0500]                          mov     ecx, [_@@@tmp+3Ch]
  3113 00001C39 29D0                                    sub     eax, edx
  3114 00001C3B 8D1450                                  lea     edx, [eax+edx*2]
  3115 00001C3E A3[1C4E0500]                            mov     [_@@s2], eax
  3116 00001C43 8915[184E0500]                          mov     [_@@s0], edx
  3117 00001C49 29F1                                    sub     ecx, esi
  3118 00001C4B 8D0471                                  lea     eax, [ecx+esi*2]
  3119 00001C4E D1E0                                    shl     eax, 1
  3120 00001C50 BABE2B214E                              mov     edx, 4E212BBEh  ; icos36h_3
  3121 00001C55 F7EA                                    imul    edx
  3122 00001C57 89D6                                    mov     esi, edx
  3123 00001C59 89C8                                    mov     eax, ecx
  3124 00001C5B D1E0                                    shl     eax, 1
  3125 00001C5D BADFA1946F                              mov     edx, 6F94A1DFh  ; icos36h_5 (8-3)
  3126 00001C62 F7EA                                    imul    edx
  3127 00001C64 8915[204E0500]                          mov     [_@@s3], edx
  3128 00001C6A 8B0D[184E0500]                          mov     ecx, [_@@s0]
  3129 00001C70 29F1                                    sub     ecx, esi
  3130 00001C72 8D3471                                  lea     esi, [ecx+esi*2]
  3131 00001C75 8B4530                                  mov     eax, [ebp+48]
  3132 00001C78 F7E9                                    imul    ecx
  3133 00001C7A 035330                                  add     edx, [ebx+48]
  3134 00001C7D 899700060000                            mov     [edi+1536], edx
  3135 00001C83 8B4514                                  mov     eax, [ebp+20]
  3136 00001C86 F7E9                                    imul    ecx
  3137 00001C88 035314                                  add     edx, [ebx+20]
  3138 00001C8B 899780020000                            mov     [edi+640], edx
  3139 00001C91 8B4578                                  mov     eax, [ebp+120]
  3140 00001C94 F7EE                                    imul    esi
  3141 00001C96 895330                                  mov     [ebx+30h], edx
  3142 00001C99 8B455C                                  mov     eax, [ebp+92]
  3143 00001C9C F7EE                                    imul    esi
  3144 00001C9E 895314                                  mov     [ebx+20], edx
  3145 00001CA1 8B0D[1C4E0500]                          mov     ecx, [_@@s2]
  3146 00001CA7 8B35[204E0500]                          mov     esi, [_@@s3]
  3147 00001CAD 29F1                                    sub     ecx, esi
  3148 00001CAF 8D3471                                  lea     esi, [ecx+esi*2]
  3149 00001CB2 8B450C                                  mov     eax, [ebp+12]
  3150 00001CB5 F7E9                                    imul    ecx
  3151 00001CB7 03530C                                  add     edx, [ebx+12]
  3152 00001CBA 899780010000                            mov     [edi+384], edx
  3153 00001CC0 8B4538                                  mov     eax, [ebp+56]
  3154 00001CC3 F7E9                                    imul    ecx
  3155 00001CC5 035338                                  add     edx, [ebx+56]
  3156 00001CC8 899700070000                            mov     [edi+1792], edx
  3157 00001CCE 8B4554                                  mov     eax, [ebp+84]
  3158 00001CD1 F7EE                                    imul    esi
  3159 00001CD3 89530C                                  mov     [ebx+12], edx
  3160 00001CD6 8B8580000000                            mov     eax, [ebp+128]
  3161 00001CDC F7EE                                    imul    esi
  3162 00001CDE 895338                                  mov     [ebx+56], edx
  3163 00001CE1 8B0D[644E0500]                          mov     ecx, [_@@@tmp+40h] ; IRP j,4
  3164                                                                          ; [@@tmp+(j*4+0)*4]
  3165 00001CE7 A1[684E0500]                            mov     eax, [_@@@tmp+44h] ; [@@tmp+(j*4+1)*4]
  3166 00001CEC D1E0                                    shl     eax, 1
  3167 00001CEE BA9A79825A                              mov     edx, 5A82799Ah  ; icos36h_4 (8-4)
  3168 00001CF3 F7EA                                    imul    edx
  3169 00001CF5 29D1                                    sub     ecx, edx
  3170 00001CF7 8D3451                                  lea     esi, [ecx+edx*2]
  3171 00001CFA 8B4534                                  mov     eax, [ebp+52]   ; @@MULH [edi+(9+j)*SBLIMIT*4],[ebp+(9+j)*4],
  3172                                                                          ; -,-,-,-,0,ecx,[ebx+(9+j)*4]
  3173                                                                          ; out[(9+4)*SBLIMIT] = MULH(t0,win[9+4])+buf[9+4]
  3174 00001CFD F7E9                                    imul    ecx
  3175 00001CFF 035334                                  add     edx, [ebx+52]
  3176 00001D02 899780060000                            mov     [edi+1664], edx ; 13*SBLIMIT*4 = 1664
  3177 00001D08 8B4510                                  mov     eax, [ebp+16]   ; @MULH [edi+(8-j)*SBLIMIT*4],[ebp+(8-j)*4],
  3178                                                                          ; -,-,-,-,0,ecx,[ebx+(8-j)*4]
  3179 00001D0B F7E9                                    imul    ecx
  3180 00001D0D 035310                                  add     edx, [ebx+16]
  3181 00001D10 899700020000                            mov     [edi+512], edx
  3182 00001D16 8B457C                                  mov     eax, [ebp+124]  ; @@MULH [ebx+(9+j)*4],[ebp+(9+j+18)*4] ,-,-,-,-,0,esi,-
  3183 00001D19 F7EE                                    imul    esi
  3184 00001D1B 895334                                  mov     [ebx+52], edx
  3185 00001D1E 8B4558                                  mov     eax, [ebp+88]   ; @@MULH [ebx+(8-j)*4],[ebp+(8-j+18)*4],-,-,-,-,0,esi,-
  3186 00001D21 F7EE                                    imul    esi
  3187 00001D23 895310                                  mov     [ebx+16], edx
  3188 00001D26 5E                                      pop     esi
  3189 00001D27 C3                                      retn
  3190                                  
  3191                                  
  3192                                  ; =============== S U B R O U T I N E =======================================
  3193                                  
  3194                                  
  3195                                  mp3_imdct12:
  3196 00001D28 8B06                                    mov     eax, [esi]      ; in: esi=src - out: [out2_...]
  3197 00001D2A A3[6C4E0500]                            mov     [_@@tmp0], eax  ; IRP nn,0,1,2,3,4,5
  3198                                                                          ;  @@tmp&nn rd 1
  3199                                                                          ; ENDM
  3200                                                                          ; mov  eax,[esi+0*3*4] ; = src[0*3]
  3201 00001D2F 8B560C                                  mov     edx, [esi+12]   ; [esi+1*3*4] ; = src[1*3]
  3202 00001D32 01D0                                    add     eax, edx        ; = src[0*3]+src[1*3]
  3203 00001D34 A3[704E0500]                            mov     [_@@tmp1], eax
  3204 00001D39 8B4618                                  mov     eax, [esi+24]
  3205 00001D3C 01C2                                    add     edx, eax
  3206 00001D3E 8915[744E0500]                          mov     [_@@tmp2], edx
  3207 00001D44 8B5624                                  mov     edx, [esi+36]   ; [esi+3*3*4]
  3208 00001D47 01D0                                    add     eax, edx
  3209 00001D49 A3[784E0500]                            mov     [_@@tmp3], eax
  3210 00001D4E 8B4630                                  mov     eax, [esi+48]
  3211 00001D51 01C2                                    add     edx, eax
  3212 00001D53 8915[7C4E0500]                          mov     [_@@tmp4], edx
  3213 00001D59 8B563C                                  mov     edx, [esi+60]   ; [esi+5*3*4]
  3214 00001D5C 01D0                                    add     eax, edx        ; = src[4*3]+src[5*3]
  3215 00001D5E 0305[784E0500]                          add     eax, [_@@tmp3]
  3216 00001D64 A3[804E0500]                            mov     [_@@tmp5], eax  ; tmp5 = src[4*3]+src[5*3]+tmp3
  3217 00001D69 8B15[704E0500]                          mov     edx, [_@@tmp1]
  3218 00001D6F 0115[784E0500]                          add     [_@@tmp3], edx
  3219 00001D75 A1[744E0500]                            mov     eax, [_@@tmp2]  ; @@MULH @@tmp2,@@tmp2,-,-,-,-,1,C3,-
  3220                                                                          ; tmp2 = MULH(2*tmp2,C3)
  3221 00001D7A D1E0                                    shl     eax, 1
  3222 00001D7C BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  3223 00001D81 F7EA                                    imul    edx
  3224 00001D83 8915[744E0500]                          mov     [_@@tmp2], edx
  3225 00001D89 A1[784E0500]                            mov     eax, [_@@tmp3]  ; @@MULH @@tmp3,@@tmp3,-,-,-,-,2,C3,-
  3226                                                                          ; tmp3 = MULH(4*tmp3,C3)
  3227 00001D8E C1E002                                  shl     eax, 2
  3228 00001D91 BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  3229 00001D96 F7EA                                    imul    edx
  3230 00001D98 8915[784E0500]                          mov     [_@@tmp3], edx
  3231 00001D9E A1[704E0500]                            mov     eax, [_@@tmp1]  ; @@MULH edx,@@tmp1,sub,@@tmp5,-,-,1,icos36h_4,-
  3232 00001DA3 2B05[804E0500]                          sub     eax, [_@@tmp5]  ; t2 = MULH(2*(tmp1-tmp5),icos36h_4)
  3233 00001DA9 D1E0                                    shl     eax, 1
  3234 00001DAB BA9A79825A                              mov     edx, 5A82799Ah  ; icos36h_4
  3235 00001DB0 F7EA                                    imul    edx
  3236 00001DB2 A1[6C4E0500]                            mov     eax, [_@@tmp0]  ; @@SUM eax,@@tmp0,sub,@@tmp4,-,-
  3237 00001DB7 2B05[7C4E0500]                          sub     eax, [_@@tmp4]  ; t1 = tmp0 - tmp4
  3238 00001DBD 29D0                                    sub     eax, edx        ; @@CAST macro t1,t2,dst0,dst1,dst2,dst3
  3239                                                                          ;   sub  t1,t2                           ;t1-t2
  3240                                                                          ;   lea  t2,[t1+t2*2]                    ;t1+t2
  3241                                                                          ;   mov  dword ptr [mp3_out2_a&dst0],t1  ;t1-t2
  3242                                                                          ;   mov  dword ptr [mp3_out2_b&dst0],t2  ;t1+t2
  3243                                                                          ; endm
  3244 00001DBF 8D1450                                  lea     edx, [eax+edx*2] ; @@CAST eax,edx,1,4,7,10
  3245                                                                          ; out2[1,4,7,10]=t1-t2,t1-t2,t1+t2,t1+t2
  3246 00001DC2 A3[884E0500]                            mov     [mp3_out2_a1], eax
  3247 00001DC7 8915[944E0500]                          mov     [mp3_out2_b1], edx
  3248 00001DCD A1[7C4E0500]                            mov     eax, [_@@tmp4]
  3249 00001DD2 8B15[704E0500]                          mov     edx, [_@@tmp1]
  3250 00001DD8 D1F8                                    sar     eax, 1
  3251 00001DDA D1E2                                    shl     edx, 1
  3252 00001DDC 0105[6C4E0500]                          add     [_@@tmp0], eax  ; tmp0 = tmp0 + tmp4/2
  3253 00001DE2 0115[804E0500]                          add     [_@@tmp5], edx  ; tmp5 = tmp5 + tmp1*2
  3254 00001DE8 A1[804E0500]                            mov     eax, [_@@tmp5]  ; @@MULH edx,@@tmp5,add,@@tmp3,-,-,0,icos36h_1,-
  3255 00001DED 0305[784E0500]                          add     eax, [_@@tmp3]
  3256 00001DF3 BA07F74142                              mov     edx, 4241F707h  ; icos36h_1
  3257 00001DF8 F7EA                                    imul    edx
  3258 00001DFA A1[6C4E0500]                            mov     eax, [_@@tmp0]  ; @@SUM eax,@@tmp0,add,@@tmp2,-,-
  3259 00001DFF 0305[744E0500]                          add     eax, [_@@tmp2]
  3260 00001E05 29D0                                    sub     eax, edx        ; @@CAST eax,edx,2,3,8,9
  3261 00001E07 8D1450                                  lea     edx, [eax+edx*2]
  3262 00001E0A A3[8C4E0500]                            mov     [mp3_out2_a2], eax
  3263 00001E0F 8915[984E0500]                          mov     [mp3_out2_b2], edx
  3264 00001E15 A1[804E0500]                            mov     eax, [_@@tmp5]  ; @@MULH edx,@@tmp5,sub,@@tmp3,-,-,1,icos36h_7,-
  3265 00001E1A 2B05[784E0500]                          sub     eax, [_@@tmp3]
  3266 00001E20 D1E0                                    shl     eax, 1
  3267 00001E22 BA1E75A37B                              mov     edx, 7BA3751Eh  ; icos36h_7
  3268 00001E27 F7EA                                    imul    edx
  3269 00001E29 A1[6C4E0500]                            mov     eax, [_@@tmp0]  ; @@SUM eax,@@tmp0,sub,@@tmp2,-,-
  3270 00001E2E 2B05[744E0500]                          sub     eax, [_@@tmp2]
  3271 00001E34 29D0                                    sub     eax, edx        ; @@CAST eax,edx,0,5,6,11
  3272 00001E36 8D1450                                  lea     edx, [eax+edx*2]
  3273 00001E39 A3[844E0500]                            mov     [mp3_out2_a0], eax
  3274 00001E3E 8915[904E0500]                          mov     [mp3_out2_b0], edx
  3275 00001E44 C3                                      retn
  3276                                  
  3277                                  
  3278                                  ; =============== S U B R O U T I N E =======================================
  3279                                  
  3280                                  
  3281                                  mp3_compute_imdct:
  3282                                  		; 16/02/2025
  3283                                  
  3284                                  .no_rdtsc_supported:
  3285 00001E45 53                                      push    ebx
  3286 00001E46 8B4B60                                  mov     ecx, [ebx+96]   ; [ebx+$mp3gr_num_nonzero_hybrids_div9]
  3287 00001E49 6BC109                                  imul    eax, ecx, 9
  3288 00001E4C 8DBC83A0000000                          lea     edi, [ebx+eax*4+160] ; [ebx+$mp3gr_sb_hybrid+eax*4]
  3289 00001E53 E322                                    jecxz   .breakout
  3290                                  
  3291                                  .scan_zero_lop:
  3292 00001E55 83EF24                                  sub     edi, 36         ; index-9
  3293 00001E58 8B07                                    mov     eax, [edi]      ; [edi+0*4]
  3294 00001E5A 0B4704                                  or      eax, [edi+4]
  3295 00001E5D 0B4708                                  or      eax, [edi+8]
  3296 00001E60 0B470C                                  or      eax, [edi+12]
  3297 00001E63 0B4710                                  or      eax, [edi+16]
  3298 00001E66 0B4714                                  or      eax, [edi+20]
  3299 00001E69 0B4718                                  or      eax, [edi+24]
  3300 00001E6C 0B471C                                  or      eax, [edi+28]
  3301 00001E6F 0B4720                                  or      eax, [edi+32]   ; [edi+8*4]
  3302 00001E72 7503                                    jnz     short .breakout
  3303 00001E74 49                                      dec     ecx
  3304 00001E75 75DE                                    jnz     short .scan_zero_lop
  3305                                  
  3306                                  .breakout:
  3307 00001E77 41                                      inc     ecx             ; div9+1
  3308 00001E78 D1E9                                    shr     ecx, 1          ; div18
  3309 00001E7A 890D[B04E0500]                          mov     [_@@sblimit], ecx
  3310 00001E80 837B2C02                                cmp     dword [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  3311 00001E84 7505                                    jnz     short .this_long_end
  3312 00001E86 8B4B30                                  mov     ecx, [ebx+48]   ; [ebx+$mp3gr_switch_point]
  3313 00001E89 D1E1                                    shl     ecx, 1          ; 0,1 --> 0,2
  3314                                  
  3315                                  .this_long_end:
  3316 00001E8B 890D[AC4E0500]                          mov     [_@@mdct_long_end], ecx
  3317 00001E91 8B4330                                  mov     eax, [ebx+48]   ; [ebx+$mp3gr_switch_point]
  3318 00001E94 A3[B44E0500]                            mov     [_@@switch_point], eax
  3319 00001E99 8B432C                                  mov     eax, [ebx+44]   ; [ebx+$mp3gr_block_type]
  3320 00001E9C 69C090000000                            imul    eax, 144        ; 1*36*4
  3321 00001EA2 A3[A84E0500]                            mov     [_@@www], eax
  3322 00001EA7 8B0D[7C190100]                          mov     ecx, [mp3_curr_channel]
  3323 00001EAD A1[80190100]                            mov     eax, [mp3_curr_granule]
  3324 00001EB2 69C900120000                            imul    ecx, 4608       ; 36*SBLIMIT*4 ; channel ; sb_samples[ch][gr*18]
  3325 00001EB8 69C000090000                            imul    eax, 2304       ; 18*SBLIMIT*4 ; frame=granule*18
  3326 00001EBE 8DBC01[E0E20000]                        lea     edi, [mp3_sb_samples+ecx+eax]
  3327 00001EC5 8DB3A0000000                            lea     esi, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid]
  3328 00001ECB A1[7C190100]                            mov     eax, [mp3_curr_channel]
  3329 00001ED0 69C000090000                            imul    eax, 2304       ; SBLIMIT*18*4
  3330 00001ED6 8D98[E0060100]                          lea     ebx, [mp3_mdct_buf+eax]
  3331                                  		
  3332                                  		; 16/02/2025
  3333                                  .no_rdtsc_supported@:
  3334 00001EDC C705[A44E0500]0000-                     mov	dword [_@@@JJJ], 0
  3334 00001EE4 0000               
  3335 00001EE6 833D[AC4E0500]00                        cmp	dword [_@@mdct_long_end], 0
  3336 00001EED 744D                                    jz      short .imdct36_done
  3337                                  
  3338                                  .imdct36_lop:
  3339 00001EEF BD[0C080500]                            mov	ebp, mp3_mdct_win ; for j=0 to mdct_long_end-1
  3340 00001EF4 833D[A44E0500]02                        cmp	dword [_@@@JJJ], 2
  3341 00001EFB 19C0                                    sbb	eax, eax
  3342 00001EFD 2305[B44E0500]                          and	eax, [_@@switch_point]
  3343 00001F03 7506                                    jnz	short .this_window ; force window 0
  3344 00001F05 032D[A84E0500]                          add	ebp, [_@@www] ; mdct_win
  3345                                  
  3346                                  .this_window:
  3347 00001F0B A1[A44E0500]                            mov	eax, [_@@@JJJ]
  3348 00001F10 D1E8                                    shr	eax, 1          ; cy=0,1
  3349 00001F12 19C0                                    sbb	eax, eax        ; eax=0,FFFFFFFFh
  3350 00001F14 2540020000                              and	eax, 576        ; 4*36*4
  3351 00001F19 01C5                                    add	ebp, eax
  3352 00001F1B E836F8FFFF                              call	mp3_imdct36
  3353 00001F20 83C704                                  add	edi, 4          ; 1*4 ; dst
  3354 00001F23 83C648                                  add	esi, 72         ; 18*4 ; sb_hybrid
  3355 00001F26 83C348                                  add	ebx, 72         ; mdct_buf ; next
  3356 00001F29 FF05[A44E0500]                          inc	dword [_@@@JJJ]
  3357 00001F2F A1[A44E0500]                            mov	eax, [_@@@JJJ]
  3358 00001F34 3B05[AC4E0500]                          cmp	eax, [_@@mdct_long_end]
  3359 00001F3A 72B3                                    jb	short .imdct36_lop
  3360                                  
  3361                                  .imdct36_done:
  3362                                  		; 16/02/2025
  3363                                  .no_rdtsc_supported@@:
  3364                                  
  3365                                  		; 16/02/2025
  3366                                  .no_rdtsc_supported@@@:
  3367 00001F3C A1[A44E0500]                            mov     eax, [_@@@JJJ]
  3368 00001F41 3B05[B04E0500]                          cmp     eax, [_@@sblimit]
  3369 00001F47 0F83D7020000                            jnb     .imdct12_done
  3370                                  
  3371                                  .imdct12_lop:
  3372 00001F4D BD[2C090500]                            mov     ebp, (mp3_mdct_win+120h) ; for j=mdct_long_end to sblimit-1
  3373 00001F52 A1[A44E0500]                            mov     eax, [_@@@JJJ]
  3374 00001F57 D1E8                                    shr     eax, 1          ; cy=0,1
  3375 00001F59 19C0                                    sbb     eax, eax        ; eax=0,FFFFFFFFh
  3376 00001F5B 2540020000                              and     eax, 576        ; 4*36*4
  3377 00001F60 01C5                                    add     ebp, eax        ; mdct_win
  3378 00001F62 8B03                                    mov     eax, [ebx]      ; IRP i,0,1,2,3,4,5
  3379 00001F64 8907                                    mov     [edi], eax      ; @@SUM [edi+i*SBLIMIT*4],[ebx+(i+0)*4],-,-,-,-
  3380 00001F66 8B4304                                  mov     eax, [ebx+4]
  3381 00001F69 898780000000                            mov     [edi+128], eax
  3382 00001F6F 8B4308                                  mov     eax, [ebx+8]
  3383 00001F72 898700010000                            mov     [edi+256], eax
  3384 00001F78 8B430C                                  mov     eax, [ebx+12]
  3385 00001F7B 898780010000                            mov     [edi+384], eax
  3386 00001F81 8B4310                                  mov     eax, [ebx+16]
  3387 00001F84 898700020000                            mov     [edi+512], eax
  3388 00001F8A 8B4314                                  mov     eax, [ebx+20]
  3389 00001F8D 898780020000                            mov     [edi+640], eax  ; ENDM
  3390 00001F93 81C700030000                            add     edi, 768        ; 6*SBLIMIT*4
  3391 00001F99 E88AFDFFFF                              call    mp3_imdct12
  3392 00001F9E A1[844E0500]                            mov     eax, [mp3_out2_a0] ; IRP i,0,1,2,3,4,5
  3393 00001FA3 8B5500                                  mov     edx, [ebp+0]    ; @@MULH [edi+i*SBLIMIT*4],[mp3_out2_a&i],
  3394                                                                          ; -,-,-,-,0,[ebp+(i+0)*4],[ebx+(1*6+i)*4]
  3395 00001FA6 F7EA                                    imul    edx
  3396 00001FA8 035318                                  add     edx, [ebx+24]
  3397 00001FAB 8917                                    mov     [edi], edx
  3398 00001FAD A1[904E0500]                            mov     eax, [mp3_out2_b0] ; @@MULH [ebx+(2*6+i)*4],[mp3_out2_b&i],
  3399                                                                          ; -,-,-,-,0,[ebp+(i+6)*4],-
  3400 00001FB2 8B5518                                  mov     edx, [ebp+24]
  3401 00001FB5 F7EA                                    imul    edx
  3402 00001FB7 895330                                  mov     [ebx+48], edx
  3403 00001FBA A1[884E0500]                            mov     eax, [mp3_out2_a1] ; i = 1
  3404 00001FBF 8B5504                                  mov     edx, [ebp+4]
  3405 00001FC2 F7EA                                    imul    edx
  3406 00001FC4 03531C                                  add     edx, [ebx+28]
  3407 00001FC7 899780000000                            mov     [edi+128], edx
  3408 00001FCD A1[944E0500]                            mov     eax, [mp3_out2_b1]
  3409 00001FD2 8B551C                                  mov     edx, [ebp+28]
  3410 00001FD5 F7EA                                    imul    edx
  3411 00001FD7 895334                                  mov     [ebx+52], edx
  3412 00001FDA A1[8C4E0500]                            mov     eax, [mp3_out2_a2] ; i = 2
  3413 00001FDF 8B5508                                  mov     edx, [ebp+8]
  3414 00001FE2 F7EA                                    imul    edx
  3415 00001FE4 035320                                  add     edx, [ebx+32]
  3416 00001FE7 899700010000                            mov     [edi+256], edx
  3417 00001FED A1[984E0500]                            mov     eax, [mp3_out2_b2]
  3418 00001FF2 8B5520                                  mov     edx, [ebp+32]
  3419 00001FF5 F7EA                                    imul    edx
  3420 00001FF7 895338                                  mov     [ebx+56], edx
  3421 00001FFA A1[8C4E0500]                            mov     eax, [mp3_out2_a2] ; i = 3 ; mp3_out2_a3 equ mp3_out2_a2
  3422 00001FFF 8B550C                                  mov     edx, [ebp+12]
  3423 00002002 F7EA                                    imul    edx
  3424 00002004 035324                                  add     edx, [ebx+36]
  3425 00002007 899780010000                            mov     [edi+384], edx
  3426 0000200D A1[984E0500]                            mov     eax, [mp3_out2_b2] ; mp3_out2_b3 equ mp3_out2_b2
  3427 00002012 8B5524                                  mov     edx, [ebp+36]
  3428 00002015 F7EA                                    imul    edx
  3429 00002017 89533C                                  mov     [ebx+60], edx
  3430 0000201A A1[884E0500]                            mov     eax, [mp3_out2_a1] ; i = 4 ; mp3_out2_a4 equ mp3_out2_a1
  3431 0000201F 8B5510                                  mov     edx, [ebp+16]
  3432 00002022 F7EA                                    imul    edx
  3433 00002024 035328                                  add     edx, [ebx+40]
  3434 00002027 899700020000                            mov     [edi+512], edx
  3435 0000202D A1[944E0500]                            mov     eax, [mp3_out2_b1] ; mp3_out2_b4 equ mp3_out2_b1
  3436 00002032 8B5528                                  mov     edx, [ebp+40]
  3437 00002035 F7EA                                    imul    edx
  3438 00002037 895340                                  mov     [ebx+64], edx
  3439 0000203A A1[844E0500]                            mov     eax, [mp3_out2_a0] ; i = 5 ; mp3_out2_a5 equ mp3_out2_a0
  3440 0000203F 8B5514                                  mov     edx, [ebp+20]
  3441 00002042 F7EA                                    imul    edx
  3442 00002044 03532C                                  add     edx, [ebx+44]
  3443 00002047 899780020000                            mov     [edi+640], edx
  3444 0000204D A1[904E0500]                            mov     eax, [mp3_out2_b0] ; mp3_out2_b5 equ mp3_out2_b0
  3445 00002052 8B552C                                  mov     edx, [ebp+44]
  3446 00002055 F7EA                                    imul    edx
  3447 00002057 895344                                  mov     [ebx+68], edx   ; ENDM
  3448 0000205A 81C700030000                            add     edi, 768        ; 6*SBLIMIT*4
  3449 00002060 83C604                                  add     esi, 4          ; sb_hybrid
  3450 00002063 E8C0FCFFFF                              call    mp3_imdct12
  3451 00002068 A1[844E0500]                            mov     eax, [mp3_out2_a0] ; IRP i,0,1,2,3,4,5
  3452 0000206D 8B5500                                  mov     edx, [ebp+0]    ; @@MULH [edi+i*SBLIMIT*4],[mp3_out2_a&i],
  3453                                                                          ; -,-,-,-,0,[ebp+(i+0)*4],[ebx+(2*6+i)*4]
  3454 00002070 F7EA                                    imul    edx             ; @@MULH [ebx+(0*6+i)*4],[mp3_out2_b&i],
  3455                                                                          ; -,-,-,-,0,[ebp+(i+6)*4],-
  3456 00002072 035330                                  add     edx, [ebx+48]
  3457 00002075 8917                                    mov     [edi], edx
  3458 00002077 A1[904E0500]                            mov     eax, [mp3_out2_b0]
  3459 0000207C 8B5518                                  mov     edx, [ebp+18h]
  3460 0000207F F7EA                                    imul    edx
  3461 00002081 8913                                    mov     [ebx], edx
  3462 00002083 A1[884E0500]                            mov     eax, [mp3_out2_a1] ; i = 1
  3463 00002088 8B5504                                  mov     edx, [ebp+4]
  3464 0000208B F7EA                                    imul    edx
  3465 0000208D 035334                                  add     edx, [ebx+52]
  3466 00002090 899780000000                            mov     [edi+128], edx
  3467 00002096 A1[944E0500]                            mov     eax, [mp3_out2_b1]
  3468 0000209B 8B551C                                  mov     edx, [ebp+28]
  3469 0000209E F7EA                                    imul    edx
  3470 000020A0 895304                                  mov     [ebx+4], edx
  3471 000020A3 A1[8C4E0500]                            mov     eax, [mp3_out2_a2] ; i = 2
  3472 000020A8 8B5508                                  mov     edx, [ebp+8]
  3473 000020AB F7EA                                    imul    edx
  3474 000020AD 035338                                  add     edx, [ebx+56]
  3475 000020B0 899700010000                            mov     [edi+256], edx
  3476 000020B6 A1[984E0500]                            mov     eax, [mp3_out2_b2]
  3477 000020BB 8B5520                                  mov     edx, [ebp+32]
  3478 000020BE F7EA                                    imul    edx
  3479 000020C0 895308                                  mov     [ebx+8], edx
  3480 000020C3 A1[8C4E0500]                            mov     eax, [mp3_out2_a2] ; i = 3
  3481 000020C8 8B550C                                  mov     edx, [ebp+12]
  3482 000020CB F7EA                                    imul    edx
  3483 000020CD 03533C                                  add     edx, [ebx+60]
  3484 000020D0 899780010000                            mov     [edi+384], edx
  3485 000020D6 A1[984E0500]                            mov     eax, [mp3_out2_b2]
  3486 000020DB 8B5524                                  mov     edx, [ebp+36]
  3487 000020DE F7EA                                    imul    edx
  3488 000020E0 89530C                                  mov     [ebx+12], edx
  3489 000020E3 A1[884E0500]                            mov     eax, [mp3_out2_a1] ; i = 4
  3490 000020E8 8B5510                                  mov     edx, [ebp+16]
  3491 000020EB F7EA                                    imul    edx
  3492 000020ED 035340                                  add     edx, [ebx+64]
  3493 000020F0 899700020000                            mov     [edi+512], edx
  3494 000020F6 A1[944E0500]                            mov     eax, [mp3_out2_b1]
  3495 000020FB 8B5528                                  mov     edx, [ebp+40]
  3496 000020FE F7EA                                    imul    edx
  3497 00002100 895310                                  mov     [ebx+16], edx
  3498 00002103 A1[844E0500]                            mov     eax, [mp3_out2_a0] ; i = 5
  3499 00002108 8B5514                                  mov     edx, [ebp+20]
  3500 0000210B F7EA                                    imul    edx
  3501 0000210D 035344                                  add     edx, [ebx+68]
  3502 00002110 899780020000                            mov     [edi+640], edx
  3503 00002116 A1[904E0500]                            mov     eax, [mp3_out2_b0]
  3504 0000211B 8B552C                                  mov     edx, [ebp+44]
  3505 0000211E F7EA                                    imul    edx
  3506 00002120 895314                                  mov     [ebx+20], edx   ; ENDM
  3507 00002123 83C604                                  add     esi, 4
  3508 00002126 E8FDFBFFFF                              call    mp3_imdct12
  3509 0000212B A1[844E0500]                            mov     eax, [mp3_out2_a0] ; IRP i,0,1,2,3,4,5
  3510 00002130 8B5500                                  mov     edx, [ebp+0]    ; @@MULH [ebx+(0*6+i)*4],[mp3_out2_a&i],
  3511                                                                          ; -,-,-,-,0,[ebp+(i+0)*4],[ebx+(0*6+i)*4]
  3512 00002133 F7EA                                    imul    edx
  3513 00002135 0313                                    add     edx, [ebx]
  3514 00002137 8913                                    mov     [ebx], edx
  3515 00002139 A1[904E0500]                            mov     eax, [mp3_out2_b0] ; @@MULH [ebx+(1*6+i)*4],[mp3_out2_b&i],
  3516                                                                          ; -,-,-,-,0,[ebp+(i+6)*4],-
  3517 0000213E 8B5518                                  mov     edx, [ebp+24]
  3518 00002141 F7EA                                    imul    edx
  3519 00002143 895318                                  mov     [ebx+24], edx
  3520 00002146 C7433000000000                          mov     dword [ebx+48], 0 ; [ebx+(2*6+i)*4]
  3521 0000214D A1[884E0500]                            mov     eax, [mp3_out2_a1] ; i = 1
  3522 00002152 8B5504                                  mov     edx, [ebp+4]
  3523 00002155 F7EA                                    imul    edx
  3524 00002157 035304                                  add     edx, [ebx+4]
  3525 0000215A 895304                                  mov     [ebx+4], edx
  3526 0000215D A1[944E0500]                            mov     eax, [mp3_out2_b1]
  3527 00002162 8B551C                                  mov     edx, [ebp+28]
  3528 00002165 F7EA                                    imul    edx
  3529 00002167 89531C                                  mov     [ebx+28], edx
  3530 0000216A C7433400000000                          mov     dword [ebx+52], 0 ; [ebx+(2*6+i)*4]
  3531 00002171 A1[8C4E0500]                            mov     eax, [mp3_out2_a2] ; i = 2
  3532 00002176 8B5508                                  mov     edx, [ebp+8]
  3533 00002179 F7EA                                    imul    edx
  3534 0000217B 035308                                  add     edx, [ebx+8]
  3535 0000217E 895308                                  mov     [ebx+8], edx
  3536 00002181 A1[984E0500]                            mov     eax, [mp3_out2_b2]
  3537 00002186 8B5520                                  mov     edx, [ebp+32]
  3538 00002189 F7EA                                    imul    edx
  3539 0000218B 895320                                  mov     [ebx+32], edx
  3540 0000218E C7433800000000                          mov     dword [ebx+56], 0
  3541 00002195 A1[8C4E0500]                            mov     eax, [mp3_out2_a2] ; i = 3
  3542 0000219A 8B550C                                  mov     edx, [ebp+12]
  3543 0000219D F7EA                                    imul    edx
  3544 0000219F 03530C                                  add     edx, [ebx+0Ch]
  3545 000021A2 89530C                                  mov     [ebx+12], edx
  3546 000021A5 A1[984E0500]                            mov     eax, [mp3_out2_b2]
  3547 000021AA 8B5524                                  mov     edx, [ebp+36]
  3548 000021AD F7EA                                    imul    edx
  3549 000021AF 895324                                  mov     [ebx+36], edx
  3550 000021B2 C7433C00000000                          mov     dword [ebx+60], 0 ; [ebx+(2*6+i)*4]
  3551 000021B9 A1[884E0500]                            mov     eax, [mp3_out2_a1] ; i = 4
  3552 000021BE 8B5510                                  mov     edx, [ebp+16]
  3553 000021C1 F7EA                                    imul    edx
  3554 000021C3 035310                                  add     edx, [ebx+16]
  3555 000021C6 895310                                  mov     [ebx+16], edx
  3556 000021C9 A1[944E0500]                            mov     eax, [mp3_out2_b1]
  3557 000021CE 8B5528                                  mov     edx, [ebp+40]
  3558 000021D1 F7EA                                    imul    edx
  3559 000021D3 895328                                  mov     [ebx+40], edx
  3560 000021D6 C7434000000000                          mov     dword [ebx+64], 0
  3561 000021DD A1[844E0500]                            mov     eax, [mp3_out2_a0] ; i = 5
  3562 000021E2 8B5514                                  mov     edx, [ebp+20]
  3563 000021E5 F7EA                                    imul    edx
  3564 000021E7 035314                                  add     edx, [ebx+20]
  3565 000021EA 895314                                  mov     [ebx+20], edx
  3566 000021ED A1[904E0500]                            mov     eax, [mp3_out2_b0]
  3567 000021F2 8B552C                                  mov     edx, [ebp+44]
  3568 000021F5 F7EA                                    imul    edx
  3569 000021F7 89532C                                  mov     [ebx+44], edx
  3570 000021FA C7434400000000                          mov     dword [ebx+68], 0 ; [ebx+(2*6+i)*4]
  3571 00002201 81C704FAFFFF                            add     edi, -1532      ; (1*4) - (2*6*SBLIMIT*4) ; dst
  3572 00002207 83C640                                  add     esi, 64         ; 18*4 - (2*4) ; sb_hybrid
  3573 0000220A 83C348                                  add     ebx, 72         ; 18*4 ; mdct_buf
  3574 0000220D FF05[A44E0500]                          inc     dword [_@@@JJJ]	; next
  3575 00002213 A1[A44E0500]                            mov     eax, [_@@@JJJ]
  3576 00002218 3B05[B04E0500]                          cmp     eax, [_@@sblimit]
  3577 0000221E 0F8229FDFFFF                            jb      .imdct12_lop
  3578                                  
  3579                                  .imdct12_done:
  3580                                  		; 16/02/2025
  3581                                  
  3582                                  .no_rdtsc_supported@@@@:
  3583                                  
  3584                                  		; 16/02/2025
  3585                                  .no_rdtsc_supported@@@@@:
  3586 00002224 833D[A44E0500]20                        cmp     dword [_@@@JJJ], 32 ; SBLIMIT
  3587 0000222B 0F8333010000                            jnb     .zero_outer_done
  3588                                  
  3589                                  .zero_outer_lop:
  3590 00002231 8B03                                    mov     eax, [ebx]      ; zero bands
  3591                                                                          ; IRP nn,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17
  3592                                                                          ;  mov  eax,dword ptr [ebx+nn*4]
  3593                                                                          ;  mov  dword ptr [ebx+nn*4],0
  3594                                                                          ;  mov  dword ptr [edi+nn*SBLIMIT*4],eax ; [dst]
  3595                                                                          ; ENDM
  3596 00002233 C70300000000                            mov     dword [ebx], 0 ; nn = 0
  3597 00002239 8907                                    mov     [edi], eax
  3598 0000223B 8B4304                                  mov     eax, [ebx+4]    ; nn = 1
  3599 0000223E C7430400000000                          mov     dword [ebx+4], 0
  3600 00002245 898780000000                            mov     [edi+128], eax
  3601 0000224B 8B4308                                  mov     eax, [ebx+8]
  3602 0000224E C7430800000000                          mov     dword [ebx+8], 0
  3603 00002255 898700010000                            mov     [edi+256], eax
  3604 0000225B 8B430C                                  mov     eax, [ebx+12]
  3605 0000225E C7430C00000000                          mov     dword [ebx+12], 0
  3606 00002265 898780010000                            mov     [edi+384], eax
  3607 0000226B 8B4310                                  mov     eax, [ebx+16]   ; nn = 4
  3608 0000226E C7431000000000                          mov     dword [ebx+16], 0
  3609 00002275 898700020000                            mov     [edi+512], eax
  3610 0000227B 8B4314                                  mov     eax, [ebx+20]
  3611 0000227E C7431400000000                          mov     dword [ebx+20], 0
  3612 00002285 898780020000                            mov     [edi+640], eax  ; [edi+5*SBLIMIT*4]
  3613 0000228B 8B4318                                  mov     eax, [ebx+24]
  3614 0000228E C7431800000000                          mov     dword [ebx+24], 0
  3615 00002295 898700030000                            mov     [edi+768], eax
  3616 0000229B 8B431C                                  mov     eax, [ebx+28]   ; nn = 7
  3617 0000229E C7431C00000000                          mov     dword [ebx+28], 0
  3618 000022A5 898780030000                            mov     [edi+896], eax
  3619 000022AB 8B4320                                  mov     eax, [ebx+32]
  3620 000022AE C7432000000000                          mov     dword [ebx+32], 0
  3621 000022B5 898700040000                            mov     [edi+1024], eax ; [edi+8*SBLIMIT*4]
  3622 000022BB 8B4324                                  mov     eax, [ebx+36]
  3623 000022BE C7432400000000                          mov     dword [ebx+36], 0
  3624 000022C5 898780040000                            mov     [edi+1152], eax
  3625 000022CB 8B4328                                  mov     eax, [ebx+40]
  3626 000022CE C7432800000000                          mov     dword [ebx+40], 0
  3627 000022D5 898700050000                            mov     [edi+1280], eax
  3628 000022DB 8B432C                                  mov     eax, [ebx+44]
  3629 000022DE C7432C00000000                          mov     dword [ebx+44], 0
  3630 000022E5 898780050000                            mov     [edi+1408], eax
  3631 000022EB 8B4330                                  mov     eax, [ebx+48]
  3632 000022EE C7433000000000                          mov     dword [ebx+48], 0
  3633 000022F5 898700060000                            mov     [edi+1536], eax
  3634 000022FB 8B4334                                  mov     eax, [ebx+52]
  3635 000022FE C7433400000000                          mov     dword [ebx+52], 0
  3636 00002305 898780060000                            mov     [edi+1664], eax
  3637 0000230B 8B4338                                  mov     eax, [ebx+56]
  3638 0000230E C7433800000000                          mov     dword [ebx+56], 0
  3639 00002315 898700070000                            mov     [edi+1792], eax
  3640 0000231B 8B433C                                  mov     eax, [ebx+60]
  3641 0000231E C7433C00000000                          mov     dword [ebx+60], 0
  3642 00002325 898780070000                            mov     [edi+1920], eax
  3643 0000232B 8B4340                                  mov     eax, [ebx+64]
  3644 0000232E C7434000000000                          mov     dword [ebx+64], 0 ; [edi+16*SBLIMIT*4]
  3645 00002335 898700080000                            mov     [edi+2048], eax
  3646 0000233B 8B4344                                  mov     eax, [ebx+68]   ; nn = 17
  3647 0000233E C7434400000000                          mov     dword [ebx+68], 0
  3648 00002345 898780080000                            mov     [edi+2176], eax ; ENDM
  3649 0000234B 83C348                                  add     ebx, 72         ; 18*4
  3650 0000234E 83C704                                  add     edi, 4
  3651 00002351 FF05[A44E0500]                          inc     dword [_@@@JJJ]
  3652 00002357 833D[A44E0500]20                        cmp     dword [_@@@JJJ], 32
  3653 0000235E 0F82CDFEFFFF                            jb      .zero_outer_lop
  3654                                  
  3655                                  .zero_outer_done:
  3656                                  		; 16/02/2025
  3657                                  
  3658                                  .no_rdtsc_supported@@@@@@:
  3659 00002364 5B                                      pop     ebx
  3660                                  
  3661                                  		; 16/02/2025
  3662                                  .no_rdtsc_supported@@@@@@@:
  3663 00002365 C3                                      retn
  3664                                  
  3665                                  
  3666                                  ; =============== S U B R O U T I N E =======================================
  3667                                  
  3668                                  
  3669                                  mp3_dct32_shift_0:
  3670 00002366 8B06                                    mov     eax, [esi]      ; mp3_dct32_macro macro rate_shift ; rate_shift = 0
  3671 00002368 8B567C                                  mov     edx, [esi+124]  ; @@BF macro a,b,sign,cos,shift
  3672                                                                          ; @@BF 0,31,+,COS0_0,1
  3673                                                                          ; @@need_a equ (rate_shift EQ 0) or (a LT 16) ; a = 0
  3674                                                                          ; @@need_b equ (rate_shift EQ 0) or (b LT 16) ; b = 31
  3675                                                                          ; IF @@need_a AND @@need_b ; rate_shift = 0
  3676                                                                          ;    mov eax,dword ptr [esi+a*4]
  3677                                                                          ;    mov edx,dword ptr [esi+b*4]
  3678                                                                          ;    add dword ptr [esi+a*4],edx
  3679 0000236B 0116                                    add     [esi], edx
  3680 0000236D 29D0                                    sub     eax, edx
  3681 0000236F D1E0                                    shl     eax, 1          ; shl  eax,shift
  3682                                                                          ; (needed when COS.fraction is less than 32bit)
  3683 00002371 BA51C21340                              mov     edx, 4013C251h  ; sign&&cos ; +COS0_0 = 4013C251h
  3684 00002376 F7EA                                    imul    edx
  3685 00002378 89567C                                  mov     [esi+124], edx  ; [esi+b*4] ; upper 32bit of multiply result
  3686 0000237B 8B463C                                  mov     eax, [esi+60]   ; @@BF 15,16,+,COS0_15,5
  3687                                                                          ; [esi+a*4]
  3688 0000237E 8B5640                                  mov     edx, [esi+64]   ; [esi+b*4]
  3689 00002381 01563C                                  add     [esi+60], edx   ; [esi+a*4]
  3690 00002384 29D0                                    sub     eax, edx
  3691 00002386 C1E005                                  shl     eax, 5          ; shl eax,shift
  3692 00002389 BAFB228551                              mov     edx, 518522FBh  ; sign&&cos ; +COS0_15 = 518522FBh
  3693 0000238E F7EA                                    imul    edx
  3694 00002390 895640                                  mov     [esi+64], edx   ; [esi+b*4]
  3695 00002393 8B06                                    mov     eax, [esi]      ; @@BF 0,15,+,COS1_0,1
  3696 00002395 8B563C                                  mov     edx, [esi+60]
  3697 00002398 0116                                    add     [esi], edx
  3698 0000239A 29D0                                    sub     eax, edx
  3699 0000239C D1E0                                    shl     eax, 1
  3700 0000239E BA72464F40                              mov     edx, 404F4672h  ; +COS1_0
  3701 000023A3 F7EA                                    imul    edx
  3702 000023A5 89563C                                  mov     [esi+60], edx
  3703 000023A8 8B4640                                  mov     eax, [esi+64]   ; @@BF 16,31,-,COS1_0,1
  3704 000023AB 8B567C                                  mov     edx, [esi+124]
  3705 000023AE 015640                                  add     [esi+64], edx
  3706 000023B1 29D0                                    sub     eax, edx
  3707 000023B3 D1E0                                    shl     eax, 1
  3708 000023B5 BA8EB9B0BF                              mov     edx, 0BFB0B98Eh ; -COS1_0
  3709 000023BA F7EA                                    imul    edx
  3710 000023BC 89567C                                  mov     [esi+124], edx
  3711 000023BF 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,24,+,COS0_7,1
  3712 000023C2 8B5660                                  mov     edx, [esi+96]
  3713 000023C5 01561C                                  add     [esi+28], edx
  3714 000023C8 29D0                                    sub     eax, edx
  3715 000023CA D1E0                                    shl     eax, 1
  3716 000023CC BAA71E6056                              mov     edx, 56601EA7h
  3717 000023D1 F7EA                                    imul    edx
  3718 000023D3 895660                                  mov     [esi+96], edx
  3719 000023D6 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,23,+,COS0_8,1
  3720 000023D9 8B565C                                  mov     edx, [esi+92]
  3721 000023DC 015620                                  add     [esi+32], edx
  3722 000023DF 29D0                                    sub     eax, edx
  3723 000023E1 D1E0                                    shl     eax, 1
  3724 000023E3 BAECF64C5F                              mov     edx, 5F4CF6ECh
  3725 000023E8 F7EA                                    imul    edx
  3726 000023EA 89565C                                  mov     [esi+92], edx
  3727 000023ED 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,8,+,COS1_7,4
  3728 000023F0 8B5620                                  mov     edx, [esi+32]
  3729 000023F3 01561C                                  add     [esi+28], edx
  3730 000023F6 29D0                                    sub     eax, edx
  3731 000023F8 C1E004                                  shl     eax, 4
  3732 000023FB BA044E9E51                              mov     edx, 519E4E04h
  3733 00002400 F7EA                                    imul    edx
  3734 00002402 895620                                  mov     [esi+32], edx
  3735 00002405 8B465C                                  mov     eax, [esi+92]   ; @@BF 23,24,-,COS1_7,4
  3736 00002408 8B5660                                  mov     edx, [esi+96]
  3737 0000240B 01565C                                  add     [esi+92], edx
  3738 0000240E 29D0                                    sub     eax, edx
  3739 00002410 C1E004                                  shl     eax, 4
  3740 00002413 BAFCB161AE                              mov     edx, 0AE61B1FCh
  3741 00002418 F7EA                                    imul    edx
  3742 0000241A 895660                                  mov     [esi+96], edx
  3743 0000241D 8B06                                    mov     eax, [esi]      ; @@BF 0,7,+,COS2_0,1
  3744 0000241F 8B561C                                  mov     edx, [esi+28]
  3745 00002422 0116                                    add     [esi], edx
  3746 00002424 29D0                                    sub     eax, edx
  3747 00002426 D1E0                                    shl     eax, 1
  3748 00002428 BA46FB4041                              mov     edx, 4140FB46h
  3749 0000242D F7EA                                    imul    edx
  3750 0000242F 89561C                                  mov     [esi+28], edx
  3751 00002432 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,15,-,COS2_0,1
  3752 00002435 8B563C                                  mov     edx, [esi+60]
  3753 00002438 015620                                  add     [esi+32], edx
  3754 0000243B 29D0                                    sub     eax, edx
  3755 0000243D D1E0                                    shl     eax, 1
  3756 0000243F BABA04BFBE                              mov     edx, 0BEBF04BAh
  3757 00002444 F7EA                                    imul    edx
  3758 00002446 89563C                                  mov     [esi+60], edx
  3759 00002449 8B4640                                  mov     eax, [esi+64]   ; @@BF 16,23,+,COS2_0,1
  3760 0000244C 8B565C                                  mov     edx, [esi+92]
  3761 0000244F 015640                                  add     [esi+40h], edx
  3762 00002452 29D0                                    sub     eax, edx
  3763 00002454 D1E0                                    shl     eax, 1
  3764 00002456 BA46FB4041                              mov     edx, 4140FB46h
  3765 0000245B F7EA                                    imul    edx
  3766 0000245D 89565C                                  mov     [esi+92], edx
  3767 00002460 8B4660                                  mov     eax, [esi+96]   ; @@BF 24,31,-,COS2_0,1
  3768 00002463 8B567C                                  mov     edx, [esi+124]
  3769 00002466 015660                                  add     [esi+96], edx
  3770 00002469 29D0                                    sub     eax, edx
  3771 0000246B D1E0                                    shl     eax, 1
  3772 0000246D BABA04BFBE                              mov     edx, 0BEBF04BAh
  3773 00002472 F7EA                                    imul    edx
  3774 00002474 89567C                                  mov     [esi+124], edx
  3775 00002477 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,28,+,COS0_3,1
  3776 0000247A 8B5670                                  mov     edx, [esi+112]
  3777 0000247D 01560C                                  add     [esi+12], edx
  3778 00002480 29D0                                    sub     eax, edx
  3779 00002482 D1E0                                    shl     eax, 1
  3780 00002484 BA2134F943                              mov     edx, 43F93421h
  3781 00002489 F7EA                                    imul    edx
  3782 0000248B 895670                                  mov     [esi+112], edx
  3783 0000248E 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,19,+,COS0_12,2
  3784 00002491 8B564C                                  mov     edx, [esi+76]
  3785 00002494 015630                                  add     [esi+48], edx
  3786 00002497 29D0                                    sub     eax, edx
  3787 00002499 C1E002                                  shl     eax, 2
  3788 0000249C BA978DFC5E                              mov     edx, 5EFC8D97h
  3789 000024A1 F7EA                                    imul    edx
  3790 000024A3 89564C                                  mov     [esi+76], edx
  3791 000024A6 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,12,+,COS1_3,1
  3792 000024A9 8B5630                                  mov     edx, [esi+48]
  3793 000024AC 01560C                                  add     [esi+12], edx
  3794 000024AF 29D0                                    sub     eax, edx
  3795 000024B1 D1E0                                    shl     eax, 1
  3796 000024B3 BA630ECB52                              mov     edx, 52CB0E63h
  3797 000024B8 F7EA                                    imul    edx
  3798 000024BA 895630                                  mov     [esi+48], edx
  3799 000024BD 8B464C                                  mov     eax, [esi+76]   ; @@BF 19,28,-,COS1_3,1
  3800 000024C0 8B5670                                  mov     edx, [esi+112]
  3801 000024C3 01564C                                  add     [esi+76], edx
  3802 000024C6 29D0                                    sub     eax, edx
  3803 000024C8 D1E0                                    shl     eax, 1
  3804 000024CA BA9DF134AD                              mov     edx, 0AD34F19Dh
  3805 000024CF F7EA                                    imul    edx
  3806 000024D1 895670                                  mov     [esi+112], edx
  3807 000024D4 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,27,+,COS0_4,1
  3808 000024D7 8B566C                                  mov     edx, [esi+108]
  3809 000024DA 015610                                  add     [esi+16], edx
  3810 000024DD 29D0                                    sub     eax, edx
  3811 000024DF D1E0                                    shl     eax, 1
  3812 000024E1 BAC51BCC46                              mov     edx, 46CC1BC5h
  3813 000024E6 F7EA                                    imul    edx
  3814 000024E8 89566C                                  mov     [esi+108], edx
  3815 000024EB 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,20,+,COS0_11,2
  3816 000024EE 8B5650                                  mov     edx, [esi+80]
  3817 000024F1 01562C                                  add     [esi+44], edx
  3818 000024F4 29D0                                    sub     eax, edx
  3819 000024F6 C1E002                                  shl     eax, 2
  3820 000024F9 BA981AD84A                              mov     edx, 4AD81A98h
  3821 000024FE F7EA                                    imul    edx
  3822 00002500 895650                                  mov     [esi+80], edx
  3823 00002503 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,11,+,COS1_4,1
  3824 00002506 8B562C                                  mov     edx, [esi+44]
  3825 00002509 015610                                  add     [esi+16], edx
  3826 0000250C 29D0                                    sub     eax, edx
  3827 0000250E D1E0                                    shl     eax, 1
  3828 00002510 BA2E40E264                              mov     edx, 64E2402Eh
  3829 00002515 F7EA                                    imul    edx
  3830 00002517 89562C                                  mov     [esi+44], edx
  3831 0000251A 8B4650                                  mov     eax, [esi+80]   ; @@BF 20,27,-,COS1_4,1
  3832 0000251D 8B566C                                  mov     edx, [esi+108]
  3833 00002520 015650                                  add     [esi+80], edx
  3834 00002523 29D0                                    sub     eax, edx
  3835 00002525 D1E0                                    shl     eax, 1
  3836 00002527 BAD2BF1D9B                              mov     edx, 9B1DBFD2h
  3837 0000252C F7EA                                    imul    edx
  3838 0000252E 89566C                                  mov     [esi+108], edx
  3839 00002531 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,4,+,COS2_3,3
  3840 00002534 8B5610                                  mov     edx, [esi+16]
  3841 00002537 01560C                                  add     [esi+12], edx
  3842 0000253A 29D0                                    sub     eax, edx
  3843 0000253C C1E003                                  shl     eax, 3
  3844 0000253F BA42670352                              mov     edx, 52036742h
  3845 00002544 F7EA                                    imul    edx
  3846 00002546 895610                                  mov     [esi+16], edx
  3847 00002549 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,12,-,COS2_3,3
  3848 0000254C 8B5630                                  mov     edx, [esi+48]
  3849 0000254F 01562C                                  add     [esi+44], edx
  3850 00002552 29D0                                    sub     eax, edx
  3851 00002554 C1E003                                  shl     eax, 3
  3852 00002557 BABE98FCAD                              mov     edx, 0ADFC98BEh ; -COS2_3
  3853 0000255C F7EA                                    imul    edx
  3854 0000255E 895630                                  mov     [esi+48], edx
  3855 00002561 8B464C                                  mov     eax, [esi+76]   ; @@BF 19,20,+,COS2_3,3
  3856 00002564 8B5650                                  mov     edx, [esi+80]
  3857 00002567 01564C                                  add     [esi+4Ch], edx
  3858 0000256A 29D0                                    sub     eax, edx
  3859 0000256C C1E003                                  shl     eax, 3
  3860 0000256F BA42670352                              mov     edx, 52036742h  ; +COS2_3
  3861 00002574 F7EA                                    imul    edx
  3862 00002576 895650                                  mov     [esi+80], edx
  3863 00002579 8B466C                                  mov     eax, [esi+108]  ; @@BF 27,28,-,COS2_3,3
  3864 0000257C 8B5670                                  mov     edx, [esi+112]
  3865 0000257F 01566C                                  add     [esi+108], edx
  3866 00002582 29D0                                    sub     eax, edx
  3867 00002584 C1E003                                  shl     eax, 3
  3868 00002587 BABE98FCAD                              mov     edx, 0ADFC98BEh
  3869 0000258C F7EA                                    imul    edx
  3870 0000258E 895670                                  mov     [esi+112], edx
  3871 00002591 8B06                                    mov     eax, [esi]      ; @@BF 0,3,+,COS3_0,1
  3872 00002593 8B560C                                  mov     edx, [esi+12]
  3873 00002596 0116                                    add     [esi], edx
  3874 00002598 29D0                                    sub     eax, edx
  3875 0000259A D1E0                                    shl     eax, 1
  3876 0000259C BAF0E94545                              mov     edx, 4545E9F0h
  3877 000025A1 F7EA                                    imul    edx
  3878 000025A3 89560C                                  mov     [esi+12], edx
  3879 000025A6 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,7,-,COS3_0,1
  3880 000025A9 8B561C                                  mov     edx, [esi+28]
  3881 000025AC 015610                                  add     [esi+16], edx
  3882 000025AF 29D0                                    sub     eax, edx
  3883 000025B1 D1E0                                    shl     eax, 1
  3884 000025B3 BA1016BABA                              mov     edx, 0BABA1610h
  3885 000025B8 F7EA                                    imul    edx
  3886 000025BA 89561C                                  mov     [esi+28], edx
  3887 000025BD 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,11,+,COS3_0,1
  3888 000025C0 8B562C                                  mov     edx, [esi+44]
  3889 000025C3 015620                                  add     [esi+32], edx
  3890 000025C6 29D0                                    sub     eax, edx
  3891 000025C8 D1E0                                    shl     eax, 1
  3892 000025CA BAF0E94545                              mov     edx, 4545E9F0h
  3893 000025CF F7EA                                    imul    edx
  3894 000025D1 89562C                                  mov     [esi+44], edx
  3895 000025D4 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,15,-,COS3_0,1
  3896 000025D7 8B563C                                  mov     edx, [esi+60]
  3897 000025DA 015630                                  add     [esi+48], edx
  3898 000025DD 29D0                                    sub     eax, edx
  3899 000025DF D1E0                                    shl     eax, 1
  3900 000025E1 BA1016BABA                              mov     edx, 0BABA1610h
  3901 000025E6 F7EA                                    imul    edx
  3902 000025E8 89563C                                  mov     [esi+60], edx
  3903 000025EB 8B4640                                  mov     eax, [esi+64]   ; @@BF 16,19,+,COS3_0,1
  3904 000025EE 8B564C                                  mov     edx, [esi+76]
  3905 000025F1 015640                                  add     [esi+64], edx
  3906 000025F4 29D0                                    sub     eax, edx
  3907 000025F6 D1E0                                    shl     eax, 1
  3908 000025F8 BAF0E94545                              mov     edx, 4545E9F0h
  3909 000025FD F7EA                                    imul    edx
  3910 000025FF 89564C                                  mov     [esi+76], edx
  3911 00002602 8B4650                                  mov     eax, [esi+80]   ; @@BF 20,23,-,COS3_0,1
  3912 00002605 8B565C                                  mov     edx, [esi+92]
  3913 00002608 015650                                  add     [esi+80], edx
  3914 0000260B 29D0                                    sub     eax, edx
  3915 0000260D D1E0                                    shl     eax, 1
  3916 0000260F BA1016BABA                              mov     edx, 0BABA1610h ; -COS3_0
  3917 00002614 F7EA                                    imul    edx
  3918 00002616 89565C                                  mov     [esi+92], edx
  3919 00002619 8B4660                                  mov     eax, [esi+96]   ; @@BF 24,27,+,COS3_0,1
  3920 0000261C 8B566C                                  mov     edx, [esi+108]
  3921 0000261F 015660                                  add     [esi+96], edx
  3922 00002622 29D0                                    sub     eax, edx
  3923 00002624 D1E0                                    shl     eax, 1
  3924 00002626 BAF0E94545                              mov     edx, 4545E9F0h  ; +COS3_0
  3925 0000262B F7EA                                    imul    edx
  3926 0000262D 89566C                                  mov     [esi+108], edx
  3927 00002630 8B4670                                  mov     eax, [esi+112]  ; @@BF 28,31,-,COS3_0,1
  3928 00002633 8B567C                                  mov     edx, [esi+124]
  3929 00002636 015670                                  add     [esi+112], edx
  3930 00002639 29D0                                    sub     eax, edx
  3931 0000263B D1E0                                    shl     eax, 1
  3932 0000263D BA1016BABA                              mov     edx, 0BABA1610h
  3933 00002642 F7EA                                    imul    edx
  3934 00002644 89567C                                  mov     [esi+124], edx
  3935 00002647 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,30,+,COS0_1,1
  3936 0000264A 8B5678                                  mov     edx, [esi+120]
  3937 0000264D 015604                                  add     [esi+4], edx
  3938 00002650 29D0                                    sub     eax, edx
  3939 00002652 D1E0                                    shl     eax, 1
  3940 00002654 BABD45B340                              mov     edx, 40B345BDh
  3941 00002659 F7EA                                    imul    edx
  3942 0000265B 895678                                  mov     [esi+120], edx
  3943 0000265E 8B4638                                  mov     eax, [esi+56]   ; @@BF 14,17,+,COS0_14,3
  3944 00002661 8B5644                                  mov     edx, [esi+68]
  3945 00002664 015638                                  add     [esi+56], edx
  3946 00002667 29D0                                    sub     eax, edx
  3947 00002669 C1E003                                  shl     eax, 3
  3948 0000266C BAD0200B6D                              mov     edx, 6D0B20D0h
  3949 00002671 F7EA                                    imul    edx
  3950 00002673 895644                                  mov     [esi+68], edx
  3951 00002676 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,14,+,COS1_1,1
  3952 00002679 8B5638                                  mov     edx, [esi+56]
  3953 0000267C 015604                                  add     [esi+4], edx
  3954 0000267F 29D0                                    sub     eax, edx
  3955 00002681 D1E0                                    shl     eax, 1
  3956 00002683 BA103CE142                              mov     edx, 42E13C10h
  3957 00002688 F7EA                                    imul    edx
  3958 0000268A 895638                                  mov     [esi+56], edx
  3959 0000268D 8B4644                                  mov     eax, [esi+68]   ; @@BF 17,30,-,COS1_1,1
  3960 00002690 8B5678                                  mov     edx, [esi+120]
  3961 00002693 015644                                  add     [esi+68], edx
  3962 00002696 29D0                                    sub     eax, edx
  3963 00002698 D1E0                                    shl     eax, 1
  3964 0000269A BAF0C31EBD                              mov     edx, 0BD1EC3F0h
  3965 0000269F F7EA                                    imul    edx
  3966 000026A1 895678                                  mov     [esi+120], edx
  3967 000026A4 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,25,+,COS0_6,1
  3968 000026A7 8B5664                                  mov     edx, [esi+100]
  3969 000026AA 015618                                  add     [esi+24], edx
  3970 000026AD 29D0                                    sub     eax, edx
  3971 000026AF D1E0                                    shl     eax, 1
  3972 000026B1 BA1237AE4F                              mov     edx, 4FAE3712h
  3973 000026B6 F7EA                                    imul    edx
  3974 000026B8 895664                                  mov     [esi+100], edx
  3975 000026BB 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,22,+,COS0_9,1
  3976 000026BE 8B5658                                  mov     edx, [esi+88]
  3977 000026C1 015624                                  add     [esi+36], edx
  3978 000026C4 29D0                                    sub     eax, edx
  3979 000026C6 D1E0                                    shl     eax, 1
  3980 000026C8 BA27CF6F6B                              mov     edx, 6B6FCF27h
  3981 000026CD F7EA                                    imul    edx
  3982 000026CF 895658                                  mov     [esi+88], edx
  3983 000026D2 8B4618                                  mov     eax, [esi+24]   ; @@BF 6, 9,+,COS1_6,2
  3984 000026D5 8B5624                                  mov     edx, [esi+36]
  3985 000026D8 015618                                  add     [esi+24], edx
  3986 000026DB 29D0                                    sub     eax, edx
  3987 000026DD C1E002                                  shl     eax, 2
  3988 000026E0 BAC2923C6E                              mov     edx, 6E3C92C2h
  3989 000026E5 F7EA                                    imul    edx
  3990 000026E7 895624                                  mov     [esi+36], edx
  3991 000026EA 8B4658                                  mov     eax, [esi+88]   ; @@BF 22,25,-,COS1_6,2
  3992 000026ED 8B5664                                  mov     edx, [esi+100]
  3993 000026F0 015658                                  add     [esi+88], edx
  3994 000026F3 29D0                                    sub     eax, edx
  3995 000026F5 C1E002                                  shl     eax, 2
  3996 000026F8 BA3E6DC391                              mov     edx, 91C36D3Eh
  3997 000026FD F7EA                                    imul    edx
  3998 000026FF 895664                                  mov     [esi+100], edx
  3999 00002702 8B4604                                  mov     eax, [esi+4]    ; @@BF 1, 6,+,COS2_1,1
  4000 00002705 8B5618                                  mov     edx, [esi+24]
  4001 00002708 015604                                  add     [esi+4], edx
  4002 0000270B 29D0                                    sub     eax, edx
  4003 0000270D D1E0                                    shl     eax, 1
  4004 0000270F BA88DEF84C                              mov     edx, 4CF8DE88h
  4005 00002714 F7EA                                    imul    edx
  4006 00002716 895618                                  mov     [esi+24], edx
  4007 00002719 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,14,-,COS2_1,1
  4008 0000271C 8B5638                                  mov     edx, [esi+56]
  4009 0000271F 015624                                  add     [esi+36], edx
  4010 00002722 29D0                                    sub     eax, edx
  4011 00002724 D1E0                                    shl     eax, 1
  4012 00002726 BA782107B3                              mov     edx, 0B3072178h
  4013 0000272B F7EA                                    imul    edx
  4014 0000272D 895638                                  mov     [esi+56], edx
  4015 00002730 8B4644                                  mov     eax, [esi+68]   ; @@BF 17,22,+,COS2_1,1
  4016 00002733 8B5658                                  mov     edx, [esi+88]
  4017 00002736 015644                                  add     [esi+68], edx
  4018 00002739 29D0                                    sub     eax, edx
  4019 0000273B D1E0                                    shl     eax, 1
  4020 0000273D BA88DEF84C                              mov     edx, 4CF8DE88h
  4021 00002742 F7EA                                    imul    edx
  4022 00002744 895658                                  mov     [esi+88], edx
  4023 00002747 8B4664                                  mov     eax, [esi+100]  ; @@BF 25,30,-,COS2_1,1
  4024 0000274A 8B5678                                  mov     edx, [esi+120]
  4025 0000274D 015664                                  add     [esi+100], edx
  4026 00002750 29D0                                    sub     eax, edx
  4027 00002752 D1E0                                    shl     eax, 1
  4028 00002754 BA782107B3                              mov     edx, 0B3072178h
  4029 00002759 F7EA                                    imul    edx
  4030 0000275B 895678                                  mov     [esi+120], edx
  4031 0000275E 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,29,+,COS0_2,1
  4032 00002761 8B5674                                  mov     edx, [esi+116]
  4033 00002764 015608                                  add     [esi+8], edx
  4034 00002767 29D0                                    sub     eax, edx
  4035 00002769 D1E0                                    shl     eax, 1
  4036 0000276B BA6E2DFA41                              mov     edx, 41FA2D6Eh
  4037 00002770 F7EA                                    imul    edx
  4038 00002772 895674                                  mov     [esi+116], edx
  4039 00002775 8B4634                                  mov     eax, [esi+52]   ; @@BF 13,18,+,COS0_13,3
  4040 00002778 8B5648                                  mov     edx, [esi+72]
  4041 0000277B 015634                                  add     [esi+52], edx
  4042 0000277E 29D0                                    sub     eax, edx
  4043 00002780 C1E003                                  shl     eax, 3
  4044 00002783 BA9057D941                              mov     edx, 41D95790h
  4045 00002788 F7EA                                    imul    edx
  4046 0000278A 895648                                  mov     [esi+72], edx
  4047 0000278D 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,13,+,COS1_2,1
  4048 00002790 8B5634                                  mov     edx, [esi+52]
  4049 00002793 015608                                  add     [esi+8], edx
  4050 00002796 29D0                                    sub     eax, edx
  4051 00002798 D1E0                                    shl     eax, 1
  4052 0000279A BA459F9148                              mov     edx, 48919F45h
  4053 0000279F F7EA                                    imul    edx
  4054 000027A1 895634                                  mov     [esi+52], edx
  4055 000027A4 8B4648                                  mov     eax, [esi+72]   ; @@BF 18,29,-,COS1_2,1
  4056 000027A7 8B5674                                  mov     edx, [esi+116]
  4057 000027AA 015648                                  add     [esi+72], edx
  4058 000027AD 29D0                                    sub     eax, edx
  4059 000027AF D1E0                                    shl     eax, 1
  4060 000027B1 BABB606EB7                              mov     edx, 0B76E60BBh
  4061 000027B6 F7EA                                    imul    edx
  4062 000027B8 895674                                  mov     [esi+116], edx
  4063 000027BB 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,26,+,COS0_5,1
  4064 000027BE 8B5668                                  mov     edx, [esi+104]
  4065 000027C1 015614                                  add     [esi+20], edx
  4066 000027C4 29D0                                    sub     eax, edx
  4067 000027C6 D1E0                                    shl     eax, 1
  4068 000027C8 BAF19C9D4A                              mov     edx, 4A9D9CF1h
  4069 000027CD F7EA                                    imul    edx
  4070 000027CF 895668                                  mov     [esi+104], edx
  4071 000027D2 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,21,+,COS0_10,1
  4072 000027D5 8B5654                                  mov     edx, [esi+84]
  4073 000027D8 015628                                  add     [esi+40], edx
  4074 000027DB 29D0                                    sub     eax, edx
  4075 000027DD D1E0                                    shl     eax, 1
  4076 000027DF BAB41D7D7C                              mov     edx, 7C7D1DB4h
  4077 000027E4 F7EA                                    imul    edx
  4078 000027E6 895654                                  mov     [esi+84], edx
  4079 000027E9 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,10,+,COS1_5,2
  4080 000027EC 8B5628                                  mov     edx, [esi+40]
  4081 000027EF 015614                                  add     [esi+20], edx
  4082 000027F2 29D0                                    sub     eax, edx
  4083 000027F4 C1E002                                  shl     eax, 2
  4084 000027F7 BAAA24E243                              mov     edx, 43E224AAh
  4085 000027FC F7EA                                    imul    edx
  4086 000027FE 895628                                  mov     [esi+40], edx
  4087 00002801 8B4654                                  mov     eax, [esi+84]   ; @@BF 21,26,-,COS1_5,2
  4088 00002804 8B5668                                  mov     edx, [esi+104]
  4089 00002807 015654                                  add     [esi+84], edx
  4090 0000280A 29D0                                    sub     eax, edx
  4091 0000280C C1E002                                  shl     eax, 2
  4092 0000280F BA56DB1DBC                              mov     edx, 0BC1DDB56h
  4093 00002814 F7EA                                    imul    edx
  4094 00002816 895668                                  mov     [esi+104], edx
  4095 00002819 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,5,+,COS2_2,1
  4096 0000281C 8B5614                                  mov     edx, [esi+20]
  4097 0000281F 015608                                  add     [esi+8], edx
  4098 00002822 29D0                                    sub     eax, edx
  4099 00002824 D1E0                                    shl     eax, 1
  4100 00002826 BABF6B3273                              mov     edx, 73326BBFh  ; +COS2_2
  4101 0000282B F7EA                                    imul    edx
  4102 0000282D 895614                                  mov     [esi+20], edx
  4103 00002830 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,13,-,COS2_2,1
  4104 00002833 8B5634                                  mov     edx, [esi+52]
  4105 00002836 015628                                  add     [esi+40], edx
  4106 00002839 29D0                                    sub     eax, edx
  4107 0000283B D1E0                                    shl     eax, 1
  4108 0000283D BA4194CD8C                              mov     edx, 8CCD9441h  ; -COS2_2
  4109 00002842 F7EA                                    imul    edx
  4110 00002844 895634                                  mov     [esi+52], edx
  4111 00002847 8B4648                                  mov     eax, [esi+72]   ; @@BF 18,21,+,COS2_2,1
  4112 0000284A 8B5654                                  mov     edx, [esi+84]
  4113 0000284D 015648                                  add     [esi+72], edx
  4114 00002850 29D0                                    sub     eax, edx
  4115 00002852 D1E0                                    shl     eax, 1
  4116 00002854 BABF6B3273                              mov     edx, 73326BBFh
  4117 00002859 F7EA                                    imul    edx
  4118 0000285B 895654                                  mov     [esi+84], edx
  4119 0000285E 8B4668                                  mov     eax, [esi+104]  ; @@BF 26,29,-,COS2_2,1
  4120 00002861 8B5674                                  mov     edx, [esi+116]
  4121 00002864 015668                                  add     [esi+104], edx
  4122 00002867 29D0                                    sub     eax, edx
  4123 00002869 D1E0                                    shl     eax, 1
  4124 0000286B BA4194CD8C                              mov     edx, 8CCD9441h
  4125 00002870 F7EA                                    imul    edx
  4126 00002872 895674                                  mov     [esi+116], edx
  4127 00002875 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,2,+,COS3_1,2
  4128 00002878 8B5608                                  mov     edx, [esi+8]
  4129 0000287B 015604                                  add     [esi+4], edx
  4130 0000287E 29D0                                    sub     eax, edx
  4131 00002880 C1E002                                  shl     eax, 2
  4132 00002883 BA46BA9E53                              mov     edx, 539EBA46h
  4133 00002888 F7EA                                    imul    edx
  4134 0000288A 895608                                  mov     [esi+8], edx
  4135 0000288D 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,6,-,COS3_1,2
  4136 00002890 8B5618                                  mov     edx, [esi+24]
  4137 00002893 015614                                  add     [esi+20], edx
  4138 00002896 29D0                                    sub     eax, edx
  4139 00002898 C1E002                                  shl     eax, 2
  4140 0000289B BABA4561AC                              mov     edx, 0AC6145BAh
  4141 000028A0 F7EA                                    imul    edx
  4142 000028A2 895618                                  mov     [esi+24], edx
  4143 000028A5 8B4624                                  mov     eax, [esi+36]   ; IF rate_shift LT 2
  4144                                                                          ; @@BF 9,10,+,COS3_1,2
  4145 000028A8 8B5628                                  mov     edx, [esi+40]
  4146 000028AB 015624                                  add     [esi+36], edx
  4147 000028AE 29D0                                    sub     eax, edx
  4148 000028B0 C1E002                                  shl     eax, 2
  4149 000028B3 BA46BA9E53                              mov     edx, 539EBA46h
  4150 000028B8 F7EA                                    imul    edx
  4151 000028BA 895628                                  mov     [esi+40], edx
  4152 000028BD 8B4634                                  mov     eax, [esi+52]   ; @@BF 13,14,-,COS3_1,2
  4153 000028C0 8B5638                                  mov     edx, [esi+56]
  4154 000028C3 015634                                  add     [esi+52], edx
  4155 000028C6 29D0                                    sub     eax, edx
  4156 000028C8 C1E002                                  shl     eax, 2
  4157 000028CB BABA4561AC                              mov     edx, 0AC6145BAh
  4158 000028D0 F7EA                                    imul    edx
  4159 000028D2 895638                                  mov     [esi+56], edx   ; ENDIF
  4160 000028D5 8B4644                                  mov     eax, [esi+68]   ; @@BF 17,18,+,COS3_1,2
  4161 000028D8 8B5648                                  mov     edx, [esi+72]
  4162 000028DB 015644                                  add     [esi+68], edx
  4163 000028DE 29D0                                    sub     eax, edx
  4164 000028E0 C1E002                                  shl     eax, 2
  4165 000028E3 BA46BA9E53                              mov     edx, 539EBA46h
  4166 000028E8 F7EA                                    imul    edx
  4167 000028EA 895648                                  mov     [esi+72], edx
  4168 000028ED 8B4654                                  mov     eax, [esi+84]   ; @@BF 21,22,-,COS3_1,2
  4169 000028F0 8B5658                                  mov     edx, [esi+88]
  4170 000028F3 015654                                  add     [esi+84], edx
  4171 000028F6 29D0                                    sub     eax, edx
  4172 000028F8 C1E002                                  shl     eax, 2
  4173 000028FB BABA4561AC                              mov     edx, 0AC6145BAh
  4174 00002900 F7EA                                    imul    edx
  4175 00002902 895658                                  mov     [esi+88], edx
  4176 00002905 8B4664                                  mov     eax, [esi+100]  ; @@BF 25,26,+,COS3_1,2
  4177 00002908 8B5668                                  mov     edx, [esi+104]
  4178 0000290B 015664                                  add     [esi+100], edx
  4179 0000290E 29D0                                    sub     eax, edx
  4180 00002910 C1E002                                  shl     eax, 2
  4181 00002913 BA46BA9E53                              mov     edx, 539EBA46h
  4182 00002918 F7EA                                    imul    edx
  4183 0000291A 895668                                  mov     [esi+104], edx
  4184 0000291D 8B4674                                  mov     eax, [esi+116]  ; @@BF 29,30,-,COS3_1,2
  4185 00002920 8B5678                                  mov     edx, [esi+120]
  4186 00002923 015674                                  add     [esi+116], edx
  4187 00002926 29D0                                    sub     eax, edx
  4188 00002928 C1E002                                  shl     eax, 2
  4189 0000292B BABA4561AC                              mov     edx, 0AC6145BAh
  4190 00002930 F7EA                                    imul    edx
  4191 00002932 895678                                  mov     [esi+120], edx
  4192 00002935 8B06                                    mov     eax, [esi]      ; @@BF1 macro a, b, c, d
  4193                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4194                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4195                                                                          ;   @@ADD c, d
  4196                                                                          ;  endm
  4197                                                                          ; @@BF1 0,1,2,3
  4198 00002937 8B5604                                  mov     edx, [esi+4]    ; @@BF 0,1,+,COS4_0,1
  4199 0000293A 0116                                    add     [esi], edx
  4200 0000293C 29D0                                    sub     eax, edx
  4201 0000293E D1E0                                    shl     eax, 1
  4202 00002940 BA9A79825A                              mov     edx, 5A82799Ah  ; +COS4_0
  4203 00002945 F7EA                                    imul    edx
  4204 00002947 895604                                  mov     [esi+4], edx
  4205 0000294A 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,3,-,COS4_0,1
  4206 0000294D 8B560C                                  mov     edx, [esi+12]
  4207 00002950 015608                                  add     [esi+8], edx
  4208 00002953 29D0                                    sub     eax, edx
  4209 00002955 D1E0                                    shl     eax, 1
  4210 00002957 BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  4211 0000295C F7EA                                    imul    edx
  4212 0000295E 89560C                                  mov     [esi+12], edx
  4213 00002961 8B460C                                  mov     eax, [esi+12]   ; @@ADD 2,3
  4214 00002964 014608                                  add     [esi+8], eax
  4215 00002967 8B4610                                  mov     eax, [esi+16]   ; @@BF2 macro a, b, c, d
  4216                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4217                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4218                                                                          ;   @@ADD c, d
  4219                                                                          ;   @@ADD a, c
  4220                                                                          ;   @@ADD c, b
  4221                                                                          ;   @@ADD b, d
  4222                                                                          ;  endm
  4223                                                                          ; @@BF2 4,5,6,7
  4224 0000296A 8B5614                                  mov     edx, [esi+20]   ; @@BF 4,5,+,COS4_0,1
  4225 0000296D 015610                                  add     [esi+16], edx
  4226 00002970 29D0                                    sub     eax, edx
  4227 00002972 D1E0                                    shl     eax, 1
  4228 00002974 BA9A79825A                              mov     edx, 5A82799Ah
  4229 00002979 F7EA                                    imul    edx
  4230 0000297B 895614                                  mov     [esi+20], edx
  4231 0000297E 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,7,-,COS4_0,1
  4232 00002981 8B561C                                  mov     edx, [esi+28]
  4233 00002984 015618                                  add     [esi+24], edx
  4234 00002987 29D0                                    sub     eax, edx
  4235 00002989 D1E0                                    shl     eax, 1
  4236 0000298B BA66867DA5                              mov     edx, 0A57D8666h
  4237 00002990 F7EA                                    imul    edx
  4238 00002992 89561C                                  mov     [esi+28], edx
  4239 00002995 8B461C                                  mov     eax, [esi+28]   ; @@ADD macro dst,src
  4240                                                                          ;   IF (rate_shift EQ 0) or (dst LT 16)
  4241                                                                          ;    ;tab[a] += tab[b]
  4242                                                                          ;    mov  eax,dword ptr [esi+src*4]
  4243                                                                          ;    add  dword ptr [esi+dst*4],eax
  4244                                                                          ;   ENDIF
  4245                                                                          ;  endm
  4246                                                                          ; @@ADD 6,7
  4247 00002998 014618                                  add     [esi+24], eax
  4248 0000299B 8B4618                                  mov     eax, [esi+24]   ; @@ADD 4,6
  4249 0000299E 014610                                  add     [esi+16], eax
  4250 000029A1 8B4614                                  mov     eax, [esi+20]   ; @@ADD 6,5
  4251 000029A4 014618                                  add     [esi+24], eax
  4252 000029A7 8B461C                                  mov     eax, [esi+28]   ; @@ADD 5,7
  4253 000029AA 014614                                  add     [esi+20], eax
  4254 000029AD 8B4620                                  mov     eax, [esi+32]   ; IF rate_shift LT 2
  4255                                                                          ; @@BF1 8,9,10,11
  4256 000029B0 8B5624                                  mov     edx, [esi+36]   ; @@BF 8,9,+,COS4_0,1
  4257 000029B3 015620                                  add     [esi+32], edx
  4258 000029B6 29D0                                    sub     eax, edx
  4259 000029B8 D1E0                                    shl     eax, 1
  4260 000029BA BA9A79825A                              mov     edx, 5A82799Ah
  4261 000029BF F7EA                                    imul    edx
  4262 000029C1 895624                                  mov     [esi+36], edx
  4263 000029C4 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,11,-,COS4_0,1
  4264 000029C7 8B562C                                  mov     edx, [esi+44]
  4265 000029CA 015628                                  add     [esi+40], edx
  4266 000029CD 29D0                                    sub     eax, edx
  4267 000029CF D1E0                                    shl     eax, 1
  4268 000029D1 BA66867DA5                              mov     edx, 0A57D8666h
  4269 000029D6 F7EA                                    imul    edx
  4270 000029D8 89562C                                  mov     [esi+44], edx
  4271 000029DB 8B462C                                  mov     eax, [esi+44]   ; @@ADD 10,11
  4272 000029DE 014628                                  add     [esi+40], eax
  4273 000029E1 8B4630                                  mov     eax, [esi+48]   ; @@BF2 12,13,14,15
  4274 000029E4 8B5634                                  mov     edx, [esi+52]   ; @@BF 12,13,+,COS4_0,1
  4275 000029E7 015630                                  add     [esi+48], edx
  4276 000029EA 29D0                                    sub     eax, edx
  4277 000029EC D1E0                                    shl     eax, 1
  4278 000029EE BA9A79825A                              mov     edx, 5A82799Ah
  4279 000029F3 F7EA                                    imul    edx
  4280 000029F5 895634                                  mov     [esi+52], edx
  4281 000029F8 8B4638                                  mov     eax, [esi+56]   ; @@BF 14,15,-,COS4_0,1
  4282 000029FB 8B563C                                  mov     edx, [esi+60]
  4283 000029FE 015638                                  add     [esi+56], edx
  4284 00002A01 29D0                                    sub     eax, edx
  4285 00002A03 D1E0                                    shl     eax, 1
  4286 00002A05 BA66867DA5                              mov     edx, 0A57D8666h
  4287 00002A0A F7EA                                    imul    edx
  4288 00002A0C 89563C                                  mov     [esi+60], edx
  4289 00002A0F 8B463C                                  mov     eax, [esi+60]   ; @@ADD 14,15
  4290 00002A12 014638                                  add     [esi+56], eax
  4291 00002A15 8B4638                                  mov     eax, [esi+56]   ; @@ADD 12,14
  4292 00002A18 014630                                  add     [esi+48], eax
  4293 00002A1B 8B4634                                  mov     eax, [esi+52]   ; @@ADD 14,13
  4294 00002A1E 014638                                  add     [esi+56], eax
  4295 00002A21 8B463C                                  mov     eax, [esi+60]   ; @@ADD 13,15
  4296 00002A24 014634                                  add     [esi+52], eax   ; ENDIF
  4297 00002A27 8B4640                                  mov     eax, [esi+64]   ; @@BF1 16,17,18,19
  4298 00002A2A 8B5644                                  mov     edx, [esi+68]
  4299 00002A2D 015640                                  add     [esi+64], edx
  4300 00002A30 29D0                                    sub     eax, edx
  4301 00002A32 D1E0                                    shl     eax, 1
  4302 00002A34 BA9A79825A                              mov     edx, 5A82799Ah  ; +COS4_0
  4303 00002A39 F7EA                                    imul    edx
  4304 00002A3B 895644                                  mov     [esi+68], edx
  4305 00002A3E 8B4648                                  mov     eax, [esi+72]
  4306 00002A41 8B564C                                  mov     edx, [esi+76]
  4307 00002A44 015648                                  add     [esi+72], edx
  4308 00002A47 29D0                                    sub     eax, edx
  4309 00002A49 D1E0                                    shl     eax, 1
  4310 00002A4B BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  4311 00002A50 F7EA                                    imul    edx
  4312 00002A52 89564C                                  mov     [esi+76], edx
  4313 00002A55 8B464C                                  mov     eax, [esi+76]   ; @@ADD 18,19
  4314 00002A58 014648                                  add     [esi+72], eax
  4315 00002A5B 8B4650                                  mov     eax, [esi+80]   ; @@BF2 20,21,22,23
  4316 00002A5E 8B5654                                  mov     edx, [esi+84]
  4317 00002A61 015650                                  add     [esi+80], edx
  4318 00002A64 29D0                                    sub     eax, edx
  4319 00002A66 D1E0                                    shl     eax, 1
  4320 00002A68 BA9A79825A                              mov     edx, 5A82799Ah
  4321 00002A6D F7EA                                    imul    edx
  4322 00002A6F 895654                                  mov     [esi+84], edx
  4323 00002A72 8B4658                                  mov     eax, [esi+88]
  4324 00002A75 8B565C                                  mov     edx, [esi+92]
  4325 00002A78 015658                                  add     [esi+88], edx
  4326 00002A7B 29D0                                    sub     eax, edx
  4327 00002A7D D1E0                                    shl     eax, 1
  4328 00002A7F BA66867DA5                              mov     edx, 0A57D8666h
  4329 00002A84 F7EA                                    imul    edx
  4330 00002A86 89565C                                  mov     [esi+92], edx
  4331 00002A89 8B465C                                  mov     eax, [esi+92]   ; @@ADD 22,23
  4332 00002A8C 014658                                  add     [esi+88], eax
  4333 00002A8F 8B4658                                  mov     eax, [esi+88]   ; @@ADD 20,22
  4334 00002A92 014650                                  add     [esi+80], eax
  4335 00002A95 8B4654                                  mov     eax, [esi+84]
  4336 00002A98 014658                                  add     [esi+88], eax
  4337 00002A9B 8B465C                                  mov     eax, [esi+92]
  4338 00002A9E 014654                                  add     [esi+84], eax
  4339 00002AA1 8B4660                                  mov     eax, [esi+96]   ; @@BF1 24,25,26,27
  4340 00002AA4 8B5664                                  mov     edx, [esi+100]
  4341 00002AA7 015660                                  add     [esi+96], edx
  4342 00002AAA 29D0                                    sub     eax, edx
  4343 00002AAC D1E0                                    shl     eax, 1
  4344 00002AAE BA9A79825A                              mov     edx, 5A82799Ah
  4345 00002AB3 F7EA                                    imul    edx
  4346 00002AB5 895664                                  mov     [esi+100], edx
  4347 00002AB8 8B4668                                  mov     eax, [esi+104]
  4348 00002ABB 8B566C                                  mov     edx, [esi+108]
  4349 00002ABE 015668                                  add     [esi+104], edx
  4350 00002AC1 29D0                                    sub     eax, edx
  4351 00002AC3 D1E0                                    shl     eax, 1
  4352 00002AC5 BA66867DA5                              mov     edx, 0A57D8666h
  4353 00002ACA F7EA                                    imul    edx
  4354 00002ACC 89566C                                  mov     [esi+108], edx
  4355 00002ACF 8B466C                                  mov     eax, [esi+108]
  4356 00002AD2 014668                                  add     [esi+104], eax
  4357 00002AD5 8B4670                                  mov     eax, [esi+112]  ; @@BF2 28,29,30,31
  4358 00002AD8 8B5674                                  mov     edx, [esi+116]
  4359 00002ADB 015670                                  add     [esi+112], edx
  4360 00002ADE 29D0                                    sub     eax, edx
  4361 00002AE0 D1E0                                    shl     eax, 1
  4362 00002AE2 BA9A79825A                              mov     edx, 5A82799Ah
  4363 00002AE7 F7EA                                    imul    edx
  4364 00002AE9 895674                                  mov     [esi+116], edx
  4365 00002AEC 8B4678                                  mov     eax, [esi+120]
  4366 00002AEF 8B567C                                  mov     edx, [esi+124]
  4367 00002AF2 015678                                  add     [esi+120], edx
  4368 00002AF5 29D0                                    sub     eax, edx
  4369 00002AF7 D1E0                                    shl     eax, 1
  4370 00002AF9 BA66867DA5                              mov     edx, 0A57D8666h
  4371 00002AFE F7EA                                    imul    edx
  4372 00002B00 89567C                                  mov     [esi+124], edx
  4373 00002B03 8B467C                                  mov     eax, [esi+124]
  4374 00002B06 014678                                  add     [esi+120], eax
  4375 00002B09 8B4678                                  mov     eax, [esi+120]
  4376 00002B0C 014670                                  add     [esi+112], eax
  4377 00002B0F 8B4674                                  mov     eax, [esi+116]
  4378 00002B12 014678                                  add     [esi+120], eax
  4379 00002B15 8B467C                                  mov     eax, [esi+124]
  4380 00002B18 014674                                  add     [esi+116], eax
  4381 00002B1B 8B06                                    mov     eax, [esi]      ; @@OUT macro dst,src1,src2
  4382                                                                          ; IF ((dst AND ((1 SHL rate_shift)-1)) EQ 0)
  4383                                                                          ;    mov eax,dword ptr [esi+src1*4]
  4384                                                                          ;    IFDIFI <src2>,<->
  4385                                                                          ;      add eax,dword ptr [esi+src2*4]
  4386                                                                          ;    ENDIF
  4387                                                                          ;    IF SYNTH32
  4388                                                                          ;       mov dword ptr [edi+dst*4],eax
  4389                                                                          ;       IF (LONG_WINDOW EQ 0)
  4390                                                                          ;          mov dword ptr [edi+dst*4+512*4],eax
  4391                                                                          ;       ENDIF
  4392                                                                          ;    ELSE
  4393                                                                          ;        ......
  4394                                                                          ;    ENDIF
  4395                                                                          ; @@OUT 0,0,-
  4396 00002B1D 8907                                    mov     [edi], eax      ; mov dword ptr [edi+dst*4],eax
  4397 00002B1F 8B4604                                  mov     eax, [esi+4]    ; @@OUT 16,1, -
  4398                                                                          ; mov eax,dword ptr [esi+src1*4]
  4399 00002B22 894740                                  mov     [edi+64], eax   ; mov dword ptr [edi+dst*4],eax
  4400 00002B25 8B4608                                  mov     eax, [esi+8]    ; @@OUT 8,2,-
  4401 00002B28 894720                                  mov     [edi+32], eax
  4402 00002B2B 8B460C                                  mov     eax, [esi+12]   ; @@OUT 24,3,-
  4403 00002B2E 894760                                  mov     [edi+96], eax
  4404 00002B31 8B4610                                  mov     eax, [esi+16]   ; @@OUT 4,4,-
  4405 00002B34 894710                                  mov     [edi+16], eax
  4406 00002B37 8B4614                                  mov     eax, [esi+20]   ; @@OUT 20,5,-
  4407 00002B3A 894750                                  mov     [edi+80], eax
  4408 00002B3D 8B4618                                  mov     eax, [esi+24]   ; @@OUT 12,6,-
  4409 00002B40 894730                                  mov     [edi+48], eax
  4410 00002B43 8B461C                                  mov     eax, [esi+28]   ; @@OUT 28,7,-
  4411 00002B46 894770                                  mov     [edi+112], eax
  4412 00002B49 8B4620                                  mov     eax, [esi+32]   ; @@OUT 2,8,12
  4413 00002B4C 034630                                  add     eax, [esi+48]   ; add eax,dword ptr [esi+src2*4]
  4414 00002B4F 894708                                  mov     [edi+8], eax
  4415 00002B52 8B4624                                  mov     eax, [esi+36]   ; @@OUT 18,9,13
  4416 00002B55 034634                                  add     eax, [esi+52]   ; add eax,dword ptr [esi+src2*4]
  4417 00002B58 894748                                  mov     [edi+72], eax
  4418 00002B5B 8B4628                                  mov     eax, [esi+40]   ; @@OUT 10,10,14
  4419 00002B5E 034638                                  add     eax, [esi+56]
  4420 00002B61 894728                                  mov     [edi+40], eax
  4421 00002B64 8B462C                                  mov     eax, [esi+44]   ; @@OUT 26,11,15
  4422 00002B67 03463C                                  add     eax, [esi+60]
  4423 00002B6A 894768                                  mov     [edi+104], eax
  4424 00002B6D 8B4630                                  mov     eax, [esi+48]   ; @@OUT 6,12,10
  4425 00002B70 034628                                  add     eax, [esi+40]
  4426 00002B73 894718                                  mov     [edi+24], eax
  4427 00002B76 8B4634                                  mov     eax, [esi+52]   ; @@OUT 22,13,11
  4428 00002B79 03462C                                  add     eax, [esi+44]
  4429 00002B7C 894758                                  mov     [edi+88], eax
  4430 00002B7F 8B4638                                  mov     eax, [esi+56]   ; @@OUT 14,14,9
  4431 00002B82 034624                                  add     eax, [esi+36]
  4432 00002B85 894738                                  mov     [edi+56], eax
  4433 00002B88 8B463C                                  mov     eax, [esi+60]   ; @@OUT 30,15,-
  4434 00002B8B 894778                                  mov     [edi+120], eax
  4435 00002B8E 8B4670                                  mov     eax, [esi+112]  ; @@ADD 24,28
  4436 00002B91 014660                                  add     [esi+96], eax
  4437 00002B94 8B4668                                  mov     eax, [esi+104]  ; @@ADD 28,26
  4438 00002B97 014670                                  add     [esi+112], eax
  4439 00002B9A 8B4678                                  mov     eax, [esi+120]  ; @@ADD 26,30
  4440 00002B9D 014668                                  add     [esi+104], eax
  4441 00002BA0 8B4664                                  mov     eax, [esi+100]  ; @@ADD 30,25
  4442 00002BA3 014678                                  add     [esi+120], eax
  4443 00002BA6 8B4674                                  mov     eax, [esi+116]  ; @@ADD 25,29
  4444 00002BA9 014664                                  add     [esi+100], eax
  4445 00002BAC 8B466C                                  mov     eax, [esi+108]  ; @@ADD 29,27
  4446 00002BAF 014674                                  add     [esi+116], eax
  4447 00002BB2 8B467C                                  mov     eax, [esi+124]  ; @@ADD 27,31
  4448 00002BB5 01466C                                  add     [esi+108], eax
  4449 00002BB8 8B4640                                  mov     eax, [esi+64]   ; @@OUT 1,16,24
  4450 00002BBB 034660                                  add     eax, [esi+96]
  4451 00002BBE 894704                                  mov     [edi+4], eax
  4452 00002BC1 8B4644                                  mov     eax, [esi+68]   ; @@OUT 17,17,25
  4453 00002BC4 034664                                  add     eax, [esi+100]
  4454 00002BC7 894744                                  mov     [edi+68], eax
  4455 00002BCA 8B4648                                  mov     eax, [esi+72]   ; @@OUT 9,18,26
  4456 00002BCD 034668                                  add     eax, [esi+104]
  4457 00002BD0 894724                                  mov     [edi+36], eax
  4458 00002BD3 8B464C                                  mov     eax, [esi+76]   ; @@OUT 25,19,27
  4459 00002BD6 03466C                                  add     eax, [esi+108]
  4460 00002BD9 894764                                  mov     [edi+100], eax
  4461 00002BDC 8B4650                                  mov     eax, [esi+80]   ; @@OUT 5,20,28
  4462 00002BDF 034670                                  add     eax, [esi+112]
  4463 00002BE2 894714                                  mov     [edi+20], eax
  4464 00002BE5 8B4654                                  mov     eax, [esi+84]   ; @@OUT 21,21,29
  4465 00002BE8 034674                                  add     eax, [esi+116]
  4466 00002BEB 894754                                  mov     [edi+84], eax
  4467 00002BEE 8B4658                                  mov     eax, [esi+88]   ; @@OUT 13,22,30
  4468 00002BF1 034678                                  add     eax, [esi+120]
  4469 00002BF4 894734                                  mov     [edi+52], eax
  4470 00002BF7 8B465C                                  mov     eax, [esi+92]   ; @@OUT 29,23,31
  4471 00002BFA 03467C                                  add     eax, [esi+124]
  4472 00002BFD 894774                                  mov     [edi+116], eax
  4473 00002C00 8B4660                                  mov     eax, [esi+96]   ; @@OUT 3,24,20
  4474 00002C03 034650                                  add     eax, [esi+80]
  4475 00002C06 89470C                                  mov     [edi+12], eax
  4476 00002C09 8B4664                                  mov     eax, [esi+100]  ; @@OUT 19,25,21
  4477 00002C0C 034654                                  add     eax, [esi+84]
  4478 00002C0F 89474C                                  mov     [edi+76], eax
  4479 00002C12 8B4668                                  mov     eax, [esi+104]  ; @@OUT 11,26,22
  4480 00002C15 034658                                  add     eax, [esi+88]
  4481 00002C18 89472C                                  mov     [edi+44], eax
  4482 00002C1B 8B466C                                  mov     eax, [esi+108]  ; @@OUT 27,27,23
  4483 00002C1E 03465C                                  add     eax, [esi+92]
  4484 00002C21 89476C                                  mov     [edi+108], eax
  4485 00002C24 8B4670                                  mov     eax, [esi+112]  ; @@OUT 7,28,18
  4486 00002C27 034648                                  add     eax, [esi+72]
  4487 00002C2A 89471C                                  mov     [edi+28], eax
  4488 00002C2D 8B4674                                  mov     eax, [esi+116]  ; @@OUT 23,29,19
  4489 00002C30 03464C                                  add     eax, [esi+76]
  4490 00002C33 89475C                                  mov     [edi+92], eax
  4491 00002C36 8B4678                                  mov     eax, [esi+120]  ; @@OUT 15,30,17
  4492 00002C39 034644                                  add     eax, [esi+68]
  4493 00002C3C 89473C                                  mov     [edi+60], eax
  4494 00002C3F 8B467C                                  mov     eax, [esi+124]  ; @@OUT 31,31,-
  4495 00002C42 89477C                                  mov     [edi+124], eax
  4496 00002C45 C3                                      retn
  4497                                  
  4498                                  
  4499                                  ; =============== S U B R O U T I N E =======================================
  4500                                  
  4501                                  
  4502                                  mp3_dct32_shift_1:
  4503 00002C46 8B467C                                  mov     eax, [esi+124]  ; mp3_dct32_macro macro rate_shift ; rate_shift = 1
  4504 00002C49 0106                                    add     [esi], eax      ; @@BF macro a,b,sign,cos,shift
  4505                                                                          ; @@need_a equ (rate_shift EQ 0) or (a LT 16) ; a = 0
  4506                                                                          ; @@need_b equ (rate_shift EQ 0) or (b LT 16) ; b = 31
  4507                                                                          ; IF @@need_a AND @@need_b ; rate_shift = 0
  4508                                                                          ;    mov eax,dword ptr [esi+a*4]
  4509                                                                          ;    mov edx,dword ptr [esi+b*4]
  4510                                                                          ;    add dword ptr [esi+a*4],edx
  4511                                                                          ; ELSEIF @@need_a
  4512                                                                          ;    mov eax,dword ptr [esi+b*4]
  4513                                                                          ;    add dword ptr [esi+a*4],eax
  4514                                                                          ;
  4515                                                                          ; @@BF 0,31,+,COS0_0,1
  4516 00002C4B 8B4640                                  mov     eax, [esi+64]   ; @@BF 15,16,+,COS0_15,5
  4517 00002C4E 01463C                                  add     [esi+60], eax
  4518 00002C51 8B06                                    mov     eax, [esi]      ; @@BF 0,15,+,COS1_0,1
  4519 00002C53 8B563C                                  mov     edx, [esi+60]
  4520 00002C56 0116                                    add     [esi], edx
  4521 00002C58 29D0                                    sub     eax, edx
  4522 00002C5A D1E0                                    shl     eax, 1
  4523 00002C5C BA72464F40                              mov     edx, 404F4672h  ; COS1_0
  4524 00002C61 F7EA                                    imul    edx
  4525 00002C63 89563C                                  mov     [esi+60], edx
  4526 00002C66 8B4660                                  mov     eax, [esi+96]   ; skip @@BF 16,31,-,COS1_0,1
  4527                                                                          ; @@BF 7,24,+,COS0_7,1
  4528 00002C69 01461C                                  add     [esi+28], eax
  4529 00002C6C 8B465C                                  mov     eax, [esi+92]   ; @@BF 8,23,+,COS0_8,1
  4530 00002C6F 014620                                  add     [esi+32], eax
  4531 00002C72 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,8,+,COS1_7,4
  4532 00002C75 8B5620                                  mov     edx, [esi+32]
  4533 00002C78 01561C                                  add     [esi+28], edx
  4534 00002C7B 29D0                                    sub     eax, edx
  4535 00002C7D C1E004                                  shl     eax, 4
  4536 00002C80 BA044E9E51                              mov     edx, 519E4E04h  ; COS1_7
  4537 00002C85 F7EA                                    imul    edx
  4538 00002C87 895620                                  mov     [esi+32], edx
  4539 00002C8A 8B06                                    mov     eax, [esi]      ; skip @@BF 23,24,-,COS1_7,4
  4540                                                                          ; @@BF 0,7,+,COS2_0,1
  4541 00002C8C 8B561C                                  mov     edx, [esi+28]
  4542 00002C8F 0116                                    add     [esi], edx
  4543 00002C91 29D0                                    sub     eax, edx
  4544 00002C93 D1E0                                    shl     eax, 1
  4545 00002C95 BA46FB4041                              mov     edx, 4140FB46h  ; COS2_0
  4546 00002C9A F7EA                                    imul    edx
  4547 00002C9C 89561C                                  mov     [esi+28], edx
  4548 00002C9F 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,15,-,COS2_0,1
  4549 00002CA2 8B563C                                  mov     edx, [esi+60]
  4550 00002CA5 015620                                  add     [esi+32], edx
  4551 00002CA8 29D0                                    sub     eax, edx
  4552 00002CAA D1E0                                    shl     eax, 1
  4553 00002CAC BABA04BFBE                              mov     edx, 0BEBF04BAh ; -COS2_0
  4554 00002CB1 F7EA                                    imul    edx
  4555 00002CB3 89563C                                  mov     [esi+60], edx
  4556 00002CB6 8B4670                                  mov     eax, [esi+112]  ; skip @@BF 16,23,+,COS2_0,1
  4557                                                                          ;      @@BF 24,31,-,COS2_0,1
  4558                                                                          ; @@BF 3,28,+,COS0_3,1
  4559 00002CB9 01460C                                  add     [esi+12], eax
  4560 00002CBC 8B464C                                  mov     eax, [esi+76]   ; @@BF 12,19,+,COS0_12,2
  4561 00002CBF 014630                                  add     [esi+48], eax
  4562 00002CC2 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,12,+,COS1_3,1
  4563 00002CC5 8B5630                                  mov     edx, [esi+48]
  4564 00002CC8 01560C                                  add     [esi+12], edx
  4565 00002CCB 29D0                                    sub     eax, edx
  4566 00002CCD D1E0                                    shl     eax, 1
  4567 00002CCF BA630ECB52                              mov     edx, 52CB0E63h
  4568 00002CD4 F7EA                                    imul    edx
  4569 00002CD6 895630                                  mov     [esi+48], edx
  4570 00002CD9 8B466C                                  mov     eax, [esi+108]  ; @@BF 4,27,+,COS0_4,1
  4571 00002CDC 014610                                  add     [esi+16], eax
  4572 00002CDF 8B4650                                  mov     eax, [esi+80]   ; @@BF 11,20,+,COS0_11,2
  4573 00002CE2 01462C                                  add     [esi+44], eax
  4574 00002CE5 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,11,+,COS1_4,1
  4575 00002CE8 8B562C                                  mov     edx, [esi+44]
  4576 00002CEB 015610                                  add     [esi+16], edx
  4577 00002CEE 29D0                                    sub     eax, edx
  4578 00002CF0 D1E0                                    shl     eax, 1
  4579 00002CF2 BA2E40E264                              mov     edx, 64E2402Eh  ; COS1_4
  4580 00002CF7 F7EA                                    imul    edx
  4581 00002CF9 89562C                                  mov     [esi+44], edx
  4582 00002CFC 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,4,+,COS2_3,3
  4583 00002CFF 8B5610                                  mov     edx, [esi+16]
  4584 00002D02 01560C                                  add     [esi+12], edx
  4585 00002D05 29D0                                    sub     eax, edx
  4586 00002D07 C1E003                                  shl     eax, 3
  4587 00002D0A BA42670352                              mov     edx, 52036742h
  4588 00002D0F F7EA                                    imul    edx
  4589 00002D11 895610                                  mov     [esi+16], edx
  4590 00002D14 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,12,-,COS2_3,3
  4591 00002D17 8B5630                                  mov     edx, [esi+48]
  4592 00002D1A 01562C                                  add     [esi+44], edx
  4593 00002D1D 29D0                                    sub     eax, edx
  4594 00002D1F C1E003                                  shl     eax, 3
  4595 00002D22 BABE98FCAD                              mov     edx, 0ADFC98BEh ; -COS2_3
  4596 00002D27 F7EA                                    imul    edx
  4597 00002D29 895630                                  mov     [esi+48], edx
  4598 00002D2C 8B06                                    mov     eax, [esi]      ; @@BF 0,3,+,COS3_0,1
  4599 00002D2E 8B560C                                  mov     edx, [esi+12]
  4600 00002D31 0116                                    add     [esi], edx
  4601 00002D33 29D0                                    sub     eax, edx
  4602 00002D35 D1E0                                    shl     eax, 1
  4603 00002D37 BAF0E94545                              mov     edx, 4545E9F0h
  4604 00002D3C F7EA                                    imul    edx
  4605 00002D3E 89560C                                  mov     [esi+12], edx
  4606 00002D41 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,7,-,COS3_0,1
  4607 00002D44 8B561C                                  mov     edx, [esi+28]
  4608 00002D47 015610                                  add     [esi+16], edx
  4609 00002D4A 29D0                                    sub     eax, edx
  4610 00002D4C D1E0                                    shl     eax, 1
  4611 00002D4E BA1016BABA                              mov     edx, 0BABA1610h
  4612 00002D53 F7EA                                    imul    edx
  4613 00002D55 89561C                                  mov     [esi+28], edx
  4614 00002D58 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,11,+,COS3_0,1
  4615 00002D5B 8B562C                                  mov     edx, [esi+44]
  4616 00002D5E 015620                                  add     [esi+32], edx
  4617 00002D61 29D0                                    sub     eax, edx
  4618 00002D63 D1E0                                    shl     eax, 1
  4619 00002D65 BAF0E94545                              mov     edx, 4545E9F0h
  4620 00002D6A F7EA                                    imul    edx
  4621 00002D6C 89562C                                  mov     [esi+44], edx
  4622 00002D6F 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,15,-,COS3_0,1
  4623 00002D72 8B563C                                  mov     edx, [esi+60]
  4624 00002D75 015630                                  add     [esi+48], edx
  4625 00002D78 29D0                                    sub     eax, edx
  4626 00002D7A D1E0                                    shl     eax, 1
  4627 00002D7C BA1016BABA                              mov     edx, 0BABA1610h ; -COS3_0
  4628 00002D81 F7EA                                    imul    edx
  4629 00002D83 89563C                                  mov     [esi+60], edx
  4630 00002D86 8B4678                                  mov     eax, [esi+120]  ; @@BF 1,30,+,COS0_1,1
  4631 00002D89 014604                                  add     [esi+4], eax
  4632 00002D8C 8B4644                                  mov     eax, [esi+68]   ; @@BF 14,17,+,COS0_14,3
  4633 00002D8F 014638                                  add     [esi+56], eax
  4634 00002D92 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,14,+,COS1_1,1
  4635 00002D95 8B5638                                  mov     edx, [esi+56]
  4636 00002D98 015604                                  add     [esi+4], edx
  4637 00002D9B 29D0                                    sub     eax, edx
  4638 00002D9D D1E0                                    shl     eax, 1
  4639 00002D9F BA103CE142                              mov     edx, 42E13C10h
  4640 00002DA4 F7EA                                    imul    edx
  4641 00002DA6 895638                                  mov     [esi+56], edx
  4642 00002DA9 8B4664                                  mov     eax, [esi+100]  ; @@BF 6,25,+,COS0_6,1
  4643 00002DAC 014618                                  add     [esi+24], eax
  4644 00002DAF 8B4658                                  mov     eax, [esi+88]   ; @@BF 9,22,+,COS0_9,1
  4645 00002DB2 014624                                  add     [esi+36], eax
  4646 00002DB5 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,9,+,COS1_6,2
  4647 00002DB8 8B5624                                  mov     edx, [esi+36]
  4648 00002DBB 015618                                  add     [esi+24], edx
  4649 00002DBE 29D0                                    sub     eax, edx
  4650 00002DC0 C1E002                                  shl     eax, 2
  4651 00002DC3 BAC2923C6E                              mov     edx, 6E3C92C2h  ; +COS1_6
  4652 00002DC8 F7EA                                    imul    edx
  4653 00002DCA 895624                                  mov     [esi+36], edx
  4654 00002DCD 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,6,+,COS2_1,1
  4655 00002DD0 8B5618                                  mov     edx, [esi+24]
  4656 00002DD3 015604                                  add     [esi+4], edx
  4657 00002DD6 29D0                                    sub     eax, edx
  4658 00002DD8 D1E0                                    shl     eax, 1
  4659 00002DDA BA88DEF84C                              mov     edx, 4CF8DE88h
  4660 00002DDF F7EA                                    imul    edx
  4661 00002DE1 895618                                  mov     [esi+24], edx
  4662 00002DE4 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,14,-,COS2_1,1
  4663 00002DE7 8B5638                                  mov     edx, [esi+56]
  4664 00002DEA 015624                                  add     [esi+36], edx
  4665 00002DED 29D0                                    sub     eax, edx
  4666 00002DEF D1E0                                    shl     eax, 1
  4667 00002DF1 BA782107B3                              mov     edx, 0B3072178h ; -COS2_1
  4668 00002DF6 F7EA                                    imul    edx
  4669 00002DF8 895638                                  mov     [esi+56], edx
  4670 00002DFB 8B4674                                  mov     eax, [esi+116]  ; @@BF 2,29,+,COS0_2,1
  4671 00002DFE 014608                                  add     [esi+8], eax
  4672 00002E01 8B4648                                  mov     eax, [esi+72]   ; @@BF 13,18,+,COS0_13,3
  4673 00002E04 014634                                  add     [esi+52], eax
  4674 00002E07 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,13,+,COS1_2,1
  4675 00002E0A 8B5634                                  mov     edx, [esi+52]
  4676 00002E0D 015608                                  add     [esi+8], edx
  4677 00002E10 29D0                                    sub     eax, edx
  4678 00002E12 D1E0                                    shl     eax, 1
  4679 00002E14 BA459F9148                              mov     edx, 48919F45h
  4680 00002E19 F7EA                                    imul    edx
  4681 00002E1B 895634                                  mov     [esi+52], edx
  4682 00002E1E 8B4668                                  mov     eax, [esi+104]  ; @@BF 5,26,+,COS0_5,1
  4683 00002E21 014614                                  add     [esi+20], eax
  4684 00002E24 8B4654                                  mov     eax, [esi+84]   ; @@BF 10,21,+,COS0_10,1
  4685 00002E27 014628                                  add     [esi+40], eax
  4686 00002E2A 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,10,+,COS1_5,2
  4687 00002E2D 8B5628                                  mov     edx, [esi+40]
  4688 00002E30 015614                                  add     [esi+20], edx
  4689 00002E33 29D0                                    sub     eax, edx
  4690 00002E35 C1E002                                  shl     eax, 2
  4691 00002E38 BAAA24E243                              mov     edx, 43E224AAh
  4692 00002E3D F7EA                                    imul    edx
  4693 00002E3F 895628                                  mov     [esi+40], edx
  4694 00002E42 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,5,+,COS2_2,1
  4695 00002E45 8B5614                                  mov     edx, [esi+20]
  4696 00002E48 015608                                  add     [esi+8], edx
  4697 00002E4B 29D0                                    sub     eax, edx
  4698 00002E4D D1E0                                    shl     eax, 1
  4699 00002E4F BABF6B3273                              mov     edx, 73326BBFh  ; COS2_2
  4700 00002E54 F7EA                                    imul    edx
  4701 00002E56 895614                                  mov     [esi+20], edx
  4702 00002E59 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,13,-,COS2_2,1
  4703 00002E5C 8B5634                                  mov     edx, [esi+52]
  4704 00002E5F 015628                                  add     [esi+40], edx
  4705 00002E62 29D0                                    sub     eax, edx
  4706 00002E64 D1E0                                    shl     eax, 1
  4707 00002E66 BA4194CD8C                              mov     edx, 8CCD9441h  ; -COS2_2
  4708 00002E6B F7EA                                    imul    edx
  4709 00002E6D 895634                                  mov     [esi+52], edx
  4710 00002E70 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,2,+,COS3_1,2
  4711 00002E73 8B5608                                  mov     edx, [esi+8]
  4712 00002E76 015604                                  add     [esi+4], edx
  4713 00002E79 29D0                                    sub     eax, edx
  4714 00002E7B C1E002                                  shl     eax, 2
  4715 00002E7E BA46BA9E53                              mov     edx, 539EBA46h
  4716 00002E83 F7EA                                    imul    edx
  4717 00002E85 895608                                  mov     [esi+8], edx
  4718 00002E88 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,6,-,COS3_1,2
  4719 00002E8B 8B5618                                  mov     edx, [esi+24]
  4720 00002E8E 015614                                  add     [esi+20], edx
  4721 00002E91 29D0                                    sub     eax, edx
  4722 00002E93 C1E002                                  shl     eax, 2
  4723 00002E96 BABA4561AC                              mov     edx, 0AC6145BAh
  4724 00002E9B F7EA                                    imul    edx
  4725 00002E9D 895618                                  mov     [esi+24], edx
  4726 00002EA0 8B4624                                  mov     eax, [esi+36]   ; IF rate_shift LT 2
  4727                                                                          ; @@BF 9,10,+,COS3_1,2
  4728 00002EA3 8B5628                                  mov     edx, [esi+40]
  4729 00002EA6 015624                                  add     [esi+36], edx
  4730 00002EA9 29D0                                    sub     eax, edx
  4731 00002EAB C1E002                                  shl     eax, 2
  4732 00002EAE BA46BA9E53                              mov     edx, 539EBA46h  ; +COS3_1
  4733 00002EB3 F7EA                                    imul    edx
  4734 00002EB5 895628                                  mov     [esi+40], edx
  4735 00002EB8 8B4634                                  mov     eax, [esi+52]   ; @@BF 13,14,-,COS3_1,2
  4736 00002EBB 8B5638                                  mov     edx, [esi+56]
  4737 00002EBE 015634                                  add     [esi+52], edx
  4738 00002EC1 29D0                                    sub     eax, edx
  4739 00002EC3 C1E002                                  shl     eax, 2
  4740 00002EC6 BABA4561AC                              mov     edx, 0AC6145BAh ; -COS3_1
  4741 00002ECB F7EA                                    imul    edx
  4742 00002ECD 895638                                  mov     [esi+56], edx   ; ENDIF
  4743 00002ED0 8B06                                    mov     eax, [esi]      ; @@BF1 macro a, b, c, d
  4744                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4745                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4746                                                                          ;   @@ADD c, d
  4747                                                                          ;  endm
  4748                                                                          ; @@BF1 0,1,2,3
  4749 00002ED2 8B5604                                  mov     edx, [esi+4]    ; @@BF 0,1,+,COS4_0,1
  4750 00002ED5 0116                                    add     [esi], edx
  4751 00002ED7 29D0                                    sub     eax, edx
  4752 00002ED9 D1E0                                    shl     eax, 1
  4753 00002EDB BA9A79825A                              mov     edx, 5A82799Ah
  4754 00002EE0 F7EA                                    imul    edx
  4755 00002EE2 895604                                  mov     [esi+4], edx
  4756 00002EE5 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,3,+,COS4_0,1
  4757 00002EE8 8B560C                                  mov     edx, [esi+12]
  4758 00002EEB 015608                                  add     [esi+8], edx
  4759 00002EEE 29D0                                    sub     eax, edx
  4760 00002EF0 D1E0                                    shl     eax, 1
  4761 00002EF2 BA66867DA5                              mov     edx, 0A57D8666h
  4762 00002EF7 F7EA                                    imul    edx
  4763 00002EF9 89560C                                  mov     [esi+12], edx
  4764 00002EFC 8B460C                                  mov     eax, [esi+12]   ; @@ADD 2,3
  4765 00002EFF 014608                                  add     [esi+8], eax
  4766 00002F02 8B4610                                  mov     eax, [esi+16]   ; @@BF2 macro a, b, c, d
  4767                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4768                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4769                                                                          ;   @@ADD c, d
  4770                                                                          ;   @@ADD a, c
  4771                                                                          ;   @@ADD c, b
  4772                                                                          ;   @@ADD b, d
  4773                                                                          ;  endm
  4774                                                                          ; @@BF2 4,5,6,7
  4775 00002F05 8B5614                                  mov     edx, [esi+20]   ; @@BF 4,5,+,COS4_0,1
  4776 00002F08 015610                                  add     [esi+16], edx
  4777 00002F0B 29D0                                    sub     eax, edx
  4778 00002F0D D1E0                                    shl     eax, 1
  4779 00002F0F BA9A79825A                              mov     edx, 5A82799Ah  ; +COS4_0
  4780 00002F14 F7EA                                    imul    edx
  4781 00002F16 895614                                  mov     [esi+20], edx
  4782 00002F19 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,7,-,COS4_0,1
  4783 00002F1C 8B561C                                  mov     edx, [esi+28]
  4784 00002F1F 015618                                  add     [esi+24], edx
  4785 00002F22 29D0                                    sub     eax, edx
  4786 00002F24 D1E0                                    shl     eax, 1
  4787 00002F26 BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  4788 00002F2B F7EA                                    imul    edx
  4789 00002F2D 89561C                                  mov     [esi+28], edx
  4790 00002F30 8B461C                                  mov     eax, [esi+28]   ; @@ADD macro dst,src
  4791                                                                          ;   IF (rate_shift EQ 0) or (dst LT 16)
  4792                                                                          ;    ;tab[a] += tab[b]
  4793                                                                          ;    mov  eax,dword ptr [esi+src*4]
  4794                                                                          ;    add  dword ptr [esi+dst*4],eax
  4795                                                                          ;   ENDIF
  4796                                                                          ;  endm
  4797                                                                          ; @@ADD 6,7
  4798 00002F33 014618                                  add     [esi+24], eax
  4799 00002F36 8B4618                                  mov     eax, [esi+24]   ; @@ADD 4,6
  4800 00002F39 014610                                  add     [esi+16], eax
  4801 00002F3C 8B4614                                  mov     eax, [esi+20]   ; @@ADD 6,5
  4802 00002F3F 014618                                  add     [esi+24], eax
  4803 00002F42 8B461C                                  mov     eax, [esi+28]   ; @@ADD 5,7
  4804 00002F45 014614                                  add     [esi+20], eax
  4805 00002F48 8B4620                                  mov     eax, [esi+32]   ; IF rate_shift LT 2
  4806                                                                          ; @@BF1 8,9,10,11
  4807 00002F4B 8B5624                                  mov     edx, [esi+36]
  4808 00002F4E 015620                                  add     [esi+32], edx
  4809 00002F51 29D0                                    sub     eax, edx
  4810 00002F53 D1E0                                    shl     eax, 1
  4811 00002F55 BA9A79825A                              mov     edx, 5A82799Ah
  4812 00002F5A F7EA                                    imul    edx
  4813 00002F5C 895624                                  mov     [esi+36], edx
  4814 00002F5F 8B4628                                  mov     eax, [esi+40]
  4815 00002F62 8B562C                                  mov     edx, [esi+44]
  4816 00002F65 015628                                  add     [esi+40], edx
  4817 00002F68 29D0                                    sub     eax, edx
  4818 00002F6A D1E0                                    shl     eax, 1
  4819 00002F6C BA66867DA5                              mov     edx, 0A57D8666h
  4820 00002F71 F7EA                                    imul    edx
  4821 00002F73 89562C                                  mov     [esi+44], edx
  4822 00002F76 8B462C                                  mov     eax, [esi+44]
  4823 00002F79 014628                                  add     [esi+40], eax
  4824 00002F7C 8B4630                                  mov     eax, [esi+48]   ; @@BF2 12,13,14,15
  4825 00002F7F 8B5634                                  mov     edx, [esi+52]
  4826 00002F82 015630                                  add     [esi+48], edx
  4827 00002F85 29D0                                    sub     eax, edx
  4828 00002F87 D1E0                                    shl     eax, 1
  4829 00002F89 BA9A79825A                              mov     edx, 5A82799Ah
  4830 00002F8E F7EA                                    imul    edx
  4831 00002F90 895634                                  mov     [esi+52], edx
  4832 00002F93 8B4638                                  mov     eax, [esi+56]
  4833 00002F96 8B563C                                  mov     edx, [esi+60]
  4834 00002F99 015638                                  add     [esi+56], edx
  4835 00002F9C 29D0                                    sub     eax, edx
  4836 00002F9E D1E0                                    shl     eax, 1
  4837 00002FA0 BA66867DA5                              mov     edx, 0A57D8666h
  4838 00002FA5 F7EA                                    imul    edx
  4839 00002FA7 89563C                                  mov     [esi+60], edx
  4840 00002FAA 8B463C                                  mov     eax, [esi+60]
  4841 00002FAD 014638                                  add     [esi+56], eax
  4842 00002FB0 8B4638                                  mov     eax, [esi+56]
  4843 00002FB3 014630                                  add     [esi+48], eax
  4844 00002FB6 8B4634                                  mov     eax, [esi+52]
  4845 00002FB9 014638                                  add     [esi+56], eax
  4846 00002FBC 8B463C                                  mov     eax, [esi+60]
  4847 00002FBF 014634                                  add     [esi+52], eax
  4848 00002FC2 8B06                                    mov     eax, [esi]      ; @@OUT macro dst,src1,src2
  4849                                                                          ; IF ((dst AND ((1 SHL rate_shift)-1)) EQ 0)
  4850                                                                          ;    mov eax,dword ptr [esi+src1*4]
  4851                                                                          ;    IFDIFI <src2>,<->
  4852                                                                          ;      add eax,dword ptr [esi+src2*4]
  4853                                                                          ;    ENDIF
  4854                                                                          ;    IF SYNTH32
  4855                                                                          ;       mov dword ptr [edi+dst*4],eax
  4856                                                                          ;       IF (LONG_WINDOW EQ 0)
  4857                                                                          ;          mov dword ptr [edi+dst*4+512*4],eax
  4858                                                                          ;       ENDIF
  4859                                                                          ;    ELSE
  4860                                                                          ;        ......
  4861                                                                          ;    ENDIF
  4862                                                                          ; @@OUT 0,0,-
  4863 00002FC4 8907                                    mov     [edi], eax
  4864 00002FC6 8B4604                                  mov     eax, [esi+4]    ; @@OUT 16,1,-
  4865 00002FC9 894740                                  mov     [edi+64], eax
  4866 00002FCC 8B4608                                  mov     eax, [esi+8]    ; @@OUT 8,2,-
  4867 00002FCF 894720                                  mov     [edi+32], eax
  4868 00002FD2 8B460C                                  mov     eax, [esi+12]   ; @@OUT 24,3,-
  4869 00002FD5 894760                                  mov     [edi+96], eax
  4870 00002FD8 8B4610                                  mov     eax, [esi+16]   ; @@OUT 4,4,-
  4871 00002FDB 894710                                  mov     [edi+16], eax
  4872 00002FDE 8B4614                                  mov     eax, [esi+20]   ; @@OUT 20,5,-
  4873 00002FE1 894750                                  mov     [edi+80], eax
  4874 00002FE4 8B4618                                  mov     eax, [esi+24]   ; @@OUT 12,6,-
  4875 00002FE7 894730                                  mov     [edi+48], eax
  4876 00002FEA 8B461C                                  mov     eax, [esi+28]   ; @@OUT 28,7,-
  4877 00002FED 894770                                  mov     [edi+112], eax
  4878 00002FF0 8B4620                                  mov     eax, [esi+32]   ; @@OUT 2,8,12
  4879 00002FF3 034630                                  add     eax, [esi+48]
  4880 00002FF6 894708                                  mov     [edi+8], eax
  4881 00002FF9 8B4624                                  mov     eax, [esi+36]   ; @@OUT 18,9,13
  4882 00002FFC 034634                                  add     eax, [esi+52]
  4883 00002FFF 894748                                  mov     [edi+72], eax
  4884 00003002 8B4628                                  mov     eax, [esi+40]   ; @@OUT 10,10,14
  4885 00003005 034638                                  add     eax, [esi+56]
  4886 00003008 894728                                  mov     [edi+40], eax
  4887 0000300B 8B462C                                  mov     eax, [esi+44]   ; @@OUT 26,11,15
  4888 0000300E 03463C                                  add     eax, [esi+60]
  4889 00003011 894768                                  mov     [edi+104], eax
  4890 00003014 8B4630                                  mov     eax, [esi+48]   ; @@OUT 6,12,10
  4891 00003017 034628                                  add     eax, [esi+40]
  4892 0000301A 894718                                  mov     [edi+24], eax
  4893 0000301D 8B4634                                  mov     eax, [esi+52]   ; @@OUT 22,13,11
  4894 00003020 03462C                                  add     eax, [esi+44]
  4895 00003023 894758                                  mov     [edi+88], eax
  4896 00003026 8B4638                                  mov     eax, [esi+56]   ; @@OUT 14,14,9
  4897 00003029 034624                                  add     eax, [esi+36]
  4898 0000302C 894738                                  mov     [edi+56], eax
  4899 0000302F 8B463C                                  mov     eax, [esi+60]   ; @@OUT 30,15,-
  4900 00003032 894778                                  mov     [edi+120], eax
  4901 00003035 C3                                      retn
  4902                                  
  4903                                  
  4904                                  ; =============== S U B R O U T I N E =======================================
  4905                                  
  4906                                  
  4907                                  mp3_dct32_shift_2:
  4908 00003036 8B467C                                  mov     eax, [esi+124]  ; mp3_dct32_macro macro rate_shift ; rate_shift = 2
  4909 00003039 0106                                    add     [esi], eax      ; @@BF macro a,b,sign,cos,shift
  4910                                                                          ; @@need_a equ (rate_shift EQ 0) or (a LT 16) ; a = 0
  4911                                                                          ; @@need_b equ (rate_shift EQ 0) or (b LT 16) ; b = 31
  4912                                                                          ; IF @@need_a AND @@need_b ; rate_shift = 0
  4913                                                                          ;    mov eax,dword ptr [esi+a*4]
  4914                                                                          ;    mov edx,dword ptr [esi+b*4]
  4915                                                                          ;    add dword ptr [esi+a*4],edx
  4916                                                                          ; ELSEIF @@need_a
  4917                                                                          ;    mov eax,dword ptr [esi+b*4]
  4918                                                                          ;    add dword ptr [esi+a*4],eax
  4919                                                                          ;
  4920                                                                          ; @@BF 0,31,+,COS0_0,1
  4921 0000303B 8B4640                                  mov     eax, [esi+64]   ; @@BF 15,16,+,COS0_15,5
  4922 0000303E 01463C                                  add     [esi+60], eax
  4923 00003041 8B06                                    mov     eax, [esi]      ; @@BF 0,15,+,COS1_0,1
  4924 00003043 8B563C                                  mov     edx, [esi+60]
  4925 00003046 0116                                    add     [esi], edx
  4926 00003048 29D0                                    sub     eax, edx
  4927 0000304A D1E0                                    shl     eax, 1
  4928 0000304C BA72464F40                              mov     edx, 404F4672h  ; COS1_0
  4929 00003051 F7EA                                    imul    edx
  4930 00003053 89563C                                  mov     [esi+60], edx
  4931 00003056 8B4660                                  mov     eax, [esi+96]   ; @@BF 7,24,+,COS0_7,1
  4932 00003059 01461C                                  add     [esi+28], eax
  4933 0000305C 8B465C                                  mov     eax, [esi+92]   ; @@BF 8,23,+,COS0_8,1
  4934 0000305F 014620                                  add     [esi+32], eax
  4935 00003062 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,8,+,COS1_7,4
  4936 00003065 8B5620                                  mov     edx, [esi+32]
  4937 00003068 01561C                                  add     [esi+28], edx
  4938 0000306B 29D0                                    sub     eax, edx
  4939 0000306D C1E004                                  shl     eax, 4
  4940 00003070 BA044E9E51                              mov     edx, 519E4E04h  ; COS1_7
  4941 00003075 F7EA                                    imul    edx
  4942 00003077 895620                                  mov     [esi+32], edx
  4943 0000307A 8B06                                    mov     eax, [esi]      ; @@BF 0,7,+,COS2_0,1
  4944 0000307C 8B561C                                  mov     edx, [esi+28]
  4945 0000307F 0116                                    add     [esi], edx
  4946 00003081 29D0                                    sub     eax, edx
  4947 00003083 D1E0                                    shl     eax, 1
  4948 00003085 BA46FB4041                              mov     edx, 4140FB46h  ; COS2_0
  4949 0000308A F7EA                                    imul    edx
  4950 0000308C 89561C                                  mov     [esi+28], edx
  4951 0000308F 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,15,-,COS2_0,1
  4952 00003092 8B563C                                  mov     edx, [esi+60]
  4953 00003095 015620                                  add     [esi+32], edx
  4954 00003098 29D0                                    sub     eax, edx
  4955 0000309A D1E0                                    shl     eax, 1
  4956 0000309C BABA04BFBE                              mov     edx, 0BEBF04BAh
  4957 000030A1 F7EA                                    imul    edx
  4958 000030A3 89563C                                  mov     [esi+60], edx
  4959 000030A6 8B4670                                  mov     eax, [esi+112]  ; @@BF 3,28,+,COS0_3,1
  4960 000030A9 01460C                                  add     [esi+12], eax
  4961 000030AC 8B464C                                  mov     eax, [esi+76]   ; @@BF 12,19,+,COS0_12,2
  4962 000030AF 014630                                  add     [esi+48], eax
  4963 000030B2 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,12,+,COS1_3,1
  4964 000030B5 8B5630                                  mov     edx, [esi+48]
  4965 000030B8 01560C                                  add     [esi+12], edx
  4966 000030BB 29D0                                    sub     eax, edx
  4967 000030BD D1E0                                    shl     eax, 1
  4968 000030BF BA630ECB52                              mov     edx, 52CB0E63h  ; COS1_3
  4969 000030C4 F7EA                                    imul    edx
  4970 000030C6 895630                                  mov     [esi+48], edx
  4971 000030C9 8B466C                                  mov     eax, [esi+108]  ; @@BF 4,27,+,COS0_4,1
  4972 000030CC 014610                                  add     [esi+16], eax
  4973 000030CF 8B4650                                  mov     eax, [esi+80]   ; @@BF 11,20,+,COS0_11,2
  4974 000030D2 01462C                                  add     [esi+44], eax
  4975 000030D5 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,11,+,COS1_4,1
  4976 000030D8 8B562C                                  mov     edx, [esi+44]
  4977 000030DB 015610                                  add     [esi+16], edx
  4978 000030DE 29D0                                    sub     eax, edx
  4979 000030E0 D1E0                                    shl     eax, 1
  4980 000030E2 BA2E40E264                              mov     edx, 64E2402Eh
  4981 000030E7 F7EA                                    imul    edx
  4982 000030E9 89562C                                  mov     [esi+44], edx
  4983 000030EC 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,4,+,COS2_3,3
  4984 000030EF 8B5610                                  mov     edx, [esi+16]
  4985 000030F2 01560C                                  add     [esi+12], edx
  4986 000030F5 29D0                                    sub     eax, edx
  4987 000030F7 C1E003                                  shl     eax, 3
  4988 000030FA BA42670352                              mov     edx, 52036742h
  4989 000030FF F7EA                                    imul    edx
  4990 00003101 895610                                  mov     [esi+16], edx
  4991 00003104 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,12,-,COS2_3,3
  4992 00003107 8B5630                                  mov     edx, [esi+48]
  4993 0000310A 01562C                                  add     [esi+44], edx
  4994 0000310D 29D0                                    sub     eax, edx
  4995 0000310F C1E003                                  shl     eax, 3
  4996 00003112 BABE98FCAD                              mov     edx, 0ADFC98BEh ; -COS2_3
  4997 00003117 F7EA                                    imul    edx
  4998 00003119 895630                                  mov     [esi+48], edx
  4999 0000311C 8B06                                    mov     eax, [esi]      ; @@BF 0,3,+,COS3_0,1
  5000 0000311E 8B560C                                  mov     edx, [esi+12]
  5001 00003121 0116                                    add     [esi], edx
  5002 00003123 29D0                                    sub     eax, edx
  5003 00003125 D1E0                                    shl     eax, 1
  5004 00003127 BAF0E94545                              mov     edx, 4545E9F0h
  5005 0000312C F7EA                                    imul    edx
  5006 0000312E 89560C                                  mov     [esi+12], edx
  5007 00003131 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,7,-,COS3_0,1
  5008 00003134 8B561C                                  mov     edx, [esi+28]
  5009 00003137 015610                                  add     [esi+16], edx
  5010 0000313A 29D0                                    sub     eax, edx
  5011 0000313C D1E0                                    shl     eax, 1
  5012 0000313E BA1016BABA                              mov     edx, 0BABA1610h
  5013 00003143 F7EA                                    imul    edx
  5014 00003145 89561C                                  mov     [esi+28], edx
  5015 00003148 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,11,+,COS3_0,1
  5016 0000314B 8B562C                                  mov     edx, [esi+44]
  5017 0000314E 015620                                  add     [esi+32], edx
  5018 00003151 29D0                                    sub     eax, edx
  5019 00003153 D1E0                                    shl     eax, 1
  5020 00003155 BAF0E94545                              mov     edx, 4545E9F0h
  5021 0000315A F7EA                                    imul    edx
  5022 0000315C 89562C                                  mov     [esi+44], edx
  5023 0000315F 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,15,-,COS3_0,1
  5024 00003162 8B563C                                  mov     edx, [esi+60]
  5025 00003165 015630                                  add     [esi+48], edx
  5026 00003168 29D0                                    sub     eax, edx
  5027 0000316A D1E0                                    shl     eax, 1
  5028 0000316C BA1016BABA                              mov     edx, 0BABA1610h
  5029 00003171 F7EA                                    imul    edx
  5030 00003173 89563C                                  mov     [esi+60], edx
  5031 00003176 8B4678                                  mov     eax, [esi+120]  ; @@BF 1,30,+,COS0_1,1
  5032 00003179 014604                                  add     [esi+4], eax
  5033 0000317C 8B4644                                  mov     eax, [esi+68]   ; @@BF 14,17,+,COS0_14,3
  5034 0000317F 014638                                  add     [esi+56], eax
  5035 00003182 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,14,+,COS1_1,1
  5036 00003185 8B5638                                  mov     edx, [esi+56]
  5037 00003188 015604                                  add     [esi+4], edx
  5038 0000318B 29D0                                    sub     eax, edx
  5039 0000318D D1E0                                    shl     eax, 1
  5040 0000318F BA103CE142                              mov     edx, 42E13C10h  ; COS1_1
  5041 00003194 F7EA                                    imul    edx
  5042 00003196 895638                                  mov     [esi+56], edx
  5043 00003199 8B4664                                  mov     eax, [esi+100]  ; @@BF 6,25,+,COS0_6,1
  5044 0000319C 014618                                  add     [esi+24], eax
  5045 0000319F 8B4658                                  mov     eax, [esi+88]   ; @@BF 9,22,+,COS0_9,1
  5046 000031A2 014624                                  add     [esi+36], eax
  5047 000031A5 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,9,+,COS1_6,2
  5048 000031A8 8B5624                                  mov     edx, [esi+36]
  5049 000031AB 015618                                  add     [esi+24], edx
  5050 000031AE 29D0                                    sub     eax, edx
  5051 000031B0 C1E002                                  shl     eax, 2
  5052 000031B3 BAC2923C6E                              mov     edx, 6E3C92C2h
  5053 000031B8 F7EA                                    imul    edx
  5054 000031BA 895624                                  mov     [esi+36], edx
  5055 000031BD 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,6,+,COS2_1,1
  5056 000031C0 8B5618                                  mov     edx, [esi+24]
  5057 000031C3 015604                                  add     [esi+4], edx
  5058 000031C6 29D0                                    sub     eax, edx
  5059 000031C8 D1E0                                    shl     eax, 1
  5060 000031CA BA88DEF84C                              mov     edx, 4CF8DE88h  ; COS2_1
  5061 000031CF F7EA                                    imul    edx
  5062 000031D1 895618                                  mov     [esi+24], edx
  5063 000031D4 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,14,-,COS2_1,1
  5064 000031D7 8B5638                                  mov     edx, [esi+56]
  5065 000031DA 015624                                  add     [esi+36], edx
  5066 000031DD 29D0                                    sub     eax, edx
  5067 000031DF D1E0                                    shl     eax, 1
  5068 000031E1 BA782107B3                              mov     edx, 0B3072178h ; -COS2_1
  5069 000031E6 F7EA                                    imul    edx
  5070 000031E8 895638                                  mov     [esi+56], edx
  5071 000031EB 8B4674                                  mov     eax, [esi+116]  ; @@BF 2,29,+,COS0_2,1
  5072 000031EE 014608                                  add     [esi+8], eax
  5073 000031F1 8B4648                                  mov     eax, [esi+72]   ; @@BF 13,18,+,COS0_13,3
  5074 000031F4 014634                                  add     [esi+52], eax
  5075 000031F7 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,13,+,COS1_2,1
  5076 000031FA 8B5634                                  mov     edx, [esi+52]
  5077 000031FD 015608                                  add     [esi+8], edx
  5078 00003200 29D0                                    sub     eax, edx
  5079 00003202 D1E0                                    shl     eax, 1
  5080 00003204 BA459F9148                              mov     edx, 48919F45h
  5081 00003209 F7EA                                    imul    edx
  5082 0000320B 895634                                  mov     [esi+52], edx
  5083 0000320E 8B4668                                  mov     eax, [esi+104]  ; @@BF 5,26,+,COS0_5,1
  5084 00003211 014614                                  add     [esi+20], eax
  5085 00003214 8B4654                                  mov     eax, [esi+84]   ; @@BF 10,21,+,COS0_10,1
  5086 00003217 014628                                  add     [esi+40], eax
  5087 0000321A 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,10,+,COS1_5,2
  5088 0000321D 8B5628                                  mov     edx, [esi+40]
  5089 00003220 015614                                  add     [esi+20], edx
  5090 00003223 29D0                                    sub     eax, edx
  5091 00003225 C1E002                                  shl     eax, 2
  5092 00003228 BAAA24E243                              mov     edx, 43E224AAh
  5093 0000322D F7EA                                    imul    edx
  5094 0000322F 895628                                  mov     [esi+40], edx
  5095 00003232 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,5,+,COS2_2,1
  5096 00003235 8B5614                                  mov     edx, [esi+20]
  5097 00003238 015608                                  add     [esi+8], edx
  5098 0000323B 29D0                                    sub     eax, edx
  5099 0000323D D1E0                                    shl     eax, 1
  5100 0000323F BABF6B3273                              mov     edx, 73326BBFh  ; COS2_2
  5101 00003244 F7EA                                    imul    edx
  5102 00003246 895614                                  mov     [esi+20], edx
  5103 00003249 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,13,-,COS2_2,1
  5104 0000324C 8B5634                                  mov     edx, [esi+52]
  5105 0000324F 015628                                  add     [esi+40], edx
  5106 00003252 29D0                                    sub     eax, edx
  5107 00003254 D1E0                                    shl     eax, 1
  5108 00003256 BA4194CD8C                              mov     edx, 8CCD9441h  ; -COS2_2
  5109 0000325B F7EA                                    imul    edx
  5110 0000325D 895634                                  mov     [esi+52], edx
  5111 00003260 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,2,+,COS3_1,2
  5112 00003263 8B5608                                  mov     edx, [esi+8]
  5113 00003266 015604                                  add     [esi+4], edx
  5114 00003269 29D0                                    sub     eax, edx
  5115 0000326B C1E002                                  shl     eax, 2
  5116 0000326E BA46BA9E53                              mov     edx, 539EBA46h  ; COS3_1
  5117 00003273 F7EA                                    imul    edx
  5118 00003275 895608                                  mov     [esi+8], edx
  5119 00003278 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,6,-,COS3_1,2
  5120 0000327B 8B5618                                  mov     edx, [esi+24]
  5121 0000327E 015614                                  add     [esi+14h], edx
  5122 00003281 29D0                                    sub     eax, edx
  5123 00003283 C1E002                                  shl     eax, 2
  5124 00003286 BABA4561AC                              mov     edx, 0AC6145BAh ; -COS3_1
  5125 0000328B F7EA                                    imul    edx
  5126 0000328D 895618                                  mov     [esi+24], edx
  5127 00003290 8B06                                    mov     eax, [esi]      ; @@BF1 macro a, b, c, d
  5128                                                                          ;   @@BF  a, b,+,COS4_0, 1
  5129                                                                          ;   @@BF  c, d,-,COS4_0, 1
  5130                                                                          ;   @@ADD c, d
  5131                                                                          ;  endm
  5132                                                                          ; @@BF1 0,1,2,3
  5133 00003292 8B5604                                  mov     edx, [esi+4]    ; @@BF 0,1,+,COS4_0,1
  5134 00003295 0116                                    add     [esi], edx
  5135 00003297 29D0                                    sub     eax, edx
  5136 00003299 D1E0                                    shl     eax, 1
  5137 0000329B BA9A79825A                              mov     edx, 5A82799Ah
  5138 000032A0 F7EA                                    imul    edx
  5139 000032A2 895604                                  mov     [esi+4], edx
  5140 000032A5 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,3,-,COS4_0,1
  5141 000032A8 8B560C                                  mov     edx, [esi+12]
  5142 000032AB 015608                                  add     [esi+8], edx
  5143 000032AE 29D0                                    sub     eax, edx
  5144 000032B0 D1E0                                    shl     eax, 1
  5145 000032B2 BA66867DA5                              mov     edx, 0A57D8666h
  5146 000032B7 F7EA                                    imul    edx
  5147 000032B9 89560C                                  mov     [esi+12], edx
  5148 000032BC 8B460C                                  mov     eax, [esi+12]   ; @@ADD 2,3
  5149 000032BF 014608                                  add     [esi+8], eax
  5150 000032C2 8B4610                                  mov     eax, [esi+16]   ; @@BF2 macro a, b, c, d
  5151                                                                          ;   @@BF  a, b,+,COS4_0, 1
  5152                                                                          ;   @@BF  c, d,-,COS4_0, 1
  5153                                                                          ;   @@ADD c, d
  5154                                                                          ;   @@ADD a, c
  5155                                                                          ;   @@ADD c, b
  5156                                                                          ;   @@ADD b, d
  5157                                                                          ;  endm
  5158                                                                          ; @@BF2 4,5,6,7
  5159 000032C5 8B5614                                  mov     edx, [esi+20]   ; @@BF 4,5,+,COS4_0,1
  5160 000032C8 015610                                  add     [esi+16], edx
  5161 000032CB 29D0                                    sub     eax, edx
  5162 000032CD D1E0                                    shl     eax, 1
  5163 000032CF BA9A79825A                              mov     edx, 5A82799Ah  ; COS4_0
  5164 000032D4 F7EA                                    imul    edx
  5165 000032D6 895614                                  mov     [esi+20], edx
  5166 000032D9 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,7,-,COS4_0,1
  5167 000032DC 8B561C                                  mov     edx, [esi+28]
  5168 000032DF 015618                                  add     [esi+18h], edx
  5169 000032E2 29D0                                    sub     eax, edx
  5170 000032E4 D1E0                                    shl     eax, 1
  5171 000032E6 BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  5172 000032EB F7EA                                    imul    edx
  5173 000032ED 89561C                                  mov     [esi+28], edx
  5174 000032F0 8B461C                                  mov     eax, [esi+28]   ; @@ADD 6,7
  5175 000032F3 014618                                  add     [esi+24], eax
  5176 000032F6 8B4618                                  mov     eax, [esi+24]   ; @@ADD 4,6
  5177 000032F9 014610                                  add     [esi+16], eax
  5178 000032FC 8B4614                                  mov     eax, [esi+20]   ; @@ADD 6,5
  5179 000032FF 014618                                  add     [esi+24], eax
  5180 00003302 8B461C                                  mov     eax, [esi+28]   ; @@ADD 5,7
  5181 00003305 014614                                  add     [esi+20], eax
  5182 00003308 8B06                                    mov     eax, [esi]      ; @@OUT macro dst,src1,src2
  5183                                                                          ; IF ((dst AND ((1 SHL rate_shift)-1)) EQ 0)
  5184                                                                          ;    mov eax,dword ptr [esi+src1*4]
  5185                                                                          ;    IFDIFI <src2>,<->
  5186                                                                          ;      add eax,dword ptr [esi+src2*4]
  5187                                                                          ;    ENDIF
  5188                                                                          ;    IF SYNTH32
  5189                                                                          ;       mov dword ptr [edi+dst*4],eax
  5190                                                                          ;       IF (LONG_WINDOW EQ 0)
  5191                                                                          ;          mov dword ptr [edi+dst*4+512*4],eax
  5192                                                                          ;       ENDIF
  5193                                                                          ;    ELSE
  5194                                                                          ;        ......
  5195                                                                          ;    ENDIF
  5196                                                                          ; @@OUT 0,0,-
  5197 0000330A 8907                                    mov     [edi], eax
  5198 0000330C 8B4604                                  mov     eax, [esi+4]    ; @@OUT 16,1,-
  5199 0000330F 894740                                  mov     [edi+64], eax
  5200 00003312 8B4608                                  mov     eax, [esi+8]    ; @@OUT 8,2,-
  5201 00003315 894720                                  mov     [edi+32], eax
  5202 00003318 8B460C                                  mov     eax, [esi+12]   ; @@OUT 24,3,-
  5203 0000331B 894760                                  mov     [edi+96], eax
  5204 0000331E 8B4610                                  mov     eax, [esi+16]   ; @@OUT 4,4,-
  5205 00003321 894710                                  mov     [edi+16], eax
  5206 00003324 8B4614                                  mov     eax, [esi+20]   ; @@OUT 20,5,-
  5207 00003327 894750                                  mov     [edi+80], eax
  5208 0000332A 8B4618                                  mov     eax, [esi+24]   ; @@OUT 12,6,-
  5209 0000332D 894730                                  mov     [edi+48], eax
  5210 00003330 8B461C                                  mov     eax, [esi+28]   ; @@OUT 28,7,-
  5211 00003333 894770                                  mov     [edi+112], eax
  5212 00003336 C3                                      retn
  5213                                  
  5214                                  ; =============== S U B R O U T I N E =======================================
  5215                                  
  5216                                  		; 15/02/2025
  5217                                  mp3_synth_filter_proc:
  5218                                  		;;;;
  5219                                  synth_16bit_shift_0_slow:
  5220                                  
  5221                                                 	; 16/02/2025
  5222                                  .no_rdtsc_supported:
  5223 00003337 BE[E0E20000]                            mov	esi, mp3_sb_samples
  5224 0000333C 8B3D[70190100]                          mov	edi, [mp3_samples_dst]
  5225 00003342 C705[7C190100]0000-                     mov	dword [mp3_curr_channel], 0
  5225 0000334A 0000               
  5226                                  
  5227                                  .synth_channel_lop:
  5228 0000334C 56                                      push	esi
  5229 0000334D 57                                      push	edi
  5230 0000334E 893D[C4C20000]                          mov	[mp3_curr_syn_dst], edi
  5231 00003354 C705[84190100]0000-                     mov	dword [mp3_curr_frame], 0
  5231 0000335C 0000               
  5232                                  
  5233                                  .synth_frame_lop:
  5234 0000335E 56                                      push    esi
  5235                                  	
  5236                                  		; 16/02/2025
  5237                                  .no_rdtsc_supported@:
  5238 0000335F 8B15[7C190100]                          mov     edx, [mp3_curr_channel]
  5239 00003365 8B0495[D8E20000]                        mov     eax, [mp3_synth_index+edx*4]
  5240 0000336C 832C95[D8E20000]20                      sub     dword [mp3_synth_index+edx*4], 32
  5241 00003374 C1E20A                                  shl     edx, 10         ; channel*1024
  5242 00003377 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  5243 0000337C 09D0                                    or      eax, edx
  5244 0000337E A3[C0C20000]                            mov     [mp3_curr_syn_index], eax
  5245 00003383 8B3D[C0C20000]                          mov     edi, [mp3_curr_syn_index]
  5246 00003389 8D3CBD[D8C20000]                        lea     edi, [mp3_synth_buf+edi*4]
  5247 00003390 E8D1EFFFFF                              call    mp3_dct32_shift_0 ; mp3_dct32_shift_&rate_shift
  5248                                  		
  5249                                  		; 16/02/2025		
  5250                                  .no_rdtsc_supported@@:
  5251                                  
  5252                                  		; 16/02/2025
  5253                                  .no_rdtsc_supported@@@:
  5254 00003395 E84A000000                              call    mp3_synth_filter_this_16bit_shift_0_slow
  5255                                  	
  5256                                  		; 16/02/2025
  5257                                  .no_rdtsc_supported@@@@:
  5258 0000339A 5E                                      pop     esi
  5259 0000339B A1[78190100]                            mov     eax, [mp3_samples_dst_step]
  5260 000033A0 C1E005                                  shl     eax, 5
  5261                                  		; 15/02/2025
  5262 000033A3 0105[C4C20000]                          add     [mp3_curr_syn_dst], eax
  5263 000033A9 81C680000000                            add     esi, 128        ; SBLIMIT*4
  5264 000033AF FF05[84190100]                          inc     dword [mp3_curr_frame]
  5265 000033B5 A1[84190100]                            mov     eax, [mp3_curr_frame]
  5266 000033BA 3B05[C8C20000]                          cmp     eax, [mp3_nb_frames]
  5267 000033C0 729C                                    jb      .synth_frame_lop
  5268 000033C2 5F                                      pop     edi
  5269 000033C3 5E                                      pop     esi
  5270                                  		;add	edi, [mp3_bytes_per_sample]
  5271                                  		; 17/02/2025
  5272                                  		;add	edi, 2 ; [mp3_bytes_per_sample] = 2
  5273 000033C4 47                                      inc	edi
  5274 000033C5 47                      		inc	edi
  5275 000033C6 81C600120000            		add     esi, 4608       ; 36*SBLIMIT*4
  5276 000033CC FF05[7C190100]                          inc     dword [mp3_curr_channel]
  5277 000033D2 A1[7C190100]                            mov     eax, [mp3_curr_channel]
  5278                                  		; 16/02/2025
  5279 000033D7 3B05[BCC20000]                          cmp     eax, [mp3_num_channels]
  5280 000033DD 0F8269FFFFFF                            jb      .synth_channel_lop
  5281                                  	
  5282                                  		; 16/02/2025
  5283                                  .no_rdtsc_supported@@@@@:
  5284 000033E3 C3                                      retn
  5285                                  
  5286                                  
  5287                                  ; =============== S U B R O U T I N E =======================================
  5288                                  
  5289                                  
  5290                                  mp3_synth_filter_this_16bit_shift_0_slow:
  5291 000033E4 A1[C0C20000]                            mov     eax, [mp3_curr_syn_index]
  5292 000033E9 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  5293 000033EE 0F847C010000                            jz      .append_copy_to_window
  5294 000033F4 90                                      nop
  5295                                  
  5296                                  .append_copy_to_window_back:
  5297 000033F5 89C5                                    mov     ebp, eax        ; mov @@win1,eax
  5298 000033F7 81E5C0010000                            and     ebp, 1C0h       ; and @@win1,1FFh-1Fh-20h
  5299 000033FD 2520040000                              and     eax, 420h       ; and eax,20h+(1 shl 10) ; bit5, and channel
  5300 00003402 8D7010                                  lea     esi, [eax+10h]  ; lea @@syn1,[eax+10h]
  5301 00003405 8D7830                                  lea     edi, [eax+30h]  ; lea @@syn2,[eax+30h]
  5302 00003408 F7DD                                    neg     ebp
  5303 0000340A 81E5C0010000                            and     ebp, 1C0h       ; and @@win1,1FFh-1Fh-20h
  5304 00003410 8B0D[C4C20000]                          mov     ecx, [mp3_curr_syn_dst]
  5305                                  
  5306                                  .samples_lop:
  5307 00003416 BB10001000                              mov     ebx, 100010h    ; mov @@sum,(8000h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  5308                                                                          ; @@out_shift = 5
  5309                                  
  5310                                  .SUM8_@:                                ; @@SUM8 macro sum,win,ww,syn
  5311 0000341B 8B14B5[D8C20000]                        mov     edx, [mp3_synth_buf+esi*4] ; IRP nn,0,1,2,3,4,5,6,7
  5312                                                                          ; @@SUM8 @@sum,@@win1,0, @@syn1
  5313 00003422 8B04AD[8C140500]                        mov     eax, [mp3_synth_win+ebp*4] ; [mp3_synth_buf+syn*4+(nn*64*4)]
  5314 00003429 F7EA                                    imul    edx             ; [mp3_synth_win+win*4+(nn*64*4)+ww*4]
  5315 0000342B 01D3                                    add     ebx, edx
  5316 0000342D 8B14B5[D8C30000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  5317 00003434 8B04AD[8C150500]                        mov     eax, [(mp3_synth_win+100h)+ebp*4]
  5318 0000343B F7EA                                    imul    edx
  5319 0000343D 01D3                                    add     ebx, edx        ; add sum,edx
  5320 0000343F 8B14B5[D8C40000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  5321 00003446 8B04AD[8C160500]                        mov     eax, [(mp3_synth_win+200h)+ebp*4] ; [mp3_synth_win+win*4+(nn*64*4)+ww*4]
  5322 0000344D F7EA                                    imul    edx             ; 64bit = 32bit * 32bit
  5323 0000344F 01D3                                    add     ebx, edx
  5324 00003451 8B14B5[D8C50000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  5325 00003458 8B04AD[8C170500]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  5326 0000345F F7EA                                    imul    edx
  5327 00003461 01D3                                    add     ebx, edx
  5328 00003463 8B14B5[D8C60000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  5329 0000346A 8B04AD[8C180500]                        mov     eax, [(mp3_synth_win+400h)+ebp*4]
  5330 00003471 F7EA                                    imul    edx
  5331 00003473 01D3                                    add     ebx, edx
  5332 00003475 8B14B5[D8C70000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  5333 0000347C 8B04AD[8C190500]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  5334 00003483 F7EA                                    imul    edx
  5335 00003485 01D3                                    add     ebx, edx
  5336 00003487 8B14B5[D8C80000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  5337 0000348E 8B04AD[8C1A0500]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  5338 00003495 F7EA                                    imul    edx
  5339 00003497 01D3                                    add     ebx, edx
  5340 00003499 8B14B5[D8C90000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  5341 000034A0 8B04AD[8C1B0500]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  5342 000034A7 F7EA                                    imul    edx
  5343 000034A9 01D3                                    add     ebx, edx
  5344                                  
  5345                                  .skippp:                               ; @@SUM8 macro sum,win,ww,syn
  5346 000034AB 8B14BD[D8C20000]                        mov     edx, [mp3_synth_buf+edi*4] ; @@SUM8 @@sum,@@win1,32,@@syn2
  5347                                                                          ; [mp3_synth_buf+syn*4+(nn*64*4)]
  5348 000034B2 8B04AD[0C150500]                        mov     eax, [(mp3_synth_win+80h)+ebp*4] ; [mp3_synth_win+win*4+(nn*64*4)+ww*4]
  5349 000034B9 F7EA                                    imul    edx
  5350 000034BB 01D3                                    add     ebx, edx
  5351 000034BD 8B14BD[D8C30000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  5352 000034C4 8B04AD[0C160500]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  5353 000034CB F7EA                                    imul    edx
  5354 000034CD 01D3                                    add     ebx, edx
  5355 000034CF 8B14BD[D8C40000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  5356 000034D6 8B04AD[0C170500]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  5357 000034DD F7EA                                    imul    edx
  5358 000034DF 01D3                                    add     ebx, edx
  5359 000034E1 8B14BD[D8C50000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  5360 000034E8 8B04AD[0C180500]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  5361 000034EF F7EA                                    imul    edx
  5362 000034F1 01D3                                    add     ebx, edx
  5363 000034F3 8B14BD[D8C60000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  5364 000034FA 8B04AD[0C190500]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  5365 00003501 F7EA                                    imul    edx
  5366 00003503 01D3                                    add     ebx, edx
  5367 00003505 8B14BD[D8C70000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  5368 0000350C 8B04AD[0C1A0500]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  5369 00003513 F7EA                                    imul    edx
  5370 00003515 01D3                                    add     ebx, edx
  5371 00003517 8B14BD[D8C80000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  5372 0000351E 8B04AD[0C1B0500]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  5373 00003525 F7EA                                    imul    edx
  5374 00003527 01D3                                    add     ebx, edx
  5375 00003529 8B14BD[D8C90000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  5376 00003530 8B04AD[0C1C0500]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  5377 00003537 F7EA                                    imul    edx
  5378 00003539 01D3                                    add     ebx, edx
  5379 0000353B 81FB00002000                            cmp     ebx, 200000h    ; cmp @@sum,10000h SHL (@@out_shift)
  5380 00003541 7322                                    jnb     short .sat
  5381 00003543 C1FB05                                  sar     ebx, 5          ; sar @@sum,(@@out_shift)
  5382 00003546 81EB00800000                            sub     ebx, 8000h      ; make 16bit signed
  5383                                  
  5384                                  .sat_back:
  5385 0000354C 668919                                  mov     [ecx], bx
  5386 0000354F 030D[78190100]                          add     ecx, [mp3_samples_dst_step]
  5387 00003555 46                                      inc     esi             ; inc @@syn1
  5388 00003556 4F                                      dec     edi             ; dec @@syn2
  5389 00003557 45                                      inc     ebp             ; inc @@win1
  5390 00003558 F7C51F000000                            test    ebp, 1Fh        ; test @@win1,1Fh
  5391 0000355E 0F85B2FEFFFF                            jnz     .samples_lop
  5392 00003564 C3                                      retn
  5393                                  
  5394                                  .sat:
  5395 00003565 C1FB1F                                  sar     ebx, 31         ; FFFFFFFFh,00000000h
  5396 00003568 81F3FF7F0000                            xor     ebx, 7FFFh      ; FFFF8000h,00007FFFh (signed 16bit)
  5397 0000356E EBDC                                    jmp     short .sat_back
  5398                                  
  5399                                  .append_copy_to_window:
  5400 00003570 8D3485[D8C20000]                        lea     esi, [mp3_synth_buf+eax*4]
  5401 00003577 8DBE00080000                            lea     edi, [esi+2048] ; [esi+512*4]
  5402 0000357D B912000000                              mov     ecx, 18         ; (12h*4)/4
  5403 00003582 F3A5                                    rep movsd
  5404 00003584 E96CFEFFFF                              jmp     .append_copy_to_window_back
  5405                                  
  5406                                  
  5407                                  ; =============== S U B R O U T I N E =======================================
  5408                                  
  5409                                  
  5410                                  mp3_any_init_synth_window:
  5411 00003589 31D2                                    xor     edx, edx        ; index (0..100h)
  5412 0000358B 31C9                                    xor     ecx, ecx        ; delta.val
  5413 0000358D 898C12[8C140500]                        mov     [mp3_synth_win+edx*2], ecx
  5414                                  
  5415                                  .synth_lop:
  5416 00003594 0FBF9C12[D69C0000]                      movsx   ebx, word [mp3_synth_win_src+edx*2]
  5417 0000359C 01D9                                    add     ecx, ebx
  5418 0000359E 89C8                                    mov     eax, ecx
  5419                                  
  5420                                  		; 15/02/2025
  5421 000035A0 C1E00E                                  shl	eax, 14         ; (WFRAC_BITS_slow-WFRAC_BITS_default)
  5422                                  
  5423 000035A3 42                                      inc     edx             ; index (1..100h)
  5424 000035A4 BB00020000                              mov     ebx, 200h
  5425 000035A9 29D3                                    sub     ebx, edx        ; 1FFh..100h
  5426 000035AB 89049D[8C140500]                        mov     [mp3_synth_win+ebx*4], eax
  5427 000035B2 F7C23F000000                            test    edx, 3Fh
  5428 000035B8 7402                                    jz      short .synth_keep_sign
  5429 000035BA F7D8                                    neg     eax
  5430                                  
  5431                                  .synth_keep_sign:
  5432 000035BC 890495[8C140500]                        mov     [mp3_synth_win+edx*4], eax
  5433 000035C3 81FA00010000                            cmp     edx, 100h
  5434 000035C9 72C9                                    jb      short .synth_lop
  5435 000035CB 31D2                                    xor     edx, edx
  5436                                  
  5437                                  .synth_neg_lop:
  5438 000035CD F7C230000000                            test    edx, 30h        ; skip 0..0Fh (only negate 10h..3Fh)
  5439 000035D3 7407                                    jz      short .synth_neg_next
  5440 000035D5 F71C95[8C140500]                        neg     dword [mp3_synth_win+edx*4]
  5441                                  
  5442                                  .synth_neg_next:
  5443 000035DC 42                                      inc     edx
  5444 000035DD 81FA00020000                            cmp     edx, 200h
  5445 000035E3 72E8                                    jb      short .synth_neg_lop
  5446 000035E5 31D2                                    xor     edx, edx
  5447                                  
  5448                                  .synth_swap_lop:
  5449 000035E7 89D0                                    mov     eax, edx
  5450 000035E9 83E03F                                  and     eax, 3Fh
  5451 000035EC 83E811                                  sub     eax, 17         ; swap win [(17..31)] with win[(17..31)+32)
  5452 000035EF 83F80E                                  cmp     eax, 14         ; 31-17
  5453 000035F2 7715                                    ja      short .synth_swap_next
  5454 000035F4 8B0495[8C140500]                        mov     eax, [mp3_synth_win+edx*4]
  5455 000035FB 870495[0C150500]                        xchg    eax, [(mp3_synth_win+80h)+edx*4]
  5456 00003602 890495[8C140500]                        mov     [mp3_synth_win+edx*4], eax
  5457                                  
  5458                                  .synth_swap_next:
  5459 00003609 42                                      inc     edx
  5460 0000360A 81FA00020000                            cmp     edx, 200h
  5461 00003610 72D5                                    jb      short .synth_swap_lop
  5462 00003612 31D2                                    xor     edx, edx
  5463                                  
  5464                                  .synth_zero_lop:
  5465 00003614 C70495[CC140500]00-                     mov	dword [(mp3_synth_win+40h)+edx*4], 0
  5465 0000361C 000000             
  5466 0000361F 83C240                                  add	edx, 40h
  5467 00003622 81FA00020000                            cmp	edx, 200h
  5468 00003628 72EA                                    jb	short .synth_zero_lop
  5469 0000362A BE[8C140500]                            mov	esi, mp3_synth_win
  5470 0000362F 8DBE00080000                            lea	edi, [esi+2048] ; [esi+512*4]
  5471 00003635 B900020000                              mov	ecx, 512        ; append another copy
  5472 0000363A F3A5                                    rep movsd
  5473 0000363C C3                                      retn
  5474                                  
  5475                                  
  5476                                  ; =============== S U B R O U T I N E =======================================
  5477                                  
  5478                                  
  5479                                  mp3_any_init_band_indices:
  5480 0000363D BE[08A50000]                            mov     esi, mp3_band_size_long
  5481 00003642 BF[A0FC0100]                            mov     edi, mp3_band_index_long
  5482 00003647 BB09000000                              mov     ebx, 9
  5483                                  
  5484                                  .band_index_lop_i:
  5485 0000364C 31C0                                    xor     eax, eax
  5486 0000364E B916000000                              mov     ecx, 22
  5487                                  
  5488                                  .band_index_lop_j:
  5489 00003653 66AB                                    stosw
  5490 00003655 0FB616                                  movzx   edx, byte [esi]
  5491 00003658 01D0                                    add     eax, edx
  5492 0000365A 46                                      inc     esi
  5493 0000365B E2F6                                    loop    .band_index_lop_j
  5494 0000365D 83C10A                                  add     ecx, 10
  5495 00003660 F366AB                                  rep stosw
  5496 00003663 4B                                      dec     ebx
  5497 00003664 75E6                                    jnz     short .band_index_lop_i
  5498 00003666 C3                                      retn
  5499                                  
  5500                                  
  5501                                  ; =============== S U B R O U T I N E =======================================
  5502                                  
  5503                                  
  5504                                  mp3_any_init_lsf_sf_expand:
  5505 00003667 BE[A69C0000]                            mov     esi, mp3_lsf_sf_expand_init_table
  5506 0000366C BF[8C240500]                            mov     edi, mp3_lsf_sf_expand_exploded_table
  5507 00003671 31D2                                    xor     edx, edx        ; curr.index
  5508 00003673 31DB                                    xor     ebx, ebx        ; curr.base
  5509                                  
  5510                                  .lop:
  5511 00003675 663B5606                                cmp     dx, [esi+6]     ; nextbase
  5512 00003679 7207                                    jb      short .inrange
  5513 0000367B 668B5E06                                mov     bx, [esi+6]
  5514 0000367F 83C608                                  add     esi, 8          ; next entry
  5515                                  
  5516                                  .inrange:
  5517 00003682 89D0                                    mov     eax, edx
  5518 00003684 29D8                                    sub     eax, ebx
  5519 00003686 8A0E                                    mov     cl, [esi]
  5520 00003688 D3E8                                    shr     eax, cl         ; div2
  5521 0000368A F67603                                  div     byte [esi+3] ; mod3 ; [2]=slen[3]
  5522 0000368D 886703                                  mov     [edi+3], ah
  5523 00003690 B400                                    mov     ah, 0           ; eax=div.result
  5524 00003692 F67602                                  div     byte [esi+2] ; mod2 ; [2]=slen[2]
  5525 00003695 886702                                  mov     [edi+2], ah     ; remainder
  5526 00003698 B400                                    mov     ah, 0
  5527 0000369A F67601                                  div     byte [esi+1] ; mod1 ; [1]=slen[1]
  5528 0000369D 668907                                  mov     [edi], ax       ; [0]=slen[0]
  5529 000036A0 668B4604                                mov     ax, [esi+4]     ; [4]=tindex2
  5530 000036A4 66894704                                mov     [edi+4], ax     ; [5]=force_preflag
  5531 000036A8 83C708                                  add     edi, 8
  5532 000036AB 42                                      inc     edx             ; curr.index ; next
  5533 000036AC 81FA00040000                            cmp     edx, 1024       ; 512+512
  5534 000036B2 72C1                                    jb      short .lop
  5535 000036B4 C3                                      retn
  5536                                  
  5537                                  
  5538                                  ; =============== S U B R O U T I N E =======================================
  5539                                  
  5540                                  
  5541                                  mp3_any_init_huff_tables:
  5542 000036B5 BD[409F0000]                            mov     ebp, huff_tree_list_data
  5543 000036BA BE[2EA90000]                            mov     esi, huff_tree_list_numbits
  5544 000036BF BA01000000                              mov     edx, 1          ; idx (table 01h..11h)
  5545                                  
  5546                                  .huffman_table_lop:
  5547 000036C4 31C0                                    xor     eax, eax
  5548 000036C6 BF[B84E0500]                            mov     edi, mp3_huff_tmp_bits
  5549 000036CB B940000000                              mov     ecx, 40h        ; 100h/4 ; 100h x 8bit
  5550 000036D0 F3AB                                    rep stosd
  5551 000036D2 BF[B84F0500]                            mov     edi, mp3_huff_tmp_codes
  5552 000036D7 B980000000                              mov     ecx, 80h        ; 100h/2 ; 100h x 16bit
  5553 000036DC F3AB                                    rep stosd
  5554 000036DE 31DB                                    xor     ebx, ebx
  5555                                  
  5556                                  .huff_entry_lop:
  5557 000036E0 0FB67D00                                movzx   edi, byte [ebp+0]
  5558 000036E4 45                                      inc     ebp             ; dst=data
  5559 000036E5 AC                                      lodsb                   ; numbits
  5560 000036E6 8887[B84E0500]                          mov     [mp3_huff_tmp_bits+edi], al
  5561 000036EC B120                                    mov     cl, 32
  5562 000036EE 28C1                                    sub     cl, al          ; 32-numbits
  5563 000036F0 D3EB                                    shr     ebx, cl
  5564 000036F2 66899C3F[B84F0500]                      mov     word [mp3_huff_tmp_codes+edi*2], bx
  5565 000036FA 43                                      inc     ebx             ; next.code
  5566 000036FB D3E3                                    shl     ebx, cl         ; shift back to MSBs
  5567 000036FD 75E1                                    jnz     short .huff_entry_lop
  5568 000036FF 60                                      pusha
  5569 00003700 B800010000                              mov     eax, 100h       ; nb_codes
  5570 00003705 BB[B84E0500]                            mov     ebx, mp3_huff_tmp_bits ; bits
  5571 0000370A BE[B84F0500]                            mov     esi, mp3_huff_tmp_codes ; codes
  5572 0000370F E82C020000                              call    mp3_build_huff_table_root ; make table
  5573 00003714 61                                      popa
  5574 00003715 42                                      inc     edx             ; idx
  5575 00003716 83FA12                                  cmp     edx, 12h
  5576 00003719 75A9                                    jnz     short .huffman_table_lop ; next table
  5577 0000371B C3                                      retn
  5578                                  
  5579                                  
  5580                                  ; =============== S U B R O U T I N E =======================================
  5581                                  
  5582                                  
  5583                                  mp3_integer_init_is_stereo_lsf:
  5584 0000371C 31FF                                    xor     edi, edi
  5585                                  
  5586                                  .lsf_lop:
  5587 0000371E 89FE                                    mov     esi, edi
  5588 00003720 83E63F                                  and     esi, 3Fh
  5589 00003723 46                                      inc     esi
  5590 00003724 D1EE                                    shr     esi, 1
  5591 00003726 F7C740000000                            test    edi, 40h
  5592 0000372C 7402                                    jz      short .lsf_no_shift
  5593 0000372E D1E6                                    shl     esi, 1
  5594                                  
  5595                                  .lsf_no_shift:
  5596 00003730 BA00000040                              mov     edx, 40000000h  ; aka mul 1.000
  5597 00003735 83C604                                  add     esi, 4
  5598 00003738 F7C780000000                            test    edi, 80h        ; 2*40h
  5599 0000373E 7408                                    jz      short .no_ms_stereo
  5600 00003740 BA9A79825A                              mov     edx, 5A82799Ah  ; 2D413CCDh*2 ; aka mul 1.414
  5601 00003745 83EE02                                  sub     esi, 2
  5602                                  
  5603                                  .no_ms_stereo:
  5604 00003748 89F1                                    mov     ecx, esi
  5605 0000374A C1E902                                  shr     ecx, 2          ; msbs
  5606 0000374D 83E603                                  and     esi, 3          ; lsbs
  5607 00003750 8B04B5[00A90000]                        mov     eax, [mp3_is_table_lsf_src+esi*4]
  5608 00003757 D3E8                                    shr     eax, cl
  5609 00003759 F7C701000000                            test    edi, 1
  5610 0000375F 7501                                    jnz     short .lsf_no_swap
  5611 00003761 92                                      xchg    eax, edx
  5612                                  
  5613                                  .lsf_no_swap:
  5614 00003762 8904FD[8C0C0500]                        mov     [mp3_is_table_lsf+edi*8], eax
  5615 00003769 8914FD[900C0500]                        mov     [(mp3_is_table_lsf+4)+edi*8], edx
  5616 00003770 47                                      inc     edi
  5617 00003771 81FF00010000                            cmp     edi, 100h
  5618 00003777 72A5                                    jb      short .lsf_lop
  5619 00003779 C3                                      retn
  5620                                  
  5621                                  
  5622                                  ; =============== S U B R O U T I N E =======================================
  5623                                  
  5624                                  
  5625                                  mp3_integer_init_mdct_windows:
  5626 0000377A BF[0C080500]                            mov     edi, mp3_mdct_win
  5627 0000377F BE[88A60000]                            mov     esi, mp3_mdct_win_src
  5628 00003784 B990000000                              mov     ecx, 144        ; 36*4
  5629 00003789 F3A5                                    rep movsd
  5630 0000378B BE[0C080500]                            mov     esi, mp3_mdct_win
  5631 00003790 BF[4C0A0500]                            mov     edi, (mp3_mdct_win+240h)
  5632 00003795 B948000000                              mov     ecx, 72         ; 4*36/2 ; that is, 4*36 entry pairs
  5633                                  
  5634                                  .mdct_lop_dupe:                       
  5635 0000379A A5                                      movsd                   ; copy normal, [4..7][even] = +[0..3][even
  5636 0000379B AD                                      lodsd
  5637 0000379C F7D8                                    neg     eax             ; copy negated, [4..7][odd] = -[0..3][odd]
  5638 0000379E AB                                      stosd
  5639 0000379F E2F9                                    loop    .mdct_lop_dupe
  5640 000037A1 C3                                      retn
  5641                                  
  5642                                  
  5643                                  ; =============== S U B R O U T I N E =======================================
  5644                                  
  5645                                  
  5646                                  mp3_integer_init_table_4_3:
  5647                                  		; 15/02/2025
  5648 000037A2 B048                                    mov	al, 72          ; 100-6-VFRAC_BITS_slow
  5649                                   .this_vfrac:
  5650 000037A4 A2[E4180100]                            mov     [mp3_curr_vfrac_bits], al
  5651 000037A9 31FF                                    xor     edi, edi
  5652                                  
  5653                                  .table_4_3_lop:
  5654 000037AB 57                                      push    edi             ; for i=1 to TABLE_4_3_SIZE-1
  5655 000037AC 89F8                                    mov     eax, edi
  5656 000037AE C1E802                                  shr     eax, 2
  5657 000037B1 F7E0                                    mul     eax
  5658 000037B3 F7E0                                    mul     eax
  5659 000037B5 31DB                                    xor     ebx, ebx
  5660 000037B7 E8A2000000                              call    cbrt96
  5661 000037BC 020D[E4180100]                          add     cl, [mp3_curr_vfrac_bits]
  5662 000037C2 5F                                      pop     edi
  5663                                  
  5664                                  .inner_lop:
  5665 000037C3 89F8                                    mov     eax, edi
  5666 000037C5 83E003                                  and     eax, 3
  5667 000037C8 8B0485[10A90000]                        mov     eax, [mp3_pow2_quarters+eax*4]
  5668 000037CF F7E3                                    mul     ebx
  5669 000037D1 88CD                                    mov     ch, cl
  5670 000037D3 09D2                                    or      edx, edx
  5671 000037D5 7904                                    jns     short .this
  5672 000037D7 D1EA                                    shr     edx, 1
  5673 000037D9 FECD                                    dec     ch
  5674                                  
  5675                                  .this:
  5676 000037DB 8914BD[1C7F0200]                        mov     [mp3_table_4_3_value+edi*4], edx
  5677 000037E2 88AF[E0FE0100]                          mov     [mp3_table_4_3_exp+edi], ch
  5678 000037E8 47                                      inc     edi
  5679 000037E9 F7C703000000                            test    edi, 3
  5680 000037EF 75D2                                    jnz     short .inner_lop
  5681 000037F1 81FF3C800000                            cmp     edi, 803Ch
  5682 000037F7 72B2                                    jb      short .table_4_3_lop
  5683 000037F9 C3                                      retn
  5684                                  
  5685                                  
  5686                                  ; =============== S U B R O U T I N E =======================================
  5687                                  
  5688                                  
  5689                                  mp3_integer_init_exponent:
  5690 000037FA BF[0C880400]                            mov     edi, mp3_expval_table
  5691 000037FF 31D2                                    xor     edx, edx
  5692                                  
  5693                                  .exponent_lop:
  5694 00003801 89D0                                    mov     eax, edx        ; val=i
  5695 00003803 89D3                                    mov     ebx, edx
  5696 00003805 89D1                                    mov     ecx, edx
  5697 00003807 C1EB04                                  shr     ebx, 4
  5698 0000380A C1E906                                  shr     ecx, 6          ; 4+2
  5699 0000380D 83E00F                                  and     eax, 0Fh        ; val=i AND 0Fh
  5700 00003810 83E303                                  and     ebx, 3
  5701 00003813 8D1C83                                  lea     ebx, [ebx+eax*4] ; (0..0Fh)*4+(0..3)
  5702 00003816 8B049D[1C7F0200]                        mov     eax, [mp3_table_4_3_value+ebx*4]
  5703 0000381D 09C0                                    or      eax, eax
  5704 0000381F 741A                                    jz      short .this
  5705 00003821 2A8B[E0FE0100]                          sub     cl, [mp3_table_4_3_exp+ebx]
  5706 00003827 770D                                    ja      short .left_shift
  5707 00003829 F6D9                                    neg     cl
  5708 0000382B D3E8                                    shr     eax, cl
  5709 0000382D 80F91F                                  cmp     cl, 1Fh
  5710 00003830 7609                                    jbe     short .this
  5711 00003832 31C0                                    xor     eax, eax
  5712 00003834 EB05                                    jmp     short .this
  5713                                  
  5714                                  .left_shift:
  5715 00003836 B8FFFFFF7F                              mov     eax, 7FFFFFFFh
  5716                                  
  5717                                  .this:
  5718 0000383B AB                                      stosd
  5719 0000383C 42                                      inc     edx
  5720 0000383D 81FA00200000                            cmp     edx, 2000h
  5721 00003843 72BC                                    jb      short .exponent_lop
  5722 00003845 BE[0C880400]                            mov     esi, mp3_expval_table
  5723 0000384A BF[0C800400]                            mov     edi, mp3_exp_table
  5724 0000384F B900020000                              mov     ecx, 200h
  5725                                  
  5726                                  .exponent_dupe_lop:
  5727 00003854 8B4604                                  mov     eax, [esi+4]
  5728 00003857 AB                                      stosd
  5729 00003858 83C640                                  add     esi, 40h
  5730 0000385B E2F7                                    loop    .exponent_dupe_lop
  5731 0000385D C3                                      retn
  5732                                  
  5733                                  
  5734                                  ; =============== S U B R O U T I N E =======================================
  5735                                  
  5736                                  
  5737                                  cbrt96:
  5738 0000385E 83EC18                                  sub     esp, 18h        ; cube root, val^(1/3), from https://gist.github.com/anonymous/729557
  5739                                                                          ; in:  ebx:edx:eax = unsigned 96bit input (integer)
  5740                                                                          ; out: ebx         = unsigned 32bit result (with fractional bits)
  5741                                                                          ; out: cl          = number of fractional bits
  5742 00003861 890424                                  mov     [esp], eax
  5743 00003864 89542404                                mov     [esp+4], edx
  5744 00003868 895C2408                                mov     [esp+8], ebx
  5745 0000386C C744240C00000000                        mov     dword [esp+0Ch], 0
  5746 00003874 C744241000000000                        mov     dword [esp+10h], 0
  5747 0000387C C744241400000000                        mov     dword [esp+14h], 0
  5748 00003884 31DB                                    xor     ebx, ebx        ; result.value
  5749 00003886 B100                                    mov     cl, 0           ; result.fraction
  5750 00003888 09D0                                    or      eax, edx        ; skip if zero
  5751 0000388A 742F                                    jz      short .pre_shift_done
  5752                                  
  5753                                  .pre_shift_lop:
  5754 0000388C F7442408000000E0                        test    dword [esp+8], 0E0000000h
  5755 00003894 7525                                    jnz     short .pre_shift_done
  5756 00003896 D12424                                  shl     dword [esp], 1
  5757 00003899 D1542404                                rcl     dword [esp+4], 1
  5758 0000389D D1542408                                rcl     dword [esp+8], 1
  5759 000038A1 D12424                                  shl     dword [esp], 1
  5760 000038A4 D1542404                                rcl     dword [esp+4], 1
  5761 000038A8 D1542408                                rcl     dword [esp+8], 1
  5762 000038AC D12424                                  shl     dword [esp], 1
  5763 000038AF D1542404                                rcl     dword [esp+4], 1
  5764 000038B3 D1542408                                rcl     dword [esp+8], 1
  5765 000038B7 FEC1                                    inc     cl
  5766 000038B9 EBD1                                    jmp     short .pre_shift_lop
  5767                                  
  5768                                  .pre_shift_done:
  5769 000038BB B520                                    mov     ch, 20h         ; loopcount
  5770                                  
  5771                                  .lop:
  5772 000038BD 01DB                                    add     ebx, ebx        ; result*2
  5773 000038BF 89D8                                    mov     eax, ebx        ; y
  5774 000038C1 43                                      inc     ebx             ; result+1
  5775 000038C2 F7E3                                    mul     ebx             ; y*(y+1)
  5776 000038C4 89C6                                    mov     esi, eax
  5777 000038C6 89D7                                    mov     edi, edx
  5778 000038C8 31ED                                    xor     ebp, ebp
  5779 000038CA F9                                      stc
  5780 000038CB 11F6                                    adc     esi, esi        ; y*(y+1)*2+1
  5781 000038CD 11FF                                    adc     edi, edi
  5782 000038CF 11ED                                    adc     ebp, ebp
  5783 000038D1 01C6                                    add     esi, eax
  5784 000038D3 11D7                                    adc     edi, edx        ; y*(y+1)*3+1
  5785 000038D5 83D500                                  adc     ebp, 0
  5786 000038D8 D12424                                  shl     dword [esp], 1
  5787 000038DB D1542404                                rcl     dword [esp+4], 1
  5788 000038DF D1542408                                rcl     dword [esp+8], 1 ; shl 3
  5789 000038E3 D154240C                                rcl     dword [esp+0Ch], 1
  5790 000038E7 D1542410                                rcl     dword [esp+10h], 1
  5791 000038EB D1542414                                rcl     dword [esp+14h], 1
  5792 000038EF D12424                                  shl     dword [esp], 1
  5793 000038F2 D1542404                                rcl     dword [esp+4], 1
  5794 000038F6 D1542408                                rcl     dword [esp+8], 1
  5795 000038FA D154240C                                rcl     dword [esp+0Ch], 1
  5796 000038FE D1542410                                rcl     dword [esp+10h], 1
  5797 00003902 D1542414                                rcl     dword [esp+14h], 1
  5798 00003906 D12424                                  shl     dword [esp], 1
  5799 00003909 D1542404                                rcl     dword [esp+4], 1
  5800 0000390D D1542408                                rcl     dword [esp+8], 1
  5801 00003911 D154240C                                rcl     dword [esp+0Ch], 1
  5802 00003915 D1542410                                rcl     dword [esp+10h], 1
  5803 00003919 D1542414                                rcl     dword [esp+14h], 1
  5804 0000391D 2974240C                                sub     [esp+0Ch], esi
  5805 00003921 197C2410                                sbb     [esp+10h], edi  ; sub/compare
  5806 00003925 196C2414                                sbb     [esp+14h], ebp
  5807 00003929 730D                                    jnb     short .next
  5808 0000392B 4B                                      dec     ebx
  5809 0000392C 0174240C                                add     [esp+0Ch], esi
  5810 00003930 117C2410                                adc     [esp+10h], edi  ; undo
  5811 00003934 116C2414                                adc     [esp+14h], ebp
  5812                                  
  5813                                  .next:
  5814 00003938 FECD                                    dec     ch
  5815 0000393A 7581                                    jnz     short .lop
  5816 0000393C 83C418                                  add     esp, 18h
  5817                                  mp3_init_log_constants:
  5818 0000393F C3                                      retn
  5819                                  
  5820                                  ;mp3_init_log_constants:
  5821                                  ;                retn
  5822                                  
  5823                                  ; =============== S U B R O U T I N E =======================================
  5824                                  
  5825                                  
  5826                                  mp3_build_huff_table_root:
  5827 00003940 A3[BC510500]                            mov     [_@@nb_codes], eax ; "init_vlc"
  5828 00003945 C705[C0510500]0000-                     mov     dword [_@@prefix_numbits], 0
  5828 0000394D 0000               
  5829 0000394F C705[C4510500]0000-                     mov     dword [_@@prefix_pattern], 0
  5829 00003957 0000               
  5830 00003959 60                                      pusha
  5831 0000395A 89C1                                    mov     ecx, eax
  5832 0000395C 31C0                                    xor     eax, eax
  5833                                  
  5834                                  .prescan_lop:
  5835 0000395E 3A03                                    cmp     al, [ebx]
  5836 00003960 7702                                    ja      short .prescan_next
  5837 00003962 8A03                                    mov     al, [ebx]
  5838                                  
  5839                                  .prescan_next:
  5840 00003964 43                                      inc     ebx
  5841 00003965 E2F7                                    loop    .prescan_lop
  5842 00003967 3C09                                    cmp     al, 9           ; CHILD_BITS
  5843 00003969 7202                                    jb      short .prescan_this_limit
  5844 0000396B B009                                    mov     al, 9
  5845                                  
  5846                                  .prescan_this_limit:
  5847 0000396D A3[B8510500]                            mov     [_@@table_nb_bits], eax
  5848 00003972 61                                      popa
  5849                                  
  5850                                  mp3_build_huff_table_recursive_child:
  5851 00003973 8B0D[B8510500]                          mov     ecx, [_@@table_nb_bits]
  5852 00003979 B801000000                              mov     eax, 1
  5853 0000397E D3E0                                    shl     eax, cl
  5854 00003980 A3[C8510500]                            mov     [_@@curr_table_size], eax
  5855 00003985 48                                      dec     eax
  5856 00003986 A3[CC510500]                            mov     [_@@curr_table_mask], eax
  5857 0000398B 60                                      pusha
  5858 0000398C 8B1D[24A90000]                          mov     ebx, [mp3_huff_num_entries]
  5859 00003992 891D[D0510500]                          mov     [_@@curr_table_index], ebx
  5860 00003998 031D[C8510500]                          add     ebx, [_@@curr_table_size]
  5861 0000399E 891D[24A90000]                          mov     [mp3_huff_num_entries], ebx
  5862 000039A4 813D[24A90000]002E-                     cmp     dword [mp3_huff_num_entries], 11776 ; HUFF_TREE_SIZE/4
  5862 000039AC 0000               
  5863 000039AE 0F87F5D2FFFF                            ja      fatalunexpected
  5864 000039B4 61                                      popa
  5865 000039B5 BF[A0440100]                            mov     edi, huff_tree_buf
  5866 000039BA A1[D0510500]                            mov     eax, [_@@curr_table_index]
  5867 000039BF 66890497                                mov     [edi+edx*4], ax
  5868 000039C3 A1[B8510500]                            mov     eax, [_@@table_nb_bits]
  5869 000039C8 F7D8                                    neg     eax
  5870 000039CA 6689449702                              mov     [edi+edx*4+2], ax
  5871 000039CF BF[A0440100]                            mov     edi, huff_tree_buf
  5872 000039D4 8B15[D0510500]                          mov     edx, [_@@curr_table_index]
  5873 000039DA 8B0D[C8510500]                          mov     ecx, [_@@curr_table_size]
  5874                                  
  5875                                  .clear_table_lop:
  5876 000039E0 66C70497FFFF                            mov     word [edi+edx*4], 0FFFFh
  5877 000039E6 66C74497020000                          mov     word [edi+edx*4+2], 0
  5878 000039ED 42                                      inc     edx
  5879 000039EE E2F0                                    loop    .clear_table_lop
  5880 000039F0 53                                      push    ebx
  5881 000039F1 56                                      push    esi
  5882 000039F2 31D2                                    xor     edx, edx
  5883                                  
  5884                                  .make_table_lop:
  5885 000039F4 0FB60B                                  movzx   ecx, byte [ebx]
  5886 000039F7 0FB706                                  movzx   eax, word [esi]
  5887 000039FA 2B0D[C0510500]                          sub     ecx, [_@@prefix_numbits]
  5888 00003A00 7E74                                    jle     short .make_table_lop_next
  5889 00003A02 D3E8                                    shr     eax, cl
  5890 00003A04 3B05[C4510500]                          cmp     eax, [_@@prefix_pattern]
  5891 00003A0A 756A                                    jnz     short .make_table_lop_next
  5892 00003A0C BF[A0440100]                            mov     edi, huff_tree_buf
  5893 00003A11 0FB706                                  movzx   eax, word [esi]
  5894 00003A14 2B0D[B8510500]                          sub     ecx, [_@@table_nb_bits]
  5895 00003A1A 773E                                    ja      short .create_child_table
  5896 00003A1C F7D9                                    neg     ecx
  5897 00003A1E D3E0                                    shl     eax, cl
  5898 00003A20 2305[CC510500]                          and     eax, [_@@curr_table_mask]
  5899 00003A26 0305[D0510500]                          add     eax, [_@@curr_table_index]
  5900 00003A2C 8D3C87                                  lea     edi, [edi+eax*4]
  5901 00003A2F B801000000                              mov     eax, 1
  5902 00003A34 D3E0                                    shl     eax, cl
  5903 00003A36 89C1                                    mov     ecx, eax
  5904 00003A38 0FB603                                  movzx   eax, byte [ebx]
  5905 00003A3B 2B05[C0510500]                          sub     eax, [_@@prefix_numbits]
  5906                                  
  5907                                  .make_rept_lop:
  5908 00003A41 66837F0200                              cmp     word [edi+2], 0
  5909 00003A46 0F855DD2FFFF                            jnz     fatalunexpected
  5910 00003A4C 668917                                  mov     [edi], dx
  5911 00003A4F 66894702                                mov     [edi+2], ax
  5912 00003A53 83C704                                  add     edi, 4
  5913 00003A56 E2E9                                    loop    .make_rept_lop
  5914 00003A58 EB1C                                    jmp     short .make_table_lop_next
  5915                                  
  5916                                  .create_child_table:
  5917 00003A5A D3E8                                    shr     eax, cl
  5918 00003A5C 2305[CC510500]                          and     eax, [_@@curr_table_mask]
  5919 00003A62 0305[D0510500]                          add     eax, [_@@curr_table_index]
  5920 00003A68 F7D9                                    neg     ecx
  5921 00003A6A 66394C8702                              cmp     [edi+eax*4+2], cx
  5922 00003A6F 7C05                                    jl      short .make_table_lop_next
  5923 00003A71 66894C8702                              mov     [edi+eax*4+2], cx
  5924                                  
  5925                                  .make_table_lop_next:
  5926 00003A76 83C602                                  add     esi, 2
  5927 00003A79 43                                      inc     ebx
  5928 00003A7A 42                                      inc     edx
  5929 00003A7B 3B15[BC510500]                          cmp     edx, [_@@nb_codes]
  5930 00003A81 0F826DFFFFFF                            jb      .make_table_lop
  5931 00003A87 5E                                      pop     esi
  5932 00003A88 5B                                      pop     ebx
  5933 00003A89 8B0D[C8510500]                          mov     ecx, [_@@curr_table_size]
  5934 00003A8F 8B15[D0510500]                          mov     edx, [_@@curr_table_index]
  5935                                  
  5936                                  .make_child_tables_lop:
  5937 00003A95 BF[A0440100]                            mov     edi, huff_tree_buf
  5938 00003A9A 0FBF449702                              movsx   eax, word [edi+edx*4+2]
  5939 00003A9F 83F800                                  cmp     eax, 0
  5940 00003AA2 796D                                    jns     short .make_child_tables_lop_next
  5941 00003AA4 F7D8                                    neg     eax
  5942 00003AA6 3B05[B8510500]                          cmp     eax, [_@@table_nb_bits]
  5943 00003AAC 7605                                    jbe     short .make_child_tables_this
  5944 00003AAE A1[B8510500]                            mov     eax, [_@@table_nb_bits]
  5945                                  
  5946                                  .make_child_tables_this:
  5947 00003AB3 51                                      push	ecx
  5948 00003AB4 52                                      push	edx
  5949 00003AB5 FF35[D0510500]                          push	dword [_@@curr_table_index]
  5950 00003ABB FF35[B8510500]                          push	dword [_@@table_nb_bits]
  5951 00003AC1 FF35[C0510500]                          push	dword [_@@prefix_numbits]
  5952 00003AC7 FF35[C4510500]                          push	dword [_@@prefix_pattern]
  5953 00003ACD 8B0D[B8510500]                          mov	ecx, [_@@table_nb_bits]
  5954 00003AD3 A3[B8510500]                            mov	[_@@table_nb_bits], eax
  5955 00003AD8 010D[C0510500]                          add	[_@@prefix_numbits], ecx
  5956 00003ADE D325[C4510500]                          shl	dword [_@@prefix_pattern], cl
  5957 00003AE4 89D0                                    mov	eax, edx
  5958 00003AE6 2B05[D0510500]                          sub	eax, [_@@curr_table_index]
  5959 00003AEC 0905[C4510500]                          or	[_@@prefix_pattern], eax
  5960 00003AF2 E87CFEFFFF                              call	mp3_build_huff_table_recursive_child
  5961 00003AF7 8F05[C4510500]                          pop	dword [_@@prefix_pattern]
  5962 00003AFD 8F05[C0510500]                          pop	dword [_@@prefix_numbits]
  5963 00003B03 8F05[B8510500]                          pop	dword [_@@table_nb_bits]
  5964 00003B09 8F05[D0510500]                          pop	dword [_@@curr_table_index]
  5965 00003B0F 5A                                      pop	edx
  5966 00003B10 59                                      pop	ecx
  5967                                  
  5968                                  .make_child_tables_lop_next:
  5969 00003B11 42                                      inc	edx
  5970 00003B12 E281                                    loop	.make_child_tables_lop
  5971 00003B14 C3                                      retn
  5972                                  
  5973                                  
  5974                                  ; =============== S U B R O U T I N E =======================================
  5975                                  
  5976                                  
  5977                                  mp3_exclude_id3_and_tag:
  5978 00003B15 8B35[E0510500]                          mov     esi, [stream_pos]
  5979 00003B1B 8B0D[E4510500]                          mov     ecx, [bytes_left]
  5980 00003B21 83F90A                                  cmp     ecx, 10
  5981 00003B24 7240                                    jb      short .no_id3
  5982 00003B26 8B06                                    mov     eax, [esi]
  5983 00003B28 25FFFFFF00                              and     eax, 0FFFFFFh
  5984                                                  ;cmp    eax, '3DI'     ; "ID3"
  5985                                                  ; 20/10/2024 
  5986 00003B2D 3D49443300                              cmp     eax, 'ID3'     ; FASM & NASM syntax
  5987 00003B32 7532                                    jnz     short .no_id3
  5988 00003B34 8B4606                                  mov     eax, [esi+6]
  5989 00003B37 A980808080                              test    eax, 80808080h
  5990 00003B3C 7528                                    jnz     short .no_id3
  5991                                  
  5992                                  .xlat_4x7bit_to_28bit:
  5993 00003B3E 86E0                                    xchg    al, ah
  5994 00003B40 D0E0                                    shl     al, 1
  5995 00003B42 66D1E0                                  shl     ax, 1
  5996 00003B45 66C1E802                                shr     ax, 2
  5997 00003B49 C1C810                                  ror     eax, 16
  5998 00003B4C 86E0                                    xchg    al, ah
  5999 00003B4E D0E0                                    shl     al, 1
  6000 00003B50 66D1E0                                  shl     ax, 1
  6001 00003B53 C1E802                                  shr     eax, 2
  6002 00003B56 83C00A                                  add     eax, 10
  6003 00003B59 39C1                                    cmp     ecx, eax
  6004 00003B5B 7209                                    jb      short .no_id3
  6005 00003B5D 01C6                                    add     esi, eax
  6006 00003B5F 29C1                                    sub     ecx, eax
  6007 00003B61 A3[64190100]                            mov     [mp3_id3_size], eax
  6008                                  
  6009                                  .no_id3:
  6010 00003B66 BA80000000                              mov     edx, 80h
  6011 00003B6B 39D1                                    cmp     ecx, edx
  6012 00003B6D 721F                                    jb      short .no_tag_or_ext
  6013 00003B6F 8B440E80                                mov     eax, [esi+ecx-80h]
  6014 00003B73 25FFFFFF00                              and     eax, 0FFFFFFh
  6015                                                  ;cmp    eax, 'GAT'     ; "TAG"
  6016                                                  ; 20/10/2024
  6017 00003B78 3D54414700                              cmp     eax, 'TAG'     ; FASM & NASM syntax
  6018 00003B7D 0F8421010000                            jz      .got_tag_size_edx
  6019                                                  ;cmp    eax, 'TXE'
  6020 00003B83 3D45585400                              cmp     eax, 'EXT'
  6021 00003B88 0F8416010000                            jz      .got_tag_size_edx
  6022                                  
  6023                                  .no_tag_or_ext:
  6024 00003B8E BAE3000000                              mov     edx, 0E3h
  6025 00003B93 39D1                                    cmp     ecx, edx
  6026 00003B95 7211                                    jb      short .no_tagplus
  6027                                                  ;cmp    dword [esi+ecx-0E3h], '+GAT' ; "TAG+"
  6028                                                  ; 20/10/2024
  6029 00003B97 81BC0E1DFFFFFF5441-                     cmp     dword [esi+ecx-0E3h], 'TAG+'
  6029 00003BA0 472B               
  6030 00003BA2 0F84FC000000                            jz      .got_tag_size_edx
  6031                                  
  6032                                  .no_tagplus:
  6033 00003BA8 BA14000000                              mov     edx, 20        ; 10+10
  6034 00003BAD 39D1                                    cmp     ecx, edx
  6035 00003BAF 723C                                    jb      short .no_3di  ; "3DI",04h
  6036 00003BB1 817C0EF633444904                        cmp     dword [esi+ecx-10], 4494433h ; 'ID3'+04000000h
  6037 00003BB9 7532                                    jnz     short .no_3di
  6038 00003BBB F6440EFB10                              test    byte [esi+ecx-5], 10h ; bit 4
  6039 00003BC0 742B                                    jz      short .no_3di
  6040 00003BC2 8B440EFC                                mov     eax, [esi+ecx-4]
  6041 00003BC6 A980808080                              test    eax, 80808080h
  6042 00003BCB 7520                                    jnz     short .no_3di
  6043                                  
  6044                                  .@xlat_4x7bit_to_28bit:
  6045 00003BCD 86E0                                    xchg    al, ah
  6046 00003BCF D0E0                                    shl     al, 1
  6047 00003BD1 66D1E0                                  shl     ax, 1
  6048 00003BD4 66C1E802                                shr     ax, 2
  6049 00003BD8 C1C810                                  ror     eax, 10h
  6050 00003BDB 86E0                                    xchg    al, ah
  6051 00003BDD D0E0                                    shl     al, 1
  6052 00003BDF 66D1E0                                  shl     ax, 1
  6053 00003BE2 C1E802                                  shr     eax, 2
  6054 00003BE5 8D5014                                  lea     edx, [eax+20]  ; [eax+10+10] ; hdr+footer siz
  6055 00003BE8 E9B7000000                              jmp     .got_tag_size_edx
  6056                                  
  6057                                  .no_3di:
  6058                                                  ;cmp    dword [esi+ecx-32], 'TEPA' ; [esi+ecx-32+0]
  6059                                                  ; 20/10/2024
  6060 00003BED 817C0EE041504554                        cmp     dword [esi+ecx-32], 'APET'
  6061                                                                         ; check "APETAGEX"
  6062 00003BF5 7520                                    jnz     short .no_ape
  6063                                                  ;cmp    dword [esi+ecx-28], 'XEGA' ; [esi+ecx-32+4]
  6064 00003BF7 817C0EE441474558                        cmp     dword [esi+ecx-28], 'AGEX'
  6065 00003BFF 7516                                    jnz     short .no_ape
  6066 00003C01 8B540EEC                                mov     edx, [esi+ecx-20] ; [esi+ecx-32+12] ; get size
  6067 00003C05 F7440EF400000080                        test    dword [esi+ecx-12], 80000000h ; [esi+ecx-32+20],1 shl 31
  6068 00003C0D 7403                                    jz      short .no_ape_header
  6069 00003C0F 83C220                                  add     edx, 32        ; hdr.size
  6070                                  
  6071                                  .no_ape_header: 
  6072 00003C12 E98D000000                              jmp     .got_tag_size_edx
  6073                                  
  6074                                  .no_ape:
  6075 00003C17 BA14000000                              mov     edx, 20        ; 11+9
  6076 00003C1C 39D1                                    cmp     ecx, edx       ; "LYRICSEND" or "LYRICS200"
  6077                                                                         ; (11+N+9 bytes each)
  6078 00003C1E 7258                                    jb      short .no_lyrics
  6079                                                  ;cmp    dword [esi+ecx-9], 'IRYL'
  6080                                                  ; 20/10/2024
  6081 00003C20 817C0EF74C595249                        cmp     dword [esi+ecx-9], 'LYRI' ; FASM & NASM syntax
  6082 00003C28 754E                                    jnz     short .no_lyrics
  6083 00003C2A 807C0EFB43                              cmp     byte [esi+ecx-5], 'C'
  6084 00003C2F 7547                                    jnz     short .no_lyrics
  6085                                                  ;cmp    dword [esi+ecx-4], 'DNES'
  6086 00003C31 817C0EFC53454E44                        cmp     dword [esi+ecx-4], 'SEND'
  6087 00003C39 740C                                    jz      short .lyrics3_v1
  6088                                                  ;cmp    dword [esi+ecx-4], '002S'
  6089 00003C3B 817C0EFC53323030                        cmp     dword [esi+ecx-4], 'S200'
  6090 00003C43 7440                                    jz      short .lyrics3_v2
  6091 00003C45 7531                                    jnz     short .no_lyrics
  6092                                  
  6093                                  .lyrics3_v1:
  6094 00003C47 BA14000000                              mov     edx, 20        ; 11+9
  6095                                  
  6096                                  .lyrics3_v1_size_lop:
  6097 00003C4C 8D040E                                  lea     eax, [esi+ecx]
  6098 00003C4F 29D0                                    sub     eax, edx
  6099                                                  ;cmp    dword [eax], 'IRYL' ; "LYRICSBEGIN"
  6100                                                  ; 20/10/2024
  6101 00003C51 81384C595249                            cmp     dword [eax], 'LYRI'
  6102 00003C57 7512                                    jnz     short .lyrics3_v1_size_next
  6103                                                  ;cmp    dword [eax+4], 'EBSC'
  6104 00003C59 81780443534245                          cmp     dword [eax+4], 'CSBE'
  6105 00003C60 7509                                    jnz     short .lyrics3_v1_size_next
  6106                                                  ;cmp    dword [eax+7], 'NIGE'
  6107 00003C62 8178074547494E                          cmp     dword [eax+7], 'EGIN'
  6108 00003C69 7439                                    jz      short .got_tag_size_edx
  6109                                  
  6110                                  .lyrics3_v1_size_next:
  6111 00003C6B 42                                      inc     edx
  6112 00003C6C 81FA00140000                            cmp     edx, 5120
  6113 00003C72 7704                                    ja      short .no_lyrics
  6114 00003C74 39CA                                    cmp     edx, ecx
  6115 00003C76 76D4                                    jbe     short .lyrics3_v1_size_lop
  6116                                                  ;jmp     short .no_lyrics
  6117                                  
  6118                                  .no_lyrics:
  6119                                                  ;jmp    short .footer_tag_all_done
  6120                                  		; 22/10/2024
  6121                                  .footer_tag_all_done:
  6122 00003C78 8935[E0510500]                          mov     [stream_pos], esi
  6123 00003C7E 890D[E4510500]                          mov     [bytes_left], ecx
  6124 00003C84 C3                                      retn
  6125                                  
  6126                                  .lyrics3_v2:
  6127 00003C85 51                                      push    ecx
  6128 00003C86 56                                      push    esi
  6129 00003C87 8D740EF1                                lea     esi, [esi+ecx-15] ; [esi+ecx-6-9]
  6130 00003C8B B906000000                              mov     ecx, 6
  6131 00003C90 31D2                                    xor     edx, edx
  6132                                  
  6133                                  .lyrics3_v2_size_lop:
  6134 00003C92 6BD20A                                  imul    edx, 10
  6135 00003C95 0FB606                                  movzx   eax, byte [esi]
  6136 00003C98 46                                      inc     esi
  6137 00003C99 2C30                                    sub     al, 30h
  6138 00003C9B 01C2                                    add     edx, eax
  6139 00003C9D E2F3                                    loop    .lyrics3_v2_size_lop
  6140 00003C9F 5E                                      pop     esi
  6141 00003CA0 59                                      pop     ecx
  6142 00003CA1 83C20F                                  add     edx, 0Fh       ; 6+9
  6143                                                  ;jmp    short .got_tag_size_edx
  6144                                  
  6145                                  .got_tag_size_edx:
  6146                                  		;;;
  6147                                  		; 22/10/2024
  6148 00003CA4 29D1                                    sub    ecx, edx
  6149 00003CA6 731B                                    jnb    short .cont
  6150                                  		;;;
  6151                                  		; 16/02/2025
  6152                                  		sys	_msg, tag_size_err, 255, 0Ch
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00003CA8 BB[CE3C0000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00003CAD B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00003CB2 BA0C000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00003CB7 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00003CBC CD40                <1>  int 40h
  6153                                                  ;;;
  6154                                  		;sub    ecx, edx
  6155                                                  ;jb     fatalunexpected
  6156 00003CBE E9E6CFFFFF              		jmp	fatalunexpected
  6157                                  .cont:
  6158                                  		;;;
  6159 00003CC3 0115[68190100]                          add     [mp3_tag_size], edx
  6160 00003CC9 E998FEFFFF                              jmp     .no_id3
  6161                                  
  6162                                  ; ---------------------------------------------------------------------------
  6163                                  
  6164                                  		; 16/02/2025
  6165 00003CCE 0D0A                    tag_size_err:	db 0Dh, 0Ah
  6166 00003CD0 5461672053697A6520-     		db "Tag Size Error!?"
  6166 00003CD9 4572726F72213F     
  6167 00003CE0 0D0A00                  		db 0Dh, 0Ah, 0
  6168                                  
  6169                                  ; =============== S U B R O U T I N E =======================================
  6170                                  
  6171                                  
  6172                                  mp3_detect_free_format_block_size:
  6173 00003CE3 833D[E0180100]00                        cmp     dword [mp3_free_format_frame_size], 0
  6174 00003CEA 0F85A5000000                            jnz     .already_detected
  6175 00003CF0 31D2                                    xor     edx, edx
  6176                                  
  6177                                  .find_distance_lop:
  6178 00003CF2 3B15[8C190100]                          cmp     edx, [mp3_src_remain]
  6179 00003CF8 742B                                    jz      short .match_eof
  6180 00003CFA 8D4204                                  lea     eax, [edx+4]
  6181 00003CFD 3B05[8C190100]                          cmp     eax, [mp3_src_remain]
  6182 00003D03 771E                                    ja      short .find_distance_failed
  6183 00003D05 8B0416                                  mov     eax, [esi+edx]
  6184 00003D08 E893C5FFFF                              call    bswap_eax
  6185 00003D0D 3305[A0C20000]                          xor     eax, [mp3_hdr_32bit_header]
  6186 00003D13 25000CFEFF                              and     eax, 0FFFE0C00h
  6187 00003D18 740B                                    jz      short .match_eof
  6188                                  
  6189                                  .find_distance_next:
  6190 00003D1A 42                                      inc     edx
  6191 00003D1B 81FA00100000                            cmp     edx, 1000h
  6192 00003D21 76CF                                    jbe     short .find_distance_lop
  6193                                  
  6194                                  .find_distance_failed:
  6195 00003D23 F9                                      stc
  6196 00003D24 C3                                      retn
  6197                                  
  6198                                  .match_eof:
  6199 00003D25 89D0                                    mov     eax, edx
  6200 00003D27 2B05[ACC20000]                          sub     eax, [mp3_hdr_flag_padding]
  6201 00003D2D 83F804                                  cmp     eax, 4
  6202 00003D30 72E8                                    jb      short .find_distance_next
  6203 00003D32 A3[E0180100]                            mov     [mp3_free_format_frame_size], eax
  6204 00003D37 31DB                                    xor     ebx, ebx
  6205                                  
  6206                                  .confirm_distance_lop:
  6207 00003D39 8B041E                                  mov     eax, [esi+ebx]
  6208 00003D3C E85FC5FFFF                              call    bswap_eax
  6209 00003D41 C1E80A                                  shr     eax, 10         ; 9+1
  6210 00003D44 131D[E0180100]                          adc     ebx, [mp3_free_format_frame_size]
  6211 00003D4A 3B1D[8C190100]                          cmp     ebx, [mp3_src_remain]
  6212 00003D50 7422                                    jz      short .confirm_distance_match_eof
  6213 00003D52 8D4304                                  lea     eax, [ebx+4]
  6214 00003D55 3B05[8C190100]                          cmp     eax, [mp3_src_remain]
  6215 00003D5B 77BD                                    ja      short .find_distance_next
  6216 00003D5D 8B041E                                  mov     eax, [esi+ebx]
  6217 00003D60 E83BC5FFFF                              call    bswap_eax
  6218 00003D65 3305[A0C20000]                          xor     eax, [mp3_hdr_32bit_header]
  6219 00003D6B 25000CFEFF                              and     eax, 0FFFE0C00h
  6220 00003D70 75A8                                    jnz     short .find_distance_next
  6221 00003D72 EBC5                                    jmp     short .confirm_distance_lop
  6222                                  
  6223                                  .confirm_distance_match_eof:
  6224 00003D74 A1[E0180100]                            mov     eax, [mp3_free_format_frame_size]
  6225 00003D79 C1E003                                  shl     eax, 3
  6226 00003D7C F725[B0C20000]                          mul     dword [mp3_sample_rate]
  6227 00003D82 8B0D[9C190100]                          mov     ecx, [mp3_nb_granules]
  6228 00003D88 69C940020000                            imul    ecx, 240h
  6229 00003D8E F7F1                                    div     ecx
  6230 00003D90 A3[B8C20000]                            mov     [mp3_bit_rate], eax
  6231                                  
  6232                                  .already_detected:
  6233 00003D95 F8                                      clc
  6234 00003D96 C3                                      retn
  6235                                  
  6236                                  
  6237                                  ; =============== S U B R O U T I N E =======================================
  6238                                  
  6239                                  
  6240                                  mp3_check_xing_info:
  6241 00003D97 C705[E8180100]0000-                     mov     dword [mp3_xing_id], 0
  6241 00003D9F 0000               
  6242 00003DA1 C705[F0180100]0000-                     mov     dword [mp3_xing_frames], 0
  6242 00003DA9 0000               
  6243 00003DAB C705[F4180100]0000-                     mov     dword [mp3_xing_filesize], 0
  6243 00003DB3 0000               
  6244 00003DB5 8B35[94C20000]                          mov     esi, [mp3_src_data_location]
  6245 00003DBB AD                                      lodsd
  6246                                                  ;cmp    eax, 'gniX'
  6247                                  		; 20/10/2024
  6248 00003DBC 3D58696E67              		cmp	eax, 'Xing'     ; FASM & NASM syntax
  6249 00003DC1 7401                                    jz      short .xing
  6250 00003DC3 C3                                      retn
  6251                                  
  6252                                  .xing:
  6253 00003DC4 A3[E8180100]                            mov     [mp3_xing_id], eax
  6254 00003DC9 AD                                      lodsd
  6255 00003DCA E8D1C4FFFF                              call    bswap_eax
  6256 00003DCF A3[EC180100]                            mov     [mp3_xing_flags], eax
  6257 00003DD4 89C2                                    mov     edx, eax
  6258 00003DD6 F7C201000000                            test    edx, 1
  6259 00003DDC 740B                                    jz      short .no_xing_frames
  6260 00003DDE AD                                      lodsd
  6261 00003DDF E8BCC4FFFF                              call    bswap_eax
  6262 00003DE4 A3[F0180100]                            mov     [mp3_xing_frames], eax
  6263                                  
  6264                                  .no_xing_frames:
  6265 00003DE9 F7C202000000                            test    edx, 2          ; 1 shl 1
  6266 00003DEF 740B                                    jz      short .no_xing_filesize
  6267 00003DF1 AD                                      lodsd
  6268 00003DF2 E8A9C4FFFF                              call    bswap_eax
  6269 00003DF7 A3[F4180100]                            mov     [mp3_xing_filesize], eax
  6270                                  
  6271                                  .no_xing_filesize:
  6272 00003DFC F7C204000000                            test    edx, 4          ; 1 shl 2
  6273 00003E02 740C                                    jz      short .no_xing_toc
  6274 00003E04 B964000000                              mov     ecx, 100
  6275 00003E09 BF[F8180100]                            mov     edi, mp3_xing_toc
  6276 00003E0E F3A4                                    rep movsb
  6277                                  
  6278                                  .no_xing_toc:
  6279 00003E10 F7C208000000                            test    edx, 8          ; 1 shl 3
  6280 00003E16 740B                                    jz      short .no_xing_vbr_scale
  6281 00003E18 AD                                      lodsd
  6282 00003E19 E882C4FFFF                              call    bswap_eax
  6283 00003E1E A3[5C190100]                            mov     [mp3_xing_vbr_scale], eax
  6284                                  
  6285                                  .no_xing_vbr_scale:
  6286 00003E23 C705[B8C20000]0000-                     mov	dword [mp3_bit_rate], 0
  6286 00003E2B 0000               
  6287 00003E2D A1[B0C20000]                            mov	eax, [mp3_sample_rate]
  6288 00003E32 C1E003                                  shl	eax, 3
  6289 00003E35 F725[F4180100]                          mul	dword [mp3_xing_filesize]
  6290 00003E3B 8B0D[F0180100]                          mov	ecx, [mp3_xing_frames]
  6291 00003E41 0FAF0D[9C190100]                        imul	ecx, [mp3_nb_granules]
  6292 00003E48 69C940020000                            imul	ecx, 576        ; 18*32
  6293 00003E4E 39CA                                    cmp	edx, ecx
  6294 00003E50 7307                                    jnb	short .overflow
  6295 00003E52 F7F1                                    div	ecx
  6296 00003E54 A3[B8C20000]                            mov	[mp3_bit_rate], eax
  6297                                  .overflow:
  6298 00003E59 C3                                      retn
  6299                                  
  6300                                  
  6301                                  ; =============== S U B R O U T I N E =======================================
  6302                                  
  6303                                  		; 16/02/2025
  6304                                  		; 20/10/2024
  6305                                  mp3_decode_frame:
  6306 00003E5A 890D[8C190100]                          mov     [mp3_src_remain], ecx
  6307 00003E60 893D[70190100]                          mov     [mp3_samples_dst], edi
  6308                                  	
  6309                                  		; 16/02/2025
  6310                                  .no_rdtsc_supported@@@@:
  6311 00003E66 E899C4FFFF                              call    mp3_search_get_header
  6312 00003E6B 0F8275010000                            jc      .error
  6313 00003E71 A1[98C20000]                            mov     eax, [mp3_src_frame_size]
  6314 00003E76 83F800                                  cmp     eax, 0
  6315 00003E79 0F8E67010000                            jle     .error
  6316 00003E7F 3B05[8C190100]                          cmp     eax, [mp3_src_remain]
  6317 00003E85 0F875B010000                            ja      .error
  6318 00003E8B 8935[88190100]                          mov     [mp3_bitstream_start], esi
  6319                                  		; 11/01/2025
  6320                                  		;mov	eax, 32
  6321                                  
  6322                                  .mp3mac_bitstream_set_position:
  6323                                  		; 22/10/2024
  6324                                                  ;mov    esi, [mp3_bitstream_start]
  6325                                                  ;mov    cl, al
  6326                                                  ;shr    eax, 3
  6327                                                  ;and    cl, 7
  6328                                                  ;mov	eax, 4
  6329                                                  ;add    esi, eax
  6330 00003E91 83C604                                  add     esi, 4
  6331 00003E94 E80FC4FFFF                              call    mp3_recollect_bits
  6332                                  
  6333                                  .mp3mac_get_n_bits:
  6334                                                  ;mov    eax, ebp        ; mp3_col32
  6335                                                  ;shl    ebp, cl
  6336                                                  ;rol    eax, cl
  6337                                                  ;xor    eax, ebp        ; mp3_col32
  6338                                                  ;sub    ch, cl          ; sub mp3_colNN,num
  6339                                                  ;jns    short .cont
  6340                                                  ;mov    cl, ch          ; mov cl,mp3_colNN
  6341                                                  ;add    ch, 16
  6342                                                  ;rol    ebp, cl         ; rol mp3_col32,cl
  6343                                                  ;mov    bp, [esi]       ; mov mp3_col16,word ptr [esi]
  6344                                                  ;add    esi, 2
  6345                                                  ;ror    bp, 8           ; endianess
  6346                                                  ;ror    ebp, cl         ; ror mp3_col32,cl
  6347                                  
  6348                                  .cont:
  6349 00003E99 E8FFC5FFFF                              call	mp3_bitstream_read_header_extra
  6350 00003E9E E847C7FFFF                              call	mp3_bitstream_read_granules
  6351 00003EA3 0F823D010000                            jc	.error
  6352 00003EA9 E84AC4FFFF                              call	mp3_uncollect_bits
  6353 00003EAE 8935[94C20000]                          mov	[mp3_src_data_location], esi
  6354 00003EB4 833D[70190100]00                        cmp	dword [mp3_samples_dst], 0
  6355 00003EBB 0F840E010000                            jz	.skip_decoding
  6356 00003EC1 E8B4CBFFFF                              call	mp3_bitstream_append_to_main_data_pool
  6357 00003EC6 833D[74190100]00                        cmp	dword [mp3_samples_output_size], 0
  6358 00003ECD 0F84FC000000                            jz	.skip_decoding
  6359                                  
  6360 00003ED3 C705[80190100]0000-                     mov	dword [mp3_curr_granule], 0
  6360 00003EDB 0000               
  6361 00003EDD BB[A0190100]                            mov	ebx, mp3_granules
  6362                                  
  6363                                  .body_granule_lop:
  6364 00003EE2 891D[D4510500]                          mov	[_@@granule_addr], ebx
  6365 00003EE8 C705[7C190100]0000-                     mov	dword [mp3_curr_channel], 0
  6365 00003EF0 0000               
  6366                                  
  6367                                  .body_channel_lop:
  6368 00003EF2 8B4304                                  mov     eax, [ebx+4]    ; [ebx+$mp3gr_part2_3_start]
  6369 00003EF5 8B35[88190100]                          mov     esi, [mp3_bitstream_start]
  6370 00003EFB 88C1                                    mov     cl, al          ; mp3mac_bitstream_set_position
  6371 00003EFD C1E803                                  shr     eax, 3
  6372 00003F00 80E107                                  and     cl, 7
  6373 00003F03 01C6                                    add     esi, eax
  6374 00003F05 E89EC3FFFF                              call    mp3_recollect_bits
  6375 00003F0A 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  6376 00003F0C D3E5                                    shl     ebp, cl
  6377 00003F0E D3C0                                    rol     eax, cl
  6378 00003F10 31E8                                    xor     eax, ebp
  6379 00003F12 28CD                                    sub     ch, cl
  6380 00003F14 7913                                    jns     short .cont@
  6381 00003F16 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  6382 00003F18 80C510                                  add     ch, 16
  6383 00003F1B D3C5                                    rol     ebp, cl
  6384 00003F1D 668B2E                                  mov     bp, [esi]
  6385 00003F20 83C602                                  add     esi, 2
  6386 00003F23 66C1CD08                                ror     bp, 8
  6387 00003F27 D3CD                                    ror     ebp, cl
  6388                                  
  6389                                  .cont@:
  6390 00003F29 E8B4CBFFFF                              call    mp3_bitstream_read_scalefacs
  6391 00003F2E E87ECDFFFF                              call    mp3_get_exponents_from_scale_factors
  6392 00003F33 E894CEFFFF                              call    mp3_huffman_decode ; reads up to $mp3gr_part2_3_end
  6393 00003F38 0F82A8000000                            jc      .error
  6394                                  
  6395                                  .body_channel_next:
  6396 00003F3E 81C340130000                            add	ebx, 4928       ; $mp3gr_entrysiz*2
  6397 00003F44 FF05[7C190100]                          inc	dword [mp3_curr_channel]
  6398 00003F4A A1[7C190100]                            mov	eax, [mp3_curr_channel]
  6399                                                  ; 16/02/2025
  6400 00003F4F 3B05[BCC20000]          		cmp	eax, [mp3_num_channels]
  6401 00003F55 729B                                    jb	short .body_channel_lop
  6402 00003F57 8B1D[D4510500]                          mov	ebx, [_@@granule_addr]
  6403                                  
  6404                                  .mp3mac_push_bitstream:
  6405 00003F5D 51                                      push	ecx
  6406 00003F5E 55                                      push	ebp
  6407 00003F5F 56                                      push	esi
  6408 00003F60 E836D3FFFF                              call	mp3_compute_stereo
  6409 00003F65 C705[7C190100]0000-                     mov	dword [mp3_curr_channel], 0
  6409 00003F6D 0000               
  6410                                  
  6411                                  .cast_channel_lop:
  6412 00003F6F E8A3D5FFFF                              call    mp3_reorder_block
  6413 00003F74 E80AD6FFFF                              call    mp3_compute_antialias
  6414 00003F79 E8C7DEFFFF                              call    mp3_compute_imdct
  6415 00003F7E 81C340130000                            add     ebx, 4928       ; $mp3gr_entrysiz*2
  6416 00003F84 FF05[7C190100]                          inc	dword [mp3_curr_channel]
  6417 00003F8A A1[7C190100]                            mov     eax, [mp3_curr_channel]
  6418                                                  ; 06/02/2025
  6419 00003F8F 3B05[BCC20000]          		cmp     eax, [mp3_num_channels]
  6420 00003F95 72D8                                    jc      short .cast_channel_lop
  6421                                  
  6422                                  .mp3mac_pop_bitstream:
  6423 00003F97 5E                                      pop	esi
  6424 00003F98 5D                                      pop	ebp
  6425 00003F99 59                                      pop	ecx
  6426 00003F9A 8B1D[D4510500]                          mov	ebx, [_@@granule_addr]
  6427 00003FA0 81C3A0090000                            add	ebx, 2464       ; $mp3gr_entrysiz
  6428 00003FA6 FF05[80190100]                          inc	dword [mp3_curr_granule]
  6429 00003FAC A1[80190100]                            mov	eax, [mp3_curr_granule]
  6430 00003FB1 3B05[9C190100]                          cmp	eax, [mp3_nb_granules]
  6431 00003FB7 0F8225FFFFFF                            jc	.body_granule_lop
  6432 00003FBD E836C3FFFF                              call	mp3_uncollect_bits
  6433 00003FC2 3B35[90C20000]                          cmp	esi, [main_data_pool_wr_ptr]
  6434 00003FC8 771C                                    ja	short .error
  6435                                                  ;call	dword [mp3_synth_filter_proc] ; synth maths
  6436                                  		; 16/02/2025
  6437 00003FCA E868F3FFFF              		call	mp3_synth_filter_proc
  6438                                  
  6439                                  .skip_decoding:
  6440 00003FCF A1[90190100]                            mov     eax, [mp3_extra_bytes]
  6441 00003FD4 0105[98C20000]                          add     [mp3_src_frame_size], eax
  6442 00003FDA A1[74190100]                            mov     eax, [mp3_samples_output_size]
  6443                                  		; 15/02/2025
  6444 00003FDF FF05[6C190100]                          inc     dword [mp3_num_frames_decoded]
  6445                                  .timelog_end:
  6446                                  		; 16/02/2025
  6447                                  .no_rdtsc_supported:
  6448                                                  ;clc
  6449 00003FE5 C3                                      retn
  6450                                  
  6451                                  .error:
  6452                                  		; 16/02/2025
  6453                                  		; 20/10/2024
  6454                                  .no_rdtsc_supported@:
  6455 00003FE6 A1[90190100]                            mov     eax, [mp3_extra_bytes]
  6456 00003FEB 0105[98C20000]                          add     [mp3_src_frame_size], eax
  6457 00003FF1 F9                                      stc
  6458 00003FF2 C3                                      retn
  6459                                  
  6460                                  
  6461                                  ; =============== S U B R O U T I N E =======================================
  6462                                  
  6463                                  		; 16/02/2025
  6464                                  		; 15/02/2025
  6465                                  mp3_init:
  6466 00003FF3 BF[90B20000]                            mov     edi, main_data_pool_start ; = mp3_context_start
  6467                                                  ;mov    ecx, 74916      ; (mp3_context_end-mp3_context_start)/4
  6468 00003FF8 B97F240100                              mov     ecx, (mp3_context_end-mp3_context_start)/4
  6469 00003FFD 31C0                                    xor     eax, eax        ; ERRIF @@len AND 03h
  6470 00003FFF F3AB                                    rep stosd               ; clear context
  6471 00004001 C705[90C20000]-                         mov	dword [main_data_pool_wr_ptr], main_data_pool_start
  6471 00004007 [90B20000]         
  6472 0000400B 833D[20A90000]00                        cmp     dword [mp3_initialized], 0
  6473 00004012 7537                                    jnz     short .already_initialized
  6474 00004014 E803F7FFFF                              call    mp3_integer_init_is_stereo_lsf
  6475 00004019 E85CF7FFFF                              call    mp3_integer_init_mdct_windows
  6476 0000401E E87FF7FFFF                              call    mp3_integer_init_table_4_3
  6477 00004023 E8D2F7FFFF                              call    mp3_integer_init_exponent
  6478 00004028 E85CF5FFFF                              call    mp3_any_init_synth_window
  6479 0000402D E80BF6FFFF                              call    mp3_any_init_band_indices
  6480 00004032 E830F6FFFF                              call    mp3_any_init_lsf_sf_expand
  6481 00004037 E879F6FFFF                              call    mp3_any_init_huff_tables
  6482 0000403C E8FEF8FFFF                              call    mp3_init_log_constants
  6483                                  		; 15/02/2025
  6484 00004041 C705[20A90000]0100-                     mov     dword [mp3_initialized], 1
  6484 00004049 0000               
  6485                                  
  6486                                  .already_initialized:
  6487                                  		; 17/02/2025
  6488                                  		; 16/02/2025
  6489                                  		;mov	dword [mp3_bytes_per_sample], 2
  6490                                  		; 15/02/2025
  6491 0000404B C3                                      retn
  6492                                  
  6493                                  
  6494                                  ; =============== S U B R O U T I N E =======================================
  6495                                  
  6496                                  		; 16/02/2025
  6497                                  mp3_check_1st_frame:
  6498 0000404C E8C4FAFFFF              		call	mp3_exclude_id3_and_tag
  6499 00004051 8B35[E0510500]          		mov	esi, [stream_pos]
  6500 00004057 8B0D[E4510500]          		mov	ecx, [bytes_left]
  6501 0000405D 31FF                    		xor	edi, edi
  6502 0000405F 31ED                    		xor	ebp, ebp
  6503 00004061 E8F4FDFFFF              		call	mp3_decode_frame
  6504 00004066 7206                    		jc	short .error
  6505 00004068 E82AFDFFFF              		call	mp3_check_xing_info
  6506                                  		
  6507                                  		; 16/02/2025
  6508 0000406D F8                      		clc
  6509                                  .error:
  6510 0000406E C3                      		retn
  6511                                  
  6512                                  ;.error:
  6513                                  		;stc
  6514                                  		;retn
  6515                                  
  6516                                  
  6517                                  ; =============== S U B R O U T I N E =======================================
  6518                                  
  6519                                  
  6520                                  mp3_plain_test_without_output:
  6521 0000406F 60                                      pusha
  6522 00004070 8B35[E0510500]                          mov     esi, [stream_pos]
  6523 00004076 8B0D[E4510500]                          mov     ecx, [bytes_left]
  6524 0000407C BF[00800500]                            mov     edi, sample_buffer
  6525 00004081 31ED                                    xor     ebp, ebp
  6526 00004083 E8D2FDFFFF                              call    mp3_decode_frame
  6527 00004088 61                                      popa
  6528 00004089 7218                                    jc      short .exit
  6529 0000408B A1[98C20000]                            mov     eax, [mp3_src_frame_size]
  6530 00004090 83F800                                  cmp     eax, 0
  6531 00004093 740E                                    jz      short .exit
  6532 00004095 0105[E0510500]                          add     [stream_pos], eax
  6533 0000409B 2905[E4510500]                          sub     [bytes_left], eax
  6534 000040A1 EBCC                                    jmp     short mp3_plain_test_without_output
  6535                                  .exit:
  6536 000040A3 C3                                      retn
  6537                                  
  6538                                  
  6539                                  ; =============== S U B R O U T I N E =======================================
  6540                                  
  6541                                  		; 20/10/2024
  6542                                  wrchr:
  6543                                  		; TRDOS 386 System Call
  6544                                  		; ebx = 2 -> write character onto STDOUT
  6545                                  		;push	ebx
  6546                                  		;push	ecx
  6547                                  		;push	eax
  6548 000040A4 60                      		pusha
  6549                                  		;;mov	dword [diskresult], 0
  6550                                  		sys	_stdio, 2, eax
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000040A5 BB02000000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 000040AA 89C1                <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000040AC B82E000000          <1>  mov eax, %1
   112                              <1> 
   113 000040B1 CD40                <1>  int 40h
  6551                                  		;jnc	short .ok ; if EOF, eax = 0
  6552                                  		;xor	eax, eax ; 0
  6553                                  ;.ok:
  6554                                  		;mov	[diskresult], eax ; written byte count
  6555 000040B3 61                      		popa
  6556                                  		;pop	eax
  6557                                  		;pop	ecx
  6558                                  		;pop	ebx
  6559 000040B4 C3                      		retn
  6560                                  
  6561                                  
  6562                                  ; =============== S U B R O U T I N E =======================================
  6563                                  
  6564                                  		; 14/02/2025 (mp3play6.s)
  6565                                  		; 01/02/2025 (mp3play4.s)
  6566                                  		; 21/10/2024 (mp3play1.s)
  6567                                  set_break:
  6568                                  		; set [u.break] -end of bss- address to
  6569                                  		; end_of_bss at first (mp3 file will be loaded
  6570                                  		; at the end of bss)
  6571                                  		; ([u.break] initially points to the end of PRG file
  6572                                  		; -code and data- except BSS section)
  6573                                  		;
  6574                                  		; TRDOS 386 system call
  6575                                  		; Set break address
  6576                                  		; ebx = new [u.break]
  6577                                  		;sys	_break, end_of_bss
  6578                                  		; eax = new break address (dword aligned)
  6579                                  
  6580                                  		; 10/01/2025
  6581                                  		sys	_break, 100000h ; end of 1st 1MB
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000040B5 BB00001000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000040BA B811000000          <1>  mov eax, %1
   112                              <1> 
   113 000040BF CD40                <1>  int 40h
  6582                                  
  6583 000040C1 A3[DC510500]                            mov	[stream_start], eax
  6584 000040C6 A3[E0510500]                            mov	[stream_pos], eax
  6585                                  
  6586 000040CB C3                      		retn
  6587                                  
  6588                                  
  6589                                  ; =============== S U B R O U T I N E =======================================
  6590                                  
  6591                                  		; 16/02/2025
  6592                                  		; 15/02/2025 (tmp3play.s)
  6593                                  		; 14/02/2025 (mp3play6.s)
  6594                                  		; 01/02/2025 (mp3play4.s)	
  6595                                  		; 20/10/2024 (mp3play1.s)
  6596                                  
  6597                                  open_and_mmap_the_file:
  6598                                  		; 21/10/2024
  6599                                  		; TRDOS 386 system call
  6600                                  		; Open File
  6601                                  		; ebx = pointer to filename
  6602                                  		; ecx = open mode, 0 = read
  6603                                  		; 15/02/2025
  6604                                               	sys	_open, mp3_file_name, 0
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000040CC BB[F05B0500]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 000040D1 B900000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000040D6 B805000000          <1>  mov eax, %1
   112                              <1> 
   113 000040DB CD40                <1>  int 40h
  6605 000040DD 7277                    		jc	short .not_found
  6606                                  
  6607 000040DF A3[D8510500]                            mov     [hFile], eax
  6608                                  
  6609                                                 	; get file size by using systell system call
  6610                                   		; (not applicable for TRDOS 386 Kernel v2.0.9 and earlier)
  6611                                  		; TRDOS 386 system call
  6612                                  		; Get current file (offset) pointer
  6613                                  		; ebx = file handle (file descriptor)
  6614                                  		; ecx = 0, offset
  6615                                  		; edx = 2, from the end of file
  6616                                  		;sys	_tell, eax, 0, 2
  6617                                                  ;mov     [mp3_file_size], eax
  6618                                  
  6619                                  		; *** get file size ***
  6620                                  		; TRDOS 386 system call
  6621                                  		; Set file (offset) pointer to file size 
  6622                                  		; (needed for TRDOS kernel v2.0.9 and earlier)
  6623                                  		; ebx = file handle (file descriptor)
  6624                                  		; ecx = 0, offset
  6625                                  		; edx = 2, from the end of file
  6626                                  		sys	_seek, eax, 0, 2
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000040E4 89C3                <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 000040E6 B900000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 000040EB BA02000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000040F0 B813000000          <1>  mov eax, %1
   112                              <1> 
   113 000040F5 CD40                <1>  int 40h
  6627                                  		; TRDOS 386 system call
  6628                                  		; Get current file (offset) pointer
  6629                                  		; (needed for TRDOS 386 kernel version 2.0.9 and earlier)
  6630 000040F7 31D2                    		xor	edx, edx ; 0
  6631                                  		; ecx = 0
  6632                                  		; ebx = file handle
  6633                                  		sys	_tell
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000040F9 B814000000          <1>  mov eax, %1
   112                              <1> 
   113 000040FE CD40                <1>  int 40h
  6634 00004100 A3[60190100]            		mov     [mp3_file_size], eax
  6635                                  
  6636                                  		; *** set file offset pointer to 0 again ***
  6637                                  		; TRDOS 386 system call
  6638                                  		; Set file (offset) pointer
  6639                                  		; ebx = file handle (file descriptor)
  6640                                  		; ecx = 0, offset
  6641                                  		; edx = 0, from the beginning/start of file
  6642 00004105 50                      		push	eax
  6643                                  		sys	_seek
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004106 B813000000          <1>  mov eax, %1
   112                              <1> 
   113 0000410B CD40                <1>  int 40h
  6644 0000410D 58                      		pop	eax
  6645                                  
  6646                                  		; now, set [u.break] address to the end of mp3 file
  6647                                  		; at memory -in BSS section-
  6648                                  		; (not necessary for TRDOS 386 PRG files)
  6649                                  		; (this system call will allocate user memory pages
  6650                                  		;  before sysread system call.. early)
  6651                                  		;add	eax, end_of_bss
  6652                                  		; 13/01/2025
  6653 0000410E 0500001000              		add	eax, 100000h ; + end of 1st 1MB
  6654                                  		; TRDOS 386 system call
  6655                                  		; Set break address
  6656                                  		; ebx = new [u.break]
  6657                                  		sys	_break, eax
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004113 89C3                <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004115 B811000000          <1>  mov eax, %1
   112                              <1> 
   113 0000411A CD40                <1>  int 40h
  6658                                  
  6659                                  		; TRDOS 386 system call
  6660                                  		; Read file
  6661                                  		; ebx = file handle (file descriptor)
  6662                                  		; ecx = buffer address
  6663                                  		; edx = byte count
  6664                                  		sys	_read, [hFile], [stream_start], [mp3_file_size]
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000411C 8B1D[D8510500]      <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00004122 8B0D[DC510500]      <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00004128 8B15[60190100]      <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000412E B803000000          <1>  mov eax, %1
   112                              <1> 
   113 00004133 CD40                <1>  int 40h
  6665 00004135 7204                    		jc	short .read_error
  6666 00004137 39D0                    		cmp	eax, edx
  6667 00004139 730E                    		jnb	short .ok
  6668                                  		;or	eax, eax
  6669                                  		;jnz	short .ok
  6670                                  .read_error:		
  6671                                  		; TRDOS 386 system call
  6672                                  		; Close file
  6673                                  		; ebx = file handle (file descriptor)
  6674                                  		;sys	_close, [hFile]
  6675                                  		sys	_close
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000413B B806000000          <1>  mov eax, %1
   112                              <1> 
   113 00004140 CD40                <1>  int 40h
  6676                                  
  6677                                  		; 16/02/2025
  6678 00004142 BE[60410000]            		mov	esi, txt_read_err
  6679 00004147 EB12                    		jmp	short .r_err_msg
  6680                                  .ok:
  6681 00004149 A3[E4510500]                            mov     [bytes_left], eax ; read count
  6682                                  		
  6683                                  		; 16/02/2025
  6684                                  		sys	_close
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000414E B806000000          <1>  mov eax, %1
   112                              <1> 
   113 00004153 CD40                <1>  int 40h
  6685 00004155 C3                      		retn
  6686                                  .not_found:
  6687                                  		; 16/02/2025
  6688 00004156 BE[0BB20000]                            mov     esi, txt_not_found ; ("Error: File not found !")
  6689                                  .r_err_msg:
  6690                                  		;call	print_err_msg
  6691                                  		;;stc
  6692                                  		;retn
  6693                                  		; 16/02/2025
  6694 0000415B E92D170000              		jmp	print_err_msg
  6695                                  
  6696                                  ; ---------------------------------------------------------------------------
  6697                                  
  6698                                  		; 16/02/2025
  6699                                  txt_read_err:
  6700 00004160 46696C652072656164-     		db 'File read error !', 0Dh, 0Ah, 0
  6700 00004169 206572726F7220210D-
  6700 00004172 0A00               
  6701                                  
  6702                                  
  6703                                  ; =============== E X I T ===================================================
  6704                                  
  6705                                  		; 25/01/2025
  6706                                  		; 20/10/2024
  6707                                  ExitProcess:
  6708 00004174 E809140000              		call	set_text_mode
  6709                                  ExitP@:
  6710 00004179 31DB                    		xor	ebx, ebx  ; mov ebx, 0  ; exit code
  6711                                  ExitProcess@:	; 13/01/2025
  6712                                  		sys	_exit
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000417B B801000000          <1>  mov eax, %1
   112                              <1> 
   113 00004180 CD40                <1>  int 40h
  6713                                  ;hang:
  6714                                  		;jmp	short hang
  6715                                  
  6716                                  
  6717                                  ; ---------------------------------------------------------------------------
  6718                                  ; TRDOS 386 Audio System Functions
  6719                                  ; ---------------------------------------------------------------------------
  6720                                  
  6721                                  ; =============== S U B R O U T I N E =======================================
  6722                                  
  6723                                  		; 10/01/2025
  6724                                  		; 20/10/2024
  6725                                  detect_enable_audio_device:
  6726                                  		; 24/01/2025
  6727                                  		;mov	word [max_frequency], 48000
  6728                                  		; 10/01/2025
  6729                                  		;mov	byte [blocks], 8
  6730                                  
  6731                                  		; check AC'97 hardware at first
  6732                                  		; (48kHz support)
  6733                                  		; TRDOS 386 system call
  6734                                  		; sysaudio
  6735                                  		; Detect (BH=1) AC'97 (BL=2) Audio Device
  6736                                  .ac97:
  6737                                          	sys	_audio, 0102h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004182 BB02010000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004187 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 0000418C CD40                <1>  int 40h
  6738 0000418E 7245                    		jc	short .sb16
  6739 00004190 C605[78B20000]02        		mov	byte [audio_hardware], 2 ; AC97
  6740                                  
  6741                                  		;;;;
  6742                                  		; 12/01/2025 (ref: playwav9.s, 18/12/2024)
  6743                                  		sys	_audio, 0E00h ; get audio controller info
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004197 BB000E0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000419C B820000000          <1>  mov eax, %1
   112                              <1> 
   113 000041A1 CD40                <1>  int 40h
  6744                                  		; EAX = IRQ Number in AL
  6745                                  		;	Audio Device Number in AH 
  6746                                  		; EBX = DEV/VENDOR ID
  6747                                  		;       (DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV)
  6748                                  		; ECX = BUS/DEV/FN 
  6749                                  		;       (00000000BBBBBBBBDDDDDFFF00000000)
  6750                                  		; EDX = NABMBAR/NAMBAR (for AC97)
  6751                                  		;      (Low word, DX = NAMBAR address)
  6752                                  		; EDX = Base IO Addr (DX) for SB16 & VT8233
  6753                                  
  6754 000041A3 891D[68B20000]          		mov	[dev_vendor], ebx
  6755 000041A9 890D[64B20000]          		mov	[bus_dev_fn], ecx
  6756                                  
  6757 000041AF 668915[6CB20000]                	mov     [NAMBAR], dx	; save audio mixer base addr
  6758                                  		;shr	edx, 16
  6759                                          	;mov    [NABMBAR], dx	; save bus master base addr
  6760 000041B6 8915[6CB20000]          		mov	dword [NAMBAR], edx
  6761                                  
  6762 000041BC A2[74B20000]            		mov	[ac97_int_ln_reg], al
  6763                                  		;;;;
  6764                                  		
  6765                                  		; TRDOS 386 system call
  6766                                  		; sysaudio
  6767                                  		; Get AC'97 Codec info
  6768                                  		; (Function 14, sub function 1)
  6769                                  		sys	_audio, 0E01h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000041C1 BB010E0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000041C6 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 000041CB CD40                <1>  int 40h
  6770                                  		; Save Variable Rate Audio support bit
  6771 000041CD 2401                    		and	al, 1
  6772 000041CF A2[79B20000]            		mov	[vra], al
  6773 000041D4 C3                      		retn
  6774                                  .sb16:
  6775                                  		; check Sound Blaster 16 card at second
  6776                                  		; (44100Hz support, but 24kHz will be used)
  6777                                  		; TRDOS 386 system call
  6778                                  		; sysaudio
  6779                                  		; Detect (BH=1) SB16 (BL=1) Audio Card
  6780                                          	sys	_audio, 0101h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000041D5 BB01010000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000041DA B820000000          <1>  mov eax, %1
   112                              <1> 
   113 000041DF CD40                <1>  int 40h
  6781 000041E1 721F                    		jc	short .vt8233
  6782 000041E3 C605[78B20000]01        		mov	byte [audio_hardware], 1 ; SB16
  6783                                  		; 24/01/2025
  6784                                  		;mov	word [max_frequency], 44100
  6785                                  		; 10/01/2025
  6786                                  		;;mov	byte [blocks], 7
  6787                                  		;dec	byte [blocks]
  6788                                  
  6789                                  		;;;;
  6790                                  		; 12/01/2025 (ref: sb16play.s, 20/12/2024)
  6791                                  		sys	_audio, 0E00h ; get audio controller info
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000041EA BB000E0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000041EF B820000000          <1>  mov eax, %1
   112                              <1> 
   113 000041F4 CD40                <1>  int 40h
  6792                                  	
  6793 000041F6 8915[70B20000]          		mov	[audio_io_base], edx
  6794 000041FC A2[74B20000]            		mov	[audio_intr], al
  6795                                  		;;;;
  6796                                  
  6797 00004201 C3                      		retn
  6798                                  .vt8233:
  6799                                  		; check VIA VT3237R (VT8233) hardware at third
  6800                                  		; (48kHz support)
  6801                                  		; TRDOS 386 system call
  6802                                  		; sysaudio
  6803                                  		; Detect (BH=1) VT8237R (BL=3) Audio Device
  6804                                  		sys	_audio, 0103h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004202 BB03010000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004207 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 0000420C CD40                <1>  int 40h
  6805 0000420E 7208                    		jc	short .hda
  6806 00004210 C605[78B20000]03        		mov	byte [audio_hardware], 3 ; VT8237R
  6807 00004217 C3                      		retn
  6808                                  .hda:	
  6809                                  		; check Intel HDA hardware at last
  6810                                  		; (48kHz support)
  6811                                  		; TRDOS 386 system call
  6812                                  		; sysaudio
  6813                                  		; Detect (BH=1) Intel HDA (BL=4) Audio Device
  6814                                  		sys	_audio, 0104h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004218 BB04010000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000421D B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004222 CD40                <1>  int 40h
  6815 00004224 7208                    		jc	short .err
  6816 00004226 C605[78B20000]04        		mov	byte [audio_hardware], 4 ; HDA
  6817 0000422D C3                      		retn
  6818                                  .err:
  6819                                  		; 16/02/2025
  6820 0000422E BE[38420000]            		mov	esi, txt_audio_nf_err
  6821                                  		;call	print_err_msg
  6822                                  		;;stc
  6823                                  		;retn
  6824 00004233 E955160000              		jmp	print_err_msg	
  6825                                  
  6826                                  ; ---------------------------------------------------------------------------
  6827                                  
  6828 00004238 50726F706572206175-     txt_audio_nf_err: db 'Proper audio hardware not found!',0Dh,0Ah,0
  6828 00004241 64696F206861726477-
  6828 0000424A 617265206E6F742066-
  6828 00004253 6F756E64210D0A00   
  6829                                  
  6830                                  
  6831                                  ; =============== CONSTANT ==================================================
  6832                                  
  6833                                  		; 21/10/2024
  6834                                  ;MP3_MAX_OUTPUT_SIZE equ 2*2*18*32*2
  6835                                      ; = 1200h = 4608 decimal = 2 channels, 2 granules, 18*32, 2 byte (16bit)
  6836                                  
  6837                                  
  6838                                  ; =============== S U B R O U T I N E =======================================
  6839                                  
  6840                                  		; 29/01/2025
  6841                                  		; 28/01/2025
  6842                                  		; 27/01/2025
  6843                                  		; 12/01/2025
  6844                                  audio_system_init:
  6845                                  		; 28/01/2025
  6846 0000425B A1[74190100]            		mov	eax, [mp3_samples_output_size]
  6847                                  
  6848                                  		; 29/01/2025
  6849 00004260 C605[7BB20000]01        		mov	byte [blocks], 1
  6850                                  		;
  6851 00004267 803D[78B20000]01        		cmp	byte [audio_hardware], 1
  6852 0000426E 750A                    		jne	short .bufaloc
  6853                                  
  6854                                  		;mov	eax, sample_buffer_size
  6855                                  		; 10/01/2025
  6856                                  		;mov	byte [blocks], 16
  6857                                  		; 12/01/2025
  6858                                  		;mov	byte [blocks], 8
  6859                                  		;;mov	eax, [mp3_samples_output_size]
  6860                                  		;shl	eax, 3 ; * 8
  6861                                  		;;shl	eax, 4 ; * 16
  6862                                  		
  6863                                  		; 29/01/2025
  6864 00004270 C025[7BB20000]02        		shl	byte [blocks], 2 ; 4
  6865 00004277 C1E002                  		shl	eax, 2 ; * 4
  6866                                  .asi@:		
  6867                                  		; 12/01/2025
  6868                                  		;cmp	eax, 65536
  6869                                  		;jna	short .asi@@
  6870                                  		;sub	eax, [mp3_samples_output_size]
  6871                                  		;dec	byte [blocks]
  6872                                  		;;;
  6873                                  		; 11/01/2025
  6874                                  		;test	byte [blocks], 1
  6875                                  		;jz	short .asi@
  6876                                  		;dec	byte [blocks] ; even number
  6877                                  		;sub	eax, [mp3_samples_output_size]
  6878                                  		;;;
  6879                                  		;jmp	short .asi@
  6880                                  .asi@@:
  6881                                  		; 29/01/2025
  6882                                  		;cmp	byte [audio_hardware], 1 ; SB16
  6883                                  		;jne	short .bufaloc
  6884                                  .bufaloc:
  6885                                  		; TRDOS 386 system call
  6886                                  		; sysaudio
  6887                                  		; Allocate audio buffer (for user)
  6888                                  		; ebx = 0200h (BH=2)
  6889                                  		; ecx = buffer size (in bytes)
  6890                                  		; edx = buffer address (virtual)
  6891 0000427A A3[7CB20000]            		mov	[buffer_size], eax
  6892                                  		sys	_audio, 0200h, eax, sample_buffer
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000427F BB00020000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00004284 89C1                <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00004286 BA[00800500]        <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000428B B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004290 CD40                <1>  int 40h
  6893 00004292 722E                    		jc	short .init_err
  6894                                  		
  6895                                  		; 12/01/2025
  6896                                  		; clear audio buffer (before playback)
  6897 00004294 BF[00800500]            		mov	edi, sample_buffer
  6898                                  		; ecx = buffer size in bytes
  6899 00004299 C1E902                  		shr	ecx, 2 ; double word
  6900 0000429C 31C0                    		xor	eax, eax
  6901 0000429E F3AB                    		rep	stosd
  6902                                  
  6903                                  		; TRDOS 386 system call
  6904                                  		; sysaudio
  6905                                  		; Initialize audio device (bh = 3)
  6906                                  		; bl = 01h -> CallBack method
  6907                                  		; edx = Callback service address (virtual)
  6908                                  		; ecx = 0 ; CL = srb value ; not used
  6909                                  		sys	_audio, 0301h, 0, audio_callback
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000042A0 BB01030000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 000042A5 B900000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 000042AA BA[F8420000]        <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000042AF B820000000          <1>  mov eax, %1
   112                              <1> 
   113 000042B4 CD40                <1>  int 40h
  6910                                  		; 12/01/2025
  6911                                  		; SRB method (faster than callback method)
  6912                                  		; bl = 0 -> Signal Response Byte method
  6913                                  		; cl = 1 -> SRB set value 
  6914                                  		;     (will be set by audio IRQ service of the kernel)
  6915                                  		; edx = SRB address -one byte data-
  6916                                  		;sys	_audio, 0300h, 1, srb	
  6917                                  		
  6918 000042B6 720A                    		jc	short .init_err
  6919                                  
  6920                                  		; 24/01/2025
  6921                                  		;retn
  6922                                  
  6923 000042B8 A0[B8B10000]            		mov	al, [volume_level]
  6924                                  		;call	SetMasterVolume@
  6925                                  		;retn
  6926 000042BD E9AE000000              		jmp	SetMasterVolume@
  6927                                  
  6928                                  .init_err:
  6929                                  init_error:	
  6930                                  		; 27/01/2025
  6931 000042C2 E8BB120000              		call	set_text_mode
  6932                                  
  6933                                  		; 16/02/2025
  6934 000042C7 BE[D1420000]            		mov	esi, txt_audio_init_err
  6935                                  		;call	print_err_msg
  6936                                  		;;stc
  6937                                  		;retn
  6938 000042CC E9BC150000              		jmp	print_err_msg
  6939                                  
  6940                                  ; ---------------------------------------------------------------------------
  6941                                  
  6942 000042D1 417564696F20686172-     txt_audio_init_err: db 'Audio hardware initialization error!',0Dh,0Ah,0
  6942 000042DA 647761726520696E69-
  6942 000042E3 7469616C697A617469-
  6942 000042EC 6F6E206572726F7221-
  6942 000042F5 0D0A00             
  6943                                  
  6944                                  
  6945                                  ; =============== S U B R O U T I N E =======================================
  6946                                  
  6947                                  		; 12/01/2025
  6948                                  		; 21/10/2024
  6949                                  audio_callback:
  6950                                  		; Operating system has directed CPU here because of
  6951                                  		; user (2nd) stage of the audio hardware interrupt service.
  6952                                  		; This procedure must be short and return to operating
  6953                                  		; system again via sysrelease system call
  6954                                  		; (or any system call here will be handled as sysrelease).
  6955                                  
  6956 000042F8 C605[7AB20000]01        		mov	byte [srb], 1
  6957                                  
  6958                                  		; 12/01/2025
  6959 000042FF E82E010000                              call	try_enqueue_all_blocks
  6960                                  .skip:
  6961                                  		sys	_rele ; return from callback service 
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004304 B827000000          <1>  mov eax, %1
   112                              <1> 
   113 00004309 CD40                <1>  int 40h
  6962                                  		
  6963                                  		; we must not come here !
  6964 0000430B BBFFFFFFFF              		mov	ebx, -1
  6965                                  		sys	_exit
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004310 B801000000          <1>  mov eax, %1
   112                              <1> 
   113 00004315 CD40                <1>  int 40h
  6966                                  		;jmp	short audio_callback
  6967                                  
  6968                                  
  6969                                  ; =============== S U B R O U T I N E =======================================
  6970                                  
  6971                                  		; 22/01/2025
  6972                                  audio_f_stop: 
  6973 00004317 C605[75B20000]02        		mov	byte [stopped], 2
  6974                                  
  6975                                  		; Stop playing
  6976                                  		sys	_audio, 0700h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000431E BB00070000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004323 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004328 CD40                <1>  int 40h
  6977                                  		; Cancel callback service (for user)
  6978                                  		sys	_audio, 0900h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000432A BB00090000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000432F B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004334 CD40                <1>  int 40h
  6979                                  		; Deallocate audio buffer (for user)
  6980                                  		sys	_audio, 0A00h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004336 BB000A0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000433B B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004340 CD40                <1>  int 40h
  6981 00004342 C3                      		retn
  6982                                  
  6983                                  		; 22/01/2025
  6984                                  audio_f_pause:
  6985 00004343 C605[75B20000]01        		mov	byte [stopped], 1 ; paused
  6986                                  
  6987                                  		sys	_audio, 0500h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000434A BB00050000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000434F B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004354 CD40                <1>  int 40h
  6988 00004356 C3                      		retn
  6989                                  
  6990                                  
  6991                                  		; 22/01/2025
  6992                                  audio_f_play:	; continue to play (after pause)
  6993                                  
  6994 00004357 C605[75B20000]00        		mov	byte [stopped], 0
  6995                                  	
  6996                                  		sys	_audio, 0600h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000435E BB00060000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004363 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004368 CD40                <1>  int 40h
  6997 0000436A C3                      		retn
  6998                                  
  6999                                  ; =============== S U B R O U T I N E =======================================
  7000                                  
  7001                                  	; 22/01/2025
  7002                                  SetMasterVolume:
  7003                                  	;cmp	al, 31
  7004                                  	;ja	short setvolume_ok
  7005 0000436B A2[B8B10000]            	mov	[volume_level], al  ; max = 0, min = 31
  7006                                  
  7007                                  	; 24/01/2025
  7008                                  SetMasterVolume@:
  7009 00004370 B41F                    	mov	ah, 31
  7010 00004372 28C4                    	sub	ah, al
  7011 00004374 88E0                    	mov	al, ah
  7012                                  
  7013                                  	; Set Master Volume Level (BL=0 or 80h)
  7014                                  	; 	for next playing (BL>=80h)
  7015                                  	;sys	_audio, 0B80h, eax
  7016                                  	sys	_audio, 0B00h, eax
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004376 BB000B0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 0000437B 89C1                <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000437D B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004382 CD40                <1>  int 40h
  7017                                  	
  7018                                  setvolume_ok:
  7019 00004384 C3                      	retn
  7020                                  
  7021                                  ; =============== S U B R O U T I N E =======================================
  7022                                  
  7023                                  		; 17/02/2025
  7024                                  		; 16/02/2025 (tmp3play.s)	
  7025                                  		; 13/02/2025 (mp3play6.s)
  7026                                  		; 26/01/2025
  7027                                  		; 23/01/2025
  7028                                  		; 22/01/2025
  7029                                  		; 13/01/2025
  7030                                  		; 12/01/2025
  7031                                  		; 10/01/2025
  7032                                  		; 21/10/2024
  7033                                  mp3_cast_to_speaker:
  7034                                  		; Start	to play
  7035                                  		; 17/02/2025
  7036                                  		;mov	eax, [mp3_bytes_per_sample]
  7037                                  		;;shr	al, 1 ; 8 -> 0, 16 -> 1
  7038                                  		;;shl	al, 1 ; 16 -> 2, 8 -> 0
  7039                                  		;and	al, 2 ; 22/10/2024
  7040                                  		; 16/02/2025
  7041 00004385 8B1D[BCC20000]          		mov	ebx, [mp3_num_channels]
  7042 0000438B 4B                      		dec	ebx
  7043                                  		;or	bl, al
  7044                                  		; 17/02/2025 ([mp3_bytes_per_sample] = 2)
  7045 0000438C 80CB02                  		or	bl, 2 ; 16bit
  7046 0000438F 8B0D[B0C20000]          		mov	ecx, [mp3_sample_rate]
  7047 00004395 B704                    		mov	bh, 4 ; start to play
  7048                                  
  7049                                  		; 13/01/2025
  7050                                  mp3_cast_to_speaker_@:
  7051 00004397 53                      		push	ebx
  7052 00004398 51                      		push	ecx
  7053                                  
  7054                                                  ; 12/01/2025
  7055                                  		;call	try_enqueue_all_blocks
  7056                                  	
  7057                                  		; 12/01/2025
  7058                                  		;cmp	dword [bytes_left],0
  7059                                  		;jz	short .playback
  7060                                  		
  7061                                  		; 12/01/2025
  7062                                  		; (here audio buffer -sample_buffer- is empty)
  7063                                  		; (clear dma half buffer 1)
  7064                                  		sys	_audio, 1001h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004399 BB01100000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000439E B820000000          <1>  mov eax, %1
   112                              <1> 
   113 000043A3 CD40                <1>  int 40h
  7065                                  		; (clear dma half buffer 2)
  7066                                  		;sys	_audio, 1002h
  7067                                  
  7068                                  		; TRDOS 386 system call
  7069                                  		; sysaudio
  7070                                  		; bh = 16 : update (current, first) dma half buffer
  7071                                  		; bl = 0  : then switch to the next (second) half buffer
  7072                                  		sys	_audio, 1000h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000043A5 BB00100000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000043AA B820000000          <1>  mov eax, %1
   112                              <1> 
   113 000043AF CD40                <1>  int 40h
  7073                                  
  7074                                  		; 12/01/2025
  7075                                  		; 22/10/2024
  7076                                  		;call	try_enqueue_all_blocks
  7077                                  .playback:
  7078 000043B1 59                      		pop	ecx ; sample rate (frequency)
  7079 000043B2 5B                      		pop	ebx ; play mode (bl)
  7080                                  
  7081                                  		; TRDOS 386 system call
  7082                                  		; sysaudio
  7083                                  		; bh = 4 -> start to play
  7084                                  		; bl = mode -> bit 0, 1 = stereo, 0 = mono
  7085                                  		;	       bit 1, 1 = 16 bit, 0 = 8 bit
  7086                                  		; cx = sample rate (hertz)
  7087                                  		sys	_audio
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000043B3 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 000043B8 CD40                <1>  int 40h
  7088                                  
  7089                                  		; 12/01/2025
  7090 000043BA C605[7AB20000]00        		mov	byte [srb], 0
  7091                                  		;;;
  7092                                  
  7093                                  .playback_lop:
  7094                                  		; 21/01/2025
  7095                                  		;;;; ---------------------
  7096 000043C1 803D[75B20000]00        		cmp	byte [stopped], 0
  7097 000043C8 7609                    		jna	short .pb_l_@
  7098 000043CA E808100000              		call	checkUpdateEvents
  7099 000043CF 7230                    		jc	short .playback_end
  7100                                  
  7101                                  		; 16/02/2025
  7102 000043D1 EBEE                    		jmp	short .playback_lop
  7103                                  .pb_l_@:
  7104                                  		;;;; ---------------------
  7105                                  
  7106 000043D3 31C0                    		xor	eax, eax
  7107 000043D5 3905[E4510500]          		cmp	[bytes_left], eax ; 0
  7108 000043DB 7508                    		jnz	short .playback_next
  7109                                  		; 22/10/2024
  7110 000043DD 3805[29A90000]          		cmp	byte [num_enqueued_frames], al ; 0
  7111 000043E3 741C                                    jz	short .playback_end
  7112                                  .playback_next:
  7113 000043E5 A2[29A90000]            		mov	[num_enqueued_frames], al ; 0
  7114 000043EA 803D[7AB20000]01        		cmp	byte [srb], 1	; audio interrupt status
  7115                                  		;jb	short .getchar
  7116                                  		; 21/01/2025
  7117 000043F1 7207                    		jb	short .pb_l_@@
  7118                                  
  7119                                  		;mov	byte [srb], 0	; reset
  7120 000043F3 A2[7AB20000]            		mov	[srb], al ; 0
  7121                                  
  7122                                  		; 12/01/2025
  7123                                  		;call	try_enqueue_all_blocks
  7124                                  
  7125                                  		; 16/02/2025
  7126 000043F8 EBC7                    		jmp	short .playback_lop
  7127                                  		
  7128                                  		; 21/01/2025
  7129                                  		;;;; ---------------------
  7130                                  .pb_l_@@:
  7131 000043FA E8D80F0000              		call	checkUpdateEvents
  7132                                  		;jc	short .playback_end
  7133                                  		;jmp	short .playback_lop
  7134                                  		; 16/02/2025
  7135 000043FF 73C0                    		jnc	short .playback_lop
  7136                                  
  7137                                  		;;;; ---------------------
  7138                                  
  7139                                  .playback_end:
  7140                                  		; 16/02/2025
  7141                                  
  7142                                  		; TRDOS 386 system call
  7143                                  		; sysaudio
  7144                                  		; Stop playing
  7145                                  		sys	_audio, 0700h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004401 BB00070000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004406 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 0000440B CD40                <1>  int 40h
  7146                                  		; Cancel callback service (for user)
  7147                                  		sys	_audio, 0900h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000440D BB00090000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004412 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004417 CD40                <1>  int 40h
  7148                                  		; Deallocate audio buffer (for user)
  7149                                  		sys	_audio, 0A00h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004419 BB000A0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000441E B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004423 CD40                <1>  int 40h
  7150                                  		; Disable audio device
  7151                                  		sys	_audio, 0C00h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004425 BB000C0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000442A B820000000          <1>  mov eax, %1
   112                              <1> 
   113 0000442F CD40                <1>  int 40h
  7152 00004431 C3                      		retn
  7153                                  
  7154                                  
  7155                                  ; =============== S U B R O U T I N E =======================================
  7156                                  
  7157                                  		; 29/01/2025
  7158                                  		; 23/01/2025
  7159                                  		; 13/01/2025
  7160                                  		; 12/01/2025
  7161                                  		; 09/01/2025
  7162                                  		; 21/10/2024
  7163                                  try_enqueue_all_blocks:
  7164                                  		; 12/01/2025
  7165 00004432 60                      		pusha
  7166 00004433 BF[00800500]             		mov	edi, sample_buffer
  7167                                  		; 10/01/2025
  7168                                  		;jmp	short .first_block
  7169                                  		; 13/01/2025
  7170 00004438 EB15                    		jmp	short try_enqueue_all_blocks_@
  7171                                  ;.next_block:
  7172                                  teab_next_block:
  7173 0000443A 833D[E4510500]00                        cmp	dword [bytes_left], 0
  7174                                                  ;jle	short .enqueue_done
  7175                                  		; 13/01/2025
  7176 00004441 7E54                    		jle	short teab_enqueue_done
  7177                                  		;
  7178 00004443 8B3D[70190100]          		mov	edi, [mp3_samples_dst]
  7179 00004449 033D[74190100]          		add	edi, [mp3_samples_output_size]
  7180                                  
  7181                                  try_enqueue_all_blocks_@:
  7182                                  ;.first_block:
  7183                                  		;pusha
  7184 0000444F 8B35[E0510500]          		mov	esi, [stream_pos]
  7185 00004455 8B0D[E4510500]          		mov	ecx, [bytes_left]
  7186 0000445B 31ED                    		xor	ebp, ebp
  7187 0000445D E8F8F9FFFF              		call	mp3_decode_frame
  7188                                  		;popa
  7189                                  		;;jc	short .enqueue_done
  7190                                  		; 23/01/2025 (ignore error) -forward/backward-
  7191                                  		; 13/01/2025
  7192                                  		;jc	short teab_enqueue_done
  7193 00004462 A1[98C20000]            		mov	eax, [mp3_src_frame_size]
  7194 00004467 83F800                  		cmp	eax, 0
  7195                                  		;jz	short .enqueue_done
  7196                                  		; 13/01/2025
  7197 0000446A 742B                    		jz	short teab_enqueue_done
  7198 0000446C 0105[E0510500]          		add	[stream_pos], eax
  7199 00004472 2905[E4510500]          		sub	[bytes_left], eax
  7200 00004478 A1[74190100]            		mov	eax, [mp3_samples_output_size]
  7201 0000447D 83F800                  		cmp	eax, 0
  7202                                  		;jz	short .next_block
  7203                                  		; 13/01/2025
  7204 00004480 74B8                    		jz	short teab_next_block
  7205                                  ;.no_error:
  7206 00004482 FE05[29A90000]          		inc	byte [num_enqueued_frames]
  7207                                  		;
  7208 00004488 A0[29A90000]            		mov	al, [num_enqueued_frames]
  7209 0000448D 3A05[7BB20000]          		cmp	al, [blocks]
  7210                                  		;jb	short .next_block
  7211                                  		; 13/01/2025
  7212 00004493 72A5                    		jb	short teab_next_block
  7213                                  teab_rtn:
  7214                                  ;.rtn:
  7215                                  		; 12/01/2025
  7216 00004495 61                      		popa
  7217 00004496 C3                      		retn
  7218                                  ;.enqueue_done:
  7219                                  teab_enqueue_done:
  7220 00004497 C705[E4510500]0000-                     mov	dword [bytes_left], 0
  7220 0000449F 0000               
  7221                                  		; 12/01/2025
  7222                                  		;jmp	short .rtn
  7223                                  		; 13/01/2025
  7224 000044A1 EBF2                    		jmp	short teab_rtn
  7225                                  
  7226                                  ; ---------------------------------------------------------------------------
  7227                                  ; 13/01/2025 - Interpolation procedures for non-VRA AC97 codecs
  7228                                  ; ---------------------------------------------------------------------------
  7229                                  
  7230                                  ; =============== S U B R O U T I N E =======================================
  7231                                  		
  7232                                  		; 18/02/2025
  7233                                  		; 17/02/2025
  7234                                  		; 16/02/2025
  7235                                  		; 30/01/2025
  7236                                  		; 27/01/2025
  7237                                  		; 26/01/2025
  7238                                  		; 15/01/2025
  7239                                  		; 14/01/2025
  7240                                  		; 13/01/2025
  7241                                  audio_system_init_x:
  7242 000044A3 8B0D[74190100]          		mov	ecx, [mp3_samples_output_size]
  7243                                  		;;;
  7244                                  		; 15/01/2025
  7245 000044A9 89C8                    		mov	eax, ecx
  7246                                  		;mov	[loadsize], ecx
  7247                                  		;;;
  7248                                  		; 15/01/2025
  7249                                  		;shl	ecx, 3 ; * 8 ; 8 blocks
  7250                                  		; 14/01/2025
  7251                                  		;mov	byte [blocks], 8
  7252                                  
  7253 000044AB 803D[8CB20000]02        		cmp	byte [interpolation], 2
  7254 000044B2 731F                    		jnb	short .chk_sample_rate	; interpolation needed
  7255                                  
  7256                                  		; 48 kHZ with 16 bit stereo conversion
  7257                                  		;
  7258                                  		; selected output is
  7259                                  		;	 8bit stereo or 16bit mono or 8bit mono
  7260                                  		; (but AC97 hardware needs 16bit stereo samples)
  7261                                  	
  7262                                  		; 15/01/2025
  7263                                  		;mov	eax, ecx
  7264 000044B4 D1E0                    		shl	eax, 1 ; * 2 (mono to stereo)
  7265                                  
  7266                                  		; 18/02/2025
  7267                                  		; 17/02/2025
  7268 000044B6 BB[4A470000]            		mov	ebx, convert_to_stereo
  7269                                  		
  7270                                  		; 17/02/2025
  7271                                  		;cmp	byte [mp3_bytes_per_sample], 2
  7272                                  		;je	short .set_sizes ; 16bit mono
  7273 000044BB EB00                    		jmp	.set_sizes
  7274                                  
  7275                                  		; 17/02/2025
  7276                                  		; [mp3_bytes_per_sample] = 2
  7277                                  		; 16bit mono or 16bit stereo 
  7278                                  		; (but 16bit stereo does not need conversion here)
  7279                                  
  7280                                  		;; 8bit output (16bit conversion is neeed)
  7281                                  		;mov	ebx, convert_to_16bit
  7282                                  		;; 16/02/2025
  7283                                  		;cmp	byte [mp3_num_channels], 2
  7284                                  		;je	short .set_sizes ; 8bit stereo
  7285                                  		;; 8bit mono output
  7286                                  		;;shr	ecx, 1 ; / 2 ; 4 blocks
  7287                                  		;; 14/01/2025
  7288                                  		;shl	eax, 1
  7289                                  		;; 14/01/2025
  7290                                  		;;shr	byte [blocks], 1
  7291                                  		;mov	ebx, convert_to_stereo_16bit
  7292                                  .set_sizes:
  7293                                  .set_sizes_@:
  7294                                  		; 18/02/2025
  7295 000044BD 891D[84B20000]          		mov	[conversion], ebx
  7296 000044C3 890D[88B20000]          		mov	[loadsize], ecx
  7297                                  		;;;
  7298                                  		; 14/01/2025
  7299                                  		; align to 16bit stereo (if there is a defect)
  7300                                  		; 15/01/2025
  7301                                  		;and	al, ~3
  7302 000044C9 A3[7CB20000]            		mov	[buffer_size], eax
  7303 000044CE E981010000              		jmp	.asix_@
  7304                                  		; 13/01/2025
  7305                                  		; ----------------------------
  7306                                  		; ref: playwav9.s - 18/12/2024
  7307                                  .chk_sample_rate:
  7308                                  		; set interpolation parameters
  7309                                  		; (for 8, 11.025, 16, 22.050, 24, 32, 44.1 kHZ)
  7310                                  		; 16/02/2025
  7311 000044D3 A1[B0C20000]            		mov	eax, [mp3_sample_rate]
  7312                                  		; ecx = 8 * [mp3_samples_output_size] ; 8 blocks
  7313                                  .chk_44khz:
  7314 000044D8 3D44AC0000              		cmp	eax, 44100
  7315 000044DD 7527                    		jne	short .chk_32khz
  7316                                  		; 30/01/2025
  7317 000044DF B819000000              		mov	eax, 25 ; *
  7318                                  		; 17/02/2025
  7319                                  		;cmp	byte [mp3_bytes_per_sample], 1
  7320                                  		;jna	short .chk_44khz_1
  7321 000044E4 BB[914D0000]            		mov	ebx, load_44khz_stereo_16_bit
  7322                                  		; 16/02/2025
  7323 000044E9 803D[BCC20000]01        		cmp	byte [mp3_num_channels], 1
  7324 000044F0 7509                    		jne	short .chk_44khz_2
  7325 000044F2 BB[454D0000]            		mov	ebx, load_44khz_mono_16_bit
  7326                                  		;jmp	short .chk_44khz_2
  7327                                  		; 30/01/2025
  7328 000044F7 EB00                    		jmp	short .chk_44khz_3
  7329                                  .chk_44khz_1:
  7330                                  		; 17/02/2025
  7331                                  		; 	[mp3_bytes_per_sample] = 2
  7332                                  		;; 30/01/2025
  7333                                  		;shl	eax, 1
  7334                                  		;mov	ebx, load_44khz_stereo_8_bit
  7335                                  		;; 16/02/2025
  7336                                  		;cmp	byte [mp3_num_channels], 1
  7337                                  		;jne	short .chk_44khz_2
  7338                                  		;mov	ebx, load_44khz_mono_8_bit
  7339                                  .chk_44khz_3:
  7340                                  		; 30/01/2025
  7341 000044F9 D1E0                    		shl	eax, 1
  7342                                  .chk_44khz_2:
  7343                                  		; 48000/44100 == 25/23
  7344 000044FB BD17000000              		mov	ebp, 23
  7345                                  		;mov	eax, 25 ; *
  7346 00004500 F7E1                    		mul	ecx  ; load (decoding buffer) size
  7347 00004502 F7F5                    		div	ebp
  7348                                  		;; eax = wav output buffer size
  7349                                  		; 15/01/2025
  7350                                  		; eax = 1 block output (converted) size
  7351 00004504 EBB7                    		jmp	short .set_sizes
  7352                                  
  7353                                  		; 15/01/2025
  7354                                  ;		;;;
  7355                                  ;		; 14/01/2025
  7356                                  ;.set_sizes_@:
  7357                                  ;		cmp	ecx, 4608
  7358                                  ;		;ja	short .set_sizes
  7359                                  ;		; 15/01/2025
  7360                                  ;		jnb	short .set_sizes
  7361                                  ;		;shl	ecx, 1
  7362                                  ;		; ecx = [mp3_samples_output_size]
  7363                                  ;		shl	byte [blocks], 1
  7364                                  ;		; 15/01/2025
  7365                                  ;		;shl	eax, 1
  7366                                  ;		;jmp	short .set_sizes_@
  7367                                  ;		jmp	.set_sizes
  7368                                  		;;;
  7369                                  .chk_32khz:
  7370 00004506 3D007D0000              		cmp	eax, 32000
  7371 0000450B 7522                    		jne	short .chk_24khz
  7372                                  		; 30/01/2025
  7373 0000450D B803000000              		mov	eax, 3 ; *
  7374                                  		; 17/02/2025
  7375                                  		;cmp	byte [mp3_bytes_per_sample], 1
  7376                                  		;jna	short .chk_32khz_1
  7377 00004512 BB[274B0000]            		mov	ebx, load_32khz_stereo_16_bit
  7378                                  		; 16/02/2025
  7379 00004517 803D[BCC20000]01        		cmp	byte [mp3_num_channels], 1
  7380 0000451E 7509                    		jne	short .chk_32khz_2
  7381 00004520 BB[E74A0000]            		mov	ebx, load_32khz_mono_16_bit
  7382                                  		;jmp	short .chk_32khz_2
  7383                                  		; 30/01/2025
  7384 00004525 EB00                    		jmp	short .chk_32khz_3
  7385                                  .chk_32khz_1:
  7386                                  		; 17/02/2025
  7387                                  		;	[mp3_bytes_per_sample] = 2
  7388                                  		;; 30/01/2025
  7389                                  		;shl	eax, 1
  7390                                  		;mov	ebx, load_32khz_stereo_8_bit
  7391                                  		;; 16/02/2025
  7392                                  		;cmp	byte [mp3_num_channels], 1
  7393                                  		;jne	short .chk_32khz_2
  7394                                  		;mov	ebx, load_32khz_mono_8_bit
  7395                                  .chk_32khz_3:
  7396                                  		; 30/01/2025
  7397 00004527 D1E0                    		shl	eax, 1
  7398                                  .chk_32khz_2:
  7399                                  		; 48000/32000 = 3/2
  7400                                  		;mov	eax, 3 ; *
  7401 00004529 F7E1                    		mul	ecx 	; *3
  7402                                  		;mov	eax, ecx
  7403                                  		;add	eax, eax
  7404                                  		;add	eax, ecx
  7405 0000452B D1E8                    		shr	eax, 1  ; /2
  7406 0000452D EB8E                    		jmp	.set_sizes
  7407                                  .chk_24khz:
  7408 0000452F 3DC05D0000              		cmp	eax, 24000
  7409 00004534 7520                    		jne	short .chk_22khz
  7410                                  		; 30/01/2025
  7411 00004536 89C8                    		mov	eax, ecx ; *
  7412                                  		; 17/02/2025
  7413                                  		;cmp	byte [mp3_bytes_per_sample], 1
  7414                                  		;jna	short .chk_24khz_1
  7415                                  		; 14/01/2025 
  7416                                  		; bx -> ebx
  7417                                  		; (BugFix, 'playwav9.s' has a bug here) 
  7418 00004538 BB[854A0000]            		mov	ebx, load_24khz_stereo_16_bit
  7419                                  		; 16/02/2025
  7420 0000453D 803D[BCC20000]01        		cmp	byte [mp3_num_channels], 1
  7421 00004544 7509                    		jne	short .chk_24khz_2
  7422 00004546 BB[494A0000]            		mov	ebx, load_24khz_mono_16_bit
  7423                                  		;jmp	short .chk_24khz_2
  7424                                  		; 30/01/2025
  7425 0000454B EB00                    		jmp	short .chk_24khz_3
  7426                                  .chk_24khz_1:
  7427                                  		; 17/02/2025
  7428                                  		;	[mp3_bytes_per_sample] = 2
  7429                                  		;; 30/01/2025
  7430                                  		;shl	eax, 1
  7431                                  		;mov	ebx, load_24khz_stereo_8_bit
  7432                                  		;; 16/02/2025
  7433                                  		;cmp	byte [mp3_num_channels], 1
  7434                                  		;jne	short .chk_24khz_2
  7435                                  		;mov	ebx, load_24khz_mono_8_bit
  7436                                  .chk_24khz_3:
  7437                                  		; 30/01/2025
  7438 0000454D D1E0                    		shl	eax, 1
  7439                                  .chk_24khz_2:
  7440                                  		; 48000/24000 = 2/1
  7441                                  		;mov	eax, ecx ; *
  7442 0000454F D1E0                    		shl	eax, 1
  7443 00004551 E967FFFFFF              		jmp	.set_sizes_@
  7444                                  .chk_22khz:
  7445 00004556 3D22560000              		cmp	eax, 22050
  7446 0000455B 752A                    		jne	short .chk_16khz
  7447                                  		; 30/01/2025
  7448 0000455D B825000000              		mov	eax, 37 ; *
  7449                                  		; 17/02/2025
  7450                                  		;cmp	byte [mp3_bytes_per_sample], 1
  7451                                  		;jna	short .chk_22khz_1
  7452 00004562 BB[F54B0000]            		mov	ebx, load_22khz_stereo_16_bit
  7453                                  		; 16/02/2025
  7454 00004567 803D[BCC20000]01        		cmp	byte [mp3_num_channels], 1
  7455 0000456E 7509                    		jne	short .chk_22khz_2
  7456 00004570 BB[924B0000]            		mov	ebx, load_22khz_mono_16_bit
  7457                                  		;jmp	short .chk_22khz_2
  7458                                  		; 30/01/2025
  7459 00004575 EB00                    		jmp	short .chk_22khz_3
  7460                                  .chk_22khz_1:
  7461                                  		; 17/02/2025
  7462                                  		;	[mp3_bytes_per_sample] = 2
  7463                                  		;; 30/01/2025
  7464                                  		;shl	eax, 1
  7465                                  		;mov	ebx, load_22khz_stereo_8_bit
  7466                                  		;; 16/02/2025
  7467                                  		;cmp	byte [mp3_num_channels], 1
  7468                                  		;jne	short .chk_22khz_2
  7469                                  		;mov	ebx, load_22khz_mono_8_bit
  7470                                  .chk_22khz_3:
  7471                                  		; 30/01/2025
  7472 00004577 D1E0                    		shl	eax, 1
  7473                                  .chk_22khz_2:
  7474                                  		; 48000/22050 == 37/17
  7475 00004579 BD11000000              		mov	ebp, 17
  7476                                  		;mov	eax, 37 ; *
  7477 0000457E F7E1                    		mul	ecx  ; load (decoding buffer) size
  7478 00004580 F7F5                    		div	ebp
  7479                                  		;; eax = wav output buffer size
  7480                                  		; 15/01/2025
  7481                                  		; eax = 1 block output (converted) size
  7482 00004582 E936FFFFFF              		jmp	.set_sizes_@
  7483                                  .chk_16khz:
  7484 00004587 3D803E0000              		cmp	eax, 16000
  7485 0000458C 7522                    		jne	short .chk_11khz
  7486                                  		; 30/01/2025
  7487 0000458E 89C8                    		mov	eax, ecx ; *
  7488 00004590 D1E0                    		shl	eax, 1
  7489 00004592 01C8                    		add	eax, ecx
  7490                                  		; 17/02/2025
  7491                                  		;cmp	byte [mp3_bytes_per_sample], 1
  7492                                  		;jna	short .chk_16khz_1
  7493 00004594 BB[98490000]            		mov	ebx, load_16khz_stereo_16_bit
  7494                                  		; 16/02/2025
  7495 00004599 803D[BCC20000]01        		cmp	byte [mp3_num_channels], 1
  7496 000045A0 7509                    		jne	short .chk_16khz_2
  7497 000045A2 BB[41490000]            		mov	ebx, load_16khz_mono_16_bit
  7498                                  		;jmp	short .chk_16khz_2
  7499                                  		; 30/01/2025
  7500 000045A7 EB00                    		jmp	short .chk_16khz_3
  7501                                  .chk_16khz_1:
  7502                                  		; 17/02/2025
  7503                                  		;	[mp3_bytes_per_sample] = 2
  7504                                  		;; 30/01/2025
  7505                                  		;shl	eax, 1
  7506                                  		;mov	ebx, load_16khz_stereo_8_bit
  7507                                  		;; 16/02/2025
  7508                                  		;cmp	byte [mp3_num_channels], 1
  7509                                  		;jne	short .chk_16khz_2
  7510                                  		;mov	ebx, load_16khz_mono_8_bit
  7511                                  .chk_16khz_3:
  7512                                  		; 30/01/2025
  7513 000045A9 D1E0                    		shl	eax, 1
  7514                                  .chk_16khz_2:
  7515                                  		; 48000/16000 = 3/1
  7516                                  		;mov	eax, ecx ; *
  7517                                  		;shl	eax, 1
  7518                                  		;;add	eax, eax
  7519                                  		;add	eax, ecx
  7520 000045AB E90DFFFFFF              		jmp	.set_sizes_@
  7521                                  .chk_11khz:
  7522 000045B0 3D112B0000              		cmp	eax, 11025
  7523 000045B5 752A                    		jne	short .chk_8khz
  7524                                  		; 30/01/2025
  7525 000045B7 B84A000000              		mov	eax, 74
  7526                                  		; 17/02/2025
  7527                                  		;cmp	byte [mp3_bytes_per_sample], 1
  7528                                  		;jna	short .chk_11khz_1
  7529 000045BC BB[D54C0000]            		mov	ebx, load_11khz_stereo_16_bit
  7530                                  		; 16/02/2025
  7531 000045C1 803D[BCC20000]01        		cmp	byte [mp3_num_channels], 1
  7532 000045C8 7509                    		jne	short .chk_11khz_2
  7533 000045CA BB[814C0000]            		mov	ebx, load_11khz_mono_16_bit
  7534                                  		;jmp	short .chk_11khz_2
  7535                                  		; 30/01/2025
  7536 000045CF EB00                    		jmp	short .chk_11khz_3
  7537                                  .chk_11khz_1:
  7538                                  		; 17/02/2025
  7539                                  		;	[mp3_bytes_per_sample] = 2
  7540                                  		;; 30/01/2025
  7541                                  		;shl	eax, 1
  7542                                  		;mov	ebx, load_11khz_stereo_8_bit
  7543                                  		;; 16/02/2025
  7544                                  		;cmp	byte [mp3_num_channels], 1
  7545                                  		;jne	short .chk_11khz_2
  7546                                  		;mov	ebx, load_11khz_mono_8_bit
  7547                                  .chk_11khz_3:
  7548                                  		; 30/01/2025
  7549 000045D1 D1E0                    		shl	eax, 1
  7550                                  .chk_11khz_2:
  7551                                  		; 48000/11025 == 74/17
  7552                                  		; 14/01/2025
  7553                                  		;shr	ecx, 1	; 4 blocks
  7554                                  		;shr	byte [blocks], 1
  7555 000045D3 BD11000000              		mov	ebp, 17
  7556                                  		;mov	eax, 74 ; *
  7557 000045D8 F7E1                    		mul	ecx  ; load (decoding buffer) size
  7558 000045DA F7F5                    		div	ebp
  7559                                  		;; eax = wav output buffer size
  7560                                  		; 15/01/2025
  7561                                  		; eax = 1 block output (converted) size
  7562 000045DC E9DCFEFFFF              		jmp	.set_sizes_@
  7563                                  .chk_8khz:
  7564 000045E1 3D401F0000              		cmp	eax, 8000
  7565                                  		;jne	short .vra_needed
  7566                                  		; 01/02/2025
  7567 000045E6 7523                    		jne	short .chk_12khz
  7568                                  		; 30/01/2025
  7569 000045E8 B806000000              		mov	eax, 6 ; *
  7570                                  		; 17/02/2025
  7571                                  		;cmp	byte [mp3_bytes_per_sample], 1
  7572                                  		;jna	short .chk_8khz_1
  7573 000045ED BB[1B480000]            		mov	ebx, load_8khz_stereo_16_bit
  7574                                  		; 16/02/2025
  7575 000045F2 803D[BCC20000]01        		cmp	byte [mp3_num_channels], 1
  7576 000045F9 7509                    		jne	short .chk_8khz_2
  7577 000045FB BB[79470000]            		mov	ebx, load_8khz_mono_16_bit
  7578                                  		;jmp	short .chk_8khz_2
  7579                                  		; 30/01/2025
  7580 00004600 EB00                    		jmp	short .chk_8khz_3
  7581                                  .chk_8khz_1:
  7582                                  		; 17/02/2025
  7583                                  		;	[mp3_bytes_per_sample] = 2
  7584                                  		;; 30/01/2025
  7585                                  		;shl	eax, 1
  7586                                  		;mov	ebx, load_8khz_stereo_8_bit
  7587                                  		;; 16/02/2025
  7588                                  		;cmp	byte [mp3_num_channels], 1
  7589                                  		;jne	short .chk_8khz_2
  7590                                  		;mov	ebx, load_8khz_mono_8_bit
  7591                                  .chk_8khz_3:
  7592                                  		; 30/01/2025
  7593 00004602 D1E0                    		shl	eax, 1
  7594                                  .chk_8khz_2:
  7595                                  		;mov	eax, 6 ; *
  7596 00004604 F7E1                    		mul	ecx
  7597 00004606 E9B2FEFFFF              		jmp	.set_sizes_@
  7598                                  
  7599                                  		;;;;
  7600                                  		; 01/02/2025
  7601                                  .chk_12khz:
  7602 0000460B 3DE02E0000              		cmp	eax, 12000
  7603 00004610 7521                    		jne	short .vra_needed
  7604 00004612 89C8                    		mov	eax, ecx ; *
  7605                                  		; 17/02/2025
  7606                                  		;cmp	byte [mp3_bytes_per_sample], 1
  7607                                  		;jna	short .chk_12khz_1
  7608 00004614 BB[2F4E0000]            		mov	ebx, load_12khz_stereo_16_bit
  7609                                  		; 16/02/2025
  7610 00004619 803D[BCC20000]01        		cmp	byte [mp3_num_channels], 1
  7611 00004620 7509                    		jne	short .chk_12khz_2
  7612 00004622 BB[054E0000]            		mov	ebx, load_12khz_mono_16_bit
  7613 00004627 EB00                    		jmp	short .chk_12khz_3
  7614                                  .chk_12khz_1:
  7615                                  		; 17/02/2025
  7616                                  		;	[mp3_bytes_per_sample] = 2
  7617                                  		;; 01/02/2025
  7618                                  		;shl	eax, 1
  7619                                  		;mov	ebx, load_12khz_stereo_8_bit
  7620                                  		;; 16/02/2025
  7621                                  		;cmp	byte [mp3_num_channels], 1
  7622                                  		;jne	short .chk_12khz_2
  7623                                  		;mov	ebx, load_12khz_mono_8_bit
  7624                                  .chk_12khz_3:
  7625 00004629 D1E0                    		shl	eax, 1
  7626                                  .chk_12khz_2:
  7627                                  		; 48000/12000 = 4/1
  7628                                  		;mov	eax, ecx ; *
  7629 0000462B C1E002                  		shl	eax, 2
  7630 0000462E E98AFEFFFF              		jmp	.set_sizes_@
  7631                                  		;;;;
  7632                                  
  7633                                  .vra_needed:
  7634 00004633 58                      		pop	eax ; discard return address to the caller
  7635                                  .vra_err:
  7636                                  		; 27/01/2025
  7637 00004634 E8490F0000              		call	set_text_mode
  7638                                  		;
  7639                                  		sys	_msg, msg_no_vra, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004639 BB[9E530000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 0000463E B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00004643 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004648 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000464D CD40                <1>  int 40h
  7640                                  		;jmp	ExitProcess
  7641                                  		; 27/01/2025
  7642 0000464F E927FBFFFF              		jmp	ExitProcess@
  7643                                  
  7644                                  .asix_@:
  7645                                  		; TRDOS 386 system call
  7646                                  		; sysaudio
  7647                                  		; Allocate audio buffer (for user)
  7648                                  		; ebx = 0200h (BH=2)
  7649                                  		; ecx = buffer size (in bytes)
  7650                                  		; edx = buffer address (virtual)
  7651                                  
  7652                                  		sys	_audio, 0200h, [buffer_size], sample_buffer
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004654 BB00020000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00004659 8B0D[7CB20000]      <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 0000465F BA[00800500]        <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004664 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004669 CD40                <1>  int 40h
  7653 0000466B 7231                    		jc	short .init_err
  7654                                  
  7655                                  		; 12/01/2025
  7656                                  		; clear audio buffer (before playback)
  7657 0000466D BF[00800500]            		mov	edi, sample_buffer
  7658                                  		; ecx = buffer size in bytes
  7659 00004672 83C103                  		add	ecx, 3	; 13/01/2025
  7660 00004675 C1E902                  		shr	ecx, 2
  7661 00004678 31C0                    		xor	eax, eax
  7662 0000467A F3AB                    		rep	stosd
  7663                                  
  7664                                  		; TRDOS 386 system call
  7665                                  		; sysaudio
  7666                                  		; Initialize audio device (bh = 3)
  7667                                  		; bl = 01h -> CallBack method
  7668                                  		; edx = Callback service address (virtual)
  7669                                  		; ecx = 0 ; CL = srb value ; not used
  7670                                  		sys	_audio, 0301h, 0, audio_callback_x ; 13/01/2025
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000467C BB01030000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00004681 B900000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00004686 BA[2B470000]        <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000468B B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004690 CD40                <1>  int 40h
  7671                                  		; 12/01/2025
  7672                                  		; SRB method (faster than callback method)
  7673                                  		; bl = 0 -> Signal Response Byte method
  7674                                  		; cl = 1 -> SRB set value 
  7675                                  		;     (will be set by audio IRQ service of the kernel)
  7676                                  		; edx = SRB address -one byte data-
  7677                                  		;sys	_audio, 0300h, 1, srb	
  7678 00004692 720A                    		jc	short .init_err
  7679                                  
  7680                                  ; 27/01/2025
  7681                                  ;		; 26/01/2025
  7682                                  ;		; Map system DMA buffer to user's memory space
  7683                                  ;		; (for -fast- sound data graphics display)
  7684                                  ;		mov	eax, [buffer_size]
  7685                                  ;		shl	eax, 1 ; dma buff size is 2 * user's buff size
  7686                                  ;		sys	_audio, 0D00h, eax, dmabuffer
  7687                                  
  7688                                  		; 24/01/2025
  7689                                  		;retn
  7690 00004694 A0[B8B10000]            		mov	al, [volume_level]
  7691                                  		;call	SetMasterVolume@
  7692                                  		;retn
  7693 00004699 E9D2FCFFFF              		jmp	SetMasterVolume@
  7694                                  
  7695                                  .init_err:
  7696 0000469E E91FFCFFFF              		jmp	init_error
  7697                                  
  7698                                  
  7699                                  ; =============== S U B R O U T I N E =======================================
  7700                                  
  7701                                  		; 15/02/2025
  7702                                  		; 14/01/2025
  7703                                  		; 13/01/2025
  7704                                  mp3_cast_to_speaker_x:
  7705                                  		; 48 kHZ, 16bit, stereo
  7706 000046A3 BB03040000              		mov	ebx, 0403h
  7707 000046A8 B980BB0000              		mov	ecx, 48000
  7708                                  		; 14/01/2025
  7709 000046AD 803D[79B20000]01        		cmp	byte [vra], 1
  7710 000046B4 7206                    		jb	short .jmpto@
  7711                                  		; 15/02/2025
  7712 000046B6 8B0D[B0C20000]          		mov	ecx, [mp3_sample_rate] 
  7713                                  .jmpto@:
  7714 000046BC E9D6FCFFFF              		jmp	mp3_cast_to_speaker_@
  7715                                  
  7716                                  
  7717                                  ; =============== S U B R O U T I N E =======================================
  7718                                  	
  7719                                  		; 18/02/2025
  7720                                  		; 17/02/2025	
  7721                                  		; 23/01/2025
  7722                                  		; 15/01/2025
  7723                                  		; 13/01/2025
  7724                                  try_enqueue_all_blocks_x:
  7725                                  		; 12/01/2025
  7726 000046C1 60                      		pusha
  7727 000046C2 BF[00600500]             		mov	edi, decoding_buffer
  7728                                  		; 15/01/2025
  7729                                  		;jmp	try_enqueue_all_blocks_@
  7730 000046C7 EB15                    		jmp	short .first_block
  7731                                  
  7732                                  		; 15/01/2025
  7733                                  .next_block:
  7734 000046C9 833D[E4510500]00                        cmp	dword [bytes_left], 0
  7735 000046D0 7E4D                                    jle	short .enqueue_done
  7736                                  		;
  7737 000046D2 8B3D[70190100]          		mov	edi, [mp3_samples_dst]
  7738 000046D8 033D[74190100]          		add	edi, [mp3_samples_output_size]
  7739                                  
  7740                                  ;try_enqueue_all_blocks_@:
  7741                                  .first_block:
  7742                                  		;;pusha
  7743 000046DE 8B35[E0510500]          		mov	esi, [stream_pos]
  7744 000046E4 8B0D[E4510500]          		mov	ecx, [bytes_left]
  7745 000046EA 31ED                    		xor	ebp, ebp
  7746 000046EC E869F7FFFF              		call	mp3_decode_frame
  7747                                  		;;popa
  7748                                  		; 23/01/2025 (ignore error) -forward/backward-
  7749                                  		;jc	short .enqueue_done
  7750                                  
  7751 000046F1 A1[98C20000]            		mov	eax, [mp3_src_frame_size]
  7752 000046F6 83F800                  		cmp	eax, 0
  7753 000046F9 7424                    		jz	short .enqueue_done
  7754 000046FB 0105[E0510500]          		add	[stream_pos], eax
  7755 00004701 2905[E4510500]          		sub	[bytes_left], eax
  7756                                  
  7757 00004707 A1[74190100]            		mov	eax, [mp3_samples_output_size]
  7758 0000470C 83F800                  		cmp	eax, 0
  7759 0000470F 74B8                    		jz	short .next_block
  7760                                  
  7761                                  		; 18/02/2025
  7762                                  		; 15/01/2025
  7763 00004711 FF15[84B20000]          		call	dword [conversion]
  7764                                  		; 17/02/2025 (only one option = 16bit mono)
  7765                                  		;call	convert_to_stereo
  7766                                  		
  7767                                  .no_error:
  7768                                  		; 15/01/2025
  7769 00004717 FE05[29A90000]          		inc	byte [num_enqueued_frames]
  7770                                  .rtn:
  7771                                  		; 12/01/2025
  7772 0000471D 61                      		popa
  7773 0000471E C3                      		retn
  7774                                  .enqueue_done:
  7775 0000471F C705[E4510500]0000-                     mov	dword [bytes_left], 0
  7775 00004727 0000               
  7776                                  		; 12/01/2025
  7777 00004729 EBF2                    		jmp	short .rtn
  7778                                  
  7779                                  
  7780                                  ; =============== S U B R O U T I N E =======================================
  7781                                  
  7782                                  		; 13/01/2025
  7783                                  audio_callback_x:
  7784                                  		; Operating system has directed CPU here because of
  7785                                  		; user (2nd) stage of the audio hardware interrupt service.
  7786                                  		; This procedure must be short and return to operating
  7787                                  		; system again via sysrelease system call
  7788                                  		; (or any system call here will be handled as sysrelease).
  7789                                  
  7790 0000472B C605[7AB20000]01        		mov	byte [srb], 1
  7791                                  
  7792 00004732 E88AFFFFFF              		call	try_enqueue_all_blocks_x
  7793                                  
  7794                                  		; 15/01/2025
  7795                                  		;call	dword [conversion]
  7796                                  
  7797                                  		sys	_rele ; return from callback service 
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004737 B827000000          <1>  mov eax, %1
   112                              <1> 
   113 0000473C CD40                <1>  int 40h
  7798                                  		
  7799                                  		; we must not come here !
  7800 0000473E BBFFFFFFFF              		mov	ebx, -1
  7801                                  		sys	_exit
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004743 B801000000          <1>  mov eax, %1
   112                              <1> 
   113 00004748 CD40                <1>  int 40h
  7802                                  		;jmp	short audio_callback
  7803                                  
  7804                                  
  7805                                  ; ---------------------------------------------------------------------------
  7806                                  ; 13/01/2025 - Interpolation procedures for non-VRA AC97 codecs
  7807                                  ; ---------------------------------------------------------------------------
  7808                                  ; ref: playwav9.s - 18/12/2025
  7809                                  
  7810                                  ; =============== S U B R O U T I N E =======================================
  7811                                  
  7812                                  ; 13/01/2025
  7813                                  ; --------------------------------------------------------
  7814                                  ; 48 kHZ conversion procedures
  7815                                  ; --------------------------------------------------------
  7816                                  ; convert_to_stereo: convert 16bit mono samples to 16bit stereo
  7817                                  ; convert_to_16bit: convert 8bit stereo samples to 16bit stereo	
  7818                                  ; convert_to_stereo_16bit: convert 8bit mono samples to 16bit & stereo
  7819                                  ; [loadsize] = decoding buffer size
  7820                                  ; [buffer_size] = wav output buffer size (<= 64KB)
  7821                                  
  7822                                  ; /////
  7823                                  
  7824                                  	; 13/01/2025
  7825                                  convert_to_stereo:
  7826 0000474A BE[00600500]            	mov	esi, decoding_buffer ; (contains 16bit mono samples)
  7827 0000474F BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  7828 00004754 8B0D[88B20000]          	mov	ecx, [loadsize]
  7829 0000475A D1E9                    	shr	ecx, 1 ; word count
  7830                                  cts_1:
  7831 0000475C 66AD                    	lodsw
  7832 0000475E 66AB                    	stosw	; left channel
  7833 00004760 66AB                    	stosw	; right channel
  7834 00004762 E2F8                    	loop	cts_1
  7835                                  cts_2:
  7836                                  	; padfill
  7837 00004764 8B0D[7CB20000]          	mov	ecx, [buffer_size] 
  7838 0000476A 81C1[00800500]          	add	ecx, sample_buffer
  7839 00004770 29F9                    	sub	ecx, edi
  7840 00004772 7604                    	jna	short cts_3
  7841 00004774 31C0                    	xor	eax, eax
  7842 00004776 F3AA                    	rep	stosb
  7843                                  cts_3:
  7844 00004778 C3                      	retn
  7845                                  
  7846                                  ; /////
  7847                                  
  7848                                  ; 17/02/2025
  7849                                  %if 0
  7850                                  
  7851                                  	; 13/01/2025
  7852                                  convert_to_16bit:
  7853                                  	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  7854                                  	mov	edi, sample_buffer ; wav output buffer
  7855                                  	mov	ecx, [loadsize]
  7856                                  ct16b_1:
  7857                                  	; stereo & 8 bit
  7858                                  	lodsb
  7859                                  	sub	al, 80h ; 08/11/2023
  7860                                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  7861                                  	stosw
  7862                                  	loop	ct16b_1
  7863                                  	jmp	short cts_2
  7864                                  
  7865                                  ; /////
  7866                                  
  7867                                  	; 13/01/2025
  7868                                  convert_to_stereo_16bit:
  7869                                  	mov	esi, decoding_buffer ; (contains 8bit mono samples)
  7870                                  	mov	edi, sample_buffer ; wav output buffer
  7871                                  	mov	ecx, [loadsize]
  7872                                  cts16b_1:
  7873                                  	; mono & 8 bit
  7874                                  	lodsb
  7875                                  	sub	al, 80h ; 08/11/2023
  7876                                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  7877                                  	stosw	; left channel
  7878                                  	stosw	; right channel
  7879                                  	loop	cts16b_1
  7880                                  	jmp	short cts_2
  7881                                  
  7882                                  ; /////
  7883                                  
  7884                                  %endif
  7885                                  
  7886                                  ; =============== S U B R O U T I N E =======================================
  7887                                  
  7888                                  ; --------------------------------------------------------
  7889                                  ; 13/01/2025
  7890                                  ; --------------------------------------------------------
  7891                                  
  7892                                  ; 17/02/2025 - tmp3play.s
  7893                                  ;	16bit stereo or 16bit mono playback	
  7894                                  ; 13/01/2025 - mp3player modifications (mp3play3.s)
  7895                                  ; 07/12/2024 - playwav9.s
  7896                                  ; 01/12/2024 - ac97play.s
  7897                                  ; 29/05/2024
  7898                                  ; 26/11/2023
  7899                                  ; 25/11/2023 - playwav6.s (32 bit registers, TRDOS 386 adaption)
  7900                                  ; 15/11/2023 - PLAYWAV5.COM, ich_wav5.asm
  7901                                  ; 14/11/2023
  7902                                  ; 13/11/2023 - Erdogan Tan - (VRA, sample rate conversion)
  7903                                  ; --------------------------------------------------------
  7904                                  
  7905                                  ;;Note:	At the end of every buffer load,
  7906                                  ;;	during buffer switch/swap, there will be discontinuity
  7907                                  ;;	between the last converted sample and the 1st sample
  7908                                  ;;	of the next buffer.
  7909                                  ;;	(like as a dot noises vaguely between normal sound samples)
  7910                                  ;;	-To avoid this defect, the 1st sample of
  7911                                  ;;	the next buffer may be read from the wav file but
  7912                                  ;;	the file pointer would need to be set to 1 sample back
  7913                                  ;;	again via seek system call. Time comsumption problem! -
  7914                                  ;;
  7915                                  ;;	Erdogan Tan - 15/11/2023
  7916                                  ;;
  7917                                  ;;	((If entire wav data would be loaded at once.. conversion
  7918                                  ;;	defect/noise would disappear.. but for DOS, to keep
  7919                                  ;;	64KB buffer limit is important also it is important
  7920                                  ;;	for running under 1MB barrier without HIMEM.SYS or DPMI.
  7921                                  ;;	I have tested this program by using 2-30MB wav files.))
  7922                                  ;;
  7923                                  ;;	Test Computer:	ASUS desktop/mainboard, M2N4-SLI, 2010.
  7924                                  ;;			AMD Athlon 64 X2 2200 MHZ CPU.
  7925                                  ;;		       	NFORCE4 (CK804) AC97 audio hardware.
  7926                                  ;;			Realtek ALC850 codec.
  7927                                  ;;		       	Retro DOS v4.2 (MSDOS 6.22) operating system.
  7928                                  
  7929                                  ; =============== S U B R O U T I N E =======================================
  7930                                  
  7931                                  load_8khz_mono_16_bit:
  7932                                  	; 13/01/2025 (mp3play3.s)
  7933 00004779 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  7934 0000477E BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  7935 00004783 8B0D[88B20000]          	mov	ecx, [loadsize]
  7936                                  	; 13/01/2025
  7937 00004789 D1E9                    	shr	ecx, 1	; word count
  7938                                  lff8m2_1:
  7939 0000478B 66AD                    	lodsw
  7940 0000478D 66AB                    	stosw		; original sample (left channel)
  7941 0000478F 66AB                    	stosw		; original sample (right channel)
  7942 00004791 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  7943 00004794 66A3[23510000]          	mov	[previous_val], ax
  7944 0000479A 31C0                    	xor	eax, eax
  7945 0000479C 49                      	dec	ecx
  7946 0000479D 7403                    	jz	short lff8m2_2
  7947 0000479F 668B06                  	mov	ax, [esi]
  7948                                  lff8m2_2:
  7949 000047A2 80C480                  	add	ah, 80h ; convert sound level to 0-65535 format
  7950 000047A5 89C5                    	mov	ebp, eax	; [next_val]
  7951 000047A7 660305[23510000]        	add	ax, [previous_val]
  7952 000047AE 66D1D8                  	rcr	ax, 1
  7953 000047B1 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample
  7954 000047B3 660305[23510000]        	add	ax, [previous_val]
  7955 000047BA 66D1D8                  	rcr	ax, 1	; this is temporary interpolation value
  7956 000047BD 89C3                    	mov	ebx, eax 		
  7957 000047BF 660305[23510000]        	add	ax, [previous_val]
  7958 000047C6 66D1D8                  	rcr	ax, 1
  7959 000047C9 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  7960 000047CC 66AB                    	stosw		; this is 1st interpolated sample (L)
  7961 000047CE 66AB                    	stosw		; this is 1st interpolated sample (R)
  7962 000047D0 89D8                    	mov	eax, ebx
  7963 000047D2 6601D0                  	add	ax, dx
  7964 000047D5 66D1D8                  	rcr	ax, 1
  7965 000047D8 80EC80                  	sub	ah, 80h
  7966 000047DB 66AB                    	stosw		; this is 2nd interpolated sample (L)
  7967 000047DD 66AB                    	stosw		; this is 2nd interpolated sample (R)
  7968 000047DF 89D0                    	mov	eax, edx
  7969 000047E1 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  7970 000047E4 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  7971 000047E6 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  7972 000047E8 89E8                    	mov	eax, ebp
  7973 000047EA 6601D0                  	add	ax, dx
  7974 000047ED 66D1D8                  	rcr	ax, 1
  7975 000047F0 89C3                    	mov	ebx, eax ; this is temporary interpolation value
  7976 000047F2 6601D0                  	add	ax, dx
  7977 000047F5 66D1D8                  	rcr	ax, 1
  7978 000047F8 80EC80                  	sub	ah, 80h
  7979 000047FB 66AB                    	stosw		; this is 4th interpolated sample (L)
  7980 000047FD 66AB                    	stosw		; this is 4th interpolated sample (R)
  7981 000047FF 89E8                    	mov	eax, ebp
  7982 00004801 6601D8                  	add	ax, bx
  7983 00004804 66D1D8                  	rcr	ax, 1
  7984 00004807 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  7985 0000480A 66AB                    	stosw		; this is 5th interpolated sample (L)
  7986 0000480C 66AB                    	stosw		; this is 5th interpolated sample (R)
  7987                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  7988 0000480E 09C9                    	or	ecx, ecx
  7989 00004810 0F8575FFFFFF            	jnz	lff8m2_1
  7990                                  	;jmp	lff8m2_3
  7991                                  	; 17/02/2025
  7992 00004816 E9D0050000              	jmp	lff8_3
  7993                                  
  7994                                  ; =============== S U B R O U T I N E =======================================
  7995                                  
  7996                                  load_8khz_stereo_16_bit:
  7997                                  	; 13/01/2025 (mp3play3.s)
  7998 0000481B BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  7999 00004820 BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8000 00004825 8B0D[88B20000]          	mov	ecx, [loadsize]
  8001                                  	; 13/01/2025
  8002 0000482B C1E902                  	shr	ecx, 2	; dword count
  8003                                  lff8s2_1:
  8004 0000482E 66AD                    	lodsw
  8005 00004830 66AB                    	stosw		; original sample (L)
  8006                                  	; 15/11/2023
  8007 00004832 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  8008 00004835 66A3[23510000]          	mov	[previous_val_l], ax
  8009 0000483B 66AD                    	lodsw
  8010 0000483D 66AB                    	stosw		; original sample (R)
  8011 0000483F 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  8012 00004842 66A3[25510000]          	mov	[previous_val_r], ax
  8013 00004848 31D2                    	xor	edx, edx
  8014 0000484A 31C0                    	xor	eax, eax
  8015                                  	; 16/11/2023
  8016 0000484C 49                      	dec	ecx
  8017 0000484D 7407                    	jz	short lff8s2_2
  8018 0000484F 668B06                  	mov	ax, [esi]
  8019 00004852 668B5602                	mov	dx, [esi+2]
  8020                                  lff8s2_2:
  8021 00004856 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  8022 00004859 66A3[27510000]          	mov	[next_val_l], ax
  8023 0000485F 80C680                  	add	dh, 80h	; convert sound level to 0-65535 format
  8024 00004862 668915[29510000]        	mov	[next_val_r], dx
  8025 00004869 660305[23510000]        	add	ax, [previous_val_l]
  8026 00004870 66D1D8                  	rcr	ax, 1
  8027 00004873 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample (L)
  8028 00004875 660305[23510000]        	add	ax, [previous_val_l]
  8029 0000487C 66D1D8                  	rcr	ax, 1	
  8030 0000487F 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  8031 00004881 660305[23510000]        	add	ax, [previous_val_l]
  8032 00004888 66D1D8                  	rcr	ax, 1
  8033 0000488B 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8034 0000488E 66AB                    	stosw		; this is 1st interpolated sample (L)
  8035 00004890 66A1[29510000]          	mov	ax, [next_val_r]
  8036 00004896 660305[25510000]        	add	ax, [previous_val_r]
  8037 0000489D 66D1D8                  	rcr	ax, 1
  8038 000048A0 89C5                    	mov	ebp, eax ; this is interpolated middle (3th) sample (R)
  8039 000048A2 660305[25510000]        	add	ax, [previous_val_r]
  8040 000048A9 66D1D8                  	rcr	ax, 1
  8041 000048AC 50                      	push	eax ; *	; this is temporary interpolation value (R)
  8042 000048AD 660305[25510000]        	add	ax, [previous_val_r]
  8043 000048B4 66D1D8                  	rcr	ax, 1
  8044 000048B7 80EC80                  	sub	ah, 80h
  8045 000048BA 66AB                    	stosw		; this is 1st interpolated sample (R)
  8046 000048BC 89D8                    	mov	eax, ebx
  8047 000048BE 6601D0                  	add	ax, dx
  8048 000048C1 66D1D8                  	rcr	ax, 1
  8049 000048C4 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8050 000048C7 66AB                    	stosw		; this is 2nd interpolated sample (L)
  8051 000048C9 58                      	pop	eax ; *
  8052 000048CA 6601E8                  	add	ax, bp
  8053 000048CD 66D1D8                  	rcr	ax, 1
  8054 000048D0 80EC80                  	sub	ah, 80h
  8055 000048D3 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  8056 000048D5 89D0                    	mov	eax, edx
  8057 000048D7 80EC80                  	sub	ah, 80h
  8058 000048DA 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  8059 000048DC 89E8                    	mov	eax, ebp
  8060 000048DE 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8061 000048E1 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  8062 000048E3 66A1[27510000]          	mov	ax, [next_val_l]
  8063 000048E9 6601D0                  	add	ax, dx
  8064 000048EC 66D1D8                  	rcr	ax, 1
  8065 000048EF 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  8066 000048F1 6601D0                  	add	ax, dx
  8067 000048F4 66D1D8                  	rcr	ax, 1
  8068 000048F7 80EC80                  	sub	ah, 80h
  8069 000048FA 66AB                    	stosw		; this is 4th interpolated sample (L)
  8070 000048FC 66A1[29510000]          	mov	ax, [next_val_r]
  8071 00004902 6601E8                  	add	ax, bp
  8072 00004905 66D1D8                  	rcr	ax, 1
  8073 00004908 50                      	push	eax ; ** ; this is temporary interpolation value (R)
  8074 00004909 6601E8                  	add	ax, bp
  8075 0000490C 66D1D8                  	rcr	ax, 1
  8076 0000490F 80EC80                  	sub	ah, 80h
  8077 00004912 66AB                    	stosw		; this is 4th interpolated sample (R)
  8078 00004914 66A1[27510000]          	mov	ax, [next_val_l]
  8079 0000491A 6601D8                  	add	ax, bx
  8080 0000491D 66D1D8                  	rcr	ax, 1
  8081 00004920 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8082 00004923 66AB                    	stosw		; this is 5th interpolated sample (L)
  8083 00004925 58                      	pop	eax ; **
  8084 00004926 660305[29510000]        	add	ax, [next_val_r]
  8085 0000492D 66D1D8                  	rcr	ax, 1
  8086 00004930 80EC80                  	sub	ah, 80h
  8087 00004933 66AB                    	stosw		; this is 5th interpolated sample (R)
  8088                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  8089 00004935 E305                    	jecxz	lff8_s2_9
  8090 00004937 E9F2FEFFFF              	jmp	lff8s2_1
  8091                                  lff8_s2_9:
  8092                                  	;jmp	lff8s2_3
  8093                                  	; 17/02/2025
  8094 0000493C E9AA040000              	jmp	lff8_3
  8095                                  
  8096                                  ; =============== S U B R O U T I N E =======================================
  8097                                  
  8098                                  load_16khz_mono_16_bit:
  8099                                  	; 13/01/2025 (mp3play3.s)
  8100 00004941 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8101 00004946 BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8102 0000494B 8B0D[88B20000]          	mov	ecx, [loadsize]
  8103                                  	; 13/01/2025
  8104 00004951 D1E9                    	shr	ecx, 1	; word count
  8105                                  lff16m2_1:
  8106 00004953 66AD                    	lodsw
  8107 00004955 66AB                    	stosw		; original sample (left channel)
  8108 00004957 66AB                    	stosw		; original sample (right channel)
  8109 00004959 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  8110                                  	;mov	[previous_val], ax
  8111 0000495C 89C3                    	mov	ebx, eax
  8112 0000495E 31C0                    	xor	eax, eax
  8113 00004960 49                      	dec	ecx
  8114 00004961 7403                    	jz	short lff16m2_2
  8115 00004963 668B06                  	mov	ax, [esi]
  8116                                  lff16m2_2:
  8117 00004966 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  8118 00004969 89C5                    	mov	ebp, eax	; [next_val]
  8119                                  	;add	ax, [previous_val]
  8120 0000496B 6601D8                  	add	ax, bx
  8121 0000496E 66D1D8                  	rcr	ax, 1
  8122 00004971 89C2                    	mov	edx, eax ; this is temporary interpolation value
  8123                                  	;add	ax, [previous_val]
  8124 00004973 6601D8                  	add	ax, bx
  8125 00004976 66D1D8                  	rcr	ax, 1
  8126 00004979 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8127 0000497C 66AB                    	stosw		; this is 1st interpolated sample (L)
  8128 0000497E 66AB                    	stosw		; this is 1st interpolated sample (R)
  8129 00004980 89E8                    	mov	eax, ebp
  8130 00004982 6601D0                  	add	ax, dx
  8131 00004985 66D1D8                  	rcr	ax, 1
  8132 00004988 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8133 0000498B 66AB                    	stosw		; this is 2nd interpolated sample (L)
  8134 0000498D 66AB                    	stosw		; this is 2nd interpolated sample (R)
  8135                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  8136 0000498F 09C9                    	or	ecx, ecx
  8137 00004991 75C0                    	jnz	short lff16m2_1
  8138                                  	;jmp	lff16m2_3
  8139                                  	; 17/02/2025
  8140 00004993 E953040000              	jmp	lff16_3
  8141                                  
  8142                                  ; =============== S U B R O U T I N E =======================================
  8143                                  
  8144                                  load_16khz_stereo_16_bit:
  8145                                  	; 13/01/2025 (mp3play3.s)
  8146 00004998 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8147 0000499D BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8148 000049A2 8B0D[88B20000]          	mov	ecx, [loadsize]
  8149                                  	; 13/01/2025
  8150 000049A8 C1E902                  	shr	ecx, 2	; dword count
  8151                                  lff16s2_1:
  8152 000049AB 66AD                    	lodsw
  8153 000049AD 66AB                    	stosw		; original sample (L)
  8154 000049AF 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  8155 000049B2 66A3[23510000]          	mov	[previous_val_l], ax
  8156 000049B8 66AD                    	lodsw
  8157 000049BA 66AB                    	stosw		; original sample (R)
  8158 000049BC 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  8159 000049BF 66A3[25510000]          	mov	[previous_val_r], ax
  8160 000049C5 31D2                    	xor	edx, edx
  8161 000049C7 31C0                    	xor	eax, eax
  8162                                  	; 16/11/2023
  8163 000049C9 49                      	dec	ecx
  8164 000049CA 7407                    	jz	short lff16s2_2
  8165 000049CC 668B06                  	mov	ax, [esi]
  8166 000049CF 668B5602                	mov	dx, [esi+2]
  8167                                  lff16s2_2:
  8168 000049D3 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  8169                                  	;mov	[next_val_l], ax
  8170 000049D6 89C5                    	mov	ebp, eax
  8171 000049D8 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  8172 000049DB 668915[29510000]        	mov	[next_val_r], dx
  8173 000049E2 660305[23510000]        	add	ax, [previous_val_l]
  8174 000049E9 66D1D8                  	rcr	ax, 1
  8175 000049EC 89C2                    	mov	edx, eax ; this is temporary interpolation value (L)
  8176 000049EE 660305[23510000]        	add	ax, [previous_val_l]
  8177 000049F5 66D1D8                  	rcr	ax, 1
  8178 000049F8 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  8179 000049FB 66AB                    	stosw		; this is 1st interpolated sample (L)
  8180 000049FD 66A1[29510000]          	mov	ax, [next_val_r]
  8181 00004A03 660305[25510000]        	add	ax, [previous_val_r]
  8182 00004A0A 66D1D8                  	rcr	ax, 1
  8183 00004A0D 89C3                    	mov	ebx, eax ; this is temporary interpolation value (R)
  8184 00004A0F 660305[25510000]        	add	ax, [previous_val_r]
  8185 00004A16 66D1D8                  	rcr	ax, 1
  8186 00004A19 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8187 00004A1C 66AB                    	stosw		; this is 1st interpolated sample (R)
  8188                                  	;mov	ax, [next_val_l]
  8189 00004A1E 89E8                    	mov	eax, ebp
  8190 00004A20 6601D0                  	add	ax, dx
  8191 00004A23 66D1D8                  	rcr	ax, 1
  8192 00004A26 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8193 00004A29 66AB                    	stosw		; this is 2nd interpolated sample (L)
  8194 00004A2B 66A1[29510000]          	mov	ax, [next_val_r]
  8195 00004A31 6601D8                  	add	ax, bx
  8196 00004A34 66D1D8                  	rcr	ax, 1
  8197 00004A37 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8198 00004A3A 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  8199                                  	
  8200                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  8201 00004A3C 09C9                    	or	ecx, ecx
  8202 00004A3E 0F8567FFFFFF            	jnz	lff16s2_1
  8203                                  	;jmp	lff16s2_3
  8204                                  	; 17/02/2025
  8205 00004A44 E9A2030000              	jmp	lff16_3
  8206                                  
  8207                                  ; =============== S U B R O U T I N E =======================================
  8208                                  
  8209                                  load_24khz_mono_16_bit:
  8210                                  	; 30/01/2025
  8211                                  	; 13/01/2025 (mp3play3.s)
  8212 00004A49 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8213 00004A4E BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8214 00004A53 8B0D[88B20000]          	mov	ecx, [loadsize]
  8215                                  	; 13/01/2025
  8216 00004A59 D1E9                    	shr	ecx, 1	; word count
  8217                                  lff24m2_1:
  8218 00004A5B 66AD                    	lodsw
  8219 00004A5D 66AB                    	stosw		; original sample (left channel)
  8220 00004A5F 66AB                    	stosw		; original sample (right channel)
  8221 00004A61 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  8222                                  	;mov	[previous_val], ax
  8223                                  	;mov	ebx, eax
  8224                                  	;xor	eax, eax
  8225 00004A64 31DB                    	xor	ebx, ebx
  8226 00004A66 49                      	dec	ecx
  8227 00004A67 7403                    	jz	short lff24m2_2
  8228                                  	;mov	ax, [esi]
  8229 00004A69 668B1E                  	mov	bx, [esi]
  8230                                  lff24m2_2:
  8231                                  	; 30/01/2025
  8232 00004A6C 80C780                  	add	bh, 80h ; convert sound level 0 to 65535 format
  8233                                  	;add	ah, 80h
  8234                                  	;mov	ebp, eax	; [next_val]
  8235                                  	;add	ax, [previous_val]
  8236                                  	; ax = [previous_val]
  8237                                  	; bx = [next_val]
  8238 00004A6F 6601D8                  	add	ax, bx
  8239 00004A72 66D1D8                  	rcr	ax, 1
  8240 00004A75 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8241 00004A78 66AB                    	stosw		; this is interpolated sample (L)
  8242 00004A7A 66AB                    	stosw		; this is interpolated sample (R)
  8243                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  8244 00004A7C 09C9                    	or	ecx, ecx
  8245 00004A7E 75DB                    	jnz	short lff24m2_1
  8246 00004A80 E966030000              	jmp	lff24_3
  8247                                  
  8248                                  ; =============== S U B R O U T I N E =======================================
  8249                                  
  8250                                  load_24khz_stereo_16_bit:
  8251                                  	; 13/01/2025 (mp3play3.s)
  8252 00004A85 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8253 00004A8A BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8254 00004A8F 8B0D[88B20000]          	mov	ecx, [loadsize]
  8255                                  	; 13/01/2025
  8256 00004A95 C1E902                  	shr	ecx, 2	; dword count
  8257                                  lff24s2_1:
  8258 00004A98 66AD                    	lodsw
  8259 00004A9A 66AB                    	stosw		; original sample (L)
  8260 00004A9C 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  8261 00004A9F 66A3[23510000]          	mov	[previous_val_l], ax
  8262 00004AA5 66AD                    	lodsw
  8263 00004AA7 66AB                    	stosw		; original sample (R)
  8264 00004AA9 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  8265                                  	;mov	[previous_val_r], ax
  8266 00004AAC 89C3                    	mov	ebx, eax
  8267 00004AAE 31D2                    	xor	edx, edx
  8268 00004AB0 31C0                    	xor	eax, eax
  8269                                  	; 16/11/2023
  8270 00004AB2 49                      	dec	ecx
  8271 00004AB3 7407                    	jz	short lff24s2_2
  8272 00004AB5 668B06                  	mov	ax, [esi]
  8273 00004AB8 668B5602                	mov	dx, [esi+2]
  8274                                  lff24s2_2:
  8275 00004ABC 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  8276                                  	;;mov	[next_val_l], ax
  8277                                  	;mov	ebp, eax
  8278 00004ABF 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  8279                                  	;mov	[next_val_r], dx
  8280 00004AC2 660305[23510000]        	add	ax, [previous_val_l]
  8281 00004AC9 66D1D8                  	rcr	ax, 1
  8282 00004ACC 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  8283 00004ACF 66AB                    	stosw		; this is interpolated sample (L)
  8284                                  	;mov	ax, [next_val_r]
  8285 00004AD1 89D0                    	mov	eax, edx
  8286                                  	;add	ax, [previous_val_r]
  8287 00004AD3 6601D8                  	add	ax, bx
  8288 00004AD6 66D1D8                  	rcr	ax, 1
  8289 00004AD9 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8290 00004ADC 66AB                    	stosw		; this is interpolated sample (R)
  8291                                  	
  8292                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  8293 00004ADE 09C9                    	or	ecx, ecx
  8294 00004AE0 75B6                    	jnz	short lff24s2_1
  8295 00004AE2 E904030000              	jmp	lff24_3
  8296                                  
  8297                                  ; =============== S U B R O U T I N E =======================================
  8298                                  
  8299                                  load_32khz_mono_16_bit:
  8300                                  	; 13/01/2025 (mp3play3.s)
  8301 00004AE7 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8302 00004AEC BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8303 00004AF1 8B0D[88B20000]          	mov	ecx, [loadsize]
  8304                                  	; 13/01/2025
  8305 00004AF7 D1E9                    	shr	ecx, 1	; word count
  8306                                  lff32m2_1:
  8307 00004AF9 66AD                    	lodsw
  8308 00004AFB 66AB                    	stosw		; original sample (left channel)
  8309 00004AFD 66AB                    	stosw		; original sample (right channel)
  8310 00004AFF 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  8311                                  	;mov	[previous_val], ax
  8312                                  	;mov	ebx, eax
  8313                                  	;xor	eax, eax
  8314 00004B02 31DB                    	xor	ebx, ebx
  8315 00004B04 49                      	dec	ecx
  8316 00004B05 7403                    	jz	short lff32m2_2
  8317                                  	;mov	ax, [esi]
  8318 00004B07 668B1E                  	mov	bx, [esi]
  8319                                  lff32m2_2:
  8320                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  8321                                  	;mov	ebp, eax	; [next_val]
  8322                                  	;add	ax, [previous_val]
  8323                                  	; ax = [previous_val]
  8324                                  	; bx = [next_val]
  8325 00004B0A 6601D8                  	add	ax, bx
  8326 00004B0D 66D1D8                  	rcr	ax, 1
  8327 00004B10 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8328 00004B13 66AB                    	stosw		; this is interpolated sample (L)
  8329 00004B15 66AB                    	stosw		; this is interpolated sample (R)
  8330                                  
  8331                                  	; different than 8-16-24 kHZ !
  8332                                  	; 'original-interpolated-original' trio samples 
  8333 00004B17 E309                    	jecxz	lff32m2_3
  8334                                  
  8335 00004B19 66AD                    	lodsw
  8336 00004B1B 66AB                    	stosw		; original sample (left channel)
  8337 00004B1D 66AB                    	stosw		; original sample (right channel)
  8338                                  
  8339                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  8340 00004B1F 49                      	dec	ecx
  8341 00004B20 75D7                    	jnz	short lff32m2_1
  8342                                  lff32m2_3:
  8343 00004B22 E9C4020000              	jmp	lff32_3
  8344                                  
  8345                                  ; =============== S U B R O U T I N E =======================================
  8346                                  
  8347                                  load_32khz_stereo_16_bit:
  8348                                  	; 13/01/2025 (mp3play3.s)
  8349 00004B27 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8350 00004B2C BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8351 00004B31 8B0D[88B20000]          	mov	ecx, [loadsize]
  8352                                  	; 13/01/2025
  8353 00004B37 C1E902                  	shr	ecx, 2	; dword count
  8354                                  lff32s2_1:
  8355 00004B3A 66AD                    	lodsw
  8356 00004B3C 66AB                    	stosw		; original sample (L)
  8357 00004B3E 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  8358 00004B41 66A3[23510000]          	mov	[previous_val_l], ax
  8359 00004B47 66AD                    	lodsw
  8360 00004B49 66AB                    	stosw		; original sample (R)
  8361 00004B4B 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  8362                                  	;mov	[previous_val_r], ax
  8363 00004B4E 89C3                    	mov	ebx, eax
  8364 00004B50 31D2                    	xor	edx, edx
  8365 00004B52 31C0                    	xor	eax, eax
  8366                                  	; 16/11/2023
  8367 00004B54 49                      	dec	ecx
  8368 00004B55 7407                    	jz	short lff32s2_2
  8369 00004B57 668B06                  	mov	ax, [esi]
  8370 00004B5A 668B5602                	mov	dx, [esi+2]
  8371                                  lff32s2_2:
  8372 00004B5E 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  8373                                  	;;mov	[next_val_l], ax
  8374                                  	;mov	ebp, eax
  8375 00004B61 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  8376                                  	;mov	[next_val_r], dx
  8377 00004B64 660305[23510000]        	add	ax, [previous_val_l]
  8378 00004B6B 66D1D8                  	rcr	ax, 1
  8379 00004B6E 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  8380 00004B71 66AB                    	stosw		; this is interpolated sample (L)
  8381                                  	;mov	ax, [next_val_r]
  8382 00004B73 89D0                    	mov	eax, edx
  8383                                  	;add	ax, [previous_val_r]
  8384 00004B75 6601D8                  	add	ax, bx
  8385 00004B78 66D1D8                  	rcr	ax, 1
  8386 00004B7B 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8387 00004B7E 66AB                    	stosw		; this is interpolated sample (R)
  8388                                  
  8389                                  	; different than 8-16-24 kHZ !
  8390                                  	; 'original-interpolated-original' trio samples
  8391 00004B80 E30B                    	jecxz	lff32s2_3
  8392                                  
  8393 00004B82 66AD                    	lodsw
  8394 00004B84 66AB                    	stosw	; original sample (L)
  8395 00004B86 66AD                    	lodsw
  8396 00004B88 66AB                    	stosw	; original sample (R)
  8397                                  	
  8398                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  8399 00004B8A 49                      	dec	ecx
  8400 00004B8B 75AD                    	jnz	short lff32s2_1
  8401                                  lff32s2_3:
  8402 00004B8D E959020000              	jmp	lff32_3
  8403                                  
  8404                                  ; =============== S U B R O U T I N E =======================================
  8405                                  
  8406                                  load_22khz_mono_16_bit:
  8407                                  	; 13/01/2025 (mp3play3.s)
  8408 00004B92 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8409 00004B97 BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8410 00004B9C 8B0D[88B20000]          	mov	ecx, [loadsize]
  8411                                  	; 13/01/2025
  8412 00004BA2 D1E9                    	shr	ecx, 1	; word count
  8413                                  lff22m2_9:
  8414 00004BA4 BD05000000              	mov	ebp, 5	; interpolation (one step) loop count
  8415 00004BA9 C605[2B510000]03        	mov	byte [faz], 3  ; 3 steps/phases
  8416                                  lff22m2_1:
  8417                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  8418 00004BB0 66AD                    	lodsw
  8419 00004BB2 31D2                    	xor	edx, edx
  8420 00004BB4 49                      	dec	ecx
  8421 00004BB5 7403                    	jz	short lff22m2_2_1
  8422 00004BB7 668B16                  	mov	dx, [esi]
  8423                                  lff22m2_2_1:	
  8424                                  	; ax = [previous_val]
  8425                                  	; dx = [next_val]
  8426 00004BBA E8AA020000              	call	interpolating_3_16bit_mono ; 1 of 17
  8427 00004BBF E32F                    	jecxz	lff22m2_3
  8428                                  lff22m2_2_2:
  8429 00004BC1 66AD                    	lodsw
  8430 00004BC3 31D2                    	xor	edx, edx
  8431 00004BC5 49                      	dec	ecx
  8432 00004BC6 7403                    	jz	short lff22m2_2_3
  8433 00004BC8 668B16                  	mov	dx, [esi]
  8434                                  lff22m2_2_3:
  8435 00004BCB E82C030000               	call	interpolating_2_16bit_mono ; 2 of 17 .. 6 of 17
  8436 00004BD0 E31E                    	jecxz	lff22m2_3
  8437 00004BD2 4D                      	dec	ebp
  8438 00004BD3 75EC                    	jnz	short lff22m2_2_2
  8439                                  
  8440 00004BD5 A0[2B510000]            	mov	al, [faz]
  8441 00004BDA FEC8                    	dec	al
  8442 00004BDC 74C6                    	jz	short lff22m2_9
  8443 00004BDE FE0D[2B510000]          	dec	byte [faz]
  8444 00004BE4 BD04000000              	mov	ebp, 4
  8445 00004BE9 FEC8                    	dec	al
  8446 00004BEB 75C3                    	jnz	short lff22m2_1 ; 3:2:2:2:2 ; 7-11 of 17
  8447 00004BED 45                      	inc	ebp ; 5
  8448 00004BEE EBC0                    	jmp	short lff22m2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  8449                                  
  8450                                  lff22m2_3:
  8451                                  lff22s2_3:
  8452 00004BF0 E9F6010000              	jmp	lff22_3	; padfill
  8453                                  		; (put zeros in the remain words of the buffer)
  8454                                  
  8455                                  ; =============== S U B R O U T I N E =======================================
  8456                                  
  8457                                  load_22khz_stereo_16_bit:
  8458                                  	; 13/01/2025 (mp3play3.s)
  8459 00004BF5 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8460 00004BFA BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8461 00004BFF 8B0D[88B20000]          	mov	ecx, [loadsize]
  8462                                  	; 13/01/2025
  8463 00004C05 C1E902                  	shr	ecx, 2	; dword count
  8464                                  lff22s2_9:
  8465 00004C08 BD05000000              	mov	ebp, 5	; interpolation (one step) loop count
  8466 00004C0D C605[2B510000]03        	mov	byte [faz], 3  ; 3 steps/phase
  8467                                  lff22s2_1:
  8468                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  8469 00004C14 66AD                    	lodsw
  8470 00004C16 89C3                    	mov	ebx, eax
  8471 00004C18 66AD                    	lodsw
  8472 00004C1A 8B16                    	mov	edx, [esi]
  8473 00004C1C 668915[27510000]        	mov	[next_val_l], dx
  8474                                  	; 26/11/2023
  8475 00004C23 C1EA10                  	shr	edx, 16
  8476 00004C26 49                      	dec	ecx
  8477 00004C27 7509                    	jnz	short lff22s2_2_1
  8478 00004C29 31D2                    	xor	edx, edx ; 0
  8479 00004C2B 668915[27510000]        	mov	[next_val_l], dx
  8480                                  lff22s2_2_1:
  8481                                  	; bx = [previous_val_l]
  8482                                  	; ax = [previous_val_r]
  8483                                  	; [next_val_l]
  8484                                  	; dx = [next_val_r]
  8485 00004C32 E862020000              	call	interpolating_3_16bit_stereo ; 1 of 17 
  8486 00004C37 E3B7                    	jecxz	lff22s2_3
  8487                                  lff22s2_2_2:
  8488 00004C39 66AD                    	lodsw
  8489 00004C3B 89C3                    	mov	ebx, eax
  8490 00004C3D 66AD                    	lodsw
  8491 00004C3F 8B16                    	mov	edx, [esi]
  8492 00004C41 668915[27510000]        	mov	[next_val_l], dx
  8493                                  	; 26/11/2023
  8494 00004C48 C1EA10                  	shr	edx, 16
  8495 00004C4B 49                      	dec	ecx
  8496 00004C4C 7509                    	jnz	short lff22s2_2_3
  8497 00004C4E 31D2                    	xor	edx, edx ; 0
  8498 00004C50 668915[27510000]        	mov	[next_val_l], dx
  8499                                  lff22s2_2_3:
  8500 00004C57 E8B8020000               	call	interpolating_2_16bit_stereo ; 2 of 17 .. 6 of 17
  8501 00004C5C E31E                    	jecxz	lff22s2_2_4
  8502                                  
  8503 00004C5E 4D                      	dec	ebp
  8504 00004C5F 75D8                    	jnz	short lff22s2_2_2
  8505                                  
  8506 00004C61 A0[2B510000]            	mov	al, [faz]
  8507 00004C66 FEC8                    	dec	al
  8508 00004C68 749E                    	jz	short lff22s2_9
  8509 00004C6A FE0D[2B510000]          	dec	byte [faz]
  8510 00004C70 BD04000000              	mov	ebp, 4
  8511 00004C75 FEC8                    	dec	al
  8512 00004C77 759B                    	jnz	short lff22s2_1 ; 3:2:2:2:2 ; 7-11 of 17
  8513 00004C79 45                      	inc	ebp ; 5
  8514 00004C7A EB98                    	jmp	short lff22s2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  8515                                  
  8516                                  lff22s2_2_4:
  8517                                  	; 26/11/2023
  8518 00004C7C E96A010000              	jmp	lff22_3	; padfill
  8519                                  
  8520                                  ; =============== S U B R O U T I N E =======================================
  8521                                  
  8522                                  load_11khz_mono_16_bit:
  8523                                  	; 13/01/2025 (mp3play3.s)
  8524 00004C81 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8525 00004C86 BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8526 00004C8B 8B0D[88B20000]          	mov	ecx, [loadsize]
  8527                                  	; 13/01/2025
  8528 00004C91 D1E9                    	shr	ecx, 1	; word count
  8529                                  lff11m2_9:
  8530 00004C93 BD06000000              	mov	ebp, 6	; interpolation (one step) loop count
  8531                                  lff11m2_1:
  8532                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  8533 00004C98 66AD                    	lodsw
  8534 00004C9A 31D2                    	xor	edx, edx
  8535 00004C9C 49                      	dec	ecx
  8536 00004C9D 7403                    	jz	short lff11m2_2_1
  8537 00004C9F 668B16                  	mov	dx, [esi]
  8538                                  lff11m2_2_1:	
  8539                                  	; ax = [previous_val]
  8540                                  	; dx = [next_val]
  8541 00004CA2 E89C020000              	call	interpolating_5_16bit_mono
  8542 00004CA7 E327                    	jecxz	lff11m2_3
  8543                                  lff11m2_2_2:
  8544 00004CA9 66AD                    	lodsw
  8545 00004CAB 31D2                    	xor	edx, edx
  8546 00004CAD 49                      	dec	ecx
  8547 00004CAE 7403                    	jz	short lff11m2_2_3
  8548 00004CB0 668B16                  	mov	dx, [esi]
  8549                                  lff11m2_2_3:
  8550 00004CB3 E8B5030000               	call	interpolating_4_16bit_mono
  8551 00004CB8 E316                    	jecxz	lff11m2_3
  8552                                  
  8553 00004CBA 4D                      	dec	ebp
  8554 00004CBB 74D6                    	jz	short lff11m2_9
  8555                                  
  8556 00004CBD 66AD                    	lodsw
  8557 00004CBF 31D2                    	xor	edx, edx
  8558 00004CC1 49                      	dec	ecx
  8559 00004CC2 7403                    	jz	short lff11m2_2_4
  8560 00004CC4 668B16                  	mov	dx, [esi]
  8561                                  lff11m2_2_4:
  8562 00004CC7 E8A1030000               	call	interpolating_4_16bit_mono
  8563 00004CCC E302                    	jecxz	lff11m2_3
  8564 00004CCE EBC8                    	jmp	short lff11m2_1
  8565                                  
  8566                                  lff11m2_3:
  8567 00004CD0 E916010000              	jmp	lff11_3	; padfill
  8568                                  		; (put zeros in the remain words of the buffer)
  8569                                  
  8570                                  ; =============== S U B R O U T I N E =======================================
  8571                                  
  8572                                  load_11khz_stereo_16_bit:
  8573                                  	; 13/01/2025 (mp3play3.s)
  8574 00004CD5 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8575 00004CDA BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8576 00004CDF 8B0D[88B20000]          	mov	ecx, [loadsize]
  8577                                  	; 13/01/2025
  8578 00004CE5 C1E902                  	shr	ecx, 2	; dword count
  8579                                  lff11s2_9:
  8580 00004CE8 BD06000000              	mov	ebp, 6	; interpolation (one step) loop count
  8581                                  lff11s2_1:
  8582                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  8583 00004CED 66AD                    	lodsw
  8584 00004CEF 89C3                    	mov	ebx, eax
  8585 00004CF1 66AD                    	lodsw
  8586 00004CF3 8B16                    	mov	edx, [esi]
  8587                                  	; 15/01/2025
  8588                                  	;mov	[next_val_l], edx
  8589                                  	; 26/11/2023
  8590                                  	;shr	edx, 16
  8591                                  	;mov	[next_val_r], dx
  8592 00004CF5 49                      	dec	ecx
  8593 00004CF6 7502                    	jnz	short lff11s2_2_1
  8594 00004CF8 31D2                    	xor	edx, edx ; 0
  8595                                  	;mov	[next_val_l], dx
  8596                                  	;mov	[next_val_r], dx
  8597                                  lff11s2_2_1:
  8598                                  	; bx = [previous_val_l]
  8599                                  	; ax = [previous_val_r]
  8600                                  	; [next_val_l]
  8601                                  	; dx = [next_val_r]
  8602                                  	;;;
  8603                                  	; 15/01/2025 (BugFix)
  8604 00004CFA 8915[27510000]          	mov	[next_val_l], edx
  8605                                  	;;;
  8606 00004D00 E899020000              	call	interpolating_5_16bit_stereo
  8607 00004D05 E339                    	jecxz	lff11s2_3
  8608                                  lff11s2_2_2:
  8609 00004D07 66AD                    	lodsw
  8610 00004D09 89C3                    	mov	ebx, eax
  8611 00004D0B 66AD                    	lodsw
  8612 00004D0D 8B16                    	mov	edx, [esi]
  8613                                  	; 15/01/2025
  8614                                  	;mov	[next_val_l], dx
  8615                                  	; 26/11/2023
  8616                                  	;shr	edx, 16
  8617                                  	;mov	[next_val_r], dx
  8618 00004D0F 49                      	dec	ecx
  8619 00004D10 7502                    	jnz	short lff11s2_2_3
  8620 00004D12 31D2                    	xor	edx, edx ; 0
  8621                                  	;mov	[next_val_l], dx
  8622                                  	;mov	[next_val_r], dx
  8623                                  lff11s2_2_3:
  8624                                  	;;;
  8625                                  	; 15/01/2025 (BugFix)
  8626 00004D14 8915[27510000]          	mov	[next_val_l], edx
  8627                                  	;;;
  8628 00004D1A E887030000              	call	interpolating_4_16bit_stereo
  8629 00004D1F E31F                    	jecxz	lff11s2_3
  8630                                  	
  8631 00004D21 4D                      	dec	ebp
  8632 00004D22 74C4                    	jz	short lff11s2_9
  8633                                  
  8634 00004D24 66AD                    	lodsw
  8635 00004D26 89C3                    	mov	ebx, eax
  8636 00004D28 66AD                    	lodsw
  8637 00004D2A 8B16                    	mov	edx, [esi]
  8638                                  	; 15/01/2025
  8639                                  	;mov	[next_val_l], dx
  8640                                  	; 26/11/2023
  8641                                  	;shr	edx, 16
  8642                                  	;mov	[next_val_r], dx
  8643 00004D2C 49                      	dec	ecx
  8644 00004D2D 7502                    	jnz	short lff11s2_2_4
  8645 00004D2F 31D2                    	xor	edx, edx ; 0
  8646                                  	;mov	[next_val_l], dx
  8647                                  	;mov	[next_val_r], dx
  8648                                  lff11s2_2_4:
  8649                                  	;;;
  8650                                  	; 15/01/2025 (BugFix)
  8651 00004D31 8915[27510000]          	mov	[next_val_l], edx
  8652                                  	;;;
  8653 00004D37 E86A030000               	call	interpolating_4_16bit_stereo
  8654 00004D3C E302                    	jecxz	lff11s2_3
  8655 00004D3E EBAD                    	jmp	short lff11s2_1
  8656                                  
  8657                                  lff11s2_3:
  8658 00004D40 E9A6000000              	jmp	lff11_3	; padfill
  8659                                  		; (put zeros in the remain words of the buffer)
  8660                                  
  8661                                  ; =============== S U B R O U T I N E =======================================
  8662                                  
  8663                                  load_44khz_mono_16_bit:
  8664                                  	; 13/01/2025 (mp3play3.s)
  8665 00004D45 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8666 00004D4A BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8667 00004D4F 8B0D[88B20000]          	mov	ecx, [loadsize]
  8668                                  	; 13/01/2025
  8669 00004D55 D1E9                    	shr	ecx, 1	; word count
  8670                                  lff44m2_9:
  8671 00004D57 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  8672 00004D5C C605[2B510000]02        	mov	byte [faz], 2  ; 2 steps/phases
  8673                                  lff44m2_1:
  8674                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  8675                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  8676 00004D63 66AD                    	lodsw
  8677 00004D65 31D2                    	xor	edx, edx
  8678 00004D67 49                      	dec	ecx
  8679 00004D68 7403                    	jz	short lff44m2_2_1
  8680 00004D6A 668B16                  	mov	dx, [esi]
  8681                                  lff44m2_2_1:	
  8682                                  	; ax = [previous_val]
  8683                                  	; dx = [next_val]
  8684 00004D6D E88A010000              	call	interpolating_2_16bit_mono
  8685 00004D72 E31B                    	jecxz	lff44m2_3
  8686                                  lff44m2_2_2:
  8687 00004D74 66AD                    	lodsw
  8688 00004D76 66AB                    	stosw		; (L)eft Channel
  8689 00004D78 66AB                    	stosw		; (R)ight Channel
  8690                                  
  8691 00004D7A 49                      	dec	ecx
  8692 00004D7B 7412                    	jz	short lff44m2_3	
  8693 00004D7D 4D                      	dec	ebp
  8694 00004D7E 75F4                    	jnz	short lff44m2_2_2
  8695                                  	
  8696 00004D80 FE0D[2B510000]          	dec	byte [faz]
  8697 00004D86 74CF                    	jz	short lff44m2_9 
  8698 00004D88 BD0B000000              	mov	ebp, 11
  8699 00004D8D EBD4                    	jmp	short lff44m2_1
  8700                                  
  8701                                  lff44m2_3:
  8702                                  lff44s2_3:
  8703 00004D8F EB5A                    	jmp	short lff44_3 ; padfill
  8704                                  		; (put zeros in the remain words of the buffer)
  8705                                  
  8706                                  ; =============== S U B R O U T I N E =======================================
  8707                                  
  8708                                  load_44khz_stereo_16_bit:
  8709                                  	; 13/01/2025 (mp3play3.s)
  8710 00004D91 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8711 00004D96 BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8712 00004D9B 8B0D[88B20000]          	mov	ecx, [loadsize]
  8713                                  	; 13/01/2025
  8714 00004DA1 C1E902                  	shr	ecx, 2	; dword count
  8715                                  lff44s2_9:
  8716 00004DA4 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  8717 00004DA9 C605[2B510000]02        	mov	byte [faz], 2  ; 2 steps/phase
  8718                                  lff44s2_1:
  8719                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  8720                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  8721 00004DB0 66AD                    	lodsw
  8722 00004DB2 89C3                    	mov	ebx, eax
  8723 00004DB4 66AD                    	lodsw
  8724                                  	;mov	dx, [esi]
  8725                                  	;mov	[next_val_l], dx
  8726                                  	;mov	dx, [esi+2]
  8727                                  	; 26/11/2023
  8728 00004DB6 8B16                    	mov	edx, [esi]
  8729 00004DB8 668915[27510000]        	mov	[next_val_l], dx
  8730 00004DBF C1EA10                  	shr	edx, 16
  8731 00004DC2 49                      	dec	ecx
  8732 00004DC3 7509                    	jnz	short lff44s2_2_1
  8733 00004DC5 31D2                    	xor	edx, edx ; 0
  8734 00004DC7 668915[27510000]        	mov	[next_val_l], dx
  8735                                  lff44s2_2_1:
  8736                                  	; bx = [previous_val_l]
  8737                                  	; ax = [previous_val_r]
  8738                                  	; [next_val_l]
  8739                                  	; dx = [next_val_r]
  8740 00004DCE E841010000              	call	interpolating_2_16bit_stereo
  8741 00004DD3 E3BA                    	jecxz	lff44s2_3
  8742                                  lff44s2_2_2:
  8743                                  	;movsw		; (L)eft Channel
  8744                                  	;movsw		; (R)ight Channel
  8745 00004DD5 A5                      	movsd
  8746                                  
  8747 00004DD6 49                      	dec	ecx
  8748                                  	;jz	short lff44s2_3
  8749                                  	; 17/02/2025
  8750 00004DD7 7412                    	jz	short lff44_3
  8751 00004DD9 4D                      	dec	ebp
  8752 00004DDA 75F9                    	jnz	short lff44s2_2_2
  8753                                  	
  8754 00004DDC FE0D[2B510000]          	dec	byte [faz]
  8755 00004DE2 74C0                    	jz	short lff44s2_9 
  8756 00004DE4 BD0B000000              	mov	ebp, 11
  8757 00004DE9 EBC5                    	jmp	short lff44s2_1
  8758                                  
  8759                                  
  8760                                  ; ---------------------------------------------------------------------------
  8761                                  
  8762                                  	; 17/02/2025
  8763                                  ; padfill
  8764                                  	; (put zeros in the remain words of the buffer)
  8765                                  lff44_3:
  8766                                  lff32_3:
  8767                                  lff24_3:
  8768                                  lff22_3:
  8769                                  lff16_3:
  8770                                  lff12_3:
  8771                                  lff11_3:
  8772                                  lff8_3: 
  8773                                  	; 17/02/2025
  8774 00004DEB 8B0D[7CB20000]          	mov	ecx, [buffer_size] ; 16 bit (48 kHZ, stereo) samples
  8775 00004DF1 81C1[00800500]          	add	ecx, sample_buffer
  8776 00004DF7 29F9                    	sub	ecx, edi
  8777 00004DF9 7609                    	jna	short lff44_4 ; jbe
  8778 00004DFB 29F9                    	sub	ecx, edi
  8779                                  	;inc	ecx
  8780 00004DFD C1E902                  	shr	ecx, 2
  8781 00004E00 31C0                    	xor	eax, eax ; fill (remain part of) buffer with zeros
  8782 00004E02 F3AB                    	rep	stosd
  8783                                  lff44_4:
  8784 00004E04 C3                      	retn
  8785                                  
  8786                                  ; =============== S U B R O U T I N E =======================================
  8787                                  
  8788                                  	; 01/02/2025
  8789                                  load_12khz_mono_16_bit:
  8790 00004E05 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8791 00004E0A BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8792 00004E0F 8B0D[88B20000]          	mov	ecx, [loadsize]
  8793 00004E15 D1E9                    	shr	ecx, 1	; word count
  8794                                  lff12m2_9:
  8795 00004E17 BD06000000              	mov	ebp, 6	; interpolation (one step) loop count
  8796                                  lff12m2_1:
  8797                                  	; original-interpolated-interpolated-interpolated
  8798 00004E1C 66AD                    	lodsw
  8799 00004E1E 31D2                    	xor	edx, edx
  8800 00004E20 49                      	dec	ecx
  8801 00004E21 7403                    	jz	short lff12m2_2
  8802 00004E23 668B16                  	mov	dx, [esi]
  8803                                  lff12m2_2:	
  8804                                  	; ax = [previous_val]
  8805                                  	; dx = [next_val]
  8806 00004E26 E842020000               	call	interpolating_4_16bit_mono
  8807 00004E2B E3BE                    	jecxz	lff12_3	; 17/02/2025
  8808 00004E2D EBED                    	jmp	short lff12m2_1
  8809                                  
  8810                                  ; =============== S U B R O U T I N E =======================================
  8811                                  
  8812                                  	; 01/02/2025
  8813                                  load_12khz_stereo_16_bit:
  8814 00004E2F BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8815 00004E34 BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8816 00004E39 8B0D[88B20000]          	mov	ecx, [loadsize]
  8817 00004E3F C1E902                  	shr	ecx, 2	; dword count
  8818                                  lff12s2_1:
  8819                                  	; original-interpolated-interpolated-interpolated
  8820 00004E42 66AD                    	lodsw
  8821 00004E44 89C3                    	mov	ebx, eax
  8822 00004E46 66AD                    	lodsw
  8823 00004E48 8B16                    	mov	edx, [esi]
  8824 00004E4A 49                      	dec	ecx
  8825 00004E4B 7502                    	jnz	short lff12s2_2
  8826 00004E4D 31D2                    	xor	edx, edx ; 0
  8827                                  lff12s2_2:
  8828 00004E4F 668915[27510000]        	mov	[next_val_l], dx
  8829 00004E56 C1EA10                  	shr	edx, 16
  8830 00004E59 668915[29510000]        	mov	[next_val_r], dx
  8831                                  	; bx = [previous_val_l]
  8832                                  	; ax = [previous_val_r]
  8833                                  	; [next_val_l]
  8834                                  	; [next_val_r]
  8835 00004E60 E841020000              	call	interpolating_4_16bit_stereo
  8836 00004E65 E384                    	jecxz	lff12_3	; 17/02/2025
  8837 00004E67 EBD9                    	jmp	short lff12s2_1
  8838                                  
  8839                                  ; =============== S U B R O U T I N E =======================================
  8840                                  
  8841                                  interpolating_3_16bit_mono:
  8842                                  	; 16/11/2023
  8843                                  	; ax = [previous_val]
  8844                                  	; dx = [next_val]
  8845                                  	; original-interpolated-interpolated
  8846                                  
  8847 00004E69 66AB                    	stosw		; original sample (L)
  8848 00004E6B 66AB                    	stosw		; original sample (R)
  8849 00004E6D 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  8850 00004E70 50                      	push	eax ; *	; [previous_val]
  8851 00004E71 80C680                  	add	dh, 80h
  8852 00004E74 6601D0                  	add	ax, dx
  8853 00004E77 66D1D8                  	rcr	ax, 1
  8854 00004E7A 5B                      	pop	ebx ; *
  8855 00004E7B 93                      	xchg	ebx, eax ; bx  = interpolated middle (temporary)
  8856 00004E7C 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  8857 00004E7F 66D1D8                  	rcr	ax, 1
  8858 00004E82 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8859 00004E85 66AB                    	stosw 		; interpolated sample 1 (L)
  8860 00004E87 66AB                    	stosw		; interpolated sample 1 (R)
  8861 00004E89 89D8                    	mov	eax, ebx
  8862 00004E8B 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  8863 00004E8E 66D1D8                  	rcr	ax, 1
  8864 00004E91 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8865 00004E94 66AB                    	stosw		; interpolated sample 2 (L)
  8866 00004E96 66AB                    	stosw		; interpolated sample 2 (R)
  8867 00004E98 C3                      	retn
  8868                                  
  8869                                  ; =============== S U B R O U T I N E =======================================
  8870                                  
  8871                                  interpolating_3_16bit_stereo:
  8872                                  	; 16/11/2023
  8873                                  	; bx = [previous_val_l]
  8874                                  	; ax = [previous_val_r]
  8875                                  	; [next_val_l]
  8876                                  	; dx = [next_val_r]
  8877                                  	; original-interpolated-interpolated
  8878                                  
  8879 00004E99 93                      	xchg	eax, ebx
  8880 00004E9A 66AB                    	stosw		; original sample (L)
  8881 00004E9C 93                      	xchg	eax, ebx
  8882 00004E9D 66AB                    	stosw		; original sample (R)
  8883 00004E9F 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  8884 00004EA2 50                      	push	eax ; *	; [previous_val_r]
  8885 00004EA3 80C780                  	add	bh, 80h
  8886 00004EA6 8005[28510000]80        	add	byte [next_val_l+1], 80h
  8887 00004EAD 66A1[27510000]          	mov	ax, [next_val_l]
  8888 00004EB3 6601D8                  	add	ax, bx	; [previous_val_l]
  8889 00004EB6 66D1D8                  	rcr	ax, 1
  8890 00004EB9 93                      	xchg	eax, ebx ; ax = [previous_val_l]
  8891 00004EBA 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  8892 00004EBD 66D1D8                  	rcr	ax, 1
  8893 00004EC0 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8894 00004EC3 66AB                    	stosw 		; interpolated sample 1 (L)
  8895 00004EC5 58                      	pop	eax  ; *
  8896 00004EC6 80C680                  	add	dh, 80h ; convert sound level 0 to 65535 format
  8897 00004EC9 52                      	push	edx  ; * ; [next_val_r]
  8898 00004ECA 92                      	xchg	eax, edx
  8899 00004ECB 6601D0                  	add	ax, dx	; [next_val_r] + [previous_val_r]
  8900 00004ECE 66D1D8                  	rcr	ax, 1	; / 2
  8901 00004ED1 50                      	push	eax ; ** ; interpolated middle (R)
  8902 00004ED2 6601D0                  	add	ax, dx	; + [previous_val_r]
  8903 00004ED5 66D1D8                  	rcr	ax, 1
  8904 00004ED8 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8905 00004EDB 66AB                    	stosw 		; interpolated sample 1 (R)
  8906 00004EDD 66A1[27510000]          	mov	ax, [next_val_l]
  8907 00004EE3 6601D8                  	add	ax, bx	; + interpolated middle (L)
  8908 00004EE6 66D1D8                  	rcr	ax, 1
  8909 00004EE9 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8910 00004EEC 66AB                    	stosw 		; interpolated sample 2 (L)
  8911 00004EEE 58                      	pop	eax ; **
  8912 00004EEF 5A                      	pop	edx ; *
  8913 00004EF0 6601D0                  	add	ax, dx	; interpolated middle + [next_val_r]
  8914 00004EF3 66D1D8                  	rcr	ax, 1	; / 2
  8915 00004EF6 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8916 00004EF9 66AB                    	stosw 		; interpolated sample 2 (L)
  8917 00004EFB C3                      	retn
  8918                                  
  8919                                  ; =============== S U B R O U T I N E =======================================
  8920                                  
  8921                                  interpolating_2_16bit_mono:
  8922                                  	; 16/11/2023
  8923                                  	; ax = [previous_val]
  8924                                  	; dx = [next_val]
  8925                                  	; original-interpolated
  8926                                  
  8927 00004EFC 66AB                    	stosw		; original sample (L)
  8928 00004EFE 66AB                    	stosw		; original sample (R)
  8929 00004F00 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  8930 00004F03 80C680                  	add	dh, 80h
  8931 00004F06 6601D0                  	add	ax, dx
  8932 00004F09 66D1D8                  	rcr	ax, 1
  8933 00004F0C 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8934 00004F0F 66AB                    	stosw		; interpolated sample (L)
  8935 00004F11 66AB                    	stosw		; interpolated sample (R)
  8936 00004F13 C3                      	retn
  8937                                  
  8938                                  ; =============== S U B R O U T I N E =======================================
  8939                                  
  8940                                  interpolating_2_16bit_stereo:
  8941                                  	; 16/11/2023
  8942                                  	; bx = [previous_val_l]
  8943                                  	; ax = [previous_val_r]
  8944                                  	; [next_val_l]
  8945                                  	; dx = [next_val_r]
  8946                                  	; original-interpolated
  8947                                  
  8948 00004F14 93                      	xchg	eax, ebx
  8949 00004F15 66AB                    	stosw		; original sample (L)
  8950 00004F17 93                      	xchg	eax, ebx
  8951 00004F18 66AB                    	stosw		; original sample (R)
  8952 00004F1A 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  8953 00004F1D 80C680                  	add	dh, 80h
  8954 00004F20 6601D0                  	add	ax, dx	; [previous_val_r] + [next_val_r]
  8955 00004F23 66D1D8                  	rcr	ax, 1	; / 2
  8956                                  	; 14/01/2025
  8957 00004F26 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8958                                  	;push	eax ; *	; interpolated sample (R)
  8959                                  	; 14/01/2025
  8960 00004F29 C1E010                  	shl	eax, 16
  8961 00004F2C 66A1[27510000]          	mov	ax, [next_val_l]
  8962 00004F32 80C480                  	add	ah, 80h
  8963 00004F35 80C780                  	add	bh, 80h
  8964 00004F38 6601D8                  	add	ax, bx	; [next_val_l] + [previous_val_l]
  8965 00004F3B 66D1D8                  	rcr	ax, 1	; / 2
  8966 00004F3E 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8967                                  	; 14/01/2025
  8968                                  	;stosw 		; interpolated sample (L)
  8969                                  	;pop	eax ; *	
  8970                                  	;sub	ah, 80h	; -32768 to +32767 format again
  8971                                  	;stosw 		; interpolated sample (R)
  8972                                  	; 14/01/2025
  8973 00004F41 AB                      	stosd
  8974 00004F42 C3                      	retn
  8975                                  
  8976                                  ; =============== S U B R O U T I N E =======================================
  8977                                  
  8978                                  interpolating_5_16bit_mono:
  8979                                  	; 18/11/2023
  8980                                  	; ax = [previous_val]
  8981                                  	; dx = [next_val]
  8982                                  	; original-interpltd-interpltd-interpltd-interpltd
  8983 00004F43 66AB                    	stosw		; original sample (L)
  8984 00004F45 66AB                    	stosw		; original sample (R)
  8985 00004F47 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  8986 00004F4A 89C3                    	mov	ebx, eax ; [previous_val]
  8987 00004F4C 80C680                  	add	dh, 80h
  8988 00004F4F 6601D0                  	add	ax, dx
  8989 00004F52 66D1D8                  	rcr	ax, 1
  8990 00004F55 50                      	push	eax ; *	; interpolated middle (temporary)
  8991 00004F56 6601D8                  	add	ax, bx	; interpolated middle + [previous_val] 
  8992 00004F59 66D1D8                  	rcr	ax, 1
  8993 00004F5C 50                      	push	eax ; **	; interpolated 1st quarter (temporary)
  8994 00004F5D 6601D8                  	add	ax, bx	; 1st quarter + [previous_val]
  8995 00004F60 66D1D8                  	rcr	ax, 1	
  8996 00004F63 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8997 00004F66 66AB                    	stosw 		; interpolated sample 1 (L)
  8998 00004F68 66AB                    	stosw		; interpolated sample 1 (R)
  8999 00004F6A 58                      	pop	eax ; **
  9000 00004F6B 5B                      	pop	ebx ; *
  9001 00004F6C 6601D8                  	add	ax, bx	; 1st quarter + middle
  9002 00004F6F 66D1D8                  	rcr	ax, 1	; / 2
  9003 00004F72 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again	
  9004 00004F75 66AB                    	stosw		; interpolated sample 2 (L)
  9005 00004F77 66AB                    	stosw		; interpolated sample 2 (R)
  9006 00004F79 89D8                    	mov	eax, ebx
  9007 00004F7B 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  9008 00004F7E 66D1D8                  	rcr	ax, 1
  9009 00004F81 50                      	push	eax ; *	; interpolated 3rd quarter (temporary)
  9010 00004F82 6601D8                  	add	ax, bx	; + interpolated middle
  9011 00004F85 66D1D8                  	rcr	ax, 1
  9012 00004F88 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9013 00004F8B 66AB                    	stosw		; interpolated sample 3 (L)
  9014 00004F8D 66AB                    	stosw		; interpolated sample 3 (R)
  9015 00004F8F 58                      	pop	eax ; *	
  9016 00004F90 6601D0                  	add	ax, dx	; 3rd quarter + [next_val]
  9017 00004F93 66D1D8                  	rcr	ax, 1	; / 2
  9018 00004F96 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9019 00004F99 66AB                    	stosw		; interpolated sample 4 (L)
  9020 00004F9B 66AB                    	stosw		; interpolated sample 4 (R)
  9021 00004F9D C3                      	retn
  9022                                  
  9023                                  ; =============== S U B R O U T I N E =======================================
  9024                                  
  9025                                  interpolating_5_16bit_stereo:
  9026                                  	; 18/11/2023
  9027                                  	; bx = [previous_val_l]
  9028                                  	; ax = [previous_val_r]
  9029                                  	; [next_val_l]
  9030                                  	; [next_val_r]
  9031                                  	; original-interpltd-interpltd-interpltd-interpltd
  9032 00004F9E 51                      	push	ecx ; !
  9033 00004F9F 93                      	xchg	eax, ebx
  9034 00004FA0 66AB                    	stosw		; original sample (L)
  9035 00004FA2 93                      	xchg	eax, ebx
  9036 00004FA3 66AB                    	stosw		; original sample (R)
  9037 00004FA5 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  9038 00004FA8 50                      	push	eax ; *	; [previous_val_r]
  9039 00004FA9 80C780                  	add	bh, 80h
  9040 00004FAC 8005[28510000]80        	add	byte [next_val_l+1], 80h
  9041 00004FB3 66A1[27510000]          	mov	ax, [next_val_l]
  9042 00004FB9 6601D8                  	add	ax, bx	; [previous_val_l]
  9043 00004FBC 66D1D8                  	rcr	ax, 1
  9044 00004FBF 89C1                    	mov	ecx, eax ; interpolated middle (L)
  9045 00004FC1 6601D8                  	add	ax, bx	
  9046 00004FC4 66D1D8                  	rcr	ax, 1
  9047 00004FC7 89C2                    	mov	edx, eax ; interpolated 1st quarter (L)
  9048 00004FC9 6601D8                  	add	ax, bx	; [previous_val_l]
  9049 00004FCC 66D1D8                  	rcr	ax, 1
  9050 00004FCF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9051 00004FD2 66AB                    	stosw 		; interpolated sample 1 (L)
  9052 00004FD4 89C8                    	mov	eax, ecx
  9053 00004FD6 6601D0                  	add	ax, dx	; middle (L) + 1st quarter (L)
  9054 00004FD9 66D1D8                  	rcr	ax, 1	; / 2
  9055 00004FDC 89C3                    	mov	ebx, eax  ; interpolated sample 2 (L)
  9056 00004FDE 5A                      	pop	edx ; *	; [previous_val_r]
  9057 00004FDF 89D0                    	mov	eax, edx
  9058 00004FE1 8005[2A510000]80        	add	byte [next_val_r+1], 80h
  9059 00004FE8 660305[29510000]        	add	ax, [next_val_r]
  9060 00004FEF 66D1D8                  	rcr	ax, 1
  9061 00004FF2 50                      	push	eax ; *	; interpolated middle (R)
  9062 00004FF3 6601D0                  	add	ax, dx
  9063 00004FF6 66D1D8                  	rcr	ax, 1
  9064 00004FF9 50                      	push	eax ; ** ; interpolated 1st quarter (R)
  9065 00004FFA 6601D0                  	add	ax, dx	; [previous_val_r]
  9066 00004FFD 66D1D8                  	rcr	ax, 1
  9067 00005000 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9068 00005003 66AB                    	stosw 		; interpolated sample 1 (R)
  9069 00005005 89D8                    	mov	eax, ebx
  9070 00005007 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9071 0000500A 66AB                    	stosw 		; interpolated sample 2 (L)
  9072 0000500C 58                      	pop	eax ; **
  9073 0000500D 5A                      	pop	edx ; *
  9074 0000500E 6601D0                  	add	ax, dx	; 1st quarter (R) + middle (R)
  9075 00005011 66D1D8                  	rcr	ax, 1	; / 2
  9076 00005014 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9077 00005017 66AB                    	stosw 		; interpolated sample 2 (R)
  9078 00005019 89C8                    	mov	eax, ecx
  9079 0000501B 660305[27510000]        	add	ax, [next_val_l]
  9080 00005022 66D1D8                  	rcr	ax, 1
  9081 00005025 50                      	push	eax ; * ; interpolated 3rd quarter (L)
  9082 00005026 6601C8                  	add	ax, cx	; interpolated middle (L)
  9083 00005029 66D1D8                  	rcr	ax, 1
  9084 0000502C 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9085 0000502F 66AB                    	stosw 		; interpolated sample 3 (L)
  9086 00005031 89D0                    	mov	eax, edx
  9087 00005033 660305[29510000]        	add	ax, [next_val_r]
  9088 0000503A 66D1D8                  	rcr	ax, 1
  9089 0000503D 50                      	push	eax ; ** ; interpolated 3rd quarter (R)
  9090 0000503E 6601D0                  	add	ax, dx	; interpolated middle (R)
  9091 00005041 66D1D8                  	rcr	ax, 1
  9092 00005044 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9093 00005047 66AB                    	stosw 		; interpolated sample 3 (R)
  9094 00005049 5B                      	pop	ebx ; **
  9095 0000504A 58                      	pop	eax ; *
  9096 0000504B 660305[27510000]        	add	ax, [next_val_l]
  9097 00005052 66D1D8                  	rcr	ax, 1
  9098 00005055 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9099 00005058 66AB                    	stosw 		; interpolated sample 4 (L)
  9100 0000505A 89D8                    	mov	eax, ebx
  9101 0000505C 660305[29510000]        	add	ax, [next_val_r]
  9102 00005063 66D1D8                  	rcr	ax, 1
  9103 00005066 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9104 00005069 66AB                    	stosw 		; interpolated sample 4 (R)
  9105 0000506B 59                      	pop	ecx ; !
  9106 0000506C C3                      	retn
  9107                                  
  9108                                  ; =============== S U B R O U T I N E =======================================
  9109                                  
  9110                                  interpolating_4_16bit_mono:
  9111                                  	; 18/11/2023
  9112                                  	; ax = [previous_val]
  9113                                  	; dx = [next_val]
  9114                                  	; 01/02/2025
  9115                                  	; original-interpolated-interpolated-interpolated
  9116                                  
  9117 0000506D 66AB                    	stosw		; original sample (L)
  9118 0000506F 66AB                    	stosw		; original sample (R)
  9119 00005071 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  9120 00005074 89C3                    	mov	ebx, eax ; [previous_val]
  9121 00005076 80C680                  	add	dh, 80h
  9122 00005079 6601D0                  	add	ax, dx	; [previous_val] + [next_val]
  9123 0000507C 66D1D8                  	rcr	ax, 1
  9124 0000507F 93                      	xchg	eax, ebx
  9125 00005080 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  9126 00005083 66D1D8                  	rcr	ax, 1
  9127 00005086 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9128 00005089 66AB                    	stosw 		; interpolated sample 1 (L)
  9129 0000508B 66AB                    	stosw		; interpolated sample 1 (R)
  9130 0000508D 89D8                    	mov	eax, ebx ; interpolated middle
  9131 0000508F 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9132 00005092 66AB                    	stosw 		; interpolated sample 2 (L)
  9133 00005094 66AB                    	stosw		; interpolated sample 2 (R)
  9134 00005096 89D8                    	mov	eax, ebx
  9135 00005098 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  9136 0000509B 66D1D8                  	rcr	ax, 1
  9137 0000509E 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9138 000050A1 66AB                    	stosw		; interpolated sample 3 (L)
  9139 000050A3 66AB                    	stosw		; interpolated sample 3 (R)
  9140 000050A5 C3                      	retn
  9141                                  
  9142                                  ; =============== S U B R O U T I N E =======================================
  9143                                  
  9144                                  interpolating_4_16bit_stereo:
  9145                                  	; 18/11/2023
  9146                                  	; bx = [previous_val_l]
  9147                                  	; ax = [previous_val_r]
  9148                                  	; [next_val_l]
  9149                                  	; [next_val_r]
  9150                                  	; original-interpolated-interpolated-interpolated
  9151 000050A6 93                      	xchg	eax, ebx
  9152 000050A7 66AB                    	stosw		; original sample (L)
  9153 000050A9 93                      	xchg	eax, ebx
  9154 000050AA 66AB                    	stosw		; original sample (R)
  9155 000050AC 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  9156 000050AF 89C2                    	mov	edx, eax ; [previous_val_r]
  9157 000050B1 80C780                  	add	bh, 80h
  9158 000050B4 8005[28510000]80        	add	byte [next_val_l+1], 80h
  9159 000050BB 66A1[27510000]          	mov	ax, [next_val_l]
  9160 000050C1 6601D8                  	add	ax, bx	; [previous_val_l]
  9161 000050C4 66D1D8                  	rcr	ax, 1
  9162 000050C7 93                      	xchg	eax, ebx
  9163 000050C8 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  9164 000050CB 66D1D8                  	rcr	ax, 1
  9165 000050CE 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9166 000050D1 66AB                    	stosw 		; interpolated sample 1 (L)
  9167 000050D3 8005[2A510000]80        	add	byte [next_val_r+1], 80h
  9168 000050DA 89D0                    	mov	eax, edx ; [previous_val_r]
  9169 000050DC 660305[29510000]        	add	ax, [next_val_r]
  9170 000050E3 66D1D8                  	rcr	ax, 1
  9171 000050E6 92                      	xchg	eax, edx
  9172 000050E7 6601D0                  	add	ax, dx	; dx = interpolated middle (R)
  9173 000050EA 66D1D8                  	rcr	ax, 1
  9174 000050ED 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9175 000050F0 66AB                    	stosw 		; interpolated sample 1 (R)
  9176 000050F2 89D8                    	mov	eax, ebx
  9177 000050F4 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9178 000050F7 66AB                    	stosw 		; interpolated sample 2 (L)
  9179 000050F9 89D0                    	mov	eax, edx
  9180 000050FB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9181 000050FE 66AB                    	stosw 		; interpolated sample 2 (R)
  9182 00005100 89D8                    	mov	eax, ebx
  9183 00005102 660305[27510000]        	add	ax, [next_val_l]
  9184 00005109 66D1D8                  	rcr	ax, 1
  9185 0000510C 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9186 0000510F 66AB                    	stosw 		; interpolated sample 3 (L)
  9187 00005111 89D0                    	mov	eax, edx
  9188 00005113 660305[29510000]        	add	ax, [next_val_r]
  9189 0000511A 66D1D8                  	rcr	ax, 1
  9190 0000511D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9191 00005120 66AB                    	stosw 		; interpolated sample 3 (R)
  9192 00005122 C3                      	retn
  9193                                  
  9194                                  ; ---------------------------------------------------------------------------
  9195                                  
  9196                                  ; 13/11/2023
  9197                                  previous_val:
  9198 00005123 0000                    previous_val_l: dw 0
  9199 00005125 0000                    previous_val_r: dw 0
  9200                                  next_val:
  9201 00005127 0000                    next_val_l: dw 0
  9202 00005129 0000                    next_val_r: dw 0
  9203                                  
  9204                                  ; 16/11/2023
  9205 0000512B 00                      faz:	db 0
  9206                                  
  9207                                  ; ---------------------------------------------------------------------------
  9208                                  ; 15/02/2025 - Hardware Info display/write procedures.
  9209                                  ; ---------------------------------------------------------------------------
  9210                                  ; ref: twavply3.s (10/02/2025
  9211                                  
  9212                                  ;=============================================================================
  9213                                  ;	Write AC'97 Hardware Information
  9214                                  ;=============================================================================
  9215                                  	
  9216                                  	; 09/02/2025
  9217                                  
  9218                                  write_audio_dev_info:
  9219 0000512C 31DB                    	xor	ebx, ebx
  9220 0000512E 803D[78B20000]01        	cmp	byte [audio_hardware], 1
  9221 00005135 7557                    	jne	short write_ac97_pci_dev_info
  9222                                  
  9223                                  ;-----------------------------------------------------------------------------
  9224                                  	
  9225                                  	; 09/02/2025
  9226                                  	; 05/02/2025 - sb16play.s
  9227                                  
  9228                                  write_sb16_dev_info:
  9229 00005137 A1[70B20000]            	mov	eax, [audio_io_base]
  9230                                  	;xor	ebx, ebx
  9231 0000513C 88C3                    	mov	bl, al
  9232 0000513E 88DA                    	mov	dl, bl
  9233 00005140 80E30F                  	and	bl, 0Fh
  9234 00005143 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9235 00005149 A2[B0B00000]            	mov	[msgBasePort+2], al
  9236 0000514E 88D3                    	mov	bl, dl
  9237 00005150 C0EB04                  	shr	bl, 4
  9238 00005153 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9239 00005159 A2[AFB00000]            	mov	[msgBasePort+1], al
  9240 0000515E 88E3                    	mov	bl, ah
  9241                                  	;and	bl, 0Fh
  9242 00005160 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9243 00005166 A2[AEB00000]            	mov	[msgBasePort], al
  9244                                  
  9245                                  	;xor	eax, eax
  9246 0000516B A0[74B20000]            	mov	al, [audio_intr]
  9247 00005170 0430                    	add	al, 30h
  9248 00005172 A2[C5B00000]            	mov	[msgSB16IRQ], al
  9249                                  
  9250                                  	sys	_msg, msgSB16Info, 255, 07h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00005177 BB[78B00000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 0000517C B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005181 BA07000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005186 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000518B CD40                <1>  int 40h
  9251                                  
  9252 0000518D C3                      	retn
  9253                                  
  9254                                  ;-----------------------------------------------------------------------------
  9255                                  
  9256                                  	; 09/02/2025
  9257                                  	; 05/02/2025 - ac97play.s
  9258                                  	
  9259                                  write_ac97_pci_dev_info:
  9260                                  	; BUS/DEV/FN
  9261                                  	;	00000000BBBBBBBBDDDDDFFF00000000
  9262                                  	; DEV/VENDOR
  9263                                  	;	DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV
  9264                                  
  9265 0000518E A1[68B20000]            	mov	eax, [dev_vendor]
  9266                                  	; 07/12/2024
  9267 00005193 31DB                    	xor	ebx, ebx
  9268 00005195 88C3                    	mov	bl, al
  9269 00005197 88DA                    	mov	dl, bl
  9270 00005199 80E30F                  	and	bl, 0Fh
  9271 0000519C 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9272 000051A2 A2[4BAF0000]            	mov	[msgVendorId+3], al
  9273 000051A7 88D3                    	mov	bl, dl
  9274 000051A9 C0EB04                  	shr	bl, 4
  9275 000051AC 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9276 000051B2 A2[4AAF0000]            	mov	[msgVendorId+2], al
  9277 000051B7 88E3                    	mov	bl, ah
  9278 000051B9 88DA                    	mov	dl, bl
  9279 000051BB 80E30F                  	and	bl, 0Fh
  9280 000051BE 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9281 000051C4 A2[49AF0000]            	mov	[msgVendorId+1], al
  9282 000051C9 88D3                    	mov	bl, dl
  9283 000051CB C0EB04                  	shr	bl, 4
  9284 000051CE 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9285 000051D4 A2[48AF0000]            	mov	[msgVendorId], al
  9286 000051D9 C1E810                  	shr	eax, 16
  9287 000051DC 88C3                    	mov	bl, al
  9288 000051DE 88DA                    	mov	dl, bl
  9289 000051E0 80E30F                  	and	bl, 0Fh
  9290 000051E3 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9291 000051E9 A2[5CAF0000]            	mov	[msgDevId+3], al
  9292 000051EE 88D3                    	mov	bl, dl
  9293 000051F0 C0EB04                  	shr	bl, 4
  9294 000051F3 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9295 000051F9 A2[5BAF0000]            	mov	[msgDevId+2], al
  9296 000051FE 88E3                    	mov	bl, ah
  9297 00005200 88DA                    	mov	dl, bl
  9298 00005202 80E30F                  	and	bl, 0Fh
  9299 00005205 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9300 0000520B A2[5AAF0000]            	mov	[msgDevId+1], al
  9301 00005210 88D3                    	mov	bl, dl
  9302 00005212 C0EB04                  	shr	bl, 4
  9303 00005215 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9304 0000521B A2[59AF0000]            	mov	[msgDevId], al
  9305                                  
  9306 00005220 A1[64B20000]            	mov	eax, [bus_dev_fn]
  9307 00005225 C1E808                  	shr	eax, 8
  9308 00005228 88C3                    	mov	bl, al
  9309 0000522A 88DA                    	mov	dl, bl
  9310 0000522C 80E307                  	and	bl, 7 ; bit 0,1,2
  9311 0000522F 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9312 00005235 A2[80AF0000]            	mov	[msgFncNo+1], al
  9313 0000523A 88D3                    	mov	bl, dl
  9314 0000523C C0EB03                  	shr	bl, 3
  9315 0000523F 88DA                    	mov	dl, bl
  9316 00005241 80E30F                  	and	bl, 0Fh
  9317 00005244 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9318 0000524A A2[72AF0000]            	mov	[msgDevNo+1], al
  9319 0000524F 88D3                    	mov	bl, dl
  9320 00005251 C0EB04                  	shr	bl, 4
  9321 00005254 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9322 0000525A A2[71AF0000]            	mov	[msgDevNo], al
  9323 0000525F 88E3                    	mov	bl, ah
  9324 00005261 88DA                    	mov	dl, bl
  9325 00005263 80E30F                  	and	bl, 0Fh
  9326 00005266 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9327 0000526C A2[66AF0000]            	mov	[msgBusNo+1], al
  9328 00005271 88D3                    	mov	bl, dl
  9329 00005273 C0EB04                  	shr	bl, 4
  9330 00005276 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9331 0000527C A2[65AF0000]            	mov	[msgBusNo], al
  9332                                  
  9333                                  	;mov	ax, [ac97_NamBar]
  9334 00005281 66A1[6CB20000]          	mov	ax, [NAMBAR]
  9335 00005287 88C3                    	mov	bl, al
  9336 00005289 88DA                    	mov	dl, bl
  9337 0000528B 80E30F                  	and	bl, 0Fh
  9338 0000528E 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9339 00005294 A2[8FAF0000]            	mov	[msgNamBar+3], al
  9340 00005299 88D3                    	mov	bl, dl
  9341 0000529B C0EB04                  	shr	bl, 4
  9342 0000529E 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9343 000052A4 A2[8EAF0000]            	mov	[msgNamBar+2], al
  9344 000052A9 88E3                    	mov	bl, ah
  9345 000052AB 88DA                    	mov	dl, bl
  9346 000052AD 80E30F                  	and	bl, 0Fh
  9347 000052B0 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9348 000052B6 A2[8DAF0000]            	mov	[msgNamBar+1], al
  9349 000052BB 88D3                    	mov	bl, dl
  9350 000052BD C0EB04                  	shr	bl, 4
  9351 000052C0 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9352 000052C6 A2[8CAF0000]            	mov	[msgNamBar], al
  9353                                  
  9354                                  	;mov	ax, [ac97_NabmBar]
  9355 000052CB 66A1[6EB20000]          	mov	ax, [NABMBAR]
  9356 000052D1 88C3                    	mov	bl, al
  9357 000052D3 88DA                    	mov	dl, bl
  9358 000052D5 80E30F                  	and	bl, 0Fh
  9359 000052D8 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9360 000052DE A2[9FAF0000]            	mov	[msgNabmBar+3], al
  9361 000052E3 88D3                    	mov	bl, dl
  9362 000052E5 C0EB04                  	shr	bl, 4
  9363 000052E8 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9364 000052EE A2[9EAF0000]            	mov	[msgNabmBar+2], al
  9365 000052F3 88E3                    	mov	bl, ah
  9366 000052F5 88DA                    	mov	dl, bl
  9367 000052F7 80E30F                  	and	bl, 0Fh
  9368 000052FA 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9369 00005300 A2[9DAF0000]            	mov	[msgNabmBar+1], al
  9370 00005305 88D3                    	mov	bl, dl
  9371 00005307 C0EB04                  	shr	bl, 4
  9372 0000530A 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9373 00005310 A2[9CAF0000]            	mov	[msgNabmBar], al
  9374                                  
  9375 00005315 31C0                    	xor	eax, eax
  9376 00005317 A0[74B20000]            	mov	al, [ac97_int_ln_reg]
  9377 0000531C B10A                    	mov	cl, 10
  9378 0000531E F6F1                    	div	cl
  9379                                  	;add	[msgIRQ], ax
  9380 00005320 66053030                	add	ax, 3030h
  9381 00005324 66A3[A8AF0000]          	mov	[msgIRQ], ax
  9382                                  	;and	al, al
  9383 0000532A 3C30                    	cmp	al, 30h
  9384 0000532C 750D                    	jne	short _w_ac97imsg_
  9385 0000532E A0[A9AF0000]            	mov	al, [msgIRQ+1]
  9386 00005333 B420                    	mov	ah, ' '
  9387 00005335 66A3[A8AF0000]          	mov	[msgIRQ], ax
  9388                                  _w_ac97imsg_:
  9389                                  	sys	_msg, msgAC97Info, 255, 07h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000533B BB[17AF0000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00005340 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005345 BA07000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000534A B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000534F CD40                <1>  int 40h
  9390                                  
  9391                                          ;retn
  9392                                  
  9393                                  ;-----------------------------------------------------------------------------
  9394                                  
  9395                                  write_VRA_info:
  9396                                  	sys	_msg, msgVRAheader, 255, 07h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00005351 BB[33B00000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00005356 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 0000535B BA07000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005360 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00005365 CD40                <1>  int 40h
  9397 00005367 803D[79B20000]00        	cmp	byte [vra], 0
  9398 0000536E 7617                    	jna	short _w_VRAi_no
  9399                                  _w_VRAi_yes:
  9400                                  	sys	_msg, msgVRAyes, 255, 07h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00005370 BB[41B00000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00005375 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 0000537A BA07000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000537F B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00005384 CD40                <1>  int 40h
  9401 00005386 C3                      	retn
  9402                                  _w_VRAi_no:
  9403                                  	sys	_msg, msgVRAno, 255, 07h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00005387 BB[47B00000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 0000538C B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005391 BA07000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005396 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000539B CD40                <1>  int 40h
  9404 0000539D C3                      	retn
  9405                                  
  9406                                  ; 13/01/2025
  9407                                  ; ---------------------------------------------------------------------------
  9408                                  ; 25/11/2023
  9409                                  msg_no_vra:
  9410 0000539E 0A0D                    		db 10, 13
  9411 000053A0 4E6F20565241207375-     		db "No VRA support ! Only 48 kHZ sample rate supported !"
  9411 000053A9 70706F72742021204F-
  9411 000053B2 6E6C79203438206B48-
  9411 000053BB 5A2073616D706C6520-
  9411 000053C4 726174652073757070-
  9411 000053CD 6F727465642021     
  9412 000053D4 0A0D00                  		db 10, 13, 0
  9413                                  
  9414                                  
  9415                                  ; ---------------------------------------------------------------------------
  9416                                  ; 22/01/2025 - Check Update Events
  9417                                  ; ---------------------------------------------------------------------------
  9418                                  ; ref: playwav9.s (17/01/2025)
  9419                                  
  9420                                  ; =============== S U B R O U T I N E =======================================
  9421                                  
  9422                                  		; 16/02/2025 (tmp3play.s)
  9423                                  		; 10/02/2025 (twavply3.s)
  9424                                  		; 13/02/2025 (mp3play6.s)
  9425                                  		; 26/01/2025 (mp3play5.s)
  9426                                  		; 24/12/2024 (vgaplay.s)
  9427                                  		; 23/01/2025 (mp3play4.s)
  9428                                  		; 07/12/2024 (playwav9.s)
  9429                                  
  9430                                  checkUpdateEvents:
  9431 000053D7 E8B4000000              		call	check4keyboardstop
  9432 000053DC 7259                    		jc	short .c4ue_ok
  9433                                  
  9434 000053DE 50                      		push	eax ; *
  9435 000053DF 09C0                    		or	eax, eax
  9436 000053E1 747F                    		jz	short .c4ue_cpt
  9437                                  
  9438 000053E3 3C20                    		cmp	al, 20h ; SPACE (spacebar) ; pause/play
  9439 000053E5 7551                    		jne	short .c4ue_chk_s
  9440 000053E7 803D[75B20000]00        		cmp	byte [stopped], 0
  9441 000053EE 7707                    		ja	short .c4ue_chk_ps
  9442                                  		; pause
  9443 000053F0 E84EEFFFFF              		call	audio_f_pause
  9444                                  
  9445 000053F5 EB6B                    		jmp	short .c4ue_cpt
  9446                                  .c4ue_chk_ps:
  9447 000053F7 803D[75B20000]01        		cmp	byte [stopped], 1
  9448 000053FE 7707                    		ja	short .c4ue_replay
  9449                                  		
  9450                                  		; continue to play (after a pause)
  9451 00005400 E852EFFFFF              		call	audio_f_play
  9452 00005405 EB5B                    		jmp	.c4ue_cpt
  9453                                  .c4ue_replay:
  9454 00005407 58                      		pop	eax ; *
  9455 00005408 58                      		pop	eax ; return address
  9456                                  	
  9457 00005409 C605[75B20000]00        		mov	byte [stopped], 0
  9458                                  
  9459                                  		; move to beginning
  9460                                  		;mov	eax, [stream_start]
  9461 00005410 A1[58B20000]            		mov	eax, [stream_begin] ; 1st [stream_pos] value
  9462 00005415 A3[E0510500]            		mov	[stream_pos], eax
  9463 0000541A A1[54B20000]            		mov	eax, [stream_size]
  9464 0000541F A3[E4510500]            		mov	[bytes_left], eax
  9465                                  
  9466 00005424 803D[8CB20000]00        		cmp	byte [interpolation], 0
  9467 0000542B 7705                    		ja	short .c4ue_rp_indr
  9468                                  		;jmp	start.direct
  9469                                  		; 16/02/2025
  9470 0000542D E919AEFFFF              		jmp	replay.direct
  9471                                  .c4ue_rp_indr:
  9472                                  		;jmp	start.indirect
  9473                                  		; 16/02/2025
  9474 00005432 E933AEFFFF              		jmp	replay.indirect
  9475                                  .c4ue_ok:
  9476 00005437 C3                      		retn
  9477                                  .c4ue_chk_s:
  9478 00005438 3C53                    		cmp	al, 'S'	; stop
  9479 0000543A 7510                    		jne	short .c4ue_chk_fb
  9480 0000543C 803D[75B20000]00        		cmp	byte [stopped], 0
  9481 00005443 771D                    		ja	short .c4ue_cpt ; Already stopped/paused
  9482                                  .c4ue_stop:
  9483 00005445 E8CDEEFFFF              		call	audio_f_stop
  9484 0000544A EB16                    		jmp	short .c4ue_cpt
  9485                                  .c4ue_chk_fb:
  9486 0000544C 3C46                    		cmp	al, 'F'
  9487 0000544E 7507                    		jne	short .c4ue_chk_b
  9488                                  		;call	Player_ProcessKey_Forwards
  9489                                  		; 16/02/2025
  9490 00005450 E89A000000              		call	move_forward
  9491 00005455 EB0B                    		jmp	short .c4ue_cpt
  9492                                  .c4ue_chk_b:
  9493 00005457 3C42                    		cmp	al, 'B'
  9494                                  		; 16/02/2025
  9495 00005459 7507                    		jne	short .c4ue_cpt
  9496                                  		;call 	Player_ProcessKey_Backwards
  9497                                  		; 16/02/2025
  9498 0000545B E8BC000000              		call	move_backward
  9499 00005460 EB00                    		jmp	short .c4ue_cpt
  9500                                  
  9501                                  		; 16/02/2025
  9502                                  .c4ue_cpt:
  9503                                  		sys	_time, 4 ; get timer ticks (18.2 ticks/second)
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00005462 BB04000000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005467 B80D000000          <1>  mov eax, %1
   112                              <1> 
   113 0000546C CD40                <1>  int 40h
  9504                                  		
  9505 0000546E 59                      		pop	ecx ; *
  9506 0000546F 3B05[80B20000]          		cmp	eax, [timerticks]
  9507 00005475 7407                    		je	short .c4ue_skip_utt
  9508                                  .c4ue_utt:	
  9509 00005477 A3[80B20000]            		mov	[timerticks], eax
  9510 0000547C EB04                    		jmp	short .c4ue_cpt_@
  9511                                  
  9512                                  .c4ue_skip_utt:
  9513 0000547E 21C9                    		and	ecx, ecx
  9514 00005480 74B5                    		jz	short .c4ue_ok
  9515                                  .c4ue_cpt_@:
  9516 00005482 803D[75B20000]00        		cmp	byte [stopped], 0
  9517 00005489 77AC                    		ja	short .c4ue_ok
  9518                                  	
  9519                                  		; 16/02/2025
  9520 0000548B E9D1020000              		jmp	drawscopes
  9521                                  
  9522                                  
  9523                                  ; =============== S U B R O U T I N E =======================================
  9524                                  
  9525                                  ; --------------------------------------------------------
  9526                                  ; 22/01/2025 - Check for Keyboard Stop (Request)
  9527                                  ; --------------------------------------------------------
  9528                                  
  9529                                  		; 16/02/2025
  9530                                  		; 23/01/2025
  9531                                  		; 22/01/2025
  9532                                  check4keyboardstop:
  9533 00005490 B411                    		mov	ah, 11h
  9534                                  		; (TRDOS 386 keyboard interrupt)
  9535 00005492 CD32                    		int	32h
  9536                                  		;clc
  9537 00005494 7438                    		jz	short .cksr
  9538                                  
  9539 00005496 B410                    		mov	ah, 10h
  9540 00005498 CD32                    		int	32h
  9541                                  
  9542                                  		; 13/02/2025
  9543                                  		; 23/01/2025
  9544                                  		;;;;
  9545                                  .clear_keyb_buf:
  9546 0000549A 50                      		push	eax ; *
  9547                                  		; clear keyboard buffer
  9548 0000549B B411                    		mov	ah, 11h
  9549 0000549D CD32                    		int	32h
  9550 0000549F 7407                    		jz	short .c4ks
  9551 000054A1 B410                    		mov	ah, 10h
  9552 000054A3 CD32                    		int	32h
  9553 000054A5 5A                      		pop	edx ; *
  9554 000054A6 EBF2                    		jmp	short .clear_keyb_buf
  9555                                  
  9556                                  		; TRDOS 386 system call
  9557                                  		; sysstdio
  9558                                  		; BL = 1 -> read a character on stdin (no wait)
  9559                                  		;sys	_stdio, 1
  9560                                  		;and	eax, eax
  9561                                  		;jz	short .cksr
  9562                                  
  9563                                  		; 23/01/2025
  9564                                  .c4ks:
  9565 000054A8 58                      		pop	eax ; *
  9566                                  		;;;;
  9567                                  
  9568                                  		;;;
  9569                                  		; (change PCM out volume)
  9570 000054A9 3C2B                    		cmp	al, '+'
  9571 000054AB 750D                    		jne	short .p_1
  9572                                  	
  9573 000054AD A0[B8B10000]            		mov	al, [volume_level]
  9574 000054B2 3C00                    		cmp	al, 0
  9575 000054B4 761A                    		jna	short .p_3
  9576 000054B6 FEC8                    		dec	al
  9577 000054B8 EB0F                    		jmp	short .p_2
  9578                                  .p_1:
  9579 000054BA 3C2D                    		cmp	al, '-'
  9580 000054BC 7513                    		jne	short .p_4
  9581                                  
  9582 000054BE A0[B8B10000]            		mov	al, [volume_level]
  9583 000054C3 3C1F                    		cmp	al, 31
  9584 000054C5 7309                    		jnb	short .p_3
  9585 000054C7 FEC0                    		inc	al
  9586                                  .p_2:
  9587                                  		; 16/02/2025
  9588 000054C9 E89DEEFFFF              		call	SetMasterVolume
  9589                                  .cksr:
  9590 000054CE 31C0                    		xor	eax, eax
  9591                                  .p_3:
  9592 000054D0 C3                      		retn
  9593                                  .p_4:
  9594                                  		;cmp	ah, 01 	; ESC
  9595 000054D1 663D1B01                		cmp	ax, 011Bh ; ESC
  9596 000054D5 7416                        		je	short .p_q
  9597                                  		;cmp	al, 03h	; CTRL+C
  9598 000054D7 663D032E                		cmp	ax, 2E03h ; CTRL+C
  9599 000054DB 7410                    		je	short .p_q
  9600                                  
  9601 000054DD 3C20                    		cmp	al, 20h
  9602 000054DF 740D                    		je	short .p_r
  9603                                  
  9604 000054E1 3C0D                    		cmp	al, 0Dh ; CR/ENTER
  9605 000054E3 7409                    		je	short .p_r
  9606                                  
  9607 000054E5 24DF                    		and	al, 0DFh
  9608                                  
  9609                                  		;cmp	al, 'B'
  9610                                  		;je	short .p_r
  9611                                  		;cmp	al, 'F'
  9612                                  		;je	short .p_r
  9613                                  
  9614 000054E7 3C51                    		cmp	al, 'Q'
  9615 000054E9 7402                    		je	short .p_q
  9616                                  
  9617 000054EB F8                      		clc
  9618 000054EC C3                      		retn
  9619                                  
  9620                                  .p_q:
  9621 000054ED F9                      		stc
  9622                                  .p_r:
  9623 000054EE C3                      		retn
  9624                                  
  9625                                  
  9626                                  ; --------------------------------------------------------
  9627                                  ; 22/01/2025 - Goto Forward approx. 5 seconds
  9628                                  ; --------------------------------------------------------
  9629                                  
  9630                                  		; 16/02/2025
  9631                                  move_forward:
  9632                                  		; 23/01/2025
  9633                                  		; 22/01/2025
  9634                                  ;Player_ProcessKey_Forwards:
  9635                                  		;; 5 seconds forward
  9636                                  		;;;;
  9637                                  		;xor	ebp, ebp ; 0
  9638                                  		;;;;
  9639 000054EF A0[7AB20000]            		mov	al, [srb]
  9640 000054F4 50                      		push	eax ; *
  9641 000054F5 A1[5CB20000]            		mov	eax, [fb_count]
  9642 000054FA 8B0D[54B20000]          		mov	ecx, [stream_size]
  9643 00005500 89CA                    		mov	edx, ecx
  9644 00005502 2B15[E4510500]          		sub	edx, [bytes_left]
  9645 00005508 01D0                    		add	eax, edx
  9646 0000550A 720C                    		jc	short .ppk_f@
  9647                                  		; 23/01/2025
  9648 0000550C 89CA                    		mov	edx, ecx
  9649 0000550E 2B15[5CB20000]          		sub	edx, [fb_count]
  9650 00005514 39D0                    		cmp	eax, edx
  9651                                  		;jna	short Player_ProcessKey_set_pos
  9652                                  		; 16/02/2025
  9653 00005516 7626                    		jna	short move_fwbw_set_pos
  9654                                  .ppk_f@:
  9655 00005518 89D0                    		mov	eax, edx ; offset
  9656                                  		;jmp	short Player_ProcessKey_set_pos
  9657                                  		; 16/02/2025
  9658 0000551A EB22                    		jmp 	short move_fwbw_set_pos
  9659                                  
  9660                                  ; --------------------------------------------------------
  9661                                  ; 22/01/2025 - Goto Backward approx. 5 seconds
  9662                                  ; --------------------------------------------------------
  9663                                  
  9664                                  		; 16/02/2025
  9665                                  move_backward:
  9666                                  		; 22/01/2025
  9667                                  ;Player_ProcessKey_Backwards:
  9668                                  		;; 5 seconds backward
  9669                                  		; 23/01/2025
  9670                                  		;;;;
  9671                                  		;xor	ebp, 1
  9672                                  		;;;;
  9673 0000551C A0[7AB20000]            		mov	al, [srb]
  9674 00005521 50                      		push	eax ; *
  9675 00005522 8B15[5CB20000]          		mov	edx, [fb_count]
  9676 00005528 8B0D[54B20000]          		mov	ecx, [stream_size]
  9677                                  			; the 1st/init value of [bytes_left]
  9678 0000552E 89C8                    		mov	eax, ecx
  9679 00005530 2B05[E4510500]          		sub	eax, [bytes_left]
  9680 00005536 7604                    		jna	short .ppk_bw@
  9681 00005538 29D0                    		sub	eax, edx
  9682                                  		;jnc	short Player_ProcessKey_set_pos
  9683                                  		; 16/02/2025
  9684 0000553A 7302                    		jnc	short move_fwbw_set_pos
  9685                                  .ppk_bw@:
  9686 0000553C 31C0                    		xor	eax, eax ; offset
  9687                                  
  9688                                  ; --------------------------------------------------------
  9689                                  
  9690                                  		; 16/02/2025
  9691                                  move_fwbw_set_pos:
  9692                                  		; 23/01/2025
  9693                                  		; 22/01/2025
  9694                                  ;Player_ProcessKey_set_pos:
  9695 0000553E 5B                      		pop	ebx ; *
  9696                                  		; skip position change if audio interrupt occurs
  9697                                  		; during this f/b procedure
  9698                                  		; (because [bytes_left] would be changed)
  9699 0000553F 803D[7AB20000]00        		cmp	byte [srb], 0
  9700 00005546 7605                    		jna	short .ppk_sp@ ; proper to change
  9701 00005548 80FB00                  		cmp	bl, 0
  9702 0000554B 7628                    		jna	short .ppk_sp@@@
  9703                                  		; [srb] was 1 when starting this f/b procedure
  9704                                  		; (so, there is not a conflict)	
  9705                                  .ppk_sp@:
  9706                                  		; pause playback, pause/start audio interrupt
  9707 0000554D 51                      		push	ecx
  9708 0000554E 50                      		push	eax
  9709 0000554F E8EFEDFFFF              		call	audio_f_pause
  9710 00005554 58                      		pop	eax
  9711 00005555 59                      		pop	ecx
  9712                                  
  9713 00005556 8B1D[58B20000]          		mov	ebx, [stream_begin] 
  9714                                  				; the 1st/init value of [stream_pos]
  9715 0000555C 01C3                    		add	ebx, eax
  9716 0000555E 891D[E0510500]          		mov	[stream_pos], ebx
  9717                                  		; ecx = [stream_size]
  9718                                  		; eax = offset
  9719 00005564 29C1                    		sub	ecx, eax
  9720 00005566 7302                    		jnc	short .ppk_sp@@
  9721 00005568 31C9                    		xor	ecx, ecx
  9722                                  .ppk_sp@@:
  9723                                  		; 23/01/2025
  9724 0000556A 890D[E4510500]          		mov	[bytes_left], ecx
  9725                                  
  9726                                  		;;;;
  9727                                  		; continue to playback
  9728 00005570 E8E2EDFFFF              		call	audio_f_play
  9729                                  .ppk_sp@@@:
  9730                                  		; clear keyboard buffer
  9731                                  		;call	clear_keyb_buf
  9732                                  ; 23/01/2025
  9733                                  .clear_keyb_buf:
  9734                                  		; clear keyboard buffer
  9735 00005575 B401                    		mov	ah, 1
  9736 00005577 CD32                    		int	32h
  9737 00005579 7406                    		jz	short .ppk_sp_ok
  9738 0000557B B400                    		mov	ah, 0
  9739 0000557D CD32                    		int	32h
  9740 0000557F EBF4                    		jmp	short .clear_keyb_buf
  9741                                  
  9742                                  .ppk_sp_ok:
  9743 00005581 C3                      		retn
  9744                                  
  9745                                  
  9746                                  ; =============== S U B R O U T I N E =======================================
  9747                                  
  9748                                  		; 25/01/2025
  9749                                  		; 21/12/2024
  9750                                  set_text_mode:
  9751 00005582 30E4                    		xor    ah, ah
  9752 00005584 B003                    		mov    al, 3
  9753                                   		;int   10h ; al = 03h text mode, int 10 video
  9754 00005586 CD31                    		int    31h ; TRDOS 386 - Video interrupt
  9755 00005588 C3                      		retn
  9756                                  
  9757                                  ; =============== S U B R O U T I N E =======================================
  9758                                  
  9759                                  		; 16/02/2025 (tmp3play.s)
  9760                                  		; 13/02/2025 (mp3play6.s)
  9761                                  		; 30/12/2024 (cgaplay.s)
  9762                                  		; 26/01/2025
  9763                                  		; 25/01/2025 (mp3play5.s) -graphics/VGA mode-
  9764                                  		; 21/12/2024 (vgaplay.s)
  9765                                  		; 22/01/2025 (mp3play4.s) -text mode-
  9766                                  		; 21/01/2025
  9767                                  SetTotalTime:
  9768                                  		;;;; 22/01/2025
  9769 00005589 8B1D[B8C20000]          		mov	ebx, [mp3_bit_rate] ; bit/s
  9770 0000558F 89D8                    		mov	eax, ebx
  9771 00005591 C1E803                  		shr	eax, 3 ; byte/s
  9772 00005594 BA05000000              		mov	edx, 5
  9773 00005599 F7E2                    		mul	edx
  9774                                  
  9775 0000559B F735[98C20000]          		div	dword [mp3_src_frame_size]
  9776                                  		; eax = count of frames per 5 seconds
  9777 000055A1 21D2                    		and	edx, edx
  9778 000055A3 7401                    		jz	short .skip@
  9779 000055A5 40                      		inc	eax
  9780                                  .skip@:
  9781 000055A6 F725[98C20000]          		mul	dword [mp3_src_frame_size]
  9782 000055AC A3[5CB20000]            		mov	[fb_count], eax  ; forward/backward count
  9783                                  		;;;;
  9784                                  
  9785 000055B1 A1[54B20000]            		mov	eax, [stream_size] ; bytes
  9786 000055B6 BA08000000              		mov	edx, 8 ; 1 byte = 8 bits
  9787 000055BB F7E2                     		mul	edx
  9788                                  		;div	dword [mp3_bit_rate] ; num of bits per sec
  9789 000055BD F7F3                    		div	ebx ; 22/01/2025
  9790                                  		; eax = total seconds
  9791                                  
  9792 000055BF B33C                    		mov	bl, 60
  9793 000055C1 F6F3                    		div	bl
  9794                                  
  9795                                  		; al = minutes, ah = seconds
  9796                                  	
  9797                                  		; 15/02/2025
  9798 000055C3 50                      		push	eax
  9799 000055C4 B30A                    		mov	bl, 10
  9800 000055C6 30E4                    		xor	ah, ah
  9801 000055C8 F6F3                    		div	bl
  9802 000055CA 80C430                  		add	ah, '0'
  9803 000055CD 8825[1CB00000]          		mov	[msgMinSec+1], ah
  9804 000055D3 20C0                    		and	al, al
  9805 000055D5 740D                    		jz	short .skip@@
  9806 000055D7 28E4                    		sub	ah, ah
  9807 000055D9 F6F3                    		div	bl
  9808 000055DB 80C430                  		add	ah, '0'
  9809 000055DE 8825[1BB00000]          		mov	[msgMinSec], ah
  9810                                  .skip@@:
  9811 000055E4 58                      		pop	eax
  9812 000055E5 88E0                    		mov	al, ah
  9813 000055E7 30E4                    		xor	ah, ah
  9814 000055E9 F6F3                    		div	bl
  9815 000055EB 80C430                  		add	ah, '0'
  9816 000055EE 8825[1FB00000]          		mov	[msgMinSec+4], ah
  9817 000055F4 08C0                    		or	al, al
  9818 000055F6 740D                    		jz	short .return
  9819 000055F8 28E4                    		sub	ah, ah
  9820 000055FA F6F3                    		div	bl
  9821 000055FC 80C430                  		add	ah, '0'
  9822 000055FF 8825[1EB00000]          		mov	[msgMinSec+3], ah
  9823                                  .return:
  9824 00005605 C3                      		retn
  9825                                  	
  9826                                  
  9827                                  ; =============== S U B R O U T I N E =======================================
  9828                                  
  9829                                  		; 15/02/2025
  9830                                  write_mp3_file_info:
  9831                                  		sys	_msg, msgFileName, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00005606 BB[ADAF0000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 0000560B B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005610 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005615 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000561A CD40                <1>  int 40h
  9832                                  		sys	_msg, mp3_file_name, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000561C BB[F05B0500]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00005621 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005626 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000562B B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00005630 CD40                <1>  int 40h
  9833                                  write_sample_rate:
  9834 00005632 A1[B0C20000]            		mov	eax, [mp3_sample_rate]
  9835                                  		; ax = sample rate (hertz)
  9836 00005637 31D2                    		xor	edx, edx
  9837 00005639 66B90A00                		mov	cx, 10
  9838 0000563D 66F7F1                  		div	cx
  9839 00005640 0015[CEAF0000]          		add	[msgHertz+4], dl
  9840 00005646 29D2                    		sub	edx, edx
  9841 00005648 66F7F1                  		div	cx
  9842 0000564B 0015[CDAF0000]          		add	[msgHertz+3], dl
  9843 00005651 29D2                    		sub	edx, edx
  9844 00005653 66F7F1                  		div	cx
  9845 00005656 0015[CCAF0000]          		add	[msgHertz+2], dl
  9846 0000565C 29D2                    		sub	edx, edx
  9847 0000565E 66F7F1                  		div	cx
  9848 00005661 0015[CBAF0000]          		add	[msgHertz+1], dl
  9849 00005667 0005[CAAF0000]          		add	[msgHertz], al
  9850                                  	
  9851                                  		sys	_msg, msgSampleRate, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000566D BB[BBAF0000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00005672 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005677 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000567C B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00005681 CD40                <1>  int 40h
  9852                                  
  9853 00005683 A1[B8C20000]            		mov     eax, [mp3_bit_rate]
  9854 00005688 31D2                                    xor     edx, edx
  9855 0000568A B9E8030000                              mov     ecx, 1000
  9856 0000568F F7F1                                    div     ecx
  9857 00005691 BF[445C0500]            		mov	edi, txtSize
  9858 00005696 89E5                    		mov	ebp, esp
  9859 00005698 B90A000000              		mov	ecx, 10
  9860                                  kbits_1:
  9861 0000569D 31D2                      		xor	edx, edx
  9862 0000569F F7F1                    		div	ecx
  9863 000056A1 80C230                  		add	dl, 30h ; '0'
  9864 000056A4 52                      		push	edx
  9865 000056A5 09C0                    		or	eax, eax
  9866 000056A7 75F4                    		jnz	short kbits_1
  9867                                  kbits_2:
  9868 000056A9 5A                      		pop	edx
  9869 000056AA 88D0                    		mov	al, dl
  9870 000056AC AA                      		stosb
  9871 000056AD 39EC                    		cmp	esp, ebp
  9872 000056AF 75F8                     		jne	short kbits_2
  9873 000056B1 B000                    		mov	al, 0
  9874 000056B3 AA                      		stosb
  9875                                  
  9876                                  		sys	_msg, msgKBitRate, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000056B4 BB[D3AF0000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 000056B9 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 000056BE BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000056C3 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 000056C8 CD40                <1>  int 40h
  9877                                  
  9878                                  		sys	_msg, txtSize, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000056CA BB[445C0500]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 000056CF B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 000056D4 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000056D9 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 000056DE CD40                <1>  int 40h
  9879                                  
  9880                                  		sys	_msg, msgKBits, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000056E0 BB[E0AF0000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 000056E5 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 000056EA BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000056EF B823000000          <1>  mov eax, %1
   112                              <1> 
   113 000056F4 CD40                <1>  int 40h
  9881                                  
  9882                                  		sys	_msg, msgPlayback, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000056F6 BB[E8AF0000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 000056FB B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005700 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005705 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000570A CD40                <1>  int 40h
  9883                                  
  9884 0000570C BE[FCAF0000]            		mov	esi, msg16Bits
  9885                                  		
  9886                                  		; 17/02/2025
  9887                                  		;	[mp3_bytes_per_sample] = 2
  9888                                  		;
  9889                                  		;cmp	byte [mp3_bytes_per_sample], 2
  9890                                  		;je	short wsr_1
  9891                                  		;mov	esi, msg8Bits
  9892                                  wsr_1:
  9893                                  		sys	_msg, esi, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00005711 89F3                <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00005713 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005718 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000571D B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00005722 CD40                <1>  int 40h
  9894                                  
  9895 00005724 BE[F5AF0000]            		mov	esi, msgMono
  9896 00005729 803D[BCC20000]01        		cmp	byte [mp3_num_channels], 1
  9897 00005730 7405                    		je	short wsr_2
  9898 00005732 BE[06B00000]            		mov	esi, msgStereo
  9899                                  wsr_2:
  9900                                  		sys	_msg, esi, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00005737 89F3                <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00005739 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 0000573E BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005743 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00005748 CD40                <1>  int 40h
  9901                                  
  9902                                  		sys	_msg, msgDuration, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000574A BB[0FB00000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 0000574F B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005754 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005759 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000575E CD40                <1>  int 40h
  9903 00005760 C3                      		retn
  9904                                  
  9905                                  ;=============================================================================
  9906                                  ; drawscopes - draw wave/voice sample scopes
  9907                                  ;=============================================================================
  9908                                  
  9909                                  	; 15/02/2025	
  9910                                  	; 10/02/2025 - twavply3.s (32 bit)
  9911                                  	; 09/02/2025 - twavplay.asm (16bit)
  9912                                  	; 05/02/2025 - twavplay2.s
  9913                                  drawscopes:
  9914                                  	;call	get_current_sound_data
  9915                                  	; 15/02/2025
  9916 00005761 FF15[04100600]          	call	dword [get_sound_data]
  9917 00005767 BE[00200600]            	mov	esi, sounddata
  9918                                  
  9919 0000576C 31C9                    	xor     ecx, ecx
  9920 0000576E 31D2                    	xor     edx, edx
  9921 00005770 31FF                    	xor	edi, edi
  9922                                  drawscope0:
  9923 00005772 66AD                    	lodsw
  9924 00005774 80F480                  	xor	ah, 80h
  9925 00005777 0FB6DC                  	movzx	ebx, ah	; Left Channel
  9926 0000577A D1E3                    	shl	ebx, 1
  9927 0000577C 668B83[F0510500]        	mov	ax, [RowOfs+ebx]
  9928 00005783 668987[F0530500]        	mov	[NewScope_L+edi], ax
  9929 0000578A 30FF                    	xor	bh, bh
  9930 0000578C 66AD                    	lodsw
  9931 0000578E 80F480                  	xor	ah, 80h
  9932 00005791 88E3                    	mov	bl, ah	; Right Channel
  9933 00005793 D1E3                    	shl	ebx, 1
  9934 00005795 668B83[F0510500]        	mov	ax, [RowOfs+ebx]
  9935 0000579C 668987[F0550500]        	mov	[NewScope_R+edi], ax
  9936 000057A3 6683C702                	add	di, 2
  9937 000057A7 FEC1                    	inc	cl
  9938 000057A9 75C7                    	jnz	short drawscope0
  9939                                  
  9940 000057AB 66BAC403                	mov	dx, 3C4h
  9941                                  	;mov	ax, 0802h
  9942                                          ;out	dx, ax
  9943 000057AF 66BB0208                        mov	bx, 0802h
  9944 000057B3 B403                    	mov	ah, 3 ; outw
  9945 000057B5 CD34                    	int	34h
  9946                                  
  9947                                  	;mov	dx, 3CEh
  9948 000057B7 B2CE                    	mov	dl, 0CEh
  9949 000057B9 B008                    	mov	al, 08h
  9950                                         ;out	dx, al
  9951 000057BB B401                            mov	ah, 1 ; outb
  9952 000057BD CD34                    	int	34h
  9953                                  
  9954 000057BF 42                      	inc	edx
  9955                                  
  9956 000057C0 31F6                    	xor	esi, esi
  9957 000057C2 BB45060A00              	mov	ebx, 0A0645h
  9958                                  drawscopel4:
  9959 000057C7 B080                    	mov     al, 80h
  9960                                  drawscopel2:
  9961 000057C9 50                      	push	eax ; **
  9962 000057CA 52                      	push	edx ; *
  9963                                  	;out	dx, al
  9964 000057CB B401                    	mov	ah, 1 ; outb
  9965 000057CD CD34                    	int	34h
  9966                                  
  9967                                  	;mov	ecx, 32
  9968 000057CF B120                    	mov	cl, 32
  9969 000057D1 66B800FF                	mov	ax, 0FF00h
  9970                                  drawscopel3:
  9971 000057D5 668BBE[F0570500]                mov	di, [OldScope_L+esi]
  9972 000057DC 668B96[F0530500]        	mov	dx, [NewScope_L+esi]
  9973 000057E3 39D7                            cmp	edi, edx
  9974 000057E5 740D                            je	short drawscopef3
  9975 000057E7 88043B                  	mov	[ebx+edi], al ; L
  9976 000057EA 882413                  	mov	[ebx+edx], ah ; L
  9977 000057ED 668996[F0570500]                mov     [OldScope_L+esi], dx
  9978                                  drawscopef3:
  9979 000057F4 668BBE[F0590500]        	mov	di, [OldScope_R+esi]
  9980 000057FB 668B96[F0550500]        	mov	dx, [NewScope_R+esi]
  9981 00005802 39D7                    	cmp	edi, edx
  9982 00005804 740F                    	je	short drawscopef4
  9983 00005806 88443B26                	mov	[ebx+edi+38], al ; R
  9984 0000580A 88641326                	mov	[ebx+edx+38], ah ; R
  9985 0000580E 668996[F0590500]        	mov     [OldScope_R+esi], dx
  9986                                  drawscopef4:
  9987 00005815 83C610                  	add	esi, 2*8
  9988 00005818 43                      	inc	ebx
  9989 00005819 E2BA                    	loop    drawscopel3
  9990                                  
  9991 0000581B 5A                              pop     edx ; *
  9992 0000581C 58                              pop     eax ; **
  9993 0000581D 81EEFE010000            	sub	esi, 2*256-2
  9994 00005823 83EB20                  	sub	ebx, 32
  9995 00005826 D0E8                            shr     al, 1
  9996 00005828 759F                            jnz	short drawscopel2
  9997 0000582A F8                      	clc
  9998 0000582B C3                              retn
  9999                                  
 10000                                  
 10001                                  ; =============== S U B R O U T I N E =======================================
 10002                                  
 10003                                  ; --------------------------------------------------------
 10004                                  ; 15/02/2025 - Get Current Sound Data For Graphics
 10005                                  ; --------------------------------------------------------
 10006                                  
 10007                                  	; 15/02/2025 (tmp3play.s)
 10008                                  get_ac97_sound_data:
 10009                                  	; [sd_count] = 1024
 10010                                  	sys	_audio,	0F00h, [sd_count], sounddata
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000582C BB000F0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00005831 8B0D[60B20000]      <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005837 BA[00200600]        <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000583C B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00005841 CD40                <1>  int 40h
 10011 00005843 C3                      	retn
 10012                                  
 10013                                  ; --------------------------------------------------------
 10014                                  
 10015                                  	; 15/02/2025 (tmp3play.s)
 10016                                  get_sb16_sound_data:
 10017 00005844 BE[00240600]            	mov	esi, sounddata2
 10018                                  	sys	_audio,	0F00h, [sd_count], esi
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00005849 BB000F0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 0000584E 8B0D[60B20000]      <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005854 89F2                <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005856 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 0000585B CD40                <1>  int 40h
 10019 0000585D BF[00200600]            	mov	edi, sounddata
 10020 00005862 FF25[00100600]          	jmp	dword [sounddata_copy]
 10021                                  
 10022                                  ; --------------------------------------------------------
 10023                                  
 10024                                  ;	; 15/02/2025
 10025                                  ;	; 10/02/2025 - twavply3.s (32bit)
 10026                                  ;	; 09/02/2025 - twavplay.asm (16bit)
 10027                                  ;sdc_16bit_stereo:
 10028                                  ;	; esi = source/dma sound data buffer address
 10029                                  ;	; ecx =	load (source) count = 1024
 10030                                  ;	; edi = target sound data buffer
 10031                                  ;	;shr	ecx, 1
 10032                                  ;	;rep	movsw
 10033                                  ;	shr	ecx, 2
 10034                                  ;	rep	movsd
 10035                                  ;	retn
 10036                                  
 10037                                  ; --------------------------------------------------------
 10038                                  
 10039                                  	; 15/02/2025
 10040                                  	; 10/02/2025 - twavply3.s (32bit)
 10041                                  	; 09/02/2025 - twavplay.asm (16bit)
 10042                                  sdc_16bit_mono:
 10043                                  	; esi = source/dma sound data buffer address
 10044                                  	; ecx = load (source) count = 512
 10045                                  	; edi = target sound data buffer
 10046 00005868 D1E9                    	shr	ecx, 1
 10047                                  sdc_16bm_loop:
 10048 0000586A 66AD                    	lodsw
 10049 0000586C 66AB                    	stosw
 10050 0000586E 66AB                    	stosw
 10051 00005870 E2F8                    	loop	sdc_16bm_loop
 10052 00005872 C3                      	retn
 10053                                  
 10054                                  ; --------------------------------------------------------
 10055                                  
 10056                                  	; 15/02/2025
 10057                                  	; 10/02/2025 - twavply3.s (32bit)
 10058                                  	; 09/02/2025 - twavplay.asm (16bit)
 10059                                  sdc_8bit_stereo:
 10060                                  	; esi = source/dma sound data buffer address
 10061                                  	; ecx = load (source) count = 512
 10062                                  	; edi = target sound data buffer
 10063                                  
 10064                                  	; convert to 16 bit sample
 10065                                  sdc_8bs_loop:
 10066 00005873 AC                      	lodsb
 10067 00005874 2C80                    	sub	al, 80h ; middle = 0, min = -128, max = 127
 10068 00005876 66C1E008                	shl	ax, 8
 10069 0000587A 66AB                    	stosw
 10070 0000587C E2F5                    	loop	sdc_8bs_loop
 10071 0000587E C3                      	retn
 10072                                  
 10073                                  ; --------------------------------------------------------
 10074                                  
 10075                                  	; 15/02/2025
 10076                                  	; 10/02/2025 - twavply3.s (32bit)
 10077                                  	; 09/02/2025 - twavplay.asm (16bit)
 10078                                  sdc_8bit_mono:
 10079                                  	; esi = source/dma sound data buffer
 10080                                  	; ecx = load (source) count = 256
 10081                                  	; edi = target sound data buffer
 10082                                  
 10083                                  	; convert to 16 bit sample
 10084                                  sdc_8bm_loop:
 10085 0000587F AC                      	lodsb
 10086 00005880 2C80                    	sub	al, 80h ; middle = 0, min = -128, max = 127
 10087 00005882 66C1E008                	shl	ax, 8
 10088 00005886 66AB                    	stosw	; L
 10089                                  	; convert to stereo
 10090 00005888 66AB                    	stosw	; R
 10091 0000588A E2F3                    	loop	sdc_8bm_loop
 10092 0000588C C3                      	retn
 10093                                  
 10094                                  ; =============== S U B R O U T I N E =======================================
 10095                                  
 10096                                  		; 16/02/2025
 10097                                  print_err_msg:
 10098                                  		sys	_msg, esi, 255, 0Ch
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000588D 89F3                <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 0000588F B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005894 BA0C000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005899 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000589E CD40                <1>  int 40h
 10099 000058A0 F9                      		stc	; (needed)	
 10100 000058A1 C3                      		retn
 10101                                  
 10102                                  ;-----------------------------------------------------------------------------
 10103                                  
 10104                                  ; 16/02/2025
 10105                                  ; 10/02/2025 (twavply3.s)
 10106                                  ;=============================================================================
 10107                                  ;	Load IFF/ILBM files for VGA 640x480x16 graphics mode
 10108                                  ;=============================================================================
 10109                                  
 10110                                  ; EX1B.ASM (21/6/1994, Carlos Hasan; MSDOS, 'RUNME.EXE', 'TNYPL211')
 10111                                  
 10112                                  ; 21/10/2017 (TRDOS 386, 'tmodplay.s', Erdogan Tan, NASM syntax)
 10113                                  
 10114                                  ;-----------------------------------------------------------------------------
 10115                                  ; EQUATES AND STRUCTURES
 10116                                  ;-----------------------------------------------------------------------------
 10117                                  
 10118                                  ID_FORM equ 4D524F46h		; IFF/ILBM chunk IDs
 10119                                  ID_ILBM equ 4D424C49h
 10120                                  ID_BMHD equ 44484D42h
 10121                                  ID_CMAP equ 50414D43h
 10122                                  ID_BODY equ 59444F42h
 10123                                  
 10124                                  struc Form			; IFF/ILBM header file format
 10125 00000000 ????????                  .ID:		resd 1
 10126 00000004 ????????                  .Length:	resd 1
 10127 00000008 ????????                  .Type:	resd 1
 10128                                    .size:
 10129                                  endstruc
 10130                                  
 10131                                  struc Chunk			; IFF/ILBM header chunk format
 10132 00000000 ????????                  .ID:		resd 1
 10133 00000004 ????????                  .Length:	resd 1
 10134                                    .size:
 10135                                  endstruc
 10136                                  
 10137                                  struc BMHD			; IFF/ILBM BMHD chunk format
 10138 00000000 ????                      .Width: 	resw 1
 10139 00000002 ????                      .Height:	resw 1
 10140 00000004 ????                      .PosX:	resw 1
 10141 00000006 ????                      .PosY:	resw 1
 10142 00000008 ??                        .Planes:	resb 1
 10143 00000009 ??                        .Masking:	resb 1
 10144 0000000A ??                        .Compression:	resb 1
 10145 0000000B ??                        .Pad:		resb 1
 10146 0000000C ????                      .Transparent:	resw 1
 10147 0000000E ??                        .AspectX	resb 1
 10148 0000000F ??                        .AspectY:	resb 1
 10149 00000010 ????                      .PageWidth:	resw 1
 10150 00000012 ????                      .PageHeight:	resw 1
 10151                                    .size:
 10152                                  endstruc
 10153                                  
 10154                                  struc CMAP			; IFF/ILBM CMAP chunk format
 10155 00000000 <res 300h>                .Colors:	resb 768
 10156                                    .size:
 10157                                  endstruc
 10158                                  
 10159                                  ;------------------------------------------------------------------------------
 10160                                  ; bswap - macro to reverse the byte order of a 32-bit register, converting
 10161                                  ;         a value in little/big endian form to big/little endian form.
 10162                                  ;------------------------------------------------------------------------------
 10163                                  
 10164                                  %macro	bswap   1
 10165                                  	xchg    al, ah
 10166                                  	rol     eax, 16
 10167                                  	xchg    al, ah
 10168                                  %endmacro
 10169                                  
 10170                                  ; ---------------------------------------------------------------------------
 10171                                  ; 25/01/2025 - Player Window Display Functions
 10172                                  ; ---------------------------------------------------------------------------
 10173                                  ; ref: vgaplay2.s (18/01/2025)
 10174                                  
 10175                                  ; =============== S U B R O U T I N E =======================================
 10176                                  
 10177                                  		; 15/02/2025
 10178                                  drawplayingscreen:
 10179                                  		; 10/02/2025 - twavply3.s
 10180                                  		; 05/02/2025 - twavply2.s
 10181                                  putlbm:
 10182 000058A2 BE[B4590000]            		mov	esi, LOGO_ADDRESS
 10183                                  	
 10184                                  		;pushad
 10185                                  
 10186                                  ; check if this is a valid IFF/ILBM Deluxe Paint file
 10187                                  
 10188                                  		;cmp	dword [esi+Form.ID], ID_FORM
 10189                                  		;jne	short putlbmd0
 10190                                  		;cmp	dword [esi+Form.Type], ID_ILBM
 10191                                  		;jne	short putlbmd0
 10192                                  
 10193                                  ; get the IFF/ILBM file length in bytes
 10194                                  
 10195 000058A7 8B4604                  		mov	eax, [esi+Form.Length]
 10196                                  		bswap	eax
 10165 000058AA 86E0                <1>  xchg al, ah
 10166 000058AC C1C010              <1>  rol eax, 16
 10167 000058AF 86E0                <1>  xchg al, ah
 10197 000058B1 89C1                    		mov	ecx, eax
 10198                                  
 10199                                  ; decrease the file length and updates the file pointer
 10200                                  
 10201 000058B3 83E904                  		sub	ecx, 4
 10202 000058B6 83C60C                  		add	esi, Form.size
 10203                                  
 10204                                  ; IFF/ILBM main parser body loop
 10205                                  
 10206                                  putlbml0:
 10207 000058B9 85C9                    		test	ecx, ecx
 10208 000058BB 7E63                    		jle	short putlbmd1
 10209                                  
 10210                                  ; get the next chunk ID and length in bytes
 10211                                  
 10212 000058BD 8B1E                    		mov	ebx, [esi+Chunk.ID]
 10213 000058BF 8B4604                  		mov	eax, [esi+Chunk.Length]
 10214                                  		bswap	eax
 10165 000058C2 86E0                <1>  xchg al, ah
 10166 000058C4 C1C010              <1>  rol eax, 16
 10167 000058C7 86E0                <1>  xchg al, ah
 10215 000058C9 93                      		xchg	ebx, eax
 10216 000058CA 83C608                  		add	esi, Chunk.size
 10217                                  
 10218                                  ; word align the chunk length and decrease the file length counter
 10219                                  
 10220 000058CD 43                      		inc	ebx
 10221 000058CE 80E3FE                  		and	bl, 0FEh ; ~1
 10222 000058D1 83E908                  		sub	ecx, Chunk.size
 10223 000058D4 29D9                    		sub	ecx, ebx
 10224                                  
 10225                                  ; check for the BMHD/CMAP/BODY chunk headers
 10226                                  
 10227 000058D6 3D424D4844              		cmp	eax, ID_BMHD
 10228 000058DB 7414                    		je	short putlbmf0
 10229 000058DD 3D434D4150              		cmp	eax, ID_CMAP
 10230 000058E2 743E                    		je	short putlbmf1
 10231 000058E4 3D424F4459              		cmp	eax, ID_BODY
 10232 000058E9 7452                    		je	short putlbmf2
 10233                                  
 10234                                  ; advance to the next IFF/ILBM chunk structure
 10235                                  
 10236                                  putlbmc0:
 10237 000058EB 01DE                    		add	esi, ebx
 10238 000058ED EBCA                    		jmp	short putlbml0
 10239                                  
 10240                                  putlbmd0:
 10241 000058EF F9                      		stc
 10242                                  		;popad
 10243 000058F0 C3                      		retn
 10244                                  
 10245                                  ; process the BMHD bitmap header chunk
 10246                                  
 10247                                  putlbmf0:
 10248 000058F1 807E0804                		cmp	byte [esi+BMHD.Planes], 4
 10249 000058F5 75F8                    		jne	short putlbmd0
 10250 000058F7 807E0A01                		cmp	byte [esi+BMHD.Compression], 1
 10251 000058FB 75F2                    		jne	short putlbmd0
 10252 000058FD 807E0B00                		cmp	byte [esi+BMHD.Pad], 0
 10253 00005901 75EC                    		jne	short putlbmd0
 10254 00005903 0FB706                  		movzx	eax, word [esi+BMHD.Width]
 10255 00005906 86E0                    		xchg	al, ah
 10256 00005908 83C007                  		add	eax, 7
 10257 0000590B C1E803                  		shr	eax, 3
 10258 0000590E A3[4CB20000]            		mov	[picture.width], eax
 10259 00005913 0FB74602                		movzx	eax, word [esi+BMHD.Height]
 10260 00005917 86E0                    		xchg	al, ah
 10261 00005919 A3[50B20000]            		mov	[picture.height], eax
 10262 0000591E EBCB                    		jmp	short putlbmc0
 10263                                  
 10264                                  putlbmd1:
 10265 00005920 F8                      		clc
 10266                                  		;popad
 10267 00005921 C3                      		retn
 10268                                  
 10269                                  ; process the CMAP colormap chunk
 10270                                  
 10271                                  putlbmf1:
 10272 00005922 66BAC803                		mov	dx, 3C8h
 10273 00005926 30C0                    		xor	al, al
 10274                                  		;out	dx, al
 10275 00005928 B401                    		mov	ah, 1 ; outb
 10276 0000592A CD34                    		int	34h
 10277                                  		;inc	dx
 10278 0000592C 42                      		inc	edx
 10279                                  putlbml1:
 10280 0000592D 8A06                    		mov	al, [esi]
 10281 0000592F C0E802                  		shr	al, 2
 10282                                  		;out	dx, al
 10283                                  		;mov	ah, 1 ; outb
 10284 00005932 CD34                    		int	34h ; IOCTL interrupt (IN/OUT)
 10285 00005934 46                      		inc	esi
 10286 00005935 4B                      		dec	ebx
 10287 00005936 7FF5                    		jg	short putlbml1
 10288 00005938 E97CFFFFFF              		jmp	putlbml0
 10289                                  
 10290                                  ; process the BODY bitmap body chunk
 10291                                  
 10292                                  putlbmf2:
 10293 0000593D 60                      		pushad
 10294 0000593E BF00000A00              		mov	edi, 0A0000h
 10295                                  		;cld
 10296 00005943 66BACE03                		mov	dx, 3CEh
 10297                                  		;mov	ax, 0FF08h
 10298                                  		;out	dx, ax
 10299 00005947 66BB08FF                		mov	bx, 0FF08h
 10300 0000594B B403                    		mov	ah, 3 ; outw
 10301 0000594D CD34                    		int	34h ; IOCTL interrupt (IN/OUT)
 10302                                  		;mov	dx, 3C4h
 10303 0000594F B2C4                    		mov	dl, 0C4h
 10304 00005951 B002                    		mov	al, 02h
 10305                                  		;out	dx, al
 10306 00005953 B401                    		mov	ah, 1 ; outb
 10307 00005955 CD34                    		int	34h ; IOCTL interrupt (IN/OUT)
 10308                                  		;inc	dx
 10309 00005957 42                      		inc	edx
 10310 00005958 8B0D[50B20000]          		mov	ecx, [picture.height]
 10311                                  putlbml2:
 10312 0000595E 51                      		push	ecx
 10313 0000595F B011                    		mov	al, 11h
 10314                                  putlbml3:
 10315 00005961 50                      		push	eax
 10316 00005962 57                      		push	edi
 10317                                  		;out	dx, al
 10318 00005963 B401                    		mov	ah, 1 ; outb
 10319 00005965 CD34                    		int	34h ; IOCTL interrupt (IN/OUT)
 10320 00005967 8B1D[4CB20000]          		mov	ebx, [picture.width]
 10321                                  putlbml4:
 10322 0000596D AC                      		lodsb
 10323 0000596E 31C9                    		xor	ecx, ecx
 10324 00005970 84C0                    		test	al, al
 10325 00005972 7C09                    		jl	short putlbmf3
 10326                                  		;movzx	ecx, al
 10327 00005974 88C1                    		mov	cl, al
 10328 00005976 41                      		inc	ecx
 10329 00005977 29CB                    		sub	ebx, ecx
 10330 00005979 F3A4                    		rep	movsb
 10331 0000597B EB0A                    		jmp	short putlbmc4
 10332                                  putlbmf3:
 10333 0000597D F6D8                    		neg	al
 10334                                  		;movzx	ecx, al
 10335 0000597F 88C1                    		mov	cl, al
 10336 00005981 41                      		inc	ecx
 10337 00005982 29CB                    		sub	ebx, ecx
 10338 00005984 AC                      		lodsb
 10339 00005985 F3AA                    		rep	stosb
 10340                                  putlbmc4:
 10341 00005987 85DB                    		test	ebx, ebx
 10342 00005989 7FE2                    		jg	short putlbml4
 10343 0000598B 5F                      		pop	edi
 10344 0000598C 58                      		pop	eax
 10345 0000598D 00C0                    		add	al, al
 10346 0000598F 73D0                    		jnc	short putlbml3
 10347 00005991 83C750                  		add	edi, 80
 10348 00005994 59                      		pop	ecx
 10349 00005995 E2C7                    		loop	putlbml2
 10350 00005997 61                      		popad
 10351 00005998 E94EFFFFFF              		jmp	putlbmc0
 10352                                  
 10353                                  ; ---------------------------------------------------------------------------
 10354                                  ; 16/02/2025 - Tiny Player Logo (Screen Image)
 10355                                  ; ---------------------------------------------------------------------------
 10356                                  
 10357 0000599D 90<rep 3h>              align 4
 10358                                  
 10359 000059A0 00                      db 0
 10360 000059A1 54494E59504C41592E-     db 'TINYPLAY.LBM Start', 0
 10360 000059AA 4C424D205374617274-
 10360 000059B3 00                 
 10361                                  
 10362                                  LOGO_ADDRESS:
 10363 000059B4 <bin 4298h>             incbin "TINYPLAY.LBM"
 10364                                  
 10365 00009C4C 00                      db 0
 10366                                  
 10367 00009C4D 54494E59504C41592E-     db 'TINYPLAY.LBM End', 0
 10367 00009C56 4C424D20456E6400   
 10368                                  
 10369                                  ; ===========================================================================
 10370                                  ; end of TRDOS 386 specific procedures.
 10371                                  ; ---------------------------------------------------------------------------
 10372                                  
 10373                                  ; ===========================================================================
 10374                                  ; Initialized DATA
 10375                                  ; ===========================================================================
 10376                                  
 10377                                  ; 15/02/2025
 10378 00009C5E 90<rep 2h>              align 4
 10379                                                     
 10380                                  mp3_bitrate_tab:
 10381 00009C60 000020002800300038-     		dw  0,32,40,48,56,64,80,96,112,128,160,192,224,256,320, 0
 10381 00009C69 004000500060007000-
 10381 00009C72 8000A000C000E00000-
 10381 00009C7B 0140010000         
 10382 00009C80 000008001000180020-                     dw  0, 8,16,24,32,40,48,56,64,80,96,112,128,144,160, 0
 10382 00009C89 002800300038004000-
 10382 00009C92 500060007000800090-
 10382 00009C9B 00A0000000         
 10383                                  mp3_freq_tab:
 10384 00009CA0 44AC80BB007D            		dw 44100,48000,32000   
 10385                                  mp3_lsf_sf_expand_init_table:
 10386 00009CA6 000504040000            		db 0, 5, 4, 4, 0, 0
 10387 00009CAC 9001                                    dw 400                  ; 0..399 ; normal case
 10388 00009CAE 000504010C00                            db 0, 5, 4, 1, 0Ch, 0
 10389 00009CB4 F401                                    dw 500                  ; 400..499
 10390 00009CB6 000301011801                            db 0, 3, 1, 1, 18h, 1
 10391 00009CBC 0002                                    dw 512                  ; 500..511
 10392 00009CBE 010606012400                            db 1, 6, 6, 1, 24h, 0
 10393 00009CC4 6803                                    dw 872                  ; 512+360 ; 0..359 for 2nd channel of intensity stereo
 10394 00009CC6 010404013000                            db 1, 4, 4, 1, 30h, 0
 10395 00009CCC E803                                    dw 1000                 ; 512+488 ; 360..487
 10396 00009CCE 010301013C00                            db 1, 3, 1, 1, 3Ch, 0
 10397 00009CD4 0004                                    dw 1024                 ; 512+512 ; 488..511
 10398                                  mp3_synth_win_src:
 10399 00009CD6 010000000000000000-     		dw      1,     0,     0,     0,     0,     0,     1,     0
 10399 00009CDF 00000001000000     
 10400 00009CE6 000000000100000001-                     dw      0,     0,     1,     0,     1,     0,     1,     0
 10400 00009CEF 00000001000000     
 10401 00009CF6 010001000000010001-                     dw      1,     1,     0,     1,     1,     1,     1,     2
 10401 00009CFF 00010001000200     
 10402 00009D06 010002000100020002-                     dw      1,     2,     1,     2,     2,     3,     2,     3
 10402 00009D0F 00030002000300     
 10403 00009D16 020004000300030004-                     dw      2,     4,     3,     3,     4,     4,     4,     5
 10403 00009D1F 00040004000500     
 10404 00009D26 050005000500060006-                     dw      5,     5,     5,     6,     6,     6,     6,     7
 10404 00009D2F 00060006000700     
 10405 00009D36 070006000800070007-                     dw      7,     6,     8,     7,     7,     8,     7,     7
 10405 00009D3F 00080007000700     
 10406 00009D46 080007000700070006-                     dw      8,     7,     7,     7,     6,     6,     6,     5
 10406 00009D4F 00060006000500     
 10407 00009D56 51FEFCFFFDFFFEFFFF-                     dw 0FE51h,0FFFCh,0FFFDh,0FFFEh,0FFFFh,     0,     1,     3
 10407 00009D5F FF000001000300     
 10408 00009D66 03000600070008000B-                     dw      3,     6,     7,     8,   0Bh,   0Ch,   0Eh,   11h
 10408 00009D6F 000C000E001100     
 10409 00009D76 1300150017001A001C-                     dw    13h,   15h,   17h,   1Ah,   1Ch,   1Fh,   22h,   24h
 10409 00009D7F 001F0022002400     
 10410 00009D86 27002A002C002F0032-                     dw    27h,   2Ah,   2Ch,   2Fh,   32h,   35h,   36h,   3Ah
 10410 00009D8F 00350036003A00     
 10411 00009D96 3C003E004000420044-                     dw    3Ch,   3Eh,   40h,   42h,   44h,   45h,   47h,   48h
 10411 00009D9F 00450047004800     
 10412 00009DA6 490049004900490049-                     dw    49h,   49h,   49h,   49h,   49h,   48h,   46h,   45h
 10412 00009DAF 00480046004500     
 10413 00009DB6 430040003D003A0035-                     dw    43h,   40h,   3Dh,   3Ah,   35h,   31h,   2Bh,   27h
 10413 00009DBF 0031002B002700     
 10414 00009DC6 1F00190012000A0002-                     dw    1Fh,   19h,   12h,   0Ah,     2,0FFF9h,0FFEFh,0FFE6h
 10414 00009DCF 00F9FFEFFFE6FF     
 10415 00009DD6 3BF030003B00470053-                     dw 0F03Bh,   30h,   3Bh,   47h,   53h,   5Fh,   6Dh,   79h
 10415 00009DDF 005F006D007900     
 10416 00009DE6 86009500A100B000BD-                     dw    86h,   95h,  0A1h,  0B0h,  0BDh,  0CBh,  0D9h,  0E6h
 10416 00009DEF 00CB00D900E600     
 10417 00009DF6 F30001010D01190125-                     dw   0F3h,  101h,  10Dh,  119h,  125h,  130h,  13Ah,  144h
 10417 00009DFF 0130013A014401     
 10418 00009E06 4D0155015B01620166-                     dw   14Dh,  155h,  15Bh,  162h,  166h,  16Ah,  16Bh,  16Dh
 10418 00009E0F 016A016B016D01     
 10419 00009E16 6C016A01660160015A-                     dw   16Ch,  16Ah,  166h,  160h,  15Ah,  150h,  146h,  139h
 10419 00009E1F 01500146013901     
 10420 00009E26 2B011A010801F300DD-                     dw   12Bh,  11Ah,  108h,  0F3h,  0DDh,  0C5h,  0A9h,   8Eh
 10420 00009E2F 00C500A9008E00     
 10421 00009E36 6F004E002B000700E1-                     dw    6Fh,   4Eh,   2Bh,     7,0FFE1h,0FFB8h,0FF8Fh,0FF62h
 10421 00009E3F FFB8FF8FFF62FF     
 10422 00009E46 35FF06FFD5FEA4FE70-                     dw 0FF35h,0FF06h,0FED5h,0FEA4h,0FE70h,0FE3Ch,0FE06h,0FDD0h
 10422 00009E4F FE3CFE06FED0FD     
 10423 00009E56 0BCF9F02D702110349-                     dw 0CF0Bh,  29Fh,  2D7h,  311h,  349h,  382h,  3BBh,  3F4h
 10423 00009E5F 038203BB03F403     
 10424 00009E66 2C0464049A04D10405-                     dw   42Ch,  464h,  49Ah,  4D1h,  505h,  538h,  56Ah,  59Bh
 10424 00009E6F 0538056A059B05     
 10425 00009E76 C805F505200647066C-                     dw   5C8h,  5F5h,  620h,  647h,  66Ch,  68Fh,  6AFh,  6CCh
 10425 00009E7F 068F06AF06CC06     
 10426 00009E86 E506FC060F071F072B-                     dw   6E5h,  6FCh,  70Fh,  71Fh,  72Bh,  734h,  739h,  739h
 10426 00009E8F 07340739073907     
 10427 00009E96 370730072607170704-                     dw   737h,  730h,  726h,  717h,  704h,  6EDh,  6D3h,  6B4h
 10427 00009E9F 07ED06D306B406     
 10428 00009EA6 91066C0640061306E1-                     dw   691h,  66Ch,  640h,  613h,  5E1h,  5ABh,  573h,  537h
 10428 00009EAF 05AB0573053705     
 10429 00009EB6 F704B4046F042704DB-                     dw   4F7h,  4B4h,  46Fh,  427h,  3DBh,  38Fh,  33Eh,  2EDh
 10429 00009EBF 038F033E03ED02     
 10430 00009EC6 9A024402ED0195013D-                     dw   29Ah,  244h,  1EDh,  195h,  13Dh,  0E2h,   88h,   2Eh
 10430 00009ECF 01E20088002E00     
 10431 00009ED6 00                                      db    0
 10432 00009ED7 00                                      db    0
 10433                                  mp3_slen_table:
 10434 00009ED8 000000010002000303-     		dw  0000h, 0100h, 0200h, 0300h, 0003h, 0101h, 0201h, 0301h
 10434 00009EE1 00010101020103     
 10435 00009EE8 020102020203030103-                     dw  0102h, 0202h, 0302h, 0103h, 0203h, 0303h, 0204h, 0304h
 10435 00009EF1 02030304020403     
 10436                                  mp3_lsf_nsf_table:
 10437 00009EF8 060505050909090906-     		dd  05050506h, 09090909h, 09090906h
 10437 00009F01 090909             
 10438 00009F04 0605070309090C0606-                     dd  03070506h, 060C0909h, 060C0906h
 10438 00009F0D 090C06             
 10439 00009F10 0B0A0000121200000F-                     dd  00000A0Bh, 00001212h, 0000120Fh
 10439 00009F19 120000             
 10440 00009F1C 070707000C0C0C0006-                     dd  00070707h, 000C0C0Ch, 000C0F06h
 10440 00009F25 0F0C00             
 10441 00009F28 060606030C09090606-                     dd  03060606h, 0609090Ch, 06090C06h
 10441 00009F31 0C0906             
 10442 00009F34 080805000F0C090006-                     dd  00050808h, 00090C0Fh, 00091206h
 10442 00009F3D 120900             
 10443                                  huff_tree_list_data:
 10444 00009F40 1101100022021221        		db  11h,   1, 10h,   0, 22h,   2, 12h, 21h
 10445 00009F48 2011011000220212                        db  20h, 11h,   1, 10h,   0, 22h,   2, 12h
 10446 00009F50 2120101101003323                        db  21h, 20h, 10h, 11h,   1,   0, 33h, 23h
 10447 00009F58 3231130330221221                        db  32h, 31h, 13h,   3, 30h, 22h, 12h, 21h
 10448 00009F60 0220110110003303                        db    2, 20h, 11h,   1, 10h,   0, 33h,   3
 10449 00009F68 2332301331220212                        db  23h, 32h, 30h, 13h, 31h, 22h,   2, 12h
 10450 00009F70 2120011110005545                        db  21h, 20h,   1, 11h, 10h,   0, 55h, 45h
 10451 00009F78 5453354425521551                        db  54h, 53h, 35h, 44h, 25h, 52h, 15h, 51h
 10452 00009F80 0534504333244214                        db    5, 34h, 50h, 43h, 33h, 24h, 42h, 14h
 10453 00009F88 4140042332031331                        db  41h, 40h,   4, 23h, 32h,   3, 13h, 31h
 10454 00009F90 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10455 00009F98 1000555445533544                        db  10h,   0, 55h, 54h, 45h, 53h, 35h, 44h
 10456 00009FA0 2552051551344350                        db  25h, 52h,   5, 15h, 51h, 34h, 43h, 50h
 10457 00009FA8 3324421441044023                        db  33h, 24h, 42h, 14h, 41h,   4, 40h, 23h
 10458 00009FB0 3213310330220220                        db  32h, 13h, 31h,   3, 30h, 22h,   2, 20h
 10459 00009FB8 1221110110005545                        db  12h, 21h, 11h,   1, 10h,   0, 55h, 45h
 10460 00009FC0 3553540544255215                        db  35h, 53h, 54h,   5, 44h, 25h, 52h, 15h
 10461 00009FC8 5134435004244233                        db  51h, 34h, 43h, 50h,   4, 24h, 42h, 33h
 10462 00009FD0 4014412332133103                        db  40h, 14h, 41h, 23h, 32h, 13h, 31h,   3
 10463 00009FD8 3022021221201101                        db  30h, 22h,   2, 12h, 21h, 20h, 11h,   1
 10464 00009FE0 1000776776577566                        db  10h,   0, 77h, 67h, 76h, 57h, 75h, 66h
 10465 00009FE8 4774566537734655                        db  47h, 74h, 56h, 65h, 37h, 73h, 46h, 55h
 10466 00009FF0 5463277264077062                        db  54h, 63h, 27h, 72h, 64h,   7, 70h, 62h
 10467 00009FF8 4535065344177136                        db  45h, 35h,   6, 53h, 44h, 17h, 71h, 36h
 10468 0000A000 2625521551344316                        db  26h, 25h, 52h, 15h, 51h, 34h, 43h, 16h
 10469 0000A008 6160055024423304                        db  61h, 60h,   5, 50h, 24h, 42h, 33h,   4
 10470 0000A010 1441402332031331                        db  14h, 41h, 40h, 23h, 32h,   3, 13h, 31h
 10471 0000A018 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10472 0000A020 1000776776756647                        db  10h,   0, 77h, 67h, 76h, 75h, 66h, 47h
 10473 0000A028 7457555665377346                        db  74h, 57h, 55h, 56h, 65h, 37h, 73h, 46h
 10474 0000A030 4554355327726407                        db  45h, 54h, 35h, 53h, 27h, 72h, 64h,   7
 10475 0000A038 7117703663604425                        db  71h, 17h, 70h, 36h, 63h, 60h, 44h, 25h
 10476 0000A040 5205156226061661                        db  52h,   5, 15h, 62h, 26h,   6, 16h, 61h
 10477 0000A048 5134504333244214                        db  51h, 34h, 50h, 43h, 33h, 24h, 42h, 14h
 10478 0000A050 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 10479 0000A058 3022211202201101                        db  30h, 22h, 21h, 12h,   2, 20h, 11h,   1
 10480 0000A060 1000776776577566                        db  10h,   0, 77h, 67h, 76h, 57h, 75h, 66h
 10481 0000A068 4774655637735527                        db  47h, 74h, 65h, 56h, 37h, 73h, 55h, 27h
 10482 0000A070 7246641771077036                        db  72h, 46h, 64h, 17h, 71h,   7, 70h, 36h
 10483 0000A078 6345544406052662                        db  63h, 45h, 54h, 44h,   6,   5, 26h, 62h
 10484 0000A080 6116603553255215                        db  61h, 16h, 60h, 35h, 53h, 25h, 52h, 15h
 10485 0000A088 5134435004244214                        db  51h, 34h, 43h, 50h,   4, 24h, 42h, 14h
 10486 0000A090 3341233240033013                        db  33h, 41h, 23h, 32h, 40h,   3, 30h, 13h
 10487 0000A098 3122122102200011                        db  31h, 22h, 12h, 21h,   2, 20h,   0, 11h
 10488 0000A0A0 0110FEFCFDEDFFEF                        db    1, 10h,0FEh,0FCh,0FDh,0EDh,0FFh,0EFh
 10489 0000A0A8 DFEECFDEBFFBCEDC                        db 0DFh,0EEh,0CFh,0DEh,0BFh,0FBh,0CEh,0DCh
 10490 0000A0B0 AFE9ECDDFACDBEEB                        db 0AFh,0E9h,0ECh,0DDh,0FAh,0CDh,0BEh,0EBh
 10491 0000A0B8 9FF9EABDDB8FF8CC                        db  9Fh,0F9h,0EAh,0BDh,0DBh, 8Fh,0F8h,0CCh
 10492 0000A0C0 AE9E8E7F7EF7DAAD                        db 0AEh, 9Eh, 8Eh, 7Fh, 7Eh,0F7h,0DAh,0ADh
 10493 0000A0C8 BCCBF66FE85F9DD9                        db 0BCh,0CBh,0F6h, 6Fh,0E8h, 5Fh, 9Dh,0D9h
 10494 0000A0D0 F5E7ACBB4FF4CAE6                        db 0F5h,0E7h,0ACh,0BBh, 4Fh,0F4h,0CAh,0E6h
 10495 0000A0D8 F33F8DD82FF26E9C                        db 0F3h, 3Fh, 8Dh,0D8h, 2Fh,0F2h, 6Eh, 9Ch
 10496 0000A0E0 0FC95EAB7DD74EC8                        db  0Fh,0C9h, 5Eh,0ABh, 7Dh,0D7h, 4Eh,0C8h
 10497 0000A0E8 D63EB99BAA1FF1F0                        db 0D6h, 3Eh,0B9h, 9Bh,0AAh, 1Fh,0F1h,0F0h
 10498 0000A0F0 BAE5E48C6DE3E22E                        db 0BAh,0E5h,0E4h, 8Ch, 6Dh,0E3h,0E2h, 2Eh
 10499 0000A0F8 0E1EE1E05DD57CC7                        db  0Eh, 1Eh,0E1h,0E0h, 5Dh,0D5h, 7Ch,0C7h
 10500 0000A100 4D8BB8D49AA96CC6                        db  4Dh, 8Bh,0B8h,0D4h, 9Ah,0A9h, 6Ch,0C6h
 10501 0000A108 3DD37B2DD21DB75C                        db  3Dh,0D3h, 7Bh, 2Dh,0D2h, 1Dh,0B7h, 5Ch
 10502 0000A110 C5997AC3A7974BD1                        db 0C5h, 99h, 7Ah,0C3h,0A7h, 97h, 4Bh,0D1h
 10503 0000A118 0DD08AA84CC46BB6                        db  0Dh,0D0h, 8Ah,0A8h, 4Ch,0C4h, 6Bh,0B6h
 10504 0000A120 3C2CC25BB5891CC1                        db  3Ch, 2Ch,0C2h, 5Bh,0B5h, 89h, 1Ch,0C1h
 10505 0000A128 980CC0B46AA6793B                        db  98h, 0Ch,0C0h,0B4h, 6Ah,0A6h, 79h, 3Bh
 10506 0000A130 B3885A2BA569A478                        db 0B3h, 88h, 5Ah, 2Bh,0A5h, 69h,0A4h, 78h
 10507 0000A138 87947776B21BB10B                        db  87h, 94h, 77h, 76h,0B2h, 1Bh,0B1h, 0Bh
 10508 0000A140 B0964A3AA359952A                        db 0B0h, 96h, 4Ah, 3Ah,0A3h, 59h, 95h, 2Ah
 10509 0000A148 A21AA10A68A08649                        db 0A2h, 1Ah,0A1h, 0Ah, 68h,0A0h, 86h, 49h
 10510 0000A150 9339588567299257                        db  93h, 39h, 58h, 85h, 67h, 29h, 92h, 57h
 10511 0000A158 7538836647745665                        db  75h, 38h, 83h, 66h, 47h, 74h, 56h, 65h
 10512 0000A160 7319910990488472                        db  73h, 19h, 91h,   9, 90h, 48h, 84h, 72h
 10513 0000A168 4664288218372717                        db  46h, 64h, 28h, 82h, 18h, 37h, 27h, 17h
 10514 0000A170 7155077036634554                        db  71h, 55h,   7, 70h, 36h, 63h, 45h, 54h
 10515 0000A178 2662358108801661                        db  26h, 62h, 35h, 81h,   8, 80h, 16h, 61h
 10516 0000A180 0660534425520515                        db    6, 60h, 53h, 44h, 25h, 52h,   5, 15h
 10517 0000A188 5134435024423314                        db  51h, 34h, 43h, 50h, 24h, 42h, 33h, 14h
 10518 0000A190 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 10519 0000A198 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10520 0000A1A0 1000FFEFFEDFEEFD                        db  10h,   0,0FFh,0EFh,0FEh,0DFh,0EEh,0FDh
 10521 0000A1A8 CFFCDEEDBFFBCEEC                        db 0CFh,0FCh,0DEh,0EDh,0BFh,0FBh,0CEh,0ECh
 10522 0000A1B0 DDAFFABEEBCDDC9F                        db 0DDh,0AFh,0FAh,0BEh,0EBh,0CDh,0DCh, 9Fh
 10523 0000A1B8 F9EABDDB8FF8CC9E                        db 0F9h,0EAh,0BDh,0DBh, 8Fh,0F8h,0CCh, 9Eh
 10524 0000A1C0 E97FF7ADDABC6FAE                        db 0E9h, 7Fh,0F7h,0ADh,0DAh,0BCh, 6Fh,0AEh
 10525 0000A1C8 0FCBF68EE85F9DF5                        db  0Fh,0CBh,0F6h, 8Eh,0E8h, 5Fh, 9Dh,0F5h
 10526 0000A1D0 7EE7ACCABBD98D4F                        db  7Eh,0E7h,0ACh,0CAh,0BBh,0D9h, 8Dh, 4Fh
 10527 0000A1D8 F43FF3D8E62FF26E                        db 0F4h, 3Fh,0F3h,0D8h,0E6h, 2Fh,0F2h, 6Eh
 10528 0000A1E0 F01FF19CC95EABBA                        db 0F0h, 1Fh,0F1h, 9Ch,0C9h, 5Eh,0ABh,0BAh
 10529 0000A1E8 E57DD74EE48CC83E                        db 0E5h, 7Dh,0D7h, 4Eh,0E4h, 8Ch,0C8h, 3Eh
 10530 0000A1F0 6DD6E39BB92EAAE2                        db  6Dh,0D6h,0E3h, 9Bh,0B9h, 2Eh,0AAh,0E2h
 10531 0000A1F8 1EE10EE05DD57CC7                        db  1Eh,0E1h, 0Eh,0E0h, 5Dh,0D5h, 7Ch,0C7h
 10532 0000A200 4D8BD4B89AA96CC6                        db  4Dh, 8Bh,0D4h,0B8h, 9Ah,0A9h, 6Ch,0C6h
 10533 0000A208 3DD3D22D0D1D7BB7                        db  3Dh,0D3h,0D2h, 2Dh, 0Dh, 1Dh, 7Bh,0B7h
 10534 0000A210 D15CD0C58AA84CC4                        db 0D1h, 5Ch,0D0h,0C5h, 8Ah,0A8h, 4Ch,0C4h
 10535 0000A218 6BB6990C3CC37AA7                        db  6Bh,0B6h, 99h, 0Ch, 3Ch,0C3h, 7Ah,0A7h
 10536 0000A220 A6C00BC22C5BB51C                        db 0A6h,0C0h, 0Bh,0C2h, 2Ch, 5Bh,0B5h, 1Ch
 10537 0000A228 8998C14BB46A3B79                        db  89h, 98h,0C1h, 4Bh,0B4h, 6Ah, 3Bh, 79h
 10538 0000A230 B397882B5AB2A51B                        db 0B3h, 97h, 88h, 2Bh, 5Ah,0B2h,0A5h, 1Bh
 10539 0000A238 B1B069964AA47887                        db 0B1h,0B0h, 69h, 96h, 4Ah,0A4h, 78h, 87h
 10540 0000A240 3AA359952AA21AA1                        db  3Ah,0A3h, 59h, 95h, 2Ah,0A2h, 1Ah,0A1h
 10541 0000A248 0AA0688649943993                        db  0Ah,0A0h, 68h, 86h, 49h, 94h, 39h, 93h
 10542 0000A250 7709588529677692                        db  77h,   9, 58h, 85h, 29h, 67h, 76h, 92h
 10543 0000A258 9119904884577538                        db  91h, 19h, 90h, 48h, 84h, 57h, 75h, 38h
 10544 0000A260 8366472882188174                        db  83h, 66h, 47h, 28h, 82h, 18h, 81h, 74h
 10545 0000A268 0880566537734627                        db    8, 80h, 56h, 65h, 37h, 73h, 46h, 27h
 10546 0000A270 7264175571077036                        db  72h, 64h, 17h, 55h, 71h,   7, 70h, 36h
 10547 0000A278 6345542662160660                        db  63h, 45h, 54h, 26h, 62h, 16h,   6, 60h
 10548 0000A280 3561534425521551                        db  35h, 61h, 53h, 44h, 25h, 52h, 15h, 51h
 10549 0000A288 0550344324423341                        db    5, 50h, 34h, 43h, 24h, 42h, 33h, 41h
 10550 0000A290 1404233240031331                        db  14h,   4, 23h, 32h, 40h,   3, 13h, 31h
 10551 0000A298 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10552 0000A2A0 1000EFFEDFFDCFFC                        db  10h,   0,0EFh,0FEh,0DFh,0FDh,0CFh,0FCh
 10553 0000A2A8 BFFBAFFA9FF9F88F                        db 0BFh,0FBh,0AFh,0FAh, 9Fh,0F9h,0F8h, 8Fh
 10554 0000A2B0 7FF76FF6FF5FF54F                        db  7Fh,0F7h, 6Fh,0F6h,0FFh, 5Fh,0F5h, 4Fh
 10555 0000A2B8 F4F3F03FCEECDDDE                        db 0F4h,0F3h,0F0h, 3Fh,0CEh,0ECh,0DDh,0DEh
 10556 0000A2C0 E9EAD9EEEDEBBECD                        db 0E9h,0EAh,0D9h,0EEh,0EDh,0EBh,0BEh,0CDh
 10557 0000A2C8 DCDBAECCADDA7EAC                        db 0DCh,0DBh,0AEh,0CCh,0ADh,0DAh, 7Eh,0ACh
 10558 0000A2D0 CAC97D5EBDF22F0F                        db 0CAh,0C9h, 7Dh, 5Eh,0BDh,0F2h, 2Fh, 0Fh
 10559 0000A2D8 1FF19EBCCB8EE89D                        db  1Fh,0F1h, 9Eh,0BCh,0CBh, 8Eh,0E8h, 9Dh
 10560 0000A2E0 E7BB8DD86EE69CAB                        db 0E7h,0BBh, 8Dh,0D8h, 6Eh,0E6h, 9Ch,0ABh
 10561 0000A2E8 BAE5D74EE48CC83E                        db 0BAh,0E5h,0D7h, 4Eh,0E4h, 8Ch,0C8h, 3Eh
 10562 0000A2F0 6DD69BB9AAE1D4B8                        db  6Dh,0D6h, 9Bh,0B9h,0AAh,0E1h,0D4h,0B8h
 10563 0000A2F8 A97BB7D0E30EE05D                        db 0A9h, 7Bh,0B7h,0D0h,0E3h, 0Eh,0E0h, 5Dh
 10564 0000A300 D57CC74D8B9A6CC6                        db 0D5h, 7Ch,0C7h, 4Dh, 8Bh, 9Ah, 6Ch,0C6h
 10565 0000A308 3D5CC50D8AA8994C                        db  3Dh, 5Ch,0C5h, 0Dh, 8Ah,0A8h, 99h, 4Ch
 10566 0000A310 B67A3C5B891CC098                        db 0B6h, 7Ah, 3Ch, 5Bh, 89h, 1Ch,0C0h, 98h
 10567 0000A318 79E22E1ED32DD2D1                        db  79h,0E2h, 2Eh, 1Eh,0D3h, 2Dh,0D2h,0D1h
 10568 0000A320 3B97881DC46BC3A7                        db  3Bh, 97h, 88h, 1Dh,0C4h, 6Bh,0C3h,0A7h
 10569 0000A328 2CC2B5C10C4BB46A                        db  2Ch,0C2h,0B5h,0C1h, 0Ch, 4Bh,0B4h, 6Ah
 10570 0000A330 A6B35AA52BB21BB1                        db 0A6h,0B3h, 5Ah,0A5h, 2Bh,0B2h, 1Bh,0B1h
 10571 0000A338 0BB069964AA47887                        db  0Bh,0B0h, 69h, 96h, 4Ah,0A4h, 78h, 87h
 10572 0000A340 A33A592A9568A186                        db 0A3h, 3Ah, 59h, 2Ah, 95h, 68h,0A1h, 86h
 10573 0000A348 7794495767A21A0A                        db  77h, 94h, 49h, 57h, 67h,0A2h, 1Ah, 0Ah
 10574 0000A350 A039935885299276                        db 0A0h, 39h, 93h, 58h, 85h, 29h, 92h, 76h
 10575 0000A358 0919919048847538                        db    9, 19h, 91h, 90h, 48h, 84h, 75h, 38h
 10576 0000A360 8366288247741881                        db  83h, 66h, 28h, 82h, 47h, 74h, 18h, 81h
 10577 0000A368 8008563773654627                        db  80h,   8, 56h, 37h, 73h, 65h, 46h, 27h
 10578 0000A370 7264550717717036                        db  72h, 64h, 55h,   7, 17h, 71h, 70h, 36h
 10579 0000A378 6345542662166106                        db  63h, 45h, 54h, 26h, 62h, 16h, 61h,   6
 10580 0000A380 6053354425525115                        db  60h, 53h, 35h, 44h, 25h, 52h, 51h, 15h
 10581 0000A388 0534435024423314                        db    5, 34h, 43h, 50h, 24h, 42h, 33h, 14h
 10582 0000A390 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 10583 0000A398 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10584 0000A3A0 1000EFFEDFFDCFFC                        db  10h,   0,0EFh,0FEh,0DFh,0FDh,0CFh,0FCh
 10585 0000A3A8 BFFBFAAF9FF9F88F                        db 0BFh,0FBh,0FAh,0AFh, 9Fh,0F9h,0F8h, 8Fh
 10586 0000A3B0 7FF76FF65FF54FF4                        db  7Fh,0F7h, 6Fh,0F6h, 5Fh,0F5h, 4Fh,0F4h
 10587 0000A3B8 3FF32FF2F11FF00F                        db  3Fh,0F3h, 2Fh,0F2h,0F1h, 1Fh,0F0h, 0Fh
 10588 0000A3C0 EEDEEDCEECDDBEEB                        db 0EEh,0DEh,0EDh,0CEh,0ECh,0DDh,0BEh,0EBh
 10589 0000A3C8 CDDCAEEABDDBCC9E                        db 0CDh,0DCh,0AEh,0EAh,0BDh,0DBh,0CCh, 9Eh
 10590 0000A3D0 E9ADDABCCB8EE89D                        db 0E9h,0ADh,0DAh,0BCh,0CBh, 8Eh,0E8h, 9Dh
 10591 0000A3D8 D97EE7ACFFCABB8D                        db 0D9h, 7Eh,0E7h,0ACh,0FFh,0CAh,0BBh, 8Dh
 10592 0000A3E0 D80EE00DE66E9CC9                        db 0D8h, 0Eh,0E0h, 0Dh,0E6h, 6Eh, 9Ch,0C9h
 10593 0000A3E8 5EBAE5AB7DD7E48C                        db  5Eh,0BAh,0E5h,0ABh, 7Dh,0D7h,0E4h, 8Ch
 10594 0000A3F0 C84E2E3E6DD6E39B                        db 0C8h, 4Eh, 2Eh, 3Eh, 6Dh,0D6h,0E3h, 9Bh
 10595 0000A3F8 B9AAE21EE15DD57C                        db 0B9h,0AAh,0E2h, 1Eh,0E1h, 5Dh,0D5h, 7Ch
 10596 0000A400 C74D8BB8D49AA96C                        db 0C7h, 4Dh, 8Bh,0B8h,0D4h, 9Ah,0A9h, 6Ch
 10597 0000A408 C63DD32DD21D7BB7                        db 0C6h, 3Dh,0D3h, 2Dh,0D2h, 1Dh, 7Bh,0B7h
 10598 0000A410 D15CC58AA8994CC4                        db 0D1h, 5Ch,0C5h, 8Ah,0A8h, 99h, 4Ch,0C4h
 10599 0000A418 6BB6D00C3CC37AA7                        db  6Bh,0B6h,0D0h, 0Ch, 3Ch,0C3h, 7Ah,0A7h
 10600 0000A420 2CC25BB51C8998C1                        db  2Ch,0C2h, 5Bh,0B5h, 1Ch, 89h, 98h,0C1h
 10601 0000A428 4BC00B3BB00A1AB4                        db  4Bh,0C0h, 0Bh, 3Bh,0B0h, 0Ah, 1Ah,0B4h
 10602 0000A430 6AA67997A00990B3                        db  6Ah,0A6h, 79h, 97h,0A0h,   9, 90h,0B3h
 10603 0000A438 882B5AB2A51BB169                        db  88h, 2Bh, 5Ah,0B2h,0A5h, 1Bh,0B1h, 69h
 10604 0000A440 96A44A78873AA359                        db  96h,0A4h, 4Ah, 78h, 87h, 3Ah,0A3h, 59h
 10605 0000A448 952AA2A168867749                        db  95h, 2Ah,0A2h,0A1h, 68h, 86h, 77h, 49h
 10606 0000A450 9439935885296776                        db  94h, 39h, 93h, 58h, 85h, 29h, 67h, 76h
 10607 0000A458 9219914884577538                        db  92h, 19h, 91h, 48h, 84h, 57h, 75h, 38h
 10608 0000A460 8366288218477481                        db  83h, 66h, 28h, 82h, 18h, 47h, 74h, 81h
 10609 0000A468 0880566517077073                        db    8, 80h, 56h, 65h, 17h,   7, 70h, 73h
 10610 0000A470 3727724664557136                        db  37h, 27h, 72h, 46h, 64h, 55h, 71h, 36h
 10611 0000A478 6345542662166106                        db  63h, 45h, 54h, 26h, 62h, 16h, 61h,   6
 10612 0000A480 6035534425521505                        db  60h, 35h, 53h, 44h, 25h, 52h, 15h,   5
 10613 0000A488 5051344324423314                        db  50h, 51h, 34h, 43h, 24h, 42h, 33h, 14h
 10614 0000A490 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 10615 0000A498 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10616 0000A4A0 10000B0F0D0E0705                        db  10h,   0, 0Bh, 0Fh, 0Dh, 0Eh,   7,   5
 10617 0000A4A8 0906030A0C020104                        db    9,   6,   3, 0Ah, 0Ch,   2,   1,   4
 10618 0000A4B0 08000F0E0D0C0B0A                        db    8,   0, 0Fh, 0Eh, 0Dh, 0Ch, 0Bh, 0Ah
 10619 0000A4B8 0908070605040302                        db    9,   8,   7,   6,   5,   4,   3,   2
 10620 0000A4C0 0100                                    db    1,   0
 10621 0000A4C2 000000000000                            db 6 dup(0)
 10622                                  mp3_huff_data:
 10623 0000A4C8 0000                    		db   0,  0             
 10624 0000A4CA 0100                                    db   1,  0              ; byte[32][2] ; table,linbits
 10625 0000A4CC 0200                                    db   2,  0
 10626 0000A4CE 0300                                    db   3,  0
 10627 0000A4D0 0000                                    db   0,  0
 10628 0000A4D2 0400                                    db   4,  0
 10629 0000A4D4 0500                                    db   5,  0
 10630 0000A4D6 0600                                    db   6,  0
 10631 0000A4D8 0700                                    db   7,  0
 10632 0000A4DA 0800                                    db   8,  0
 10633 0000A4DC 0900                                    db   9,  0
 10634 0000A4DE 0A00                                    db  10,  0
 10635 0000A4E0 0B00                                    db  11,  0
 10636 0000A4E2 0C00                                    db  12,  0
 10637 0000A4E4 0000                                    db   0,  0
 10638 0000A4E6 0D00                                    db  13,  0
 10639 0000A4E8 0E01                                    db  14,  1
 10640 0000A4EA 0E02                                    db  14,  2
 10641 0000A4EC 0E03                                    db  14,  3
 10642 0000A4EE 0E04                                    db  14,  4
 10643 0000A4F0 0E06                                    db  14,  6
 10644 0000A4F2 0E08                                    db  14,  8
 10645 0000A4F4 0E0A                                    db  14, 10
 10646 0000A4F6 0E0D                                    db  14, 13
 10647 0000A4F8 0F04                                    db  15,  4
 10648 0000A4FA 0F05                                    db  15,  5
 10649 0000A4FC 0F06                                    db  15,  6
 10650 0000A4FE 0F07                                    db  15,  7
 10651 0000A500 0F08                                    db  15,  8
 10652 0000A502 0F09                                    db  15,  9
 10653 0000A504 0F0B                                    db  15, 11
 10654 0000A506 0F0D                                    db  15, 13
 10655                                  mp3_band_size_long:
 10656 0000A508 040404040404060608-     		db    4,   4,   4,   4,   4,   4,   6,   6,   8,   8, 0Ah
 10656 0000A511 080A               
 10657 0000A513 0C1014181C222A3236-                     db  0Ch, 10h, 14h, 18h, 1Ch, 22h, 2Ah, 32h, 36h, 4Ch, 9Eh ; byte[9][22]
 10657 0000A51C 4C9E               
 10658 0000A51E 040404040404060606-                     db    4,   4,   4,   4,   4,   4,   6,   6,   6,   8, 0Ah
 10658 0000A527 080A               
 10659 0000A529 0C1012161C22282E36-                     db  0Ch, 10h, 12h, 16h, 1Ch, 22h, 28h, 2Eh, 36h, 36h,0C0h
 10659 0000A532 36C0               
 10660 0000A534 040404040404060608-                     db    4,   4,   4,   4,   4,   4,   6,   6,   8, 0Ah, 0Ch
 10660 0000A53D 0A0C               
 10661 0000A53F 1014181E262E384454-                     db  10h, 14h, 18h, 1Eh, 26h, 2Eh, 38h, 44h, 54h, 66h, 1Ah
 10661 0000A548 661A               
 10662 0000A54A 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 10662 0000A553 0E10               
 10663 0000A555 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 10663 0000A55E 3A36               
 10664 0000A560 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 10664 0000A569 0E10               
 10665 0000A56B 12161A20262E344046-                     db  12h, 16h, 1Ah, 20h, 26h, 2Eh, 34h, 40h, 46h, 4Ch, 24h
 10665 0000A574 4C24               
 10666 0000A576 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 10666 0000A57F 0E10               
 10667 0000A581 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 10667 0000A58A 3A36               
 10668 0000A58C 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 10668 0000A595 0E10               
 10669 0000A597 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 10669 0000A5A0 3A36               
 10670 0000A5A2 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 10670 0000A5AB 0E10               
 10671 0000A5AD 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 10671 0000A5B6 3A36               
 10672 0000A5B8 0C0C0C0C0C0C101418-                     db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 10h, 14h, 18h, 1Ch, 20h
 10672 0000A5C1 1C20               
 10673 0000A5C3 283038404C5A020202-                     db  28h, 30h, 38h, 40h, 4Ch, 5Ah,   2,   2,   2,   2,   2
 10673 0000A5CC 0202               
 10674 0000A5CE 000000000000000000-                     db 10 dup(0)            ; data align
 10674 0000A5D7 00                 
 10675                                  mp3_band_size_short:
 10676 0000A5D8 0404040406080A0C0E-     		db    4,   4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 16h, 1Eh, 38h
 10676 0000A5E1 12161E38           
 10677 0000A5E5 0404040406060A0C0E-                     db    4,   4,   4,   4,   6,   6, 0Ah, 0Ch, 0Eh, 10h, 14h, 1Ah, 42h ; byte[9][16] ? ; byte [9][13]
 10677 0000A5EE 10141A42           
 10678 0000A5F2 0404040406080C1014-                     db    4,   4,   4,   4,   6,   8, 0Ch, 10h, 14h, 1Ah, 22h, 2Ah, 0Ch
 10678 0000A5FB 1A222A0C           
 10679 0000A5FF 0404040606080A0E12-                     db    4,   4,   4,   6,   6,   8, 0Ah, 0Eh, 12h, 1Ah, 20h, 2Ah, 12h
 10679 0000A608 1A202A12           
 10680 0000A60C 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 20h, 2Ch, 0Ch
 10680 0000A615 18202C0C           
 10681 0000A619 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 1Eh, 28h, 12h
 10681 0000A622 181E2812           
 10682 0000A626 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 1Eh, 28h, 12h
 10682 0000A62F 181E2812           
 10683 0000A633 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 1Eh, 28h, 12h
 10683 0000A63C 181E2812           
 10684 0000A640 0808080C1014181C24-                     db    8,   8,   8, 0Ch, 10h, 14h, 18h, 1Ch, 24h,   2,   2,   2, 1Ah
 10684 0000A649 0202021A           
 10685 0000A64D 000000000000000000-                     db 11 dup(0)            ; data align
 10685 0000A656 0000               
 10686                                  mp3_pretab:
 10687 0000A658 000000000000000000-     		db    0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0
 10687 0000A661 0000               
 10688 0000A663 000000000000000000-                     db    0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0
 10688 0000A66C 0000               
 10689 0000A66E 000000000000000000-                     db    0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0
 10689 0000A677 0000               
 10690 0000A679 010101010202030303-                     db    1,   1,   1,   1,   2,   2,   3,   3,   3,   2,   0
 10690 0000A682 0200               
 10691 0000A684 00000000                                db 4 dup(0)             ; data align
 10692                                  mp3_mdct_win_src:
 10693 0000A688 4B1D4200028FDB0016-     		dd  00421D4Bh, 00DB8F02h, 019C7F16h, 029ADCC0h, 04000001h, 06246711h
 10693 0000A691 7F9C01C0DC9A020100-
 10693 0000A69A 000411672406       
 10694 0000A6A0 4506EE090CD6A71238-                     dd  09EE0645h, 12A7D60Ch, 3DF40538h,0BC63D32Fh,0E7B0025Bh,0F069D222h ; these are sine values divided by cosine values...
 10694 0000A6A9 05F43D2FD363BC5B02-
 10694 0000A6B2 B0E722D269F0       
 10695 0000A6B8 567133F467D857F6A8-                     dd 0F4337156h,0F657D867h,0F7BCFBA8h,0F8BB5952h,0F97C4965h,0FA15BB1Ch
 10695 0000A6C1 FBBCF75259BBF86549-
 10695 0000A6CA 7CF91CBB15FA       
 10696 0000A6D0 936D94FA8E5100FB70-                     dd 0FA946D93h,0FB00518Eh,0FB5EA270h,0FBB2FDEAh,0FC000000h,0FC479F38h
 10696 0000A6D9 A25EFBEAFDB2FB0000-
 10696 0000A6E2 00FC389F47FC       
 10697 0000A6E8 09668BFC9898CCFC0B-                     dd 0FC8B6609h,0FCCC9898h,0FD0C4F0Bh,0FD4B895Ch,0FD8B3FCFh,0FDCC725Eh
 10697 0000A6F1 4F0CFD5C894BFDCF3F-
 10697 0000A6FA 8BFD5E72CCFD       
 10698 0000A700 2F3910FE67D857FE7D-                     dd 0FE10392Fh,0FE57D867h,0FEA4DA7Dh,0FEF935F7h,0FF5786D9h,0FFC36AD5h
 10698 0000A709 DAA4FEF735F9FED986-
 10698 0000A712 57FFD56AC3FF       
 10699 0000A718 4B1D4200028FDB0016-                     dd  00421D4Bh, 00DB8F02h, 019C7F16h, 029ADCC0h, 04000001h, 06246711h
 10699 0000A721 7F9C01C0DC9A020100-
 10699 0000A72A 000411672406       
 10700 0000A730 4506EE090CD6A71238-                     dd  09EE0645h, 12A7D60Ch, 3DF40538h,0BC63D32Fh,0E7B0025Bh,0F069D222h
 10700 0000A739 05F43D2FD363BC5B02-
 10700 0000A742 B0E722D269F0       
 10701 0000A748 567133F467D857F6A8-                     dd 0F4337156h,0F657D867h,0F7BCFBA8h,0F8BB5952h,0F97C4965h,0FA15BB1Ch
 10701 0000A751 FBBCF75259BBF86549-
 10701 0000A75A 7CF91CBB15FA       
 10702 0000A760 291B93FAB946F5FABB-                     dd 0FA931B29h,0FAF546B9h,0FB41DABBh,0FB7D8F97h,0FBABA162h,0FBCE4E62h
 10702 0000A769 DA41FB978F7DFB62A1-
 10702 0000A772 ABFB624ECEFB       
 10703 0000A778 671CF0FBAFC845FC0D-                     dd 0FBF01C67h,0FC45C8AFh,0FCD2D50Dh,0FD9008D0h,0FE74C032h,0FF771894h
 10703 0000A781 D5D2FCD00890FD32C0-
 10703 0000A78A 74FE941877FF       
 10704 0000A790 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 10704 0000A799 000000000000000000-
 10704 0000A7A2 000000000000       
 10705 0000A7A8 028FDB00010000040C-                     dd  00DB8F02h, 04000001h, 12A7D60Ch,0E7B0025Bh,0F657D867h,0F97C4965h
 10705 0000A7B1 D6A7125B02B0E767D8-
 10705 0000A7BA 57F665497CF9       
 10706 0000A7C0 8E5100FB000000FC98-                     dd 0FB00518Eh,0FC000000h,0FCCC9898h,0FD8B3FCFh,0FE57D867h,0FF5786D9h
 10706 0000A7C9 98CCFCCF3F8BFD67D8-
 10706 0000A7D2 57FED98657FF       
 10707 0000A7D8 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 10707 0000A7E1 000000000000000000-
 10707 0000A7EA 000000000000       
 10708 0000A7F0 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 10708 0000A7F9 000000000000000000-
 10708 0000A802 000000000000       
 10709 0000A808 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 10709 0000A811 000000000000000000-
 10709 0000A81A 000000000000       
 10710 0000A820 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 10710 0000A829 000000000000000000-
 10710 0000A832 000000000000       
 10711 0000A838 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 10711 0000A841 000000000000000000-
 10711 0000A84A 000000000000       
 10712 0000A850 B58869025237BA0B4F-                     dd  026988B5h, 0BBA3752h, 37D3294Fh,0B73F655Bh,0E3B0025Bh,0EDAD5D13h
 10712 0000A859 29D3375B653FB75B02-
 10712 0000A862 B0E3135DADED       
 10713 0000A868 A2ADB2F2B8288CF5D6-                     dd 0F2B2ADA2h,0F58C28B8h,0F75657D6h,0F88E2C57h,0F96DE565h,0FA1449CDh
 10713 0000A871 5756F7572C8EF865E5-
 10713 0000A87A 6DF9CD4914FA       
 10714 0000A880 936D94FA8E5100FB70-                     dd 0FA946D93h,0FB00518Eh,0FB5EA270h,0FBB2FDEAh,0FC000000h,0FC479F38h
 10714 0000A889 A25EFBEAFDB2FB0000-
 10714 0000A892 00FC389F47FC       
 10715 0000A898 09668BFC9898CCFC0B-                     dd 0FC8B6609h,0FCCC9898h,0FD0C4F0Bh,0FD4B895Ch,0FD8B3FCFh,0FDCC725Eh
 10715 0000A8A1 4F0CFD5C894BFDCF3F-
 10715 0000A8AA 8BFD5E72CCFD       
 10716 0000A8B0 2F3910FE67D857FE7D-                     dd 0FE10392Fh,0FE57D867h,0FEA4DA7Dh,0FEF935F7h,0FF5786D9h,0FFC36AD5h
 10716 0000A8B9 DAA4FEF735F9FED986-
 10716 0000A8C2 57FFD56AC3FF       
 10717                                  mp3_is_table_normal:
 10718 0000A8C8 0000000000000040        		dd  00000000h, 40000000h
 10719 0000A8D0 BB58860D46A77932                        dd  0D8658BBh, 3279A746h
 10720 0000A8D8 D1F56C17300A9328                        dd  176CF5D1h, 28930A30h
 10721 0000A8E0 0000002000000020                        dd  20000000h, 20000000h
 10722 0000A8E8 300A9328D1F56C17                        dd  28930A30h, 176CF5D1h
 10723 0000A8F0 46A77932BB58860D                        dd  3279A746h, 0D8658BBh
 10724 0000A8F8 0000004000000000                        dd  40000000h, 00000000h
 10725                                  mp3_is_table_lsf_src:			; sqrt based constants...
 10726 0000A900 00000080                		dd 80000000h            ; 40000000h*2 ; 2.0   (2^1.00) aka 2
 10727 0000A904 667EA26B                                dd 6BA27E66h            ; 35D13F33h*2 ; 1.681 (2^0.75)
 10728 0000A908 9A79825A                                dd 5A82799Ah            ; 2D413CCDh*2 ; 1.414 (2^0.50) aka sqrt(2)
 10729 0000A90C 2AF81B4C                                dd 4C1BF82Ah            ; 260DFC15h*2 ; 1.189 (2^0.25) aka sqrt(sqrt(2))
 10730                                  mp3_pow2_quarters:
 10731 0000A910 00000080                		dd 80000000h            ; 40000000h*2 ; 2^(0/4)
 10732 0000A914 52F03798                                dd 9837F052h            ; 4C1BF829h*2 ; 2^(1/4)
 10733 0000A918 34F304B5                                dd 0B504F334h           ; 5A82799Ah*2 ; 2^(2/4)
 10734 0000A91C CCFC44D7                                dd 0D744FCCCh           ; 6BA27E66h*2 ; 2^(3/4)
 10735                                  mp3_initialized:
 10736 0000A920 00000000                		dd 0                   
 10737                                  mp3_huff_num_entries:
 10738 0000A924 12000000                		dd 12h            
 10739                                  wrchr_buf:
 10740 0000A928 00                      		db 0                   
 10741                                                  
 10742                                  num_enqueued_frames:
 10743 0000A929 00                      		db 0
 10744                                  
 10745                                  ; align 4
 10746                                  
 10747                                  ; 21/10/2024                   
 10748 0000A92A 00000000                zero		dd 0
 10749                                  
 10750                                  huff_tree_list_numbits:
 10751 0000A92E 0303020106060505        		db    3,   3,   2,   1,   6,   6,   5,   5
 10752 0000A936 0503030301060605                        db    5,   3,   3,   3,   1,   6,   6,   5
 10753 0000A93E 0505030202020808                        db    5,   5,   3,   2,   2,   2,   8,   8
 10754 0000A946 0706070707070606                        db    7,   6,   7,   7,   7,   7,   6,   6
 10755 0000A94E 0606030303010707                        db    6,   6,   3,   3,   3,   1,   7,   7
 10756 0000A956 0606060505050504                        db    6,   6,   6,   5,   5,   5,   5,   4
 10757 0000A95E 0404030203030A0A                        db    4,   4,   3,   2,   3,   3, 0Ah, 0Ah
 10758 0000A966 0A0A090909090808                        db  0Ah, 0Ah,   9,   9,   9,   9,   8,   8
 10759 0000A96E 0909080909080807                        db    9,   9,   8,   9,   9,   8,   8,   7
 10760 0000A976 0707080808080707                        db    7,   7,   8,   8,   8,   8,   7,   7
 10761 0000A97E 0707060506060403                        db    7,   7,   6,   5,   6,   6,   4,   3
 10762 0000A986 03010B0B0A090A0A                        db    3,   1, 0Bh, 0Bh, 0Ah,   9, 0Ah, 0Ah
 10763 0000A98E 0909090808090909                        db    9,   9,   9,   8,   8,   9,   9,   9
 10764 0000A996 0908080807080808                        db    9,   8,   8,   8,   7,   8,   8,   8
 10765 0000A99E 0808080808060606                        db    8,   8,   8,   8,   8,   6,   6,   6
 10766 0000A9A6 0404020303020909                        db    4,   4,   2,   3,   3,   2,   9,   9
 10767 0000A9AE 0808090908080808                        db    8,   8,   9,   9,   8,   8,   8,   8
 10768 0000A9B6 0707070808070707                        db    7,   7,   7,   8,   8,   7,   7,   7
 10769 0000A9BE 0706060606050506                        db    7,   6,   6,   6,   6,   5,   5,   6
 10770 0000A9C6 0605050404040303                        db    6,   5,   5,   4,   4,   4,   3,   3
 10771 0000A9CE 03030B0B0B0B0B0B                        db    3,   3, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10772 0000A9D6 0A0A0A0A0A0A0A0B                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Bh
 10773 0000A9DE 0B0A09090A0A0909                        db  0Bh, 0Ah,   9,   9, 0Ah, 0Ah,   9,   9
 10774 0000A9E6 0A0A090A0A080809                        db  0Ah, 0Ah,   9, 0Ah, 0Ah,   8,   8,   9
 10775 0000A9EE 090A0A09090A0A08                        db    9, 0Ah, 0Ah,   9,   9, 0Ah, 0Ah,   8
 10776 0000A9F6 0808090909090909                        db    8,   8,   9,   9,   9,   9,   9,   9
 10777 0000A9FE 0808080808080707                        db    8,   8,   8,   8,   8,   8,   7,   7
 10778 0000AA06 0707060606060403                        db    7,   7,   6,   6,   6,   6,   4,   3
 10779 0000AA0E 03010A0A0A0A0A0A                        db    3,   1, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10780 0000AA16 0A0B0B0A0A090909                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah,   9,   9,   9
 10781 0000AA1E 0A0A0A0A08080909                        db  0Ah, 0Ah, 0Ah, 0Ah,   8,   8,   9,   9
 10782 0000AA26 0708080808080909                        db    7,   8,   8,   8,   8,   8,   9,   9
 10783 0000AA2E 0909080708080707                        db    9,   9,   8,   7,   8,   8,   7,   7
 10784 0000AA36 0808080909080808                        db    8,   8,   8,   9,   9,   8,   8,   8
 10785 0000AA3E 0808080707060607                        db    8,   8,   8,   7,   7,   6,   6,   7
 10786 0000AA46 0706050405050303                        db    7,   6,   5,   4,   5,   5,   3,   3
 10787 0000AA4E 03020A0A09090909                        db    3,   2, 0Ah, 0Ah,   9,   9,   9,   9
 10788 0000AA56 0909090808090908                        db    9,   9,   9,   8,   8,   9,   9,   8
 10789 0000AA5E 0808080808090908                        db    8,   8,   8,   8,   8,   9,   9,   8
 10790 0000AA66 0808080809090707                        db    8,   8,   8,   8,   9,   9,   7,   7
 10791 0000AA6E 0708080808080807                        db    7,   8,   8,   8,   8,   8,   8,   7
 10792 0000AA76 0707070808070707                        db    7,   7,   7,   8,   8,   7,   7,   7
 10793 0000AA7E 0606060607070605                        db    6,   6,   6,   6,   7,   7,   6,   5
 10794 0000AA86 0505040405050403                        db    5,   5,   4,   4,   5,   5,   4,   3
 10795 0000AA8E 0303131312111010                        db    3,   3, 13h, 13h, 12h, 11h, 10h, 10h
 10796 0000AA96 1010101010101010                        db  10h, 10h, 10h, 10h, 10h, 10h, 10h, 10h
 10797 0000AA9E 11110F0F10100F0F                        db  11h, 11h, 0Fh, 0Fh, 10h, 10h, 0Fh, 0Fh
 10798 0000AAA6 0F0F0F0F0F0F0F0F                        db  0Fh, 0Fh, 0Fh, 0Fh, 0Fh, 0Fh, 0Fh, 0Fh
 10799 0000AAAE 10100F10100E0E0F                        db  10h, 10h, 0Fh, 10h, 10h, 0Eh, 0Eh, 0Fh
 10800 0000AAB6 0F0F0F0E0E0E0E0E                        db  0Fh, 0Fh, 0Fh, 0Eh, 0Eh, 0Eh, 0Eh, 0Eh
 10801 0000AABE 0E0E0E0E0E0E0F0F                        db  0Eh, 0Eh, 0Eh, 0Eh, 0Eh, 0Eh, 0Fh, 0Fh
 10802 0000AAC6 0E0D0E0E0D0D0E0E                        db  0Eh, 0Dh, 0Eh, 0Eh, 0Dh, 0Dh, 0Eh, 0Eh
 10803 0000AACE 0D0E0E0D0E0E0D0E                        db  0Dh, 0Eh, 0Eh, 0Dh, 0Eh, 0Eh, 0Dh, 0Eh
 10804 0000AAD6 0E0D0D0E0E0C0C0C                        db  0Eh, 0Dh, 0Dh, 0Eh, 0Eh, 0Ch, 0Ch, 0Ch
 10805 0000AADE 0D0D0D0D0D0D0C0D                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch, 0Dh
 10806 0000AAE6 0D0C0C0D0D0D0D0D                        db  0Dh, 0Ch, 0Ch, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh
 10807 0000AAEE 0D0D0D0D0D0D0D0C                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch
 10808 0000AAF6 0C0D0D0C0C0C0C0D                        db  0Ch, 0Dh, 0Dh, 0Ch, 0Ch, 0Ch, 0Ch, 0Dh
 10809 0000AAFE 0D0D0D0C0D0D0C0B                        db  0Dh, 0Dh, 0Dh, 0Ch, 0Dh, 0Dh, 0Ch, 0Bh
 10810 0000AB06 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 10811 0000AB0E 0B0B0B0B0C0C0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Ch, 0Ch, 0Bh, 0Bh
 10812 0000AB16 0C0C0B0C0C0C0C0B                        db  0Ch, 0Ch, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Bh
 10813 0000AB1E 0B0C0C0B0C0C0B0C                        db  0Bh, 0Ch, 0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Ch
 10814 0000AB26 0C0B0C0C0A0A0A0B                        db  0Ch, 0Bh, 0Ch, 0Ch, 0Ah, 0Ah, 0Ah, 0Bh
 10815 0000AB2E 0B0B0B0B0B0B0B0A                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah
 10816 0000AB36 0A0A0A0B0B0A0B0B                        db  0Ah, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Bh, 0Bh
 10817 0000AB3E 0A0B0B0B0B0A0A0B                        db  0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah, 0Ah, 0Bh
 10818 0000AB46 0B0A0A0B0B0B0B0B                        db  0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10819 0000AB4E 0B09090A0A0A0A0A                        db  0Bh,   9,   9, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10820 0000AB56 0B0B0909090A0A09                        db  0Bh, 0Bh,   9,   9,   9, 0Ah, 0Ah,   9
 10821 0000AB5E 090A0A0A0A0A0A0A                        db    9, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10822 0000AB66 0A0A0A0809090909                        db  0Ah, 0Ah, 0Ah,   8,   9,   9,   9,   9
 10823 0000AB6E 09090A0A09090908                        db    9,   9, 0Ah, 0Ah,   9,   9,   9,   8
 10824 0000AB76 0809090909090908                        db    8,   9,   9,   9,   9,   9,   9,   8
 10825 0000AB7E 0708080808070707                        db    7,   8,   8,   8,   8,   7,   7,   7
 10826 0000AB86 0707060606060404                        db    7,   7,   6,   6,   6,   6,   4,   4
 10827 0000AB8E 03010D0D0D0D0C0D                        db    3,   1, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch, 0Dh
 10828 0000AB96 0D0D0D0D0D0C0D0D                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch, 0Dh, 0Dh
 10829 0000AB9E 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 10830 0000ABA6 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 10831 0000ABAE 0C0C0C0C0C0C0C0D                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Dh
 10832 0000ABB6 0D0B0B0C0C0C0C0B                        db  0Dh, 0Bh, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Bh
 10833 0000ABBE 0B0B0B0B0B0C0C0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ch, 0Ch, 0Bh
 10834 0000ABC6 0B0B0B0B0B0B0B0C                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ch
 10835 0000ABCE 0C0B0B0B0B0B0B0B                        db  0Ch, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10836 0000ABD6 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10837 0000ABDE 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10838 0000ABE6 0B0B0C0C0B0B0B0B                        db  0Bh, 0Bh, 0Ch, 0Ch, 0Bh, 0Bh, 0Bh, 0Bh
 10839 0000ABEE 0B0B0A0B0B0B0B0B                        db  0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10840 0000ABF6 0B0A0A0B0B0A0A0A                        db  0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah
 10841 0000ABFE 0A0B0B0A0A0A0A0A                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10842 0000AC06 0A0A0B0B0A0A0A0A                        db  0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah
 10843 0000AC0E 0A0B0B090A0A0A0A                        db  0Ah, 0Bh, 0Bh,   9, 0Ah, 0Ah, 0Ah, 0Ah
 10844 0000AC16 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10845 0000AC1E 090A0A0A0A090A0A                        db    9, 0Ah, 0Ah, 0Ah, 0Ah,   9, 0Ah, 0Ah
 10846 0000AC26 090A0A0A0A0A0A0A                        db    9, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10847 0000AC2E 0A09090909090909                        db  0Ah,   9,   9,   9,   9,   9,   9,   9
 10848 0000AC36 0A0A090909090909                        db  0Ah, 0Ah,   9,   9,   9,   9,   9,   9
 10849 0000AC3E 0A0A090909090909                        db  0Ah, 0Ah,   9,   9,   9,   9,   9,   9
 10850 0000AC46 0809090909090909                        db    8,   9,   9,   9,   9,   9,   9,   9
 10851 0000AC4E 0909090808080809                        db    9,   9,   9,   8,   8,   8,   8,   9
 10852 0000AC56 0909090909090908                        db    9,   9,   9,   9,   9,   9,   9,   8
 10853 0000AC5E 0808080808090908                        db    8,   8,   8,   8,   8,   9,   9,   8
 10854 0000AC66 0808080808080909                        db    8,   8,   8,   8,   8,   8,   9,   9
 10855 0000AC6E 0807080807070707                        db    8,   7,   8,   8,   7,   7,   7,   7
 10856 0000AC76 0808070707070706                        db    8,   8,   7,   7,   7,   7,   7,   6
 10857 0000AC7E 0707060607070606                        db    7,   7,   6,   6,   7,   7,   6,   6
 10858 0000AC86 0605050505050304                        db    6,   5,   5,   5,   5,   5,   3,   4
 10859 0000AC8E 04030B0B0B0B0B0B                        db    4,   3, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10860 0000AC96 0B0B0A0B0B0B0B0A                        db  0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah
 10861 0000AC9E 0A0A0A0A080A0A09                        db  0Ah, 0Ah, 0Ah, 0Ah,   8, 0Ah, 0Ah,   9
 10862 0000ACA6 0909090A1011110F                        db    9,   9,   9, 0Ah, 10h, 11h, 11h, 0Fh
 10863 0000ACAE 0F10100E0F0F0E0E                        db  0Fh, 10h, 10h, 0Eh, 0Fh, 0Fh, 0Eh, 0Eh
 10864 0000ACB6 0F0F0E0E0F0F0F0F                        db  0Fh, 0Fh, 0Eh, 0Eh, 0Fh, 0Fh, 0Fh, 0Fh
 10865 0000ACBE 0E0F0F0E0D080909                        db  0Eh, 0Fh, 0Fh, 0Eh, 0Dh,   8,   9,   9
 10866 0000ACC6 08080D0E0E0E0E0E                        db    8,   8, 0Dh, 0Eh, 0Eh, 0Eh, 0Eh, 0Eh
 10867 0000ACCE 0E0E0E0E0E0D0D0E                        db  0Eh, 0Eh, 0Eh, 0Eh, 0Eh, 0Dh, 0Dh, 0Eh
 10868 0000ACD6 0E0E0E0D0E0E0D0D                        db  0Eh, 0Eh, 0Eh, 0Dh, 0Eh, 0Eh, 0Dh, 0Dh
 10869 0000ACDE 0D0E0E0E0E0D0D0E                        db  0Dh, 0Eh, 0Eh, 0Eh, 0Eh, 0Dh, 0Dh, 0Eh
 10870 0000ACE6 0E0D0E0E0C0D0D0D                        db  0Eh, 0Dh, 0Eh, 0Eh, 0Ch, 0Dh, 0Dh, 0Dh
 10871 0000ACEE 0D0D0D0D0D0D0D0D                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh
 10872 0000ACF6 0D0D0D0C0D0D0D0D                        db  0Dh, 0Dh, 0Dh, 0Ch, 0Dh, 0Dh, 0Dh, 0Dh
 10873 0000ACFE 0D0D0C0D0D0C0C0D                        db  0Dh, 0Dh, 0Ch, 0Dh, 0Dh, 0Ch, 0Ch, 0Dh
 10874 0000AD06 0D0B0C0C0C0C0C0C                        db  0Dh, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 10875 0000AD0E 0C0D0D0B0C0C0C0C                        db  0Ch, 0Dh, 0Dh, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch
 10876 0000AD16 0B0C0C0C0C0C0C0C                        db  0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 10877 0000AD1E 0C0B0C0C0B0B0B0B                        db  0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Bh, 0Bh, 0Bh
 10878 0000AD26 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 10879 0000AD2E 0B0C0C0B0C0C0B0C                        db  0Bh, 0Ch, 0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Ch
 10880 0000AD36 0C0B0C0C0B0A0A0B                        db  0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Ah, 0Ah, 0Bh
 10881 0000AD3E 0B0B0B0B0B0A0A0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah, 0Ah, 0Bh
 10882 0000AD46 0B0A0A0B0B0B0B0B                        db  0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10883 0000AD4E 0B0B0B0A0B0B0A0A                        db  0Bh, 0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah
 10884 0000AD56 0A0B0B0A0A0B0B0A                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah
 10885 0000AD5E 0A0B0B0A09090A0A                        db  0Ah, 0Bh, 0Bh, 0Ah,   9,   9, 0Ah, 0Ah
 10886 0000AD66 0A0A0A0A0909090A                        db  0Ah, 0Ah, 0Ah, 0Ah,   9,   9,   9, 0Ah
 10887 0000AD6E 0A090A0A09090809                        db  0Ah,   9, 0Ah, 0Ah,   9,   9,   8,   9
 10888 0000AD76 0909090909090908                        db    9,   9,   9,   9,   9,   9,   9,   8
 10889 0000AD7E 0809090808070708                        db    8,   9,   9,   8,   8,   7,   7,   8
 10890 0000AD86 0807060606060404                        db    8,   7,   6,   6,   6,   6,   4,   4
 10891 0000AD8E 0301080808080808                        db    3,   1,   8,   8,   8,   8,   8,   8
 10892 0000AD96 0808070808070708                        db    8,   8,   7,   8,   8,   7,   7,   8
 10893 0000AD9E 0807070707070707                        db    8,   7,   7,   7,   7,   7,   7,   7
 10894 0000ADA6 0707070707080809                        db    7,   7,   7,   7,   7,   8,   8,   9
 10895 0000ADAE 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10896 0000ADB6 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10897 0000ADBE 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10898 0000ADC6 0B0B0B0B040B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh,   4, 0Bh, 0Bh, 0Bh
 10899 0000ADCE 0B0C0C0B0A0B0B0A                        db  0Bh, 0Ch, 0Ch, 0Bh, 0Ah, 0Bh, 0Bh, 0Ah
 10900 0000ADD6 0A0A0A0B0B0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah
 10901 0000ADDE 0A0B0B0A0A0A0A0A                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10902 0000ADE6 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10903 0000ADEE 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10904 0000ADF6 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10905 0000ADFE 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10906 0000AE06 0A0A0B0B0A0A0A0A                        db  0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah
 10907 0000AE0E 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10908 0000AE16 0A0B0B0A0B0B0A09                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Ah,   9
 10909 0000AE1E 0A0A0A0A0B0B0A09                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah,   9
 10910 0000AE26 090A0A090A0A0A0A                        db    9, 0Ah, 0Ah,   9, 0Ah, 0Ah, 0Ah, 0Ah
 10911 0000AE2E 09090A0A09090909                        db    9,   9, 0Ah, 0Ah,   9,   9,   9,   9
 10912 0000AE36 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 10913 0000AE3E 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 10914 0000AE46 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 10915 0000AE4E 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 10916 0000AE56 0A0A0909090A0A08                        db  0Ah, 0Ah,   9,   9,   9, 0Ah, 0Ah,   8
 10917 0000AE5E 0909080808080808                        db    9,   9,   8,   8,   8,   8,   8,   8
 10918 0000AE66 0808080808080809                        db    8,   8,   8,   8,   8,   8,   8,   9
 10919 0000AE6E 0908080808080809                        db    9,   8,   8,   8,   8,   8,   8,   9
 10920 0000AE76 0907080807070707                        db    9,   7,   8,   8,   7,   7,   7,   7
 10921 0000AE7E 0708080707060607                        db    7,   8,   8,   7,   7,   6,   6,   7
 10922 0000AE86 0706050506060404                        db    7,   6,   5,   5,   6,   6,   4,   4
 10923 0000AE8E 0404060606060606                        db    4,   4,   6,   6,   6,   6,   6,   6
 10924 0000AE96 0505050505040404                        db    5,   5,   5,   5,   5,   4,   4,   4
 10925 0000AE9E 0401040404040404                        db    4,   1,   4,   4,   4,   4,   4,   4
 10926 0000AEA6 0404040404040404                        db    4,   4,   4,   4,   4,   4,   4,   4
 10927 0000AEAE 0404                                    db    4,   4
 10928                                  _@@const_3:
 10929 0000AEB0 03                      		db 3
 10930 0000AEB1 000000                                  db 3 dup(0)
 10931                                  
 10932                                  		; 16/02/2025
 10933                                  ;mp3_synth_filter_procs:
 10934                                  		; 15/02/2025
 10935                                  		;dd synth_16bit_shift_0_slow ; SYNTH_MACRO 0,0,0
 10936                                  
 10937                                  ; Erdogan Tan - 17/10/2024
 10938                                  txt_hello:	
 10939 0000AEB4 0D0A                    		db 13,10
 10940                                  		;db 'NOCASH MP3 PLAYER v1.4 for Windows ',0
 10941                                  		; 09/01/2025
 10942                                  		;db 'NOCASH MP3 PLAYER v1.0 for TRDOS386 ',0
 10943                                  		; 15/02/2025
 10944 0000AEB6 54696E79204D503320-     		db 'Tiny MP3 PLAYER v1.0 for TRDOS386 by Erdogan Tan.',0
 10944 0000AEBF 504C41594552207631-
 10944 0000AEC8 2E3020666F72205452-
 10944 0000AED1 444F53333836206279-
 10944 0000AEDA 204572646F67616E20-
 10944 0000AEE3 54616E2E00         
 10945                                  txt_bdate:
 10946 0000AEE8 0D0A                    		db 13,10
 10947 0000AEEA 466562727561727920-     		db 'February 2025.',13,10,0
 10947 0000AEF3 323032352E0D0A00   
 10948                                  		
 10949 0000AEFB 31382F30322F323032-     		db "18/02/2025", 0
 10949 0000AF04 3500               
 10950                                  
 10951 0000AF06 303132333435363738-     hex_chars:	db "0123456789ABCDEF", 0
 10951 0000AF0F 3941424344454600   
 10952                                  
 10953 0000AF17 0D0A                    msgAC97Info:	db 0Dh, 0Ah
 10954 0000AF19 414339372041756469-     		db "AC97 Audio Controller & Codec Info", 0Dh, 0Ah
 10954 0000AF22 6F20436F6E74726F6C-
 10954 0000AF2B 6C6572202620436F64-
 10954 0000AF34 656320496E666F0D0A 
 10955 0000AF3D 56656E646F72204944-     		db "Vendor ID: "
 10955 0000AF46 3A20               
 10956 0000AF48 303030306820446576-     msgVendorId:	db "0000h Device ID: "
 10956 0000AF51 6963652049443A20   
 10957 0000AF59 30303030680D0A          msgDevId:	db "0000h", 0Dh, 0Ah
 10958 0000AF60 4275733A20              		db "Bus: "
 10959 0000AF65 303068204465766963-     msgBusNo:	db "00h Device: "
 10959 0000AF6E 653A20             
 10960 0000AF71 3030682046756E6374-     msgDevNo:	db "00h Function: "
 10960 0000AF7A 696F6E3A20         
 10961 0000AF7F 303068                  msgFncNo:	db "00h"
 10962 0000AF82 0D0A                    		db 0Dh, 0Ah
 10963                                  
 10964 0000AF84 4E414D4241523A20        		db "NAMBAR: "
 10965 0000AF8C 30303030682020          msgNamBar:	db "0000h  "
 10966 0000AF93 4E41424D4241523A20      		db "NABMBAR: "
 10967 0000AF9C 303030306820204952-     msgNabmBar:	db "0000h  IRQ: "
 10967 0000AFA5 513A20             
 10968 0000AFA8 3030                    msgIRQ:		dw 3030h
 10969 0000AFAA 0D0A00                  		db 0Dh, 0Ah, 0
 10970                                  
 10971 0000AFAD 0D0A46696C65204E61-     msgFileName:	db 0Dh, 0Ah, "File Name: ",0
 10971 0000AFB6 6D653A2000         
 10972 0000AFBB 0D0A53616D706C6520-     msgSampleRate:	db 0Dh, 0Ah, "Sample Rate: "
 10972 0000AFC4 526174653A20       
 10973 0000AFCA 303030303020487A00      msgHertz:	db "00000 Hz", 0 
 10974 0000AFD3 0D0A42697420526174-     msgKBitRate:	db 0Dh, 0Ah, "Bit Rate: ", 0
 10974 0000AFDC 653A2000           
 10975 0000AFE0 206B6269742F7300        msgKBits:	db " kbit/s", 0
 10976 0000AFE8 0D0A506C6179626163-     msgPlayback:	db 0Dh, 0Ah, "Playback: ", 0
 10976 0000AFF1 6B3A2000           
 10977                                  ; 17/02/2025
 10978                                  ;msg8Bits:	db "8 bits, ", 0 
 10979 0000AFF5 4D6F6E6F0D0A00          msgMono:	db "Mono", 0Dh, 0Ah, 0
 10980 0000AFFC 313620626974732C20-     msg16Bits:	db "16 bits, ", 0
 10980 0000B005 00                 
 10981 0000B006 53746572656F            msgStereo:	db "Stereo"
 10982 0000B00C 0D0A00                  nextline:	db 0Dh, 0Ah, 0
 10983                                  
 10984                                  ; 15/02/2025
 10985 0000B00F 0D0A                    msgDuration:	db 0Dh, 0Ah	
 10986 0000B011 4475726174696F6E3A-     		db "Duration: "
 10986 0000B01A 20                 
 10987 0000B01B 30303A303020286D69-     msgMinSec:	db "00:00 (minute:second)"
 10987 0000B024 6E7574653A7365636F-
 10987 0000B02D 6E6429             
 10988 0000B030 0D0A00                  		db 0Dh, 0Ah, 0	
 10989                                  
 10990 0000B033 56524120737570706F-     msgVRAheader:	db "VRA support: "
 10990 0000B03C 72743A20           
 10991 0000B040 00                      		db 0	
 10992 0000B041 5945530D0A00            msgVRAyes:	db "YES", 0Dh, 0Ah, 0
 10993 0000B047 4E4F200D0A              msgVRAno:	db "NO ", 0Dh, 0Ah
 10994 0000B04C 28496E746572706F6C-     		db "(Interpolated sample rate playing method)"
 10994 0000B055 617465642073616D70-
 10994 0000B05E 6C6520726174652070-
 10994 0000B067 6C6179696E67206D65-
 10994 0000B070 74686F6429         
 10995 0000B075 0D0A00                  		db 0Dh, 0Ah, 0
 10996                                  
 10997 0000B078 0D0A                    msgSB16Info:	db 0Dh, 0Ah
 10998 0000B07A 20417564696F204861-     		db " Audio Hardware: Sound Blaster 16", 0Dh, 0Ah
 10998 0000B083 7264776172653A2053-
 10998 0000B08C 6F756E6420426C6173-
 10998 0000B095 7465722031360D0A   
 10999 0000B09D 202020202020426173-     		db "      Base Port: "
 10999 0000B0A6 6520506F72743A20   
 11000                                  msgBasePort:
 11001 0000B0AE 303030680D0A            		db "000h", 0Dh, 0Ah
 11002 0000B0B4 202020202020202020-     		db "            IRQ: "
 11002 0000B0BD 2020204952513A20   
 11003                                  msgSB16IRQ:
 11004 0000B0C5 30                      		db 30h
 11005 0000B0C6 0D0A00                  		db 0Dh, 0Ah, 0
 11006                                  
 11007                                  		; 15/02/2025
 11008 0000B0C9 75736167653A20746D-     txt_help:	db 'usage: tmp3play filename.mp3',0Dh,0Ah,0
 11008 0000B0D2 7033706C6179206669-
 11008 0000B0DB 6C656E616D652E6D70-
 11008 0000B0E4 330D0A00           
 11009                                  
 11010 0000B0E8 0D0A                    txt_original:	db 13,10
 11011 0000B0EA 4F726967696E616C20-     		db 'Original code: ', 13,10
 11011 0000B0F3 636F64653A200D0A   
 11012 0000B0FB 202020202020202020-     		db '         Nocash MP3 Decoder/Player', 13,10
 11012 0000B104 4E6F63617368204D50-
 11012 0000B10D 33204465636F646572-
 11012 0000B116 2F506C617965720D0A 
 11013 0000B11F 202020202020202020-     		db '         MP3PLAYER.EXE v1.4 (20/09/2024)', 13,10
 11013 0000B128 4D5033504C41594552-
 11013 0000B131 2E4558452076312E34-
 11013 0000B13A 202832302F30392F32-
 11013 0000B143 303234290D0A       
 11014 0000B149 202020202020202020-     		db '         by Martin Korth (TASM source code)'
 11014 0000B152 6279204D617274696E-
 11014 0000B15B 204B6F727468202854-
 11014 0000B164 41534D20736F757263-
 11014 0000B16D 6520636F646529     
 11015 0000B174 0D0A00                  		db 13,10,0
 11016 0000B177 76312E342E30            		db 'v1.4.0'
 11017                                  ; 10/01/2025
 11018 0000B17D 00                      half_buffer:	db 0
 11019                                  
 11020                                  ; 13/02/2025
 11021 0000B17E 0D0A                    msgPressAKey:	db 0Dh, 0Ah
 11022 0000B180 202E2E2E2070726573-     		db ' ... press a key to continue ... '
 11022 0000B189 732061206B65792074-
 11022 0000B192 6F20636F6E74696E75-
 11022 0000B19B 65202E2E2E20       
 11023 0000B1A1 0D0A0D0A00              		db 0Dh, 0Ah, 0Dh, 0Ah, 0
 11024                                  
 11025                                  ; ---------------------------------------------------------------------------
 11026                                  
 11027                                  		; 13/02/2025 (mp3play6.s)
 11028                                  		; 30/12/2024 (cgaplay.s)
 11029 0000B1A6 FF<rep 8h>              fillblock:	times 8 db 0FFh
 11030 0000B1AE 0000                    		dw 0
 11031                                  
 11032                                  ; ---------------------------------------------------------------------------
 11033                                  
 11034                                  ; 13/02/2025
 11035                                  ; 23/11/2024
 11036 0000B1B0 0B0A0C0E090D0F          colors:		db 0Bh, 0Ah, 0Ch, 0Eh, 09h, 0Dh, 0Fh
 11037                                  			; cyan, green, red, yellow, blue, magenta, white
 11038 0000B1B7 0B                      ccolor:		db 0Bh	; cyan
 11039                                  
 11040                                  ; ---------------------------------------------------------------------------
 11041                                  
 11042                                  ; 24/01/2025
 11043 0000B1B8 03                      volume_level	db 3
 11044                                  
 11045                                  ; ---------------------------------------------------------------------------
 11046                                  
 11047                                  ; 26/01/2025
 11048                                  ; 07/12/2024
 11049                                  trdos386_err_msg:
 11050 0000B1B9 5452444F5320333836-     		db 'TRDOS 386 System call error !',10,13,0
 11050 0000B1C2 2053797374656D2063-
 11050 0000B1CB 616C6C206572726F72-
 11050 0000B1D4 20210A0D00         
 11051                                  
 11052                                  ; ---------------------------------------------------------------------------
 11053                                  
 11054                                  ; 15/02/2025
 11055 0000B1D9 0A0D                    noDevMsg:	db 10,13
 11056 0000B1DB 4572726F723A20556E-     		db 'Error: Unable to find a proper audio device !'
 11056 0000B1E4 61626C6520746F2066-
 11056 0000B1ED 696E6420612070726F-
 11056 0000B1F6 70657220617564696F-
 11056 0000B1FF 206465766963652021 
 11057 0000B208 0A0D00                  		db 10,13,0
 11058                                  
 11059                                  ; ---------------------------------------------------------------------------
 11060                                  
 11061                                  ; 15/02/2025
 11062                                  txt_not_found:
 11063 0000B20B 0A0D                    noFileErrMsg:	db 10,13
 11064 0000B20D 4572726F723A204669-     		db 'Error: File not found !',10,13,0
 11064 0000B216 6C65206E6F7420666F-
 11064 0000B21F 756E6420210A0D00   
 11065                                  
 11066                                  ; ---------------------------------------------------------------------------
 11067                                  
 11068                                  ; 15/02/2025
 11069 0000B227 0A0D                    not_valid_mp3f:	db 10,13
 11070 0000B229 4E6F7420612070726F-     		db 'Not a proper/valid MP3 file !',10,13,0
 11070 0000B232 7065722F76616C6964-
 11070 0000B23B 204D50332066696C65-
 11070 0000B244 20210A0D00         
 11071                                  
 11072                                  ; ---------------------------------------------------------------------------
 11073                                  
 11074                                  EOF:
 11075                                  
 11076                                  ; ===========================================================================
 11077                                  ; Uninitialized DATA (BSS)
 11078                                  ; ===========================================================================
 11079                                  
 11080 0000B249 90<rep 3h>              align 4
 11081                                  
 11082                                  ; 15/02/2025
 11083                                  bss_start:
 11084                                  
 11085                                  ABSOLUTE bss_start
 11086                                  
 11087                                  ;------------------------------------------------------------------------------
 11088                                  ; IFF/ILBM DATA
 11089                                  ;------------------------------------------------------------------------------
 11090                                  
 11091 0000B24C ????????                picture.width:	resd 1 	; current picture width and height
 11092 0000B250 ????????                picture.height:	resd 1
 11093                                  
 11094                                  ;------------------------------------------------------------------------------
 11095                                  
 11096                                  ; 16/02/2025 (tmp3play.s)
 11097                                  ; 13/02/2025
 11098                                  ; 12/02/2025 (mp3play6.s)
 11099                                  ; 05/02/2025 (cgaplay.s)
 11100                                  
 11101                                  alignb 4
 11102                                  
 11103                                  ; 25/01/2025
 11104 0000B254 ????????                stream_size	resd 1
 11105                                  ; 13/02/2025
 11106                                  ;turn_on_leds	resd 1
 11107                                  ; 22/01/2025
 11108 0000B258 ????????                stream_begin	resd 1
 11109 0000B25C ????????                fb_count	resd 1
 11110                                  
 11111                                  ; 26/01/2025
 11112 0000B260 ????????                sd_count	resd 1
 11113                                  
 11114                                  ; 12/01/2025
 11115                                  ;;;;
 11116                                  ; AC97 specific
 11117 0000B264 ????????                bus_dev_fn	resd 1
 11118 0000B268 ????????                dev_vendor	resd 1
 11119 0000B26C ????                    NAMBAR		resw 1
 11120 0000B26E ????                    NABMBAR		resw 1
 11121                                  ; SB16 specific
 11122 0000B270 ????????                audio_io_base	resd 1
 11123                                  ac97_int_ln_reg:
 11124 0000B274 ??                      audio_intr	resb 1
 11125                                  ;;;;
 11126                                  
 11127                                  ; 13/02/2025
 11128 0000B275 ??                      stopped		resb 1
 11129                                  
 11130 0000B276 ????                    alignb 4
 11131                                  
 11132                                  ;;;
 11133                                  ; 24/01/2025
 11134                                  ; 20/10/2024 (TRDOS 386 specific parameters)
 11135 0000B278 ??                      audio_hardware	resb 1
 11136 0000B279 ??                      vra		resb 1
 11137 0000B27A ??                      srb		resb 1
 11138 0000B27B ??                      blocks		resb 1
 11139 0000B27C ????????                buffer_size	resd 1
 11140                                  ;;;
 11141                                  
 11142                                  ; 23/05/2025
 11143 0000B280 ????????                timerticks	resd 1
 11144                                  
 11145                                  ; 15/01/2025 (FASM)
 11146                                  ;;;;
 11147                                  ; 13/01/2025 (Interpolation parameters)
 11148 0000B284 ????????                conversion	resd 1	; pointer to convers(t)ion
 11149                                  ;			; or interpolation proc address
 11150 0000B288 ????????                loadsize	resd 1	; decoding buffer size
 11151 0000B28C ??                      interpolation	resb 1	; interpolation status
 11152                                  
 11153                                  ;------------------------------------------------------------------------------
 11154                                  
 11155                                  ; 25/01/2025
 11156 0000B28D ??????                  alignb 4
 11157                                  
 11158                                  ; 15/02/2025
 11159                                  mp3_context_start:
 11160 0000B290 <res 1000h>             main_data_pool_start	resb 4096
 11161 0000C290 ????????                main_data_pool_wr_ptr	resd 1
 11162 0000C294 ????????                mp3_src_data_location	resd 1
 11163 0000C298 ????????                mp3_src_frame_size	resd 1
 11164 0000C29C ????????                mp3_src_frame_end	resd 1
 11165 0000C2A0 ????????                mp3_hdr_32bit_header	resd 1
 11166 0000C2A4 ????????                mp3_hdr_flag_crc	resd 1
 11167 0000C2A8 ????????                mp3_hdr_flag_mpeg25	resd 1
 11168 0000C2AC ????????                mp3_hdr_flag_padding	resd 1
 11169 0000C2B0 ????????                mp3_sample_rate		resd 1
 11170 0000C2B4 ????????                mp3_hdr_sample_rate_index resd 1
 11171 0000C2B8 ????????                mp3_bit_rate		resd 1
 11172 0000C2BC ????????                mp3_num_channels	resd 1
 11173                                  ; 17/02/2025
 11174                                  ;mp3_bytes_per_sample	resd 1
 11175 0000C2C0 ????????                mp3_curr_syn_index	resd 1
 11176 0000C2C4 ????????                mp3_curr_syn_dst	resd 1
 11177 0000C2C8 ????????                mp3_nb_frames		resd 1
 11178 0000C2CC ????????                mp3_hdr_mode_val	resd 1
 11179 0000C2D0 ????????                mp3_hdr_mode_ext	resd 1
 11180 0000C2D4 ????????                mp3_hdr_flag_lsf	resd 1
 11181                                  
 11182 0000C2D8 <res 2000h>             mp3_synth_buf   resd 2048
 11183 0000E2D8 ????????????????        mp3_synth_index resd 2
 11184 0000E2E0 <res 2400h>             mp3_sb_samples  resd 2304
 11185                                  				; MP3_MAX_CHANNELS*36*SBLIMIT
 11186 000106E0 <res 1200h>             mp3_mdct_buf    resd 1152
 11187                                  				; MP3_MAX_CHANNELS*SBLIMIT*18
 11188 000118E0 ????????                mp3_free_format_frame_size resd 1
 11189                                  
 11190 000118E4 ??                      mp3_curr_vfrac_bits resb 1
 11191                                  
 11192 000118E5 ??????                  alignb 4
 11193                                  
 11194 000118E8 ????????                mp3_xing_id     resd 1
 11195 000118EC ????????                mp3_xing_flags  resd 1
 11196 000118F0 ????????                mp3_xing_frames resd 1
 11197 000118F4 ????????                mp3_xing_filesize resd 1
 11198 000118F8 <res 64h>               mp3_xing_toc    resb 100
 11199 0001195C ????????                mp3_xing_vbr_scale resd 1
 11200 00011960 ????????                mp3_file_size   resd 1
 11201 00011964 ????????                mp3_id3_size    resd 1
 11202 00011968 ????????                mp3_tag_size    resd 1
 11203                                  
 11204 0001196C ????????                mp3_num_frames_decoded	resd 1
 11205 00011970 ????????                mp3_samples_dst		resd 1
 11206                                  ; DWORD mp3_samples_output_size
 11207 00011974 ????????                mp3_samples_output_size	resd 1
 11208 00011978 ????????                mp3_samples_dst_step	resd 1
 11209                                  
 11210 0001197C ????????                mp3_curr_channel	resd 1
 11211 00011980 ????????                mp3_curr_granule	resd 1
 11212 00011984 ????????                mp3_curr_frame		resd 1
 11213                                  
 11214 00011988 ????????                mp3_bitstream_start	resd 1
 11215 0001198C ????????                mp3_src_remain		resd 1
 11216 00011990 ????????                mp3_extra_bytes		resd 1
 11217 00011994 ????????                mp3_main_data_begin	resd 1
 11218 00011998 ????????                mp3_num_compress_bits	resd 1
 11219                                  
 11220 0001199C ????????                mp3_nb_granules resd 1
 11221                                  
 11222 000119A0 <res 2680h>             mp3_granules		resb 9856
 11223 00014020 <res 480h>              mp3_exponents		resw 576
 11224 000144A0 <res B800h>             huff_tree_buf		resb 0B800h
 11225 0001FCA0 <res 240h>              mp3_band_index_long	resw 288
 11226 0001FEE0 <res 803Ch>             mp3_table_4_3_exp	resb 32828
 11227                                  
 11228 00027F1C <res 200F0h>            mp3_table_4_3_value	resd 32828
 11229 0004800C <res 800h>              mp3_exp_table		resd 512
 11230 0004880C <res 8000h>             mp3_expval_table	resd 8192
 11231 0005080C <res 480h>              mp3_mdct_win		resd 288
 11232 00050C8C <res 800h>              mp3_is_table_lsf	resd 512
 11233 0005148C <res 1000h>             mp3_synth_win		resd 1024
 11234 0005248C <res 2000h>             mp3_lsf_sf_expand_exploded_table resb 8192
 11235                                  mp3_context_end:
 11236 0005448C ????????                _@@region_address0	resd 1
 11237 00054490 ????????                _@@region_address1	resd 1
 11238 00054494 ????????                _@@saved_sp		resd 1
 11239 00054498 ????????                mp3_main_data_siz	resd 1
 11240 0005449C ????????                _@@scfsi        resd 1
 11241 000544A0 <res Ch>                _@@gains        resd 3
 11242 000544AC ????????                _@@rle_point    resd 1
 11243 000544B0 ????????                _@@III          resd 1
 11244 000544B4 ????????                _@@JJJ          resd 1
 11245 000544B8 ????????                _@@linbits      resd 1
 11246 000544BC ????????                _@@vlc_table    resd 1
 11247 000544C0 ????????                _@@coarse_end   resd 1
 11248                                  
 11249 000544C4 ????????                _@rle_point     resd 1
 11250 000544C8 ????????                _@@rle_ptr      resd 1
 11251 000544CC ????????                _@@rle_val      resd 1
 11252 000544D0 ????????                _@@rle_val_x_40h resd 1
 11253 000544D4 ????????                _@@max_bands    resb 4
 11254 000544D8 ????????                _@@max_blocks   resd 1
 11255 000544DC ????????                _@@max_pos      resd 1
 11256 000544E0 <res 28h>               _@@sfb_array    resb 40
 11257 00054508 ????????                _@@is_tab       resd 1
 11258 0005450C ????????                _@@n_long_sfb   resd 1
 11259 00054510 ????????                _@@n_short_sfb  resd 1
 11260 00054514 ????????                _@@n_sfb        resd 1
 11261 00054518 <res 900h>              _@@tmp          resb 2304
 11262 00054E18 ????????                _@@s0           resd 1
 11263 00054E1C ????????                _@@s2           resd 1
 11264 00054E20 ????????                _@@s3           resd 1
 11265                                  
 11266 00054E24 <res 48h>               _@@@tmp         resd 18 ; resb 72
 11267 00054E6C ????????                _@@tmp0         resd 1
 11268 00054E70 ????????                _@@tmp1         resd 1
 11269 00054E74 ????????                _@@tmp2         resd 1
 11270 00054E78 ????????                _@@tmp3         resd 1
 11271 00054E7C ????????                _@@tmp4         resd 1
 11272 00054E80 ????????                _@@tmp5         resd 1
 11273 00054E84 ????????                mp3_out2_a0     resd 1
 11274 00054E88 ????????                mp3_out2_a1     resd 1
 11275 00054E8C ????????                mp3_out2_a2     resd 1
 11276 00054E90 ????????                mp3_out2_b0     resd 1
 11277 00054E94 ????????                mp3_out2_b1     resd 1
 11278 00054E98 ????????                mp3_out2_b2     resd 1
 11279 00054E9C ????????                                resd 1
 11280 00054EA0 ????????                                resd 1
 11281 00054EA4 ????????                _@@@JJJ         resd 1
 11282 00054EA8 ????????                _@@www          resd 1
 11283 00054EAC ????????                _@@mdct_long_end resd 1
 11284 00054EB0 ????????                _@@sblimit      resd 1
 11285 00054EB4 ????????                _@@switch_point resd 1
 11286 00054EB8 <res 100h>              mp3_huff_tmp_bits	resb 256
 11287 00054FB8 <res 200h>              mp3_huff_tmp_codes	resb 512
 11288 000551B8 ????????                _@@table_nb_bits	resd 1
 11289 000551BC ????????                _@@nb_codes		resd 1
 11290 000551C0 ????????                _@@prefix_numbits	resd 1
 11291 000551C4 ????????                _@@prefix_pattern	resd 1
 11292 000551C8 ????????                _@@curr_table_size	resd 1
 11293 000551CC ????????                _@@curr_table_mask	resd 1
 11294 000551D0 ????????                _@@curr_table_index	resd 1
 11295 000551D4 ????????                _@@granule_addr		resd 1
 11296                                  ; HANDLE hFile
 11297 000551D8 ????????                hFile           resd 1
 11298                                  ; HANDLE hMap
 11299                                  ;hMap           resd 1
 11300 000551DC ????????                stream_start    resd 1
 11301 000551E0 ????????                stream_pos      resd 1
 11302 000551E4 ????????                bytes_left      resd 1
 11303                                  
 11304                                  ; 17/02/2025
 11305                                  ;; 20/10/2024
 11306                                  ;; DWORD diskresult
 11307                                  ;;diskresult     resd 1
 11308                                  ;; HANDLE std_out
 11309                                  ;;std_out        resd 1
 11310                                  ;;cmdline_buf    resb 1024
 11311                                  ;cmdline_buf	resb 128
 11312                                  ;; HANDLE mp3_wav_handle
 11313                                  ;mp3_wav_handle  resd 1
 11314                                  ;; HANDLE mp3_pcm_handle
 11315                                  ;mp3_pcm_handle  resd 1
 11316                                  ;_@@max_diff     resd 1
 11317                                  ;_@@avg_diff     resd 2
 11318                                  ;pcm_filepos     resd 1
 11319                                  ;_@@mono_convert resd 1
 11320                                  ;_@@pcm_steps    resw 2
 11321                                  ;_@@worst_pcm_filepos resd 1
 11322                                  ;_@@worst_mp3_filepos resd 1
 11323                                  ;		resd 1
 11324                                  
 11325                                  ;------------------------------------------------------------------------------
 11326                                  
 11327                                  ; 15/02/2025
 11328                                  
 11329 000551E8 ????????????????        alignb 16
 11330                                  
 11331 000551F0 <res 200h>              RowOfs		resw 256
 11332                                  
 11333 000553F0 <res 200h>              NewScope_L	resw 256
 11334 000555F0 <res 200h>              NewScope_R	resw 256
 11335 000557F0 <res 200h>              OldScope_L	resw 256
 11336 000559F0 <res 200h>              OldScope_R	resw 256
 11337                                  
 11338                                  ;------------------------------------------------------------------------------
 11339                                  
 11340 00055BF0 <res 50h>               mp3_file_name	resb 80 ; wave file, path name (<= 80 bytes)
 11341                                  
 11342 00055C40 ????????                		resd 1
 11343 00055C44 ????????                txtSize		resd 1
 11344                                  
 11345                                  ;------------------------------------------------------------------------------
 11346                                  
 11347                                  ; 10/01/2025
 11348 00055C48 <res 3B8h>              alignb 4096
 11349                                  
 11350                                  ; 27/01/2025
 11351                                  ; 15/01/2025
 11352 00056000 <res 2000h>             decoding_buffer resb 8192  ; 2*4096 (max. 4608)
 11353 00058000 <res 9000h>             sample_buffer	resb 36864 ; 8*4608
 11354                                  
 11355                                  ;------------------------------------------------------------------------------
 11356                                  
 11357                                  ; 26/01/2025
 11358                                  ;alignb 4096
 11359                                  
 11360                                  ; 15/02/2025
 11361 00061000 ????????                sounddata_copy	resd 1	; address pointer for fast (conversion) copy
 11362 00061004 ????????                get_sound_data	resd 1	; procedure pointer
 11363                                  
 11364                                  ; 16/02/2025
 11365 00061008 <res FF8h>              alignb 4096
 11366                                  
 11367 00062000 <res 400h>              sounddata	resb 1024 ; 16 bit stereo samples for wave scope display
 11368 00062400 <res 200h>              sounddata2	resb 512 ; temporary buffer
 11369                                  
 11370                                  ; 26/01/2025
 11371 00062600 <res A00h>              alignb 4096
 11372                                  
 11373                                  end_of_bss:
 11374                                  
 11375                                  ; ===========================================================================
 11376                                  ; end
