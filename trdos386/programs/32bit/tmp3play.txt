     1                                  ; ****************************************************************************
     2                                  ; TMP3PLAY.PRG - Tiny MP3 PLAYER v1.0 for TRDOS 386 Operating System
     3                                  ; ----------------------------------------------------------------------------
     4                                  ; Based on 
     5                                  ; NOCASH MP3PLAY.EXE 1.4 (Windows) ASM source code (Martin Korth, 20/09/2024)
     6                                  ;
     7                                  ; 15/02/2025
     8                                  ;
     9                                  ; [ Last Modification: 20/02/2025 ]
    10                                  ;
    11                                  ; Modified from 'mp3play6.s' (14/02/2025) and 'twavply3.s' (10/02/2025)
    12                                  ;
    13                                  ; ----------------------------------------------------------------------------
    14                                  ; Modified from on MP3PLAY.ASM (for Windows console) source code - 17/10/2024
    15                                  ; ****************************************************************************
    16                                  ; Modified from Martin Korth's 'mp3play.asm' (TASM32) source code... (v1.4)
    17                                  ; Applied development method:
    18                                  ;         Disassembling 'mp3play.exe' v1.4 by using HEX-RAYS disassembler;
    19                                  ;         then... converting disassembled code to FASM syntax,
    20                                  ;                 adding '.idata' code (by help of FASM examples) to the raw
    21                                  ;                        asm file. Converting 'proc' procedures to labels.
    22                                  ;               and Finally: assembling mp3play.asm (single) file by using
    23                                  ;                           'fasm mp3play.asm' command.
    24                                  ;
    25                                  ; NOTE:
    26                                  ; Martin Korth's MP3PLAY.EXE (v1.4, 20/09/2024) file size is 45056 bytes.
    27                                  ; (This) modified MP3PLAY.EXE (v1.4.0, 17/10/2024) is 37888 bytes.
    28                                  ;
    29                                  ; ---------------------------------------------------------------------------
    30                                  ; Assembler: NASM (v2.15)
    31                                  ; ------------------------------------------------
    32                                  ; nasm tmp3play.s -l  tmp3play.txt -o TMP3PLAY.PRG
    33                                  
    34                                  ; 13/01/2025 (mp3play3.s)
    35                                  ; Interpolated sample rate playing method for non-VRA AC97 codecs.
    36                                  
    37                                  ; ===========================================================================
    38                                  ;  TRDOS 386 Operating System Specific Procedures - Erdogan Tan - 20/10/2024
    39                                  ; ===========================================================================
    40                                  
    41                                  ; 20/10/2024
    42                                  ; 20/08/2024 ; TRDOS 386 v2.0.9
    43                                  ; TRDOS 386 system calls
    44                                  _ver 	equ 0
    45                                  _exit 	equ 1
    46                                  _fork 	equ 2
    47                                  _read 	equ 3
    48                                  _write	equ 4
    49                                  _open	equ 5
    50                                  _close 	equ 6
    51                                  _wait 	equ 7
    52                                  _creat 	equ 8
    53                                  _rename equ 9
    54                                  _delete equ 10
    55                                  _exec	equ 11
    56                                  _chdir	equ 12
    57                                  _time 	equ 13
    58                                  _mkdir 	equ 14
    59                                  _chmod	equ 15
    60                                  _rmdir	equ 16
    61                                  _break	equ 17
    62                                  _drive	equ 18
    63                                  _seek	equ 19
    64                                  _tell 	equ 20
    65                                  _mem	equ 21
    66                                  _prompt	equ 22
    67                                  _path	equ 23
    68                                  _env	equ 24
    69                                  _stime	equ 25
    70                                  _quit	equ 26
    71                                  _intr	equ 27
    72                                  _dir	equ 28
    73                                  _emt 	equ 29
    74                                  _ldvrt 	equ 30
    75                                  _video 	equ 31
    76                                  _audio	equ 32
    77                                  _timer	equ 33
    78                                  _sleep	equ 34
    79                                  _msg    equ 35
    80                                  _geterr	equ 36
    81                                  _fpsave	equ 37
    82                                  _pri	equ 38
    83                                  _rele	equ 39
    84                                  _fff	equ 40
    85                                  _fnf	equ 41
    86                                  _alloc	equ 42
    87                                  _dalloc equ 43
    88                                  _calbac equ 44
    89                                  _dma	equ 45
    90                                  _stdio  equ 46	;  TRDOS 386 v2.0.9
    91                                  
    92                                  ; ---------------------------------------------------------------------------
    93                                  ; 'sys' macro
    94                                  ; ---------------------------------------------------------------------------
    95                                  ; 09/01/2025
    96                                  
    97                                  %macro sys 1-4
    98                                      ; 29/04/2016 - TRDOS 386 (TRDOS v2.0)
    99                                      ; 03/09/2015
   100                                      ; 13/04/2015
   101                                      ; Retro UNIX 386 v1 system call.
   102                                      %if %0 >= 2
   103                                          mov ebx, %2
   104                                          %if %0 >= 3
   105                                              mov ecx, %3
   106                                              %if %0 = 4
   107                                                 mov edx, %4
   108                                              %endif
   109                                          %endif
   110                                      %endif
   111                                      mov eax, %1
   112                                      ;int 30h
   113                                      int 40h ; TRDOS 386 (TRDOS v2.0)
   114                                  %endmacro
   115                                  
   116                                  ; ===========================================================================
   117                                  ; CODE
   118                                  ; ===========================================================================
   119                                  
   120                                  		[BITS 32] ; 32-bit intructions
   121                                  
   122                                  		[ORG 0]
   123                                  
   124                                  ; ===========================================================================
   125                                  
   126                                  		; 15/02/2025
   127                                  start:
   128                                  		; 15/02/2025
   129                                  		sys	_msg, txt_hello, 255, 0Bh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00000000 BB[B4AE0000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00000005 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 0000000A BA0B000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000000F B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00000014 CD40                <1>  int 40h
   130                                  
   131                                  		; 21/10/2024
   132 00000016 E89A400000              		call	set_break	; set and clear bss section
   133                                  					; also set stream_start position
   134                                  
   135                                  		; 15/02/2025
   136                                  		sys	_msg, txt_bdate, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000001B BB[E8AE0000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00000020 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00000025 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000002A B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000002F CD40                <1>  int 40h
   137                                  		sys	_msg, txt_original,255,07h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00000031 BB[E8B00000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00000036 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 0000003B BA07000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00000040 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00000045 CD40                <1>  int 40h
   138                                  
   139                                  		;;;
   140                                  		; 11/01/2025
   141 00000047 E836410000              		call	detect_enable_audio_device
   142                                  		; 15/02/2025
   143 0000004C 731B                    		jnc     short GetFileName
   144                                  _dev_not_ready:
   145                                  		; couldn't find the audio device!
   146                                  		sys	_msg, noDevMsg, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000004E BB[D9B10000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00000053 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00000058 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000005D B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00000062 CD40                <1>  int 40h
   147 00000064 E910410000              		jmp     ExitP@
   148                                  
   149                                  		; ---------------------------------------------------
   150                                  
   151                                  		; 20/02/2025
   152                                  		; 15/02/2025 - tmp3play.s
   153                                  		; 10/02/2025 - twavply3.s
   154                                  GetFileName:
   155                                  		; (TRDOS 386 -Retro UNIX 386- argument transfer method)
   156                                  		; (stack: argc,argv0addr,argv1addr,argv2addr ..
   157                                  		;			.. argv0text, argv1text ..) 
   158                                  		; ---- argc, argv[] ----
   159 00000069 89E6                    		mov	esi, esp
   160 0000006B AD                      		lodsd
   161 0000006C 83F802                  		cmp	eax, 2 ; two arguments 
   162 0000006F 7302                    		jnb	short _x
   163 00000071 EB4E                    		jmp	pmsg_usage
   164                                  
   165                                  _x:
   166 00000073 AD                      		lodsd	; skip program (PRG) file name
   167 00000074 8B36                    		mov	esi, [esi] ; MP3 file name 
   168                                  
   169                                  		;mov	edi, wav_file_name
   170                                  		; 15/02/2025
   171 00000076 BF[F05B0500]            		mov	edi, mp3_file_name
   172 0000007B 31C9                    		xor	ecx, ecx ; 0
   173                                  ScanName:       
   174 0000007D AC                      		lodsb
   175                                  
   176 0000007E 3C0D                    		cmp	al, 0Dh	; CR
   177 00000080 7633                    		jna	short a_4
   178                                  _y:
   179 00000082 3C20                    		cmp	al, 20h
   180 00000084 74F7                    		je	short ScanName	; scan start of name.
   181 00000086 AA                      		stosb
   182 00000087 B4FF                    		mov	ah, 0FFh
   183                                  a_0:
   184 00000089 FEC4                    		inc	ah
   185                                  a_1:
   186 0000008B 41                      		inc	ecx
   187 0000008C AC                      		lodsb
   188 0000008D AA                      		stosb
   189 0000008E 3C2E                    		cmp	al, '.'
   190 00000090 74F7                    		je	short a_0
   191 00000092 3C20                    		cmp	al, 20h
   192 00000094 7611                    		jna	short a_3
   193 00000096 20E4                    		and	ah, ah
   194 00000098 7406                    		jz	short a_2
   195                                  
   196                                  		; 20/02/2025
   197 0000009A 3C2F                    		cmp	al, '/'
   198 0000009C 7502                    		jne	short a_2
   199 0000009E B400                    		mov	ah, 0
   200                                  a_2:
   201 000000A0 80F94B                  		cmp	cl, 75	; 64+8+'.'+3 -> offset 75 is the last chr
   202 000000A3 72E6                    		jb	short a_1
   203 000000A5 EB0E                    		jmp	short a_4
   204                                  a_3:
   205 000000A7 4F                      		dec	edi
   206 000000A8 08E4                    		or	ah, ah		; if period NOT found,
   207 000000AA 7509                    		jnz	short a_4 	; then add a .mp3 extension.
   208                                  SetExt:
   209                                  		; 15/02/2025
   210 000000AC C7072E6D7033            		mov	dword [edi], '.mp3'
   211                                  		;mov	dword [edi], '.WAV' ; ! 64+12 is DOS limit
   212                                  					    ;   but writing +4 must not
   213                                  					    ;   destroy the following data
   214                                  					; so, 80 bytes path + 0 is possible here
   215 000000B2 83C704                  		add	edi, 4
   216                                  a_4:
   217 000000B5 C60700                  		mov	byte [edi], 0
   218                                  
   219 000000B8 803D[F05B0500]20        		cmp	byte [mp3_file_name], 20h
   220 000000BF 771B                    		ja	short mp3_filename_chk
   221                                  
   222                                  pmsg_usage:
   223                                  		sys	_msg, txt_help, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000000C1 BB[C9B00000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 000000C6 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 000000CB BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000000D0 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 000000D5 CD40                <1>  int 40h
   224                                  
   225 000000D7 E99D400000              		jmp	ExitP@
   226                                  
   227                                  		; ---------------------------------------------------
   228                                  
   229                                  mp3_filename_chk:
   230 000000DC 8B47FC                  		mov	eax, [edi-4]
   231 000000DF 25FFDFDFFF              		and	eax, 0FFDFDFFFh
   232 000000E4 3D2E4D5033              		cmp	eax, '.MP3'
   233 000000E9 751E                    		jne	short not_valid_mp3
   234                                  
   235                                  		; ---------------------------------------------------
   236                                  		
   237 000000EB 31ED                     		xor	ebp, ebp
   238 000000ED E8013F0000              		call	mp3_init
   239 000000F2 E8D53F0000              		call	open_and_mmap_the_file
   240                                  		;jc	.exit
   241                                  		; 26/01/2025
   242 000000F7 0F827C400000            		jc	ExitP@
   243                                  
   244                                  		; 13/02/2025
   245 000000FD E82A500000              		call	write_audio_dev_info
   246                                  		
   247                                  		; 15/02/2025
   248 00000102 E8453F0000              		call	mp3_check_1st_frame
   249 00000107 731B                    		jnc	short mp3_file_ready
   250                                  
   251                                  not_valid_mp3:
   252                                  		; not a proper/valid mp3 file !
   253                                  		sys	_msg, not_valid_mp3f, 255, 0Ch
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00000109 BB[27B20000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 0000010E B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00000113 BA0C000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00000118 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000011D CD40                <1>  int 40h
   254                                  
   255 0000011F E955400000              		jmp	ExitP@
   256                                  
   257                                  		; ---------------------------------------------------
   258                                  
   259                                  mp3_file_ready:
   260                                  		; 13/02/2025
   261                                  		; 22/01/2025
   262                                  		; Forward/Backward position change parameters (*)
   263 00000124 A1[E0510500]            		mov	eax, [stream_pos]
   264 00000129 A3[58B20000]            		mov	[stream_begin], eax ; *
   265 0000012E A1[E4510500]            		mov	eax, [bytes_left]
   266 00000133 A3[54B20000]            		mov	[stream_size], eax ; *
   267                                  
   268                                  		; 15/02/2025
   269 00000138 E84C540000              		call	SetTotalTime
   270                                  
   271                                  		; 15/02/2025
   272 0000013D E8C4540000              		call	write_mp3_file_info
   273                                  
   274                                  		sys	_msg, msgPressAKey, 255, 07h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00000142 BB[7EB10000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00000147 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 0000014C BA07000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00000151 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00000156 CD40                <1>  int 40h
   275                                  
   276 00000158 30E4                    		xor	ah, ah
   277 0000015A CD32                    		int	32h	; TRDOS 386 keyboard interrupt
   278                                  				; getchar (wait for keystroke)
   279                                  
   280                                  		;cmp	al, 1Bh ; ESC
   281                                  		;je	ExitP@
   282                                  		; 13/02/2025
   283 0000015C E870530000              		call	check4keyboardstop.p_4
   284 00000161 0F8212400000            		jc	ExitP@
   285                                  
   286                                  		; ---------------------------------------------------
   287                                  
   288                                  		; 17/02/2025
   289                                  		;	[mp3_bytes_per_sample] = 2
   290                                  		; 15/02/2025 (tmp3play.s)
   291                                  		; 10/02/2025 (twavply3.s)
   292                                  		; 13/02/2025 (mp3play6.s)
   293                                  		; 26/01/2025 (mp3play5.s)
   294                                  		;;;;
   295 00000167 B800010000              		mov	eax, 256
   296 0000016C B201                    		mov	dl, 1
   297 0000016E 3815[78B20000]          		cmp	byte [audio_hardware], dl ; 1
   298 00000174 7714                    		ja	short .stolp_s16 ; AC97
   299                                  
   300 00000176 BA[44580000]            		mov	edx, get_sb16_sound_data
   301                                  		; SB16		
   302 0000017B 3815[BCC20000]          		cmp	byte [mp3_num_channels], dl ; 1
   303 00000181 7707                    		ja	short .stolp_s ; stereo
   304                                  .stolp_m:
   305                                  		;mov	ebx, sdc_8bit_mono
   306                                  		;cmp	byte [mp3_bytes_per_sample], dl ; 1
   307                                  		;jna	short .stolp_ok	; 8bit, mono
   308 00000183 BB[68580000]            		mov	ebx, sdc_16bit_mono
   309 00000188 EB09                    		jmp	short .stolp_m16 ; 16bit, mono
   310                                  .stolp_s:
   311                                  		;mov	ebx, sdc_8bit_stereo
   312                                  		;cmp	byte [mp3_bytes_per_sample], dl ; 1
   313                                  		;jna	short .stolp_s8 ; 8bit, stereo
   314                                  		; 16bit, stereo
   315                                  		;mov	ebx, sdc_16bit_stereo
   316                                  .stolp_s16:
   317 0000018A 31DB                    		xor	ebx, ebx ; (not necessary)
   318 0000018C BA[2C580000]            		mov	edx, get_ac97_sound_data ; (**)
   319                                  				; also for sb16, 16bit, stereo
   320 00000191 D1E0                    		shl	eax, 1
   321                                  .stolp_s8:
   322                                  .stolp_m16:
   323 00000193 D1E0                    		shl	eax, 1
   324                                  .stolp_ok:
   325 00000195 A3[60B20000]            		mov	[sd_count], eax
   326 0000019A 891D[00100600]          		mov	[sounddata_copy], ebx
   327 000001A0 8915[04100600]          		mov	[get_sound_data], edx
   328                                  		;;;;
   329                                  
   330                                  		; 15/02/2025
   331                                  		; ---------------------------------------------------
   332                                  		
   333                                  		; 13/02/2025
   334                                  		; 30/12/2024 (cgaplay.s)
   335                                  		;;;
   336                                  		; DIRECT VGA MEMORY ACCESS
   337                                  		; bl = 0, bh = 5
   338                                  		; Direct access/map to VGA memory (0A0000h)
   339                                  
   340                                  		sys	_video, 0500h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000001A6 BB00050000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000001AB B81F000000          <1>  mov eax, %1
   112                              <1> 
   113 000001B0 CD40                <1>  int 40h
   341 000001B2 3D00000A00              		cmp	eax, 0A0000h
   342 000001B7 7405                    		je	short .vimem_map_ok
   343                                  		; 30/12/2024
   344 000001B9 E9C2000000              		jmp	trdos386_error
   345                                  .vimem_map_ok:
   346                                  		;;;;
   347                                  
   348                                  		; ---------------------------------------------------
   349                                  setgraphmode:
   350                                  		; set VGA 640x480x16 graphics mode
   351 000001BE 66B81200                		mov	ax, 12h
   352 000001C2 CD31                    		int	31h	; TRDOS 386 Video Interrupt
   353                                  				; Set video mode
   354 000001C4 66BAC003                		mov	dx, 3C0h
   355 000001C8 30C0                    		xor	al, al
   356                                  setgraphmodel0:
   357                                  		;out	dx, al
   358 000001CA B401                    		mov	ah, 1	; outb
   359 000001CC CD34                    		int	34h	; TRDOS 386 IOCTL Interrupt
   360                                  		;out	dx, al
   361                                  		;mov	ah, 1	; outb
   362 000001CE CD34                    		int	34h
   363 000001D0 FEC0                    		inc	al
   364 000001D2 3C10                    		cmp	al, 10h
   365 000001D4 72F4                    		jb	short setgraphmodel0
   366 000001D6 B020                    		mov	al, 20h
   367                                  		;out	dx, al
   368                                  		;mov	ah, 1	; outb
   369 000001D8 CD34                    		int	34h
   370                                  		;;;;
   371                                  
   372                                  		; ---------------------------------------------------
   373                                  
   374                                  		; 17/02/2025
   375 000001DA B900010000              		mov	ecx, 256
   376 000001DF 31DB                    		xor	ebx, ebx
   377 000001E1 BF[F0510500]            		mov	edi, RowOfs
   378                                  MakeOfs:
   379 000001E6 89D8                    		mov	eax, ebx
   380 000001E8 C1E007                  		shl	eax, 7 ; * 128
   381 000001EB B050                    		mov	al, 80
   382 000001ED F6E4                    		mul	ah
   383 000001EF 66AB                    		stosw
   384 000001F1 43                      		inc	ebx
   385 000001F2 E2F2                    		loop	MakeOfs
   386                                  
   387                                  		; ---------------------------------------------------
   388                                  
   389                                  		; 25/01/2025
   390                                  		; 21/12/2024
   391                                  		;;; ---------------------------
   392 000001F4 E8A9560000              		call	drawplayingscreen
   393                                  		;;; ---------------------------
   394                                  
   395                                  		; 15/02/2025
   396 000001F9 B003                    		mov	al, 3	; 0 = max, 31 = min
   397 000001FB E86B410000              		call	SetMasterVolume
   398                                  
   399                                  		;;; ---------------------------
   400                                  
   401                                  		; 16/02/2025		
   402                                  replay:
   403                                  		; 17/02/2025
   404                                  		; 15/02/2025
   405                                  		; 13/01/2025 (interpolation procs for non-VRA AC97 codecs)
   406                                  		;;;; --------------------------
   407                                  		;mov	byte [interpolation], 0
   408 00000200 B002                    		mov	al, 2
   409 00000202 3805[78B20000]          		cmp	[audio_hardware], al ; 2
   410 00000208 7241                    		jb	short .direct ; SB16	; 17/02/2025
   411                                  		; AC97
   412                                  		;mov	dword [get_sound_data], get_ac97_sound_data ; (**)
   413                                  .chk_frq:
   414 0000020A 813D[B0C20000]80BB-     		cmp	dword [mp3_sample_rate], 48000 ; 48 kHZ
   414 00000212 0000               
   415 00000214 7212                    		jb	short .chk_vra
   416 00000216 803D[BCC20000]02        		cmp	byte [mp3_num_channels], 2
   417                                  		; 17/02/2025
   418                                  		;jb	short .convert	; mono (8bit or 16bit)
   419                                  		
   420                                  		;cmp	byte [mp3_bytes_per_sample], al ; 2
   421                                  		;jnb	short .direct ; 16bit, stereo
   422                                  		; 17/02/2025
   423 0000021D 732C                    		jnb	short .direct
   424                                  .convert:
   425                                  		; 8bit m/s or 16bit mono
   426 0000021F C605[8CB20000]01        		mov	byte [interpolation], 1 ; convert (to 16 bit stereo)
   427 00000226 EB42                    		jmp	short .indirect ; 21/01/2025
   428                                  .chk_vra:
   429 00000228 A2[8CB20000]            		mov	[interpolation], al ; 2 = interpolation
   430 0000022D 803D[79B20000]01        		cmp	byte [vra], 1
   431 00000234 7234                    		jb	short .indirect ; 21/01/2025
   432 00000236 FE0D[8CB20000]          		dec	byte [interpolation] ; 1 = convert (to 16 bit stereo)
   433 0000023C 803D[BCC20000]02        		cmp	byte [mp3_num_channels], 2
   434 00000243 7225                    		jb	short .indirect ; 8 bit ; 21/01/2025
   435                                  		; 17/02/2025
   436                                  		;cmp	byte [mp3_bytes_per_sample], al ; 2
   437                                  		;jb	short .indirect ; mono ; 21/01/2025	
   438                                  
   439                                  		; 14/01/2025
   440 00000245 FE0D[8CB20000]          		dec	byte [interpolation] ; 0
   441                                  .direct:
   442                                  		;;;; --------------------------
   443                                  
   444                                  		;;; 
   445                                  		; 20/10/2024
   446                                  		;call	detect_enable_audio_device
   447                                  		;jc	.exit
   448 0000024B E80B400000              		call	audio_system_init
   449                                  		;jc	.exit
   450 00000250 7207                    		jc	short .exit@ ; 15/01/2025
   451                                  		;;;
   452                                  
   453 00000252 E82E410000                              call	mp3_cast_to_speaker
   454                                  
   455                                  		; 15/02/2025
   456                                  		; 13/01/2025
   457 00000257 EB1D                    		jmp	short .decode_done
   458                                  
   459                                  		; 15/01/2025
   460                                  .exit@:
   461                                  		; Disable audio device
   462                                  		sys	_audio, 0C00h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00000259 BB000C0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000025E B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00000263 CD40                <1>  int 40h
   463                                  		;jmp	ExitProcess
   464                                  		; 27/01/2025
   465 00000265 E9113F0000              		jmp	ExitProcess@
   466                                  
   467                                  .indirect:
   468 0000026A E834420000              		call	audio_system_init_x
   469 0000026F 72E8                    		jc	short .exit@ ; 15/01/2025
   470 00000271 E82D440000              		call	mp3_cast_to_speaker_x
   471                                  		;;;; --------------------------
   472                                  
   473                                  		; 15/02/2025
   474                                  		; 22/01/2025
   475                                  .decode_done:
   476                                  		; set video mode to 03h again (clear screen)
   477                                  		;mov	ax, 03h
   478                                  		;int	31h ; TRDOS 386 - Video interrupt
   479                                  		; 25/01/2025
   480 00000276 E807530000              		call	set_text_mode
   481                                  .exit:
   482                                  		;push   0               ; uExitCode
   483                                                  ;call   ExitProcess
   484                                  		;jmp	ExitProcess
   485                                  		; 27/01/2025
   486 0000027B E9FB3E0000              		jmp	ExitProcess@
   487                                  
   488                                  		; 13/02/2025
   489                                  		; 25/01/2025
   490                                  trdos386_error:
   491                                  		sys	_msg, trdos386_err_msg, 255, 0Eh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00000280 BB[B9B10000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00000285 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 0000028A BA0E000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000028F B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00000294 CD40                <1>  int 40h
   492 00000296 BBFFFFFFFF              		mov	ebx, -1	; (not necessary) -error exit example-
   493 0000029B E9DB3E0000              		jmp	ExitProcess@
   494                                  
   495                                  
   496                                  ; =============== S U B R O U T I N E =======================================
   497                                  
   498                                  bswap_eax:
   499 000002A0 86E0                                    xchg    al, ah
   500 000002A2 C1C810                                  ror     eax, 10h
   501 000002A5 86E0                                    xchg    al, ah
   502 000002A7 C3                                      retn
   503                                  
   504                                  ; =============== S U B R O U T I N E =======================================
   505                                  
   506                                  mp3_recollect_bits:
   507 000002A8 F7C601000000                            test    esi, 1
   508 000002AE 7510                                    jnz     short .odd
   509 000002B0 668B2E                                  mov     bp, [esi]
   510 000002B3 83C602                                  add     esi, 2
   511 000002B6 66C1CD08                                ror     bp, 8
   512 000002BA C1E510                                  shl     ebp, 16
   513 000002BD B500                                    mov     ch, 0
   514 000002BF C3                                      retn
   515                                  
   516                                  .odd:
   517 000002C0 0FB62E                                  movzx   ebp, byte [esi]
   518 000002C3 46                                      inc     esi
   519 000002C4 C1E510                                  shl     ebp, 16
   520 000002C7 668B2E                                  mov     bp, [esi]
   521 000002CA 83C602                                  add     esi, 2
   522 000002CD 66C1CD08                                ror     bp, 8
   523 000002D1 C1E508                                  shl     ebp, 8
   524 000002D4 B508                                    mov     ch, 8
   525 000002D6 C3                                      retn
   526                                  
   527                                  ; =============== S U B R O U T I N E =======================================
   528                                  
   529                                  
   530                                  mp3_get_bits:
   531 000002D7 89E8                                    mov     eax, ebp
   532 000002D9 D3E5                                    shl     ebp, cl
   533 000002DB D3C0                                    rol     eax, cl
   534 000002DD 31E8                                    xor     eax, ebp
   535 000002DF 28CD                                    sub     ch, cl
   536 000002E1 7801                                    js      short mp3_collect_more
   537 000002E3 C3                                      retn
   538                                  
   539                                  mp3_collect_more:
   540 000002E4 88E9                                    mov     cl, ch
   541 000002E6 80C510                                  add     ch, 10h
   542 000002E9 D3C5                                    rol     ebp, cl
   543 000002EB 668B2E                                  mov     bp, [esi]
   544 000002EE 83C602                                  add     esi, 2
   545 000002F1 66C1CD08                                ror     bp, 8
   546 000002F5 D3CD                                    ror     ebp, cl
   547 000002F7 C3                                      retn
   548                                  
   549                                  ; =============== S U B R O U T I N E =======================================
   550                                  
   551                                  
   552                                  mp3_uncollect_bits:
   553 000002F8 83EE02                                  sub     esi, 2
   554 000002FB C0ED03                                  shr     ch, 3
   555 000002FE 0FB6CD                                  movzx   ecx, ch
   556 00000301 29CE                                    sub     esi, ecx
   557 00000303 C3                                      retn
   558                                  
   559                                  ; =============== S U B R O U T I N E =======================================
   560                                  
   561                                  
   562                                  mp3_search_get_header:
   563                                  		; 16/02/2025
   564 00000304 C705[90190100]0000-                     mov	dword [mp3_extra_bytes], 0
   564 0000030C 0000               
   565                                  
   566                                  .retry_header:
   567 0000030E 833D[8C190100]04                        cmp	dword [mp3_src_remain], 4
   568 00000315 0F8276010000                            jb      .fail_no_header
   569 0000031B 803EFF                                  cmp     byte [esi], 0FFh
   570 0000031E 7516                                    jnz     short .bad_header
   571 00000320 8A4601                                  mov     al, [esi+1]
   572 00000323 24E6                                    and     al, 0E6h
   573 00000325 3CE2                                    cmp     al, 0E2h
   574 00000327 750D                                    jnz     short .bad_header
   575 00000329 8A4602                                  mov     al, [esi+2]
   576 0000032C 3CF0                                    cmp     al, 0F0h
   577 0000032E 7306                                    jnb     short .bad_header
   578 00000330 240C                                    and     al, 0Ch
   579 00000332 3C0C                                    cmp     al, 0Ch
   580 00000334 7519                                    jnz     short .good_header
   581                                  
   582                                  .bad_header:
   583 00000336 46                                      inc	esi
   584 00000337 FF0D[8C190100]                          dec	dword [mp3_src_remain]
   585 0000033D FF05[90190100]                          inc	dword [mp3_extra_bytes]
   586 00000343 C705[90C20000]-                         mov	dword [main_data_pool_wr_ptr], main_data_pool_start
   586 00000349 [90B20000]         
   587 0000034D EBBF                                    jmp	short .retry_header
   588                                  
   589                                  .good_header:
   590 0000034F 8B06                                    mov	eax, [esi]
   591 00000351 E84AFFFFFF                              call	bswap_eax
   592 00000356 A3[A0C20000]                            mov	[mp3_hdr_32bit_header], eax
   593 0000035B C705[D4C20000]0000-                     mov	dword [mp3_hdr_flag_lsf], 0
   593 00000363 0000               
   594 00000365 C705[A8C20000]0000-                     mov	dword [mp3_hdr_flag_mpeg25], 0
   594 0000036D 0000               
   595 0000036F C705[9C190100]0200-                     mov	dword [mp3_nb_granules], 2
   595 00000377 0000               
   596 00000379 A900000800                              test	eax, 80000h
   597 0000037E 7525                                    jnz	short .lsf_this
   598 00000380 C705[D4C20000]0100-                     mov	dword [mp3_hdr_flag_lsf], 1
   598 00000388 0000               
   599 0000038A C705[9C190100]0100-                     mov	dword [mp3_nb_granules], 1
   599 00000392 0000               
   600 00000394 A900001000                              test	eax, 100000h
   601 00000399 750A                                    jnz	short .lsf_this
   602 0000039B C705[A8C20000]0100-                     mov	dword [mp3_hdr_flag_mpeg25], 1
   602 000003A3 0000               
   603                                  
   604                                  .lsf_this:
   605 000003A5 C1E80A                                  shr     eax, 10
   606 000003A8 83E003                                  and     eax, 3
   607 000003AB 8B0D[D4C20000]                          mov     ecx, [mp3_hdr_flag_lsf]
   608 000003B1 030D[A8C20000]                          add     ecx, [mp3_hdr_flag_mpeg25]
   609 000003B7 0FB79400[A09C0000]                      movzx   edx, word [mp3_freq_tab+eax*2]
   610 000003BF D3EA                                    shr     edx, cl
   611 000003C1 8D0C49                                  lea     ecx, [ecx+ecx*2]
   612 000003C4 01C8                                    add     eax, ecx
   613 000003C6 A3[B4C20000]                            mov     [mp3_hdr_sample_rate_index], eax
   614 000003CB 8915[B0C20000]                          mov     [mp3_sample_rate], edx
   615                                  
   616                                  		; 15/02/2025
   617 000003D1 A1[A0C20000]                            mov     eax, [mp3_hdr_32bit_header]
   618 000003D6 C1E810                                  shr     eax, 10h
   619 000003D9 F7D0                                    not     eax
   620 000003DB 83E001                                  and     eax, 1
   621 000003DE A3[A4C20000]                            mov     [mp3_hdr_flag_crc], eax
   622 000003E3 A1[A0C20000]                            mov     eax, [mp3_hdr_32bit_header]
   623 000003E8 C1E809                                  shr     eax, 9
   624 000003EB 83E001                                  and     eax, 1
   625 000003EE A3[ACC20000]                            mov     [mp3_hdr_flag_padding], eax
   626 000003F3 A1[A0C20000]                            mov     eax, [mp3_hdr_32bit_header]
   627 000003F8 C1E80C                                  shr     eax, 12
   628 000003FB 83E00F                                  and     eax, 0Fh
   629 000003FE 7512                                    jnz     short .not_free_format
   630 00000400 E8DE380000                              call    mp3_detect_free_format_block_size
   631 00000405 0F822BFFFFFF                            jb      .bad_header
   632 0000040B A1[E0180100]                            mov     eax, [mp3_free_format_frame_size]
   633 00000410 EB34                                    jmp     short .this_frame_size_plus_padding
   634                                  
   635                                  .not_free_format:
   636 00000412 8B15[D4C20000]                          mov     edx, [mp3_hdr_flag_lsf]
   637 00000418 C1E204                                  shl     edx, 4
   638 0000041B 01D0                                    add     eax, edx
   639 0000041D 0FB78400[609C0000]                      movzx   eax, word [mp3_bitrate_tab+eax*2] ; kbit/s
   640 00000425 69C0E8030000                            imul    eax, 1000       ; bit/s
   641 0000042B A3[B8C20000]                            mov     [mp3_bit_rate], eax
   642 00000430 69C090000000                            imul    eax, 144        ; 144=90h=8*18
   643 00000436 31D2                                    xor     edx, edx
   644 00000438 F735[B0C20000]                          div     dword [mp3_sample_rate]
   645 0000043E 8B0D[D4C20000]                          mov     ecx, [mp3_hdr_flag_lsf]
   646 00000444 D3E8                                    shr     eax, cl
   647                                  
   648                                  .this_frame_size_plus_padding:
   649 00000446 0305[ACC20000]                          add     eax, [mp3_hdr_flag_padding]
   650 0000044C A3[98C20000]                            mov     [mp3_src_frame_size], eax
   651 00000451 01F0                                    add     eax, esi
   652 00000453 A3[9CC20000]                            mov     [mp3_src_frame_end], eax
   653 00000458 A1[A0C20000]                            mov     eax, [mp3_hdr_32bit_header]
   654 0000045D C1E806                                  shr     eax, 6
   655 00000460 83E003                                  and     eax, 3
   656 00000463 A3[CCC20000]                            mov     [mp3_hdr_mode_val], eax
   657 00000468 BA01000000                              mov     edx, 1
   658                                  
   659 0000046D 3C03                    		cmp     al, 3
   660 0000046F 7401                                    jz      short .this_channels
   661                                  
   662                                                  ;mov    edx, 2
   663                                  		; 10/01/2025
   664 00000471 42                      		inc	edx
   665                                  .this_channels:
   666 00000472 8915[BCC20000]                          mov	[mp3_num_channels], edx
   667                                   		
   668                                  		; 15/02/2025
   669                                  .allow_stereo:
   670                                  		;imul	edx, [mp3_bytes_per_sample]
   671                                                  ; 17/02/2025
   672 00000478 D1E2                    		shl	edx, 1 ; [mp3_bytes_per_sample] = 2 
   673 0000047A 8915[78190100]          		mov     [mp3_samples_dst_step], edx
   674 00000480 A1[A0C20000]                            mov     eax, [mp3_hdr_32bit_header]
   675 00000485 C1E804                                  shr     eax, 4
   676 00000488 83E003                                  and     eax, 3
   677 0000048B A3[D0C20000]                            mov     [mp3_hdr_mode_ext], eax
   678                                  		; 16/02/2025
   679                                  .no_rdtsc_supported@:
   680                                  		;clc
   681 00000490 C3                                      retn
   682                                  
   683                                  .fail_no_header:
   684                                  		; 16/02/2025
   685                                  .no_rdtsc_supported@@:
   686 00000491 C705[98C20000]0000-                     mov     dword [mp3_src_frame_size], 0
   686 00000499 0000               
   687 0000049B F9                                      stc
   688 0000049C C3                                      retn
   689                                  
   690                                  
   691                                  ; =============== S U B R O U T I N E =======================================
   692                                  
   693                                  
   694                                  mp3_bitstream_read_header_extra:
   695                                                  ; 16/02/2025
   696                                  
   697                                  .no_rdtsc_supported:
   698 0000049D 833D[A4C20000]00                        cmp     dword [mp3_hdr_flag_crc], 0
   699 000004A4 7422                                    jz      short .without_crc
   700 000004A6 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 16
   701 000004A8 C1E510                                  shl     ebp, 10h
   702 000004AB C1C010                                  rol     eax, 10h
   703 000004AE 31E8                                    xor     eax, ebp
   704 000004B0 80ED10                                  sub     ch, 10h
   705 000004B3 7913                                    jns     short .without_crc
   706 000004B5 88E9                                    mov     cl, ch          ; mp3mac_collect_more
   707 000004B7 80C510                                  add     ch, 10h
   708 000004BA D3C5                                    rol     ebp, cl
   709 000004BC 668B2E                                  mov     bp, [esi]
   710 000004BF 83C602                                  add     esi, 2
   711 000004C2 66C1CD08                                ror     bp, 8
   712 000004C6 D3CD                                    ror     ebp, cl
   713                                  
   714                                  .without_crc:
   715 000004C8 833D[D4C20000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
   716 000004CF 745B                                    jz      short .pre_lsf_zero
   717 000004D1 C705[98190100]0900-                     mov     dword [mp3_num_compress_bits], 9
   717 000004D9 0000               
   718 000004DB 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 8
   719 000004DD C1E508                                  shl     ebp, 8
   720 000004E0 C1C008                                  rol     eax, 8
   721 000004E3 31E8                                    xor     eax, ebp
   722 000004E5 80ED08                                  sub     ch, 8
   723 000004E8 7913                                    jns     short .without_crc@
   724 000004EA 88E9                                    mov     cl, ch
   725 000004EC 80C510                                  add     ch, 10h
   726 000004EF D3C5                                    rol     ebp, cl
   727 000004F1 668B2E                                  mov     bp, [esi]
   728 000004F4 83C602                                  add     esi, 2
   729 000004F7 66C1CD08                                ror     bp, 8
   730 000004FB D3CD                                    ror     ebp, cl
   731                                  
   732                                  .without_crc@:
   733 000004FD A3[94190100]                            mov     [mp3_main_data_begin], eax
   734 00000502 8A0D[BCC20000]                          mov     cl, byte [mp3_num_channels]
   735 00000508 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
   736 0000050A D3E5                                    shl     ebp, cl
   737 0000050C D3C0                                    rol     eax, cl
   738 0000050E 31E8                                    xor     eax, ebp
   739 00000510 28CD                                    sub     ch, cl
   740 00000512 7913                                    jns     short .without_crc@@
   741 00000514 88E9                                    mov     cl, ch
   742 00000516 80C510                                  add     ch, 10h
   743 00000519 D3C5                                    rol     ebp, cl
   744 0000051B 668B2E                                  mov     bp, [esi]
   745 0000051E 83C602                                  add     esi, 2
   746 00000521 66C1CD08                                ror     bp, 8
   747 00000525 D3CD                                    ror     ebp, cl
   748                                  
   749                                  .without_crc@@:
   750 00000527 E9A1000000                              jmp     .pre_lsf_done
   751                                  
   752                                  .pre_lsf_zero:
   753 0000052C C705[98190100]0400-                     mov     dword [mp3_num_compress_bits], 4
   753 00000534 0000               
   754 00000536 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 9
   755 00000538 C1E509                                  shl     ebp, 9
   756 0000053B C1C009                                  rol     eax, 9
   757 0000053E 31E8                                    xor     eax, ebp
   758 00000540 80ED09                                  sub     ch, 9
   759 00000543 7913                                    jns     short .without_crc@@@
   760 00000545 88E9                                    mov     cl, ch
   761 00000547 80C510                                  add     ch, 10h
   762 0000054A D3C5                                    rol     ebp, cl
   763 0000054C 668B2E                                  mov     bp, [esi]
   764 0000054F 83C602                                  add     esi, 2
   765 00000552 66C1CD08                                ror     bp, 8
   766 00000556 D3CD                                    ror     ebp, cl
   767                                  
   768                                  .without_crc@@@:
   769 00000558 A3[94190100]                            mov     [mp3_main_data_begin], eax
   770 0000055D 8A0D[BCC20000]                          mov     cl, byte [mp3_num_channels]
   771 00000563 D0E1                                    shl     cl, 1           ; 1,2 --> 2,4
   772 00000565 80F107                                  xor     cl, 7           ;     --> 5,3
   773 00000568 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
   774 0000056A D3E5                                    shl     ebp, cl
   775 0000056C D3C0                                    rol     eax, cl
   776 0000056E 31E8                                    xor     eax, ebp
   777 00000570 28CD                                    sub     ch, cl
   778 00000572 7913                                    jns     short .without_crc@@@@
   779 00000574 88E9                                    mov     cl, ch
   780 00000576 80C510                                  add     ch, 10h
   781 00000579 D3C5                                    rol     ebp, cl
   782 0000057B 668B2E                                  mov     bp, [esi]
   783 0000057E 83C602                                  add     esi, 2
   784 00000581 66C1CD08                                ror     bp, 8
   785 00000585 D3CD                                    ror     ebp, cl
   786                                  
   787                                  .without_crc@@@@:
   788 00000587 8B15[BCC20000]                          mov     edx, [mp3_num_channels]
   789 0000058D BB[A0190100]                            mov     ebx, mp3_granules
   790                                  
   791                                  .pre_channel_lop:
   792 00000592 C7432800000000                          mov     dword [ebx+40], 0 ; [ebx+$mp3gr_scfsi]
   793 00000599 81C3A0090000                            add     ebx, 2464       ; $mp3gr_entrysiz
   794 0000059F 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 4
   795 000005A1 C1E504                                  shl     ebp, 4
   796 000005A4 C1C004                                  rol     eax, 4
   797 000005A7 31E8                                    xor     eax, ebp
   798 000005A9 80ED04                                  sub     ch, 4
   799 000005AC 7913                                    jns     short .without_crc@@@@@
   800 000005AE 88E9                                    mov     cl, ch
   801 000005B0 80C510                                  add     ch, 10h
   802 000005B3 D3C5                                    rol     ebp, cl
   803 000005B5 668B2E                                  mov     bp, [esi]
   804 000005B8 83C602                                  add     esi, 2
   805 000005BB 66C1CD08                                ror     bp, 8
   806 000005BF D3CD                                    ror     ebp, cl
   807                                  
   808                                  .without_crc@@@@@:
   809 000005C1 894328                                  mov     [ebx+28h], eax  ; [ebx+$mp3gr_scfsi]
   810 000005C4 81C3A0090000                            add     ebx, 2464       ; $mp3gr_entrysiz
   811 000005CA 4A                                      dec     edx
   812 000005CB 75C5                                    jnz     short .pre_channel_lop
   813                                  
   814                                  .pre_lsf_done:
   815 000005CD A1[9C190100]            		mov     eax, [mp3_nb_granules]
   816 000005D2 6BC012                  		imul    eax, 12h
   817 000005D5 A3[C8C20000]            		mov     [mp3_nb_frames], eax
   818                                  		; 14/01/2025
   819                                  		;mov	eax, [mp3_nb_frames]
   820                                  		; 16/02/2025
   821 000005DA 0FAF05[BCC20000]        		imul    eax, [mp3_num_channels]
   822                                  		;imul   eax, [mp3_bytes_per_sample]
   823                                  		;shl    eax, 5
   824                                  		; 17/02/2025
   825                                  		; [mp3_bytes_per_sample] = 2
   826 000005E1 C1E006                  		shl	eax, 6 ; (eax*2) << 5
   827                                     		; 15/02/2025
   828 000005E4 A3[74190100]            		mov	[mp3_samples_output_size], eax
   829                                  		
   830                                  		; 16/02/2025
   831                                  
   832                                  .no_rdtsc_supported@:
   833 000005E9 C3                                      retn
   834                                  
   835                                  
   836                                  ; =============== S U B R O U T I N E =======================================
   837                                  
   838                                  
   839                                  mp3_bitstream_read_granules:
   840                                  		; 16/02/2025
   841                                  
   842                                  .no_rdtsc_supported:
   843 000005EA 8925[94440500]                          mov	[_@@saved_sp], esp
   844 000005F0 C705[98440500]0000-                     mov	dword [mp3_main_data_siz], 0
   844 000005F8 0000               
   845 000005FA C705[80190100]0000-                     mov	dword [mp3_curr_granule], 0
   845 00000602 0000               
   846 00000604 BB[A0190100]                            mov	ebx, mp3_granules
   847                                  
   848                                  .hdr_granule_lop:
   849 00000609 53                                      push    ebx
   850 0000060A C705[7C190100]0000-                     mov     dword [mp3_curr_channel], 0
   850 00000612 0000               
   851                                  
   852                                  .hdr_channel_lop:
   853 00000614 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 12
   854 00000616 C1E50C                                  shl     ebp, 12
   855 00000619 C1C00C                                  rol     eax, 12
   856 0000061C 31E8                                    xor     eax, ebp
   857 0000061E 80ED0C                                  sub     ch, 12
   858 00000621 7913                                    jns     short .without_crc
   859 00000623 88E9                                    mov     cl, ch
   860 00000625 80C510                                  add     ch, 16
   861 00000628 D3C5                                    rol     ebp, cl
   862 0000062A 668B2E                                  mov     bp, [esi]
   863 0000062D 83C602                                  add     esi, 2
   864 00000630 66C1CD08                                ror     bp, 8
   865 00000634 D3CD                                    ror     ebp, cl
   866                                  
   867                                  .without_crc:
   868 00000636 8B15[98440500]                          mov     edx, [mp3_main_data_siz]
   869 0000063C 8903                                    mov     [ebx], eax
   870 0000063E 895304                                  mov     [ebx+4], edx
   871 00000641 01D0                                    add     eax, edx
   872 00000643 894308                                  mov     [ebx+8], eax
   873 00000646 A3[98440500]                            mov     [mp3_main_data_siz], eax
   874 0000064B 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 9
   875 0000064D C1E509                                  shl     ebp, 9
   876 00000650 C1C009                                  rol     eax, 9
   877 00000653 31E8                                    xor     eax, ebp
   878 00000655 80ED09                                  sub     ch, 9
   879 00000658 7913                                    jns     short .without_crc@
   880 0000065A 88E9                                    mov     cl, ch
   881 0000065C 80C510                                  add     ch, 10h
   882 0000065F D3C5                                    rol     ebp, cl
   883 00000661 668B2E                                  mov     bp, [esi]
   884 00000664 83C602                                  add     esi, 2
   885 00000667 66C1CD08                                ror     bp, 8
   886 0000066B D3CD                                    ror     ebp, cl
   887                                  
   888                                  .without_crc@:
   889 0000066D 89430C                                  mov     [ebx+12], eax   ; [ebx+$mp3gr_big_values]
   890 00000670 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 8
   891 00000672 C1E508                                  shl     ebp, 8
   892 00000675 C1C008                                  rol     eax, 8
   893 00000678 31E8                                    xor     eax, ebp
   894 0000067A 80ED08                                  sub     ch, 8
   895 0000067D 7913                                    jns     short .without_crc@@
   896 0000067F 88E9                                    mov     cl, ch
   897 00000681 80C510                                  add     ch, 10h
   898 00000684 D3C5                                    rol     ebp, cl
   899 00000686 668B2E                                  mov     bp, [esi]
   900 00000689 83C602                                  add     esi, 2
   901 0000068C 66C1CD08                                ror     bp, 8
   902 00000690 D3CD                                    ror     ebp, cl
   903                                  
   904                                  .without_crc@@:
   905 00000692 05BE000000                              add	eax, 190        ; 400-210
   906 00000697 833D[CCC20000]01                        cmp	dword [mp3_hdr_mode_val], 1
   907 0000069E 750F                                    jnz	short .not_ms_stereo
   908 000006A0 F705[D0C20000]0200-                     test	dword [mp3_hdr_mode_ext], 2
   908 000006A8 0000               
   909 000006AA 7403                                    jz	short .not_ms_stereo
   910 000006AC 83E802                                  sub	eax, 2
   911                                  
   912                                  .not_ms_stereo:
   913 000006AF 894310                                  mov     [ebx+16], eax   ; [ebx+$mp3gr_global_gain]
   914 000006B2 8A0D[98190100]                          mov     cl, byte [mp3_num_compress_bits]
   915 000006B8 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
   916 000006BA D3E5                                    shl     ebp, cl
   917 000006BC D3C0                                    rol     eax, cl
   918 000006BE 31E8                                    xor     eax, ebp
   919 000006C0 28CD                                    sub     ch, cl
   920 000006C2 7913                                    jns     short .without_crc@@@
   921 000006C4 88E9                                    mov     cl, ch
   922 000006C6 80C510                                  add     ch, 10h
   923 000006C9 D3C5                                    rol     ebp, cl
   924 000006CB 668B2E                                  mov     bp, [esi]
   925 000006CE 83C602                                  add     esi, 2
   926 000006D1 66C1CD08                                ror     bp, 8
   927 000006D5 D3CD                                    ror     ebp, cl
   928                                  
   929                                  .without_crc@@@:
   930 000006D7 894314                                  mov     [ebx+20], eax   ; [ebx+$mp3gr_scalefac_compress]
   931 000006DA FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
   932                                                                          ; dec mp3_colNN
   933 000006DC D1E5                                    shl     ebp, 1          ; shl mp3_col32,1 ; cy=data
   934 000006DE 0F834F010000                            jnb     .no_blocksplit
   935 000006E4 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 2
   936 000006E6 C1E502                                  shl     ebp, 2
   937 000006E9 C1C002                                  rol     eax, 2
   938 000006EC 31E8                                    xor     eax, ebp
   939 000006EE 80ED02                                  sub     ch, 2
   940 000006F1 7913                                    jns     short .without_crc@@@@
   941 000006F3 88E9                                    mov     cl, ch
   942 000006F5 80C510                                  add     ch, 10h
   943 000006F8 D3C5                                    rol     ebp, cl
   944 000006FA 668B2E                                  mov     bp, [esi]
   945 000006FD 83C602                                  add     esi, 2
   946 00000700 66C1CD08                                ror     bp, 8
   947 00000704 D3CD                                    ror     ebp, cl
   948                                  
   949                                  .without_crc@@@@:
   950 00000706 83F800                                  cmp     eax, 0
   951 00000709 0F8463030000                            jz      .error
   952 0000070F 89432C                                  mov     [ebx+44], eax   ; [ebx+$mp3gr_block_type]
   953 00000712 83F802                                  cmp     eax, 2
   954 00000715 B812000000                              mov     eax, 18         ; 36/2 ; region_size (default)
   955 0000071A 741C                                    jz      short .this_region_size
   956 0000071C 833D[B4C20000]02                        cmp     dword [mp3_hdr_sample_rate_index], 2
   957 00000723 7613                                    jbe     short .this_region_size
   958 00000725 B81B000000                              mov     eax, 27         ; 54/2 ; region_size
   959 0000072A 833D[B4C20000]08                        cmp     dword [mp3_hdr_sample_rate_index], 8
   960 00000731 7505                                    jnz     short .this_region_size
   961 00000733 B836000000                              mov     eax, 54         ; 108/2 ; region_size (for rate=8)
   962                                  
   963                                  .this_region_size:
   964 00000738 894350                                  mov     [ebx+80], eax   ; [ebx+$mp3gr_region_size+0*4]
   965 0000073B C7435420010000                          mov     dword [ebx+84], 288 ; [ebx+$mp3gr_region_size+1*4],576/2
   966 00000742 C7435820010000                          mov     dword [ebx+88], 288 ; [ebx+$mp3gr_region_size+2*4],576/2
   967 00000749 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
   968 0000074B D1E5                                    shl     ebp, 1
   969 0000074D D1C0                                    rol     eax, 1
   970 0000074F 31E8                                    xor     eax, ebp
   971 00000751 80ED01                                  sub     ch, 1
   972 00000754 7913                                    jns     short .without_crc@@@@@
   973 00000756 88E9                                    mov     cl, ch
   974 00000758 80C510                                  add     ch, 10h
   975 0000075B D3C5                                    rol     ebp, cl
   976 0000075D 668B2E                                  mov     bp, [esi]
   977 00000760 83C602                                  add     esi, 2
   978 00000763 66C1CD08                                ror     bp, 8
   979 00000767 D3CD                                    ror     ebp, cl
   980                                  
   981                                  .without_crc@@@@@:
   982 00000769 894330                                  mov     [ebx+48], eax   ; [ebx+$mp3gr_switch_point]
   983 0000076C 89E8                                    mov     eax, ebp        ; IRP nn,0,1 ; only 0..1 for blocksplit
   984 0000076E C1E505                                  shl     ebp, 5          ; mp3mac_get_n_bits 5
   985 00000771 C1C005                                  rol     eax, 5
   986 00000774 31E8                                    xor     eax, ebp
   987 00000776 80ED05                                  sub     ch, 5
   988 00000779 7913                                    jns     short .without_crc@@@@@@
   989 0000077B 88E9                                    mov     cl, ch
   990 0000077D 80C510                                  add     ch, 10h
   991 00000780 D3C5                                    rol     ebp, cl
   992 00000782 668B2E                                  mov     bp, [esi]
   993 00000785 83C602                                  add     esi, 2
   994 00000788 66C1CD08                                ror     bp, 8
   995 0000078C D3CD                                    ror     ebp, cl
   996                                  
   997                                  .without_crc@@@@@@:
   998 0000078E 894338                                  mov     [ebx+56], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=0
   999 00000791 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 5
  1000 00000793 C1E505                                  shl     ebp, 5
  1001 00000796 C1C005                                  rol     eax, 5
  1002 00000799 31E8                                    xor     eax, ebp
  1003 0000079B 80ED05                                  sub     ch, 5
  1004 0000079E 7913                                    jns     short .without_crc_@@@@
  1005 000007A0 88E9                                    mov     cl, ch
  1006 000007A2 80C510                                  add     ch, 10h
  1007 000007A5 D3C5                                    rol     ebp, cl
  1008 000007A7 668B2E                                  mov     bp, [esi]
  1009 000007AA 83C602                                  add     esi, 2
  1010 000007AD 66C1CD08                                ror     bp, 8
  1011 000007B1 D3CD                                    ror     ebp, cl
  1012                                  
  1013                                  .without_crc_@@@@:
  1014 000007B3 89433C                                  mov     [ebx+60], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=1
  1015 000007B6 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 5
  1016 000007B8 C1E503                                  shl     ebp, 3          ; IRP nn,0,1,2
  1017 000007BB C1C003                                  rol     eax, 3          ; mp3mac_get_n_bits 3
  1018 000007BE 31E8                                    xor     eax, ebp
  1019 000007C0 80ED03                                  sub     ch, 3
  1020 000007C3 7913                                    jns     short .without_crc_@@@@@
  1021 000007C5 88E9                                    mov     cl, ch
  1022 000007C7 80C510                                  add     ch, 10h
  1023 000007CA D3C5                                    rol     ebp, cl
  1024 000007CC 668B2E                                  mov     bp, [esi]
  1025 000007CF 83C602                                  add     esi, 2
  1026 000007D2 66C1CD08                                ror     bp, 8
  1027 000007D6 D3CD                                    ror     ebp, cl
  1028                                  
  1029                                  .without_crc_@@@@@:
  1030 000007D8 C1E003                                  shl     eax, 3
  1031 000007DB 894344                                  mov     [ebx+68], eax   ; [ebx+$mp3gr_subblock_gain+nn*4] ; nn=0
  1032 000007DE 89E8                                    mov     eax, ebp
  1033 000007E0 C1E503                                  shl     ebp, 3
  1034 000007E3 C1C003                                  rol     eax, 3
  1035 000007E6 31E8                                    xor     eax, ebp
  1036 000007E8 80ED03                                  sub     ch, 3
  1037 000007EB 7913                                    jns     short .without_crc_@@@@@@
  1038 000007ED 88E9                                    mov     cl, ch
  1039 000007EF 80C510                                  add     ch, 10h
  1040 000007F2 D3C5                                    rol     ebp, cl
  1041 000007F4 668B2E                                  mov     bp, [esi]
  1042 000007F7 83C602                                  add     esi, 2
  1043 000007FA 66C1CD08                                ror     bp, 8
  1044 000007FE D3CD                                    ror     ebp, cl
  1045                                  
  1046                                  .without_crc_@@@@@@:
  1047 00000800 C1E003                                  shl     eax, 3
  1048 00000803 894348                                  mov     [ebx+72], eax   ; [ebx+$mp3gr_subblock_gain+nn*4] ; nn=1
  1049 00000806 89E8                                    mov     eax, ebp
  1050 00000808 C1E503                                  shl     ebp, 3
  1051 0000080B C1C003                                  rol     eax, 3
  1052 0000080E 31E8                                    xor     eax, ebp
  1053 00000810 80ED03                                  sub     ch, 3
  1054 00000813 7913                                    jns     short .without_crc_@@@@@@@
  1055 00000815 88E9                                    mov     cl, ch
  1056 00000817 80C510                                  add     ch, 10h
  1057 0000081A D3C5                                    rol     ebp, cl
  1058 0000081C 668B2E                                  mov     bp, [esi]
  1059 0000081F 83C602                                  add     esi, 2
  1060 00000822 66C1CD08                                ror     bp, 8
  1061 00000826 D3CD                                    ror     ebp, cl
  1062                                  
  1063                                  .without_crc_@@@@@@@:
  1064 00000828 C1E003                                  shl     eax, 3
  1065 0000082B 89434C                                  mov     [ebx+76], eax   ; [ebx+$mp3gr_subblock_gain+nn*4] ; nn=2
  1066 0000082E E910010000                              jmp     .blocksplit_done
  1067                                  
  1068                                  .no_blocksplit:                       
  1069 00000833 C7432C00000000                          mov     dword [ebx+44], 0 ; [ebx+$mp3gr_block_type]
  1070 0000083A C7433000000000                          mov     dword [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
  1071 00000841 89E8                                    mov     eax, ebp        ; IRP nn,0,1,2 ; range 0..2 when non-blocksplit
  1072 00000843 C1E505                                  shl     ebp, 5          ; mp3mac_get_n_bits 5
  1073 00000846 C1C005                                  rol     eax, 5
  1074 00000849 31E8                                    xor     eax, ebp
  1075 0000084B 80ED05                                  sub     ch, 5
  1076 0000084E 7913                                    jns     short .@_without_crc
  1077 00000850 88E9                                    mov     cl, ch
  1078 00000852 80C510                                  add     ch, 10h
  1079 00000855 D3C5                                    rol     ebp, cl
  1080 00000857 668B2E                                  mov     bp, [esi]
  1081 0000085A 83C602                                  add     esi, 2
  1082 0000085D 66C1CD08                                ror     bp, 8
  1083 00000861 D3CD                                    ror     ebp, cl
  1084                                  
  1085                                  .@_without_crc:
  1086 00000863 894338                                  mov     [ebx+56], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=0
  1087 00000866 89E8                                    mov     eax, ebp
  1088 00000868 C1E505                                  shl     ebp, 5
  1089 0000086B C1C005                                  rol     eax, 5
  1090 0000086E 31E8                                    xor     eax, ebp
  1091 00000870 80ED05                                  sub     ch, 5
  1092 00000873 7913                                    jns     short .@_without_crc_@
  1093 00000875 88E9                                    mov     cl, ch
  1094 00000877 80C510                                  add     ch, 10h
  1095 0000087A D3C5                                    rol     ebp, cl
  1096 0000087C 668B2E                                  mov     bp, [esi]
  1097 0000087F 83C602                                  add     esi, 2
  1098 00000882 66C1CD08                                ror     bp, 8
  1099 00000886 D3CD                                    ror     ebp, cl
  1100                                  
  1101                                  .@_without_crc_@:
  1102 00000888 89433C                                  mov     [ebx+60], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=1
  1103 0000088B 89E8                                    mov     eax, ebp
  1104 0000088D C1E505                                  shl     ebp, 5
  1105 00000890 C1C005                                  rol     eax, 5
  1106 00000893 31E8                                    xor     eax, ebp
  1107 00000895 80ED05                                  sub     ch, 5
  1108 00000898 7913                                    jns     short .@_without_crc_@@
  1109 0000089A 88E9                                    mov     cl, ch
  1110 0000089C 80C510                                  add     ch, 10h
  1111 0000089F D3C5                                    rol     ebp, cl
  1112 000008A1 668B2E                                  mov     bp, [esi]
  1113 000008A4 83C602                                  add     esi, 2
  1114 000008A7 66C1CD08                                ror     bp, 8
  1115 000008AB D3CD                                    ror     ebp, cl
  1116                                  
  1117                                  .@_without_crc_@@:
  1118 000008AD 894340                                  mov     [ebx+64], eax   ; [ebx+$mp3gr_table_select+nn*4] ; nn=2
  1119 000008B0 89E8                                    mov     eax, ebp
  1120 000008B2 C1E504                                  shl     ebp, 4
  1121 000008B5 C1C004                                  rol     eax, 4
  1122 000008B8 31E8                                    xor     eax, ebp
  1123 000008BA 80ED04                                  sub     ch, 4
  1124 000008BD 7913                                    jns     short .@_without_crc@@@
  1125 000008BF 88E9                                    mov     cl, ch
  1126 000008C1 80C510                                  add     ch, 10h
  1127 000008C4 D3C5                                    rol     ebp, cl
  1128 000008C6 668B2E                                  mov     bp, [esi]
  1129 000008C9 83C602                                  add     esi, 2
  1130 000008CC 66C1CD08                                ror     bp, 8
  1131 000008D0 D3CD                                    ror     ebp, cl
  1132                                  
  1133                                  .@_without_crc@@@:
  1134 000008D2 40                                      inc     eax
  1135 000008D3 A3[8C440500]                            mov     [_@@region_address0], eax
  1136 000008D8 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 3
  1137 000008DA C1E503                                  shl     ebp, 3
  1138 000008DD C1C003                                  rol     eax, 3
  1139 000008E0 31E8                                    xor     eax, ebp
  1140 000008E2 80ED03                                  sub     ch, 3
  1141 000008E5 7913                                    jns     short .@_without_crc@@@@
  1142 000008E7 88E9                                    mov     cl, ch
  1143 000008E9 80C510                                  add     ch, 10h
  1144 000008EC D3C5                                    rol     ebp, cl
  1145 000008EE 668B2E                                  mov     bp, [esi]
  1146 000008F1 83C602                                  add     esi, 2
  1147 000008F4 66C1CD08                                ror     bp, 8
  1148 000008F8 D3CD                                    ror     ebp, cl
  1149                                  
  1150                                  .@_without_crc@@@@:
  1151 000008FA 40                                      inc     eax
  1152 000008FB 0305[8C440500]                          add     eax, [_@@region_address0]
  1153 00000901 A3[90440500]                            mov     [_@@region_address1], eax
  1154 00000906 A1[B4C20000]                            mov     eax, [mp3_hdr_sample_rate_index]
  1155 0000090B C1E005                                  shl     eax, 5
  1156 0000090E 0305[8C440500]                          add     eax, [_@@region_address0]
  1157 00000914 0FB78400[A0FC0100]                      movzx   eax, word [mp3_band_index_long+eax*2]
  1158 0000091C D1E8                                    shr     eax, 1
  1159 0000091E 894350                                  mov     [ebx+80], eax   ; [ebx+$mp3gr_region_size+0*4]
  1160 00000921 A1[B4C20000]                            mov     eax, [mp3_hdr_sample_rate_index]
  1161 00000926 C1E005                                  shl     eax, 5
  1162 00000929 0305[90440500]                          add     eax, [_@@region_address1]
  1163 0000092F 0FB78400[A0FC0100]                      movzx   eax, word [mp3_band_index_long+eax*2]
  1164 00000937 D1E8                                    shr     eax, 1
  1165 00000939 894354                                  mov     [ebx+84], eax   ; [ebx+$mp3gr_region_size+1*4]
  1166 0000093C C7435820010000                          mov     dword [ebx+88], 288 ; [ebx+$mp3gr_region_size+2*4],576/2
  1167                                  
  1168                                  .blocksplit_done:
  1169 00000943 8D7B50                                  lea     edi, [ebx+80]   ; [ebx+$mp3gr_region_size+0]
  1170 00000946 31D2                                    xor     edx, edx
  1171 00000948 B103                                    mov     cl, 3
  1172                                  
  1173                                  .trunc_region_size_lop:
  1174 0000094A 8B07                                    mov     eax, [edi]
  1175 0000094C 3B430C                                  cmp     eax, [ebx+12]   ; [ebx+$mp3gr_big_values]
  1176 0000094F 7603                                    jbe     short .trunc_region_size_this
  1177 00000951 8B430C                                  mov     eax, [ebx+12]
  1178                                  
  1179                                  .trunc_region_size_this:
  1180 00000954 29D0                                    sub     eax, edx
  1181 00000956 8907                                    mov     [edi], eax
  1182 00000958 01C2                                    add     edx, eax
  1183 0000095A 83C704                                  add     edi, 4
  1184 0000095D FEC9                                    dec     cl
  1185 0000095F 75E9                                    jnz     short .trunc_region_size_lop
  1186 00000961 C7431C0D000000                          mov     dword [ebx+28], 13 ; [ebx+$mp3gr_short_start]
  1187 00000968 C7432016000000                          mov     dword [ebx+32], 22 ; [ebx+$mp3gr_long_end]
  1188 0000096F 837B2C02                                cmp     dword [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  1189 00000973 7549                                    jnz     short .these_band_indices
  1190 00000975 C7431C00000000                          mov     dword [ebx+28], 0 ; [ebx+$mp3gr_short_start]
  1191 0000097C C7432000000000                          mov     dword [ebx+32], 0 ; [ebx+$mp3gr_long_end]
  1192 00000983 837B3000                                cmp     dword [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
  1193 00000987 7435                                    jz      short .these_band_indices
  1194 00000989 C7431C02000000                          mov     dword [ebx+28], 2 ; [ebx+$mp3gr_short_start]
  1195 00000990 C7432004000000                          mov     dword [ebx+32], 4 ; [ebx+$mp3gr_long_end]
  1196 00000997 833D[B4C20000]08                        cmp     dword [mp3_hdr_sample_rate_index], 8
  1197 0000099E 741E                                    jz      short .these_band_indices
  1198 000009A0 833D[B4C20000]02                        cmp     dword [mp3_hdr_sample_rate_index], 2
  1199 000009A7 C7431C03000000                          mov     dword [ebx+28], 3 ; [ebx+$mp3gr_short_start]
  1200 000009AE C7432008000000                          mov     dword [ebx+32], 8 ; [ebx+$mp3gr_long_end]
  1201 000009B5 7607                                    jbe     short .these_band_indices
  1202 000009B7 C7432006000000                          mov     dword [ebx+32], 6 ; [ebx+$mp3gr_long_end]
  1203                                  
  1204                                  .these_band_indices:
  1205 000009BE 31C0                                    xor     eax, eax
  1206 000009C0 833D[D4C20000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
  1207 000009C7 7520                                    jnz     short .no_preflag
  1208 000009C9 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
  1209 000009CB D1E5                                    shl     ebp, 1
  1210 000009CD D1C0                                    rol     eax, 1
  1211 000009CF 31E8                                    xor     eax, ebp
  1212 000009D1 80ED01                                  sub     ch, 1
  1213 000009D4 7913                                    jns     short .no_preflag
  1214 000009D6 88E9                                    mov     cl, ch
  1215 000009D8 80C510                                  add     ch, 10h
  1216 000009DB D3C5                                    rol     ebp, cl
  1217 000009DD 668B2E                                  mov     bp, [esi]
  1218 000009E0 83C602                                  add     esi, 2
  1219 000009E3 66C1CD08                                ror     bp, 8
  1220 000009E7 D3CD                                    ror     ebp, cl
  1221                                  
  1222                                  .no_preflag:
  1223 000009E9 894318                                  mov     [ebx+24], eax   ; [ebx+$mp3gr_preflag]
  1224 000009EC 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
  1225 000009EE D1E5                                    shl     ebp, 1
  1226 000009F0 D1C0                                    rol     eax, 1
  1227 000009F2 31E8                                    xor     eax, ebp
  1228 000009F4 80ED01                                  sub     ch, 1
  1229 000009F7 7913                                    jns     short .@_without_crc@@@@@
  1230 000009F9 88E9                                    mov     cl, ch
  1231 000009FB 80C510                                  add     ch, 10h
  1232 000009FE D3C5                                    rol     ebp, cl
  1233 00000A00 668B2E                                  mov     bp, [esi]
  1234 00000A03 83C602                                  add     esi, 2
  1235 00000A06 66C1CD08                                ror     bp, 8
  1236 00000A0A D3CD                                    ror     ebp, cl
  1237                                  
  1238                                  .@_without_crc@@@@@:
  1239 00000A0C 40                                      inc     eax
  1240 00000A0D 894334                                  mov     [ebx+52], eax   ; [ebx+$mp3gr_scalefac_scale]
  1241 00000A10 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits 1
  1242 00000A12 D1E5                                    shl     ebp, 1
  1243 00000A14 D1C0                                    rol     eax, 1
  1244 00000A16 31E8                                    xor     eax, ebp
  1245 00000A18 80ED01                                  sub     ch, 1
  1246 00000A1B 7913                                    jns     short .@_without_crc@@@@@@
  1247 00000A1D 88E9                                    mov     cl, ch
  1248 00000A1F 80C510                                  add     ch, 10h
  1249 00000A22 D3C5                                    rol     ebp, cl
  1250 00000A24 668B2E                                  mov     bp, [esi]
  1251 00000A27 83C602                                  add     esi, 2
  1252 00000A2A 66C1CD08                                ror     bp, 8
  1253 00000A2E D3CD                                    ror     ebp, cl
  1254                                  
  1255                                  .@_without_crc@@@@@@: 
  1256 00000A30 83C010                                  add     eax, 10h        ; table 10h..11h (quad_vlc)
  1257 00000A33 894324                                  mov     [ebx+36], eax   ; [ebx+$mp3gr_count1table_select]
  1258 00000A36 81C340130000                            add     ebx, 4928       ; $mp3gr_entrysiz*2
  1259 00000A3C FF05[7C190100]                          inc     dword [mp3_curr_channel]
  1260 00000A42 A1[7C190100]                            mov     eax, [mp3_curr_channel]
  1261 00000A47 3B05[BCC20000]          		cmp     eax, [mp3_num_channels]
  1262 00000A4D 0F82C1FBFFFF                            jb      .hdr_channel_lop
  1263 00000A53 5B                                      pop     ebx
  1264 00000A54 81C3A0090000                            add     ebx, 2464       ; $mp3gr_entrysiz
  1265 00000A5A FF05[80190100]                          inc     dword [mp3_curr_granule]
  1266 00000A60 A1[80190100]                            mov     eax, [mp3_curr_granule]
  1267 00000A65 3B05[9C190100]                          cmp     eax, [mp3_nb_granules]
  1268 00000A6B 0F8298FBFFFF                            jb      .hdr_granule_lop
  1269                                  	
  1270                                  		; 16/02/2025
  1271                                  .no_rdtsc_supported@:
  1272                                                  ;clc
  1273 00000A71 C3                                      retn
  1274                                  
  1275                                  .error:
  1276                                  		; 16/02/2025
  1277                                  .no_rdtsc_supported@@:
  1278 00000A72 8B25[94440500]                          mov     esp, [_@@saved_sp]
  1279 00000A78 F9                                      stc
  1280 00000A79 C3                                      retn
  1281                                  
  1282                                  
  1283                                  ; =============== S U B R O U T I N E =======================================
  1284                                  
  1285                                  
  1286                                  mp3_bitstream_append_to_main_data_pool:
  1287                                                	; 16/02/2025
  1288                                  
  1289                                  .no_rdtsc_supported:
  1290 00000A7A 8B0D[9CC20000]                          mov     ecx, [mp3_src_frame_end]
  1291 00000A80 29F1                                    sub     ecx, esi
  1292 00000A82 0F8221020000                            jb      fatalunexpected
  1293 00000A88 8B3D[90C20000]                          mov     edi, [main_data_pool_wr_ptr]
  1294 00000A8E 8D040F                                  lea     eax, [edi+ecx]
  1295 00000A91 3D[90C20000]                            cmp     eax, main_data_pool_wr_ptr
  1296 00000A96 7616                                    jbe     short .pool_inrange
  1297 00000A98 51                                      push    ecx
  1298 00000A99 56                                      push    esi
  1299 00000A9A 8DB700FEFFFF                            lea     esi, [edi-200h]
  1300 00000AA0 BF[90B20000]                            mov     edi, main_data_pool_start
  1301 00000AA5 B980000000                              mov     ecx, 128
  1302 00000AAA F3A5                                    rep movsd
  1303 00000AAC 5E                                      pop     esi
  1304 00000AAD 59                                      pop     ecx
  1305                                  
  1306                                  .pool_inrange:
  1307 00000AAE 89F8                                    mov     eax, edi
  1308 00000AB0 2B05[94190100]                          sub     eax, [mp3_main_data_begin]
  1309 00000AB6 F3A4                                    rep movsb
  1310 00000AB8 893D[90C20000]                          mov     [main_data_pool_wr_ptr], edi
  1311 00000ABE 3D[90B20000]                            cmp     eax, main_data_pool_start
  1312 00000AC3 7811                                    js      short .below_pool_start
  1313 00000AC5 A3[88190100]                            mov     [mp3_bitstream_start], eax
  1314                                                  ; 22/10/2024
  1315                                  		;mov    eax, 0
  1316 00000ACA 8B35[88190100]                          mov     esi, [mp3_bitstream_start] ; mp3mac_bitstream_set_position
  1317                                                  ;mov    cl, al
  1318                                                  ;shr    eax, 3
  1319                                                  ;and    cl, 7
  1320                                                  ;add    esi, eax
  1321 00000AD0 E8D3F7FFFF                              call    mp3_recollect_bits
  1322                                                  ;mov    eax, ebp        ; mp3mac_get_n_bits cl
  1323                                                  ;shl    ebp, cl
  1324                                                  ;rol    eax, cl
  1325                                                  ;xor    eax, ebp
  1326                                                  ;sub    ch, cl
  1327                                                  ;jns    short .cont
  1328                                                  ;mov    cl, ch          ; mp3mac_collect_more
  1329                                                  ;add    ch, 10h
  1330                                                  ;rol    ebp, cl
  1331                                                  ;mov    bp, [esi]
  1332                                                  ;add    esi, 2
  1333                                                  ;ror    bp, 8
  1334                                                  ;ror    ebp, cl
  1335                                  
  1336                                  .cont:
  1337                                  		; 16/02/2025
  1338                                  		; clc ; not needed
  1339                                  
  1340                                  .no_rdtsc_supported@:
  1341 00000AD5 C3                                      retn
  1342                                  
  1343                                  .below_pool_start:
  1344 00000AD6 C705[74190100]0000-                     mov     dword [mp3_samples_output_size], 0
  1344 00000ADE 0000               
  1345 00000AE0 EBF3                                    jmp     short .cont
  1346                                  
  1347                                  
  1348                                  ; =============== S U B R O U T I N E =======================================
  1349                                  
  1350                                  
  1351                                  mp3_bitstream_read_scalefacs:
  1352                                  		; 16/02/2025
  1353                                  
  1354                                  .no_rdtsc_supported:
  1355 00000AE2 8D7B70                                  lea     edi, [ebx+112]  ; [ebx+$mp3gr_scale_factors]
  1356 00000AE5 833D[D4C20000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
  1357 00000AEC 0F850D010000                            jnz     .body_lsf_nonzero
  1358 00000AF2 8B4314                                  mov     eax, [ebx+20]   ; [ebx+$mp3gr_scalefac_compress]
  1359 00000AF5 668B9400[D89E0000]                      mov     dx, [mp3_slen_table+eax*2] ; slen[0,1]
  1360 00000AFD 837B2C02                                cmp     dword [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  1361 00000B01 757F                                    jnz     short .body_lsf_zero_non_type2
  1362 00000B03 53                                      push    ebx
  1363 00000B04 B012                                    mov     al, 18
  1364 00000B06 2A4330                                  sub     al, [ebx+48]    ; [ebx+$mp3gr_switch_point]
  1365 00000B09 88C3                                    mov     bl, al          ; @@get_bl_scalefacs_with_dl_bits 0
  1366 00000B0B 80FA00                                  cmp     dl, 0
  1367 00000B0E 7428                                    jz      short .quickfill
  1368                                  
  1369                                  .scalefac_get_lop:
  1370 00000B10 88D1                                    mov     cl, dl          ; LSB of edx, slen[i]
  1371 00000B12 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1372 00000B14 D3E5                                    shl     ebp, cl
  1373 00000B16 D3C0                                    rol     eax, cl
  1374 00000B18 31E8                                    xor     eax, ebp
  1375 00000B1A 28CD                                    sub     ch, cl
  1376 00000B1C 7913                                    jns     short .cont@
  1377 00000B1E 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1378 00000B20 80C510                                  add     ch, 10h
  1379 00000B23 D3C5                                    rol     ebp, cl
  1380 00000B25 668B2E                                  mov     bp, [esi]
  1381 00000B28 83C602                                  add     esi, 2
  1382 00000B2B 66C1CD08                                ror     bp, 8
  1383 00000B2F D3CD                                    ror     ebp, cl
  1384                                  
  1385                                  .cont@:
  1386 00000B31 AA                                      stosb
  1387 00000B32 FECB                                    dec     bl
  1388 00000B34 75DA                                    jnz     short .scalefac_get_lop
  1389 00000B36 EB09                                    jmp     short .skip_quickfill
  1390                                  
  1391                                  .quickfill:
  1392 00000B38 51                                      push    ecx
  1393 00000B39 0FB6CB                                  movzx   ecx, bl
  1394 00000B3C B000                                    mov     al, 0           ; NO_INTENSITY_FLAG
  1395 00000B3E F3AA                                    rep stosb
  1396 00000B40 59                                      pop     ecx
  1397                                  
  1398                                  .skip_quickfill:
  1399 00000B41 C1EA08                                  shr     edx, 8
  1400 00000B44 B312                                    mov     bl, 18
  1401 00000B46 80FA00                                  cmp     dl, 0           ; @@get_bl_scalefacs_with_dl_bits 0
  1402 00000B49 7428                                    jz      short .quickfill@
  1403                                  
  1404                                  .scalefac_get_lop@:
  1405 00000B4B 88D1                                    mov     cl, dl
  1406 00000B4D 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1407 00000B4F D3E5                                    shl     ebp, cl
  1408 00000B51 D3C0                                    rol     eax, cl
  1409 00000B53 31E8                                    xor     eax, ebp
  1410 00000B55 28CD                                    sub     ch, cl
  1411 00000B57 7913                                    jns     short .cont@@
  1412 00000B59 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1413 00000B5B 80C510                                  add     ch, 10h
  1414 00000B5E D3C5                                    rol     ebp, cl
  1415 00000B60 668B2E                                  mov     bp, [esi]
  1416 00000B63 83C602                                  add     esi, 2
  1417 00000B66 66C1CD08                                ror     bp, 8
  1418 00000B6A D3CD                                    ror     ebp, cl
  1419                                  
  1420                                  .cont@@:
  1421 00000B6C AA                                      stosb
  1422 00000B6D FECB                                    dec     bl
  1423 00000B6F 75DA                                    jnz     short .scalefac_get_lop@
  1424 00000B71 EB09                                    jmp     short .skip_quickfill@
  1425                                  
  1426                                  .quickfill@:
  1427 00000B73 51                                      push    ecx
  1428 00000B74 0FB6CB                                  movzx   ecx, bl
  1429 00000B77 B000                                    mov     al, 0
  1430 00000B79 F3AA                                    rep stosb
  1431 00000B7B 59                                      pop     ecx
  1432                                  
  1433                                  .skip_quickfill@:
  1434 00000B7C 5B                                      pop     ebx
  1435 00000B7D E914010000                              jmp     .body_lsf_zeropad
  1436                                  
  1437                                  .body_lsf_zero_non_type2:
  1438 00000B82 53                                      push    ebx
  1439 00000B83 C1CA08                                  ror     edx, 8
  1440 00000B86 88D6                                    mov     dh, dl          ; slen[0,1,2,3] = slen[0,0,1,1]
  1441 00000B88 C1C210                                  rol     edx, 16
  1442 00000B8B 88F2                                    mov     dl, dh
  1443 00000B8D 8A4328                                  mov     al, [ebx+40]    ; [ebx+$mp3gr_scfsi]
  1444 00000B90 C0E004                                  shl     al, 4           ; move to upper 4bit
  1445 00000B93 A2[9C440500]                            mov     byte [_@@scfsi], al
  1446 00000B98 BB06050505                              mov     ebx, 5050506h   ; num[0..3]
  1447                                  
  1448                                  .body_lsf_zero_non_type2_lop:
  1449 00000B9D D025[9C440500]                          shl     byte [_@@scfsi], 1
  1450 00000BA3 7238                                    jb      short .body_lsf_zero_non_type2_copy
  1451 00000BA5 80FA00                                  cmp     dl, 0           ; @@get_bl_scalefacs_with_dl_bits 0
  1452 00000BA8 7428                                    jz      short .quickfill@@
  1453                                  
  1454                                  .scalefac_get_lop@@:
  1455 00000BAA 88D1                                    mov     cl, dl
  1456 00000BAC 89E8                                    mov     eax, ebp
  1457 00000BAE D3E5                                    shl     ebp, cl
  1458 00000BB0 D3C0                                    rol     eax, cl
  1459 00000BB2 31E8                                    xor     eax, ebp
  1460 00000BB4 28CD                                    sub     ch, cl
  1461 00000BB6 7913                                    jns     short .cont@@@
  1462 00000BB8 88E9                                    mov     cl, ch
  1463 00000BBA 80C510                                  add     ch, 10h
  1464 00000BBD D3C5                                    rol     ebp, cl
  1465 00000BBF 668B2E                                  mov     bp, [esi]
  1466 00000BC2 83C602                                  add     esi, 2
  1467 00000BC5 66C1CD08                                ror     bp, 8
  1468 00000BC9 D3CD                                    ror     ebp, cl
  1469                                  
  1470                                  .cont@@@:
  1471 00000BCB AA                                      stosb
  1472 00000BCC FECB                                    dec     bl
  1473 00000BCE 75DA                                    jnz     short .scalefac_get_lop@@
  1474 00000BD0 EB09                                    jmp     short .skip_quickfill@@
  1475                                  
  1476                                  .quickfill@@:
  1477 00000BD2 51                                      push    ecx
  1478 00000BD3 0FB6CB                                  movzx   ecx, bl
  1479 00000BD6 B000                                    mov     al, 0
  1480 00000BD8 F3AA                                    rep stosb
  1481 00000BDA 59                                      pop     ecx
  1482                                  
  1483                                  .skip_quickfill@@:
  1484 00000BDB EB11                                    jmp     short .body_lsf_zero_non_type2_next
  1485                                  
  1486                                  .body_lsf_zero_non_type2_copy:
  1487 00000BDD 51                                      push    ecx
  1488 00000BDE 89F0                                    mov     eax, esi
  1489 00000BE0 0FB6CB                                  movzx   ecx, bl         ; copy
  1490 00000BE3 8DB760F6FFFF                            lea     esi, [edi-2464] ; [edi-$mp3gr_entrysiz] ; src=granule[0] ; from
  1491 00000BE9 F3A4                                    rep movsb               ; prev
  1492 00000BEB 89C6                                    mov     esi, eax
  1493 00000BED 59                                      pop     ecx
  1494                                  
  1495                                  .body_lsf_zero_non_type2_next:
  1496 00000BEE C1EA08                                  shr     edx, 8          ; dl=next slen
  1497 00000BF1 C1EB08                                  shr     ebx, 8          ; bl=next numfacs
  1498 00000BF4 75A7                                    jnz     short .body_lsf_zero_non_type2_lop
  1499 00000BF6 5B                                      pop     ebx
  1500 00000BF7 B000                                    mov     al, 0
  1501 00000BF9 AA                                      stosb
  1502 00000BFA E9A9000000                              jmp     .body_lsf_done
  1503                                  
  1504                                  .body_lsf_nonzero:
  1505 00000BFF 8B5314                                  mov     edx, [ebx+14h]  ; [ebx+$mp3gr_scalefac_compress]
  1506 00000C02 F705[D0C20000]0100-                     test    dword [mp3_hdr_mode_ext], 1 ; MODE_EXT_I_STEREO
  1506 00000C0A 0000               
  1507 00000C0C 740F                                    jz      short .normal_scalefac
  1508 00000C0E 833D[7C190100]00                        cmp     dword [mp3_curr_channel], 0
  1509 00000C15 7406                                    jz      short .normal_scalefac
  1510 00000C17 81C200020000                            add     edx, 512        ; for 2nd channel of intensity_stereo
  1511                                  
  1512                                  .normal_scalefac:
  1513 00000C1D 8A04D5[91240500]                        mov     al, [(mp3_lsf_sf_expand_exploded_table+5)+edx*8]
  1514 00000C24 084318                                  or      [ebx+24], al    ; [ebx+$mp3gr_preflag]
  1515 00000C27 53                                      push    ebx
  1516 00000C28 0FB604D5[90240500]                      movzx   eax, byte [(mp3_lsf_sf_expand_exploded_table+4)+edx*8]
  1517 00000C30 837B2C02                                cmp     dword [ebx+44], 2 ;  [ebx+$mp3gr_block_type]
  1518 00000C34 7507                                    jnz     short .this_tindex1
  1519 00000C36 8B5B30                                  mov     ebx, [ebx+48]   ; [ebx+$mp3gr_switch_point]
  1520 00000C39 8D449804                                lea     eax, [eax+ebx*4+4]
  1521                                  
  1522                                  .this_tindex1:
  1523 00000C3D 8B98[F89E0000]                          mov     ebx, [mp3_lsf_nsf_table+eax]
  1524 00000C43 8B14D5[8C240500]                        mov     edx, dword [mp3_lsf_sf_expand_exploded_table+edx*8]
  1525                                  
  1526                                  .scalefax_outer_lop:
  1527 00000C4A 80FA00                                  cmp     dl, 0           ; @@get_bl_scalefacs_with_dl_bits 1
  1528 00000C4D 7435                                    jz      short .@quickfil
  1529                                  
  1530                                  .@scalefac_get_lop:
  1531 00000C4F 88D1                                    mov     cl, dl
  1532 00000C51 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1533 00000C53 D3E5                                    shl     ebp, cl
  1534 00000C55 D3C0                                    rol     eax, cl
  1535 00000C57 31E8                                    xor     eax, ebp
  1536 00000C59 28CD                                    sub     ch, cl
  1537 00000C5B 7913                                    jns     short .cont
  1538 00000C5D 88E9                                    mov     cl, ch
  1539 00000C5F 80C510                                  add     ch, 10h
  1540 00000C62 D3C5                                    rol     ebp, cl
  1541 00000C64 668B2E                                  mov     bp, [esi]
  1542 00000C67 83C602                                  add     esi, 2
  1543 00000C6A 66C1CD08                                ror     bp, 8
  1544 00000C6E D3CD                                    ror     ebp, cl
  1545                                  
  1546                                  .cont:
  1547 00000C70 88D1                                    mov     cl, dl          ; numbits
  1548 00000C72 88C4                                    mov     ah, al
  1549 00000C74 FEC4                                    inc     ah              ; val+1
  1550 00000C76 D2EC                                    shr     ah, cl          ; bit0=is.max.value
  1551 00000C78 C0E407                                  shl     ah, 7           ; bit7=is.max.value
  1552 00000C7B 08E0                                    or      al, ah          ; apply NO_INTENSITY_FLAG
  1553 00000C7D AA                                      stosb
  1554 00000C7E FECB                                    dec     bl
  1555 00000C80 75CD                                    jnz     short .@scalefac_get_lop
  1556 00000C82 EB09                                    jmp     short .@skip_quickfill
  1557                                  
  1558                                  .@quickfil:
  1559 00000C84 51                                      push    ecx
  1560 00000C85 0FB6CB                                  movzx   ecx, bl
  1561 00000C88 B080                                    mov     al, 80h
  1562 00000C8A F3AA                                    rep stosb
  1563 00000C8C 59                                      pop     ecx
  1564                                  
  1565                                  .@skip_quickfill:
  1566 00000C8D C1EA08                                  shr     edx, 8
  1567 00000C90 C1EB08                                  shr     ebx, 8
  1568 00000C93 75B5                                    jnz     short .scalefax_outer_lop
  1569 00000C95 5B                                      pop     ebx
  1570                                  
  1571                                  .body_lsf_zeropad:
  1572 00000C96 89CA                                    mov     edx, ecx
  1573 00000C98 8D8B98000000                            lea     ecx, [ebx+152]  ; [ebx+$mp3gr_scale_factors+40]
  1574 00000C9E 29F9                                    sub     ecx, edi
  1575                                                  ;jb     short fatal_scalefactors
  1576                                  		; 21/10/2024
  1577 00000CA0 7207                    		jb	short fatalunexpected
  1578 00000CA2 B000                                    mov     al, 0
  1579 00000CA4 F3AA                                    rep stosb
  1580 00000CA6 89D1                                    mov     ecx, edx
  1581                                  
  1582                                  .body_lsf_done:
  1583                                  		; 16/02/2025
  1584                                  		; clc ; not needed
  1585                                  
  1586                                  .no_rdtsc_supported@@@:
  1587 00000CA8 C3                                      retn
  1588                                  
  1589                                  		; 21/10/2024
  1590                                  ;fatal_scalefactors:
  1591                                                  ;jmp    fatalunexpected
  1592                                  
  1593                                  ; ---------------------------------------------------------------------------
  1594                                  
  1595                                  		; 21/10/2024
  1596                                  fatalunexpected:                       
  1597 00000CA9 F735[2AA90000]                          div	dword [zero]
  1598                                  hang:
  1599 00000CAF EBFE                                    jmp     short hang
  1600                                  
  1601                                  
  1602                                  ; =============== S U B R O U T I N E =======================================
  1603                                  
  1604                                  
  1605                                  mp3_get_exponents_from_scale_factors:
  1606                                  		; 16/02/2025
  1607                                  
  1608                                  .no_rdtsc_supported:
  1609 00000CB1 51                                      push    ecx             ; mp3mac_push_bitstream
  1610 00000CB2 55                                      push    ebp
  1611 00000CB3 56                                      push    esi
  1612 00000CB4 C705[AC440500]0000-                     mov     dword [_@@rle_point], 0
  1612 00000CBC 0000               
  1613 00000CBE 8A4B34                                  mov     cl, [ebx+52]    ; [ebx+$mp3gr_scalefac_scale]
  1614 00000CC1 BF[20400100]                            mov     edi, mp3_exponents
  1615 00000CC6 31D2                                    xor     edx, edx
  1616 00000CC8 3B5320                                  cmp     edx, [ebx+32]   ; [ebx+$mp3gr_long_end]
  1617 00000CCB 7345                                    jnb     short .long_done
  1618 00000CCD A1[B4C20000]                            mov     eax, [mp3_hdr_sample_rate_index]
  1619 00000CD2 6BC016                                  imul    eax, 22
  1620 00000CD5 8DA8[08A50000]                          lea     ebp, [mp3_band_size_long+eax]
  1621 00000CDB 8B4318                                  mov     eax, [ebx+24]   ; [ebx+$mp3gr_preflag]
  1622 00000CDE 6BC016                                  imul    eax, 22
  1623 00000CE1 8DB0[58A60000]                          lea     esi, [mp3_pretab+eax]
  1624                                  
  1625                                  .long_lop:
  1626 00000CE7 0FB6441370                              movzx   eax, byte [ebx+edx+112] ; [ebx+$mp3gr_scale_factors+edx]
  1627 00000CEC 247F                                    and     al, 7Fh         ; strip NO_INTENSITY_FLAG
  1628 00000CEE 020416                                  add     al, [esi+edx]
  1629 00000CF1 D3E0                                    shl     eax, cl
  1630 00000CF3 F7D8                                    neg     eax
  1631 00000CF5 034310                                  add     eax, [ebx+16]   ; [ebx+$mp3gr_global_gain]
  1632 00000CF8 C1E010                                  shl     eax, 16
  1633 00000CFB 8A441500                                mov     al, [ebp+edx+0]
  1634 00000CFF 0305[AC440500]                          add     eax, [_@@rle_point]
  1635 00000D05 66A3[AC440500]                          mov     word [_@@rle_point], ax
  1636 00000D0B AB                                      stosd
  1637 00000D0C 42                                      inc     edx
  1638 00000D0D 3B5320                                  cmp     edx, [ebx+32]   ; [ebx+$mp3gr_long_end]
  1639 00000D10 72D5                                    jb      short .long_lop
  1640                                  
  1641                                  .long_done:
  1642 00000D12 8B531C                                  mov     edx, [ebx+28]   ; [ebx+$mp3gr_short_start]
  1643 00000D15 83FA0D                                  cmp     edx, 13
  1644 00000D18 0F83AA000000                            jnb     .skip_shorts
  1645 00000D1E A1[B4C20000]                            mov     eax, [mp3_hdr_sample_rate_index]
  1646 00000D23 6BC00D                                  imul    eax, 13
  1647 00000D26 8DA8[D8A50000]                          lea     ebp, [mp3_band_size_short+eax]
  1648 00000D2C 8B7320                                  mov     esi, [ebx+32]   ; [ebx+$mp3gr_long_end]
  1649 00000D2F 8B4310                                  mov     eax, [ebx+16]   ; [ebx+$mp3gr_global_gain]
  1650                                                                          ; IRP nn,0,1,2
  1651 00000D32 2B4344                                  sub     eax, [ebx+68]   ; [ebx+$mp3gr_subblock_gain+nn*4]
  1652 00000D35 A3[A0440500]                            mov     [_@@gains], eax ; [@@gains+nn*4]
  1653 00000D3A 8B4310                                  mov     eax, [ebx+16]
  1654 00000D3D 2B4348                                  sub     eax, [ebx+72]
  1655 00000D40 A3[A4440500]                            mov     [_@@gains+4], eax ; [@@gains+nn*4]
  1656 00000D45 8B4310                                  mov     eax, [ebx+16]
  1657 00000D48 2B434C                                  sub     eax, [ebx+76]   ; [ebx+$mp3gr_subblock_gain+nn*4]
  1658 00000D4B A3[A8440500]                            mov     [_@@gains+8], eax ; [@@gains+nn*4]
  1659                                  
  1660                                  .short_lop:
  1661 00000D50 0FB6443370                              movzx   eax, byte [ebx+esi+112] ; [ebx+$mp3gr_scale_factors+esi]
  1662                                                                          ; IRP nn,0,1,2
  1663 00000D55 247F                                    and     al, 7Fh         ; strip NO_INTENSITY_FLAG
  1664 00000D57 46                                      inc     esi
  1665 00000D58 D3E0                                    shl     eax, cl
  1666 00000D5A F7D8                                    neg     eax
  1667 00000D5C 0305[A0440500]                          add     eax, [_@@gains] ; [@@gains+nn*4] ; nn=0
  1668 00000D62 C1E010                                  shl     eax, 16
  1669 00000D65 8A441500                                mov     al, [ebp+edx+0] ; bstab[edx]
  1670 00000D69 0305[AC440500]                          add     eax, [_@@rle_point]
  1671 00000D6F 66A3[AC440500]                          mov     word [_@@rle_point], ax
  1672 00000D75 AB                                      stosd                   ; msw=val, lsw=point
  1673 00000D76 0FB6443370                              movzx   eax, byte [ebx+esi+112] ; [ebx+$mp3gr_scalefac_scale]
  1674 00000D7B 247F                                    and     al, 7Fh
  1675 00000D7D 46                                      inc     esi
  1676 00000D7E D3E0                                    shl     eax, cl
  1677 00000D80 F7D8                                    neg     eax
  1678 00000D82 0305[A4440500]                          add     eax, [_@@gains+4] ; [@@gains+nn*4] ; nn = 1
  1679 00000D88 C1E010                                  shl     eax, 16
  1680 00000D8B 8A441500                                mov     al, [ebp+edx+0]
  1681 00000D8F 0305[AC440500]                          add     eax, [_@@rle_point]
  1682 00000D95 66A3[AC440500]                          mov     word [_@@rle_point], ax
  1683 00000D9B AB                                      stosd
  1684 00000D9C 0FB6443370                              movzx   eax, byte [ebx+esi+70h]
  1685 00000DA1 247F                                    and     al, 7Fh
  1686 00000DA3 46                                      inc     esi
  1687 00000DA4 D3E0                                    shl     eax, cl
  1688 00000DA6 F7D8                                    neg     eax
  1689 00000DA8 0305[A8440500]                          add     eax, [_@@gains+8] ; [@@gains+nn*4] ; nn=2
  1690 00000DAE C1E010                                  shl     eax, 10h
  1691 00000DB1 8A441500                                mov     al, [ebp+edx+0]
  1692 00000DB5 0305[AC440500]                          add     eax, [_@@rle_point]
  1693 00000DBB 66A3[AC440500]                          mov     word [_@@rle_point], ax
  1694 00000DC1 AB                                      stosd
  1695 00000DC2 42                                      inc     edx
  1696 00000DC3 83FA0D                                  cmp     edx, 13
  1697 00000DC6 7288                                    jb      short .short_lop
  1698                                  
  1699                                  .skip_shorts:
  1700 00000DC8 5E                                      pop     esi             ; mp3mac_pop_bitstream
  1701 00000DC9 5D                                      pop     ebp
  1702 00000DCA 59                                      pop     ecx
  1703                                  
  1704                                  		; 16/02/2025 
  1705                                  
  1706                                  .no_rdtsc_supported@:
  1707 00000DCB C3                                      retn
  1708                                  
  1709                                  
  1710                                  ; =============== S U B R O U T I N E =======================================
  1711                                  
  1712                                  
  1713                                  mp3_huffman_decode:
  1714                                  		; 16/02/2025
  1715                                  
  1716                                  .no_rdtsc_supported:
  1717 00000DCC 8B4308                                  mov	eax, [ebx+8]    ; [ebx+$mp3gr_part2_3_end]
  1718 00000DCF C1E803                                  shr	eax, 3
  1719 00000DD2 0305[88190100]                          add	eax, [mp3_bitstream_start]
  1720 00000DD8 A3[C0440500]                            mov	[_@@coarse_end], eax
  1721 00000DDD 31FF                                    xor	edi, edi
  1722 00000DDF C705[C8440500]-                         mov	dword [_@@rle_ptr], mp3_exponents
  1722 00000DE5 [20400100]         
  1723 00000DE9 C705[C4440500]0000-                     mov	dword [_@rle_point], 0
  1723 00000DF1 0000               
  1724 00000DF3 C705[B0440500]0000-                     mov	dword [_@@III], 0  ; i=0
  1724 00000DFB 0000               
  1725                                  
  1726                                  .low_freq_lop_i:
  1727 00000DFD 8B15[B0440500]                          mov     edx, [_@@III] ; for i=0 to 2
  1728                                                                          ; low frequencies (called big_values)...
  1729 00000E03 8B449350                                mov     eax, [ebx+edx*4+80] ; [ebx+$mp3gr_region_size+edx*4]
  1730 00000E07 83F800                                  cmp     eax, 0
  1731 00000E0A 0F84D9020000                            jz      .low_freq_next_i
  1732 00000E10 A3[B4440500]                            mov     [_@@JJJ], eax
  1733 00000E15 8B549338                                mov     edx, [ebx+edx*4+56] ; [ebx+$mp3gr_table_select+edx*4]
  1734                                                                          ; select vlc table
  1735 00000E19 0FB68412[C8A40000]                      movzx   eax, byte [mp3_huff_data+edx*2] ; get huff.table number
  1736 00000E21 83F800                                  cmp     eax, 0          ; huff.table
  1737 00000E24 7528                                    jnz     short .low_freq_nonzero
  1738 00000E26 51                                      push    ecx
  1739 00000E27 57                                      push    edi
  1740 00000E28 8DBCBBA0000000                          lea     edi, [ebx+edi*4+160] ; [ebx+$mp3gr_sb_hybrid+edi*4]
  1741 00000E2F 8B0D[B4440500]                          mov     ecx, [_@@JJJ]
  1742 00000E35 D1E1                                    shl     ecx, 1
  1743 00000E37 31C0                                    xor     eax, eax        ; when huff.table=0,
  1744                                                                          ; simply set NUM*2 entries to zero
  1745 00000E39 F3AB                                    rep stosd
  1746 00000E3B 5F                                      pop     edi
  1747 00000E3C 59                                      pop     ecx
  1748 00000E3D 033D[B4440500]                          add     edi, [_@@JJJ] ; raise index accordingly (by num*2)
  1749 00000E43 033D[B4440500]                          add     edi, [_@@JJJ]
  1750 00000E49 E99B020000                              jmp     .low_freq_next_i
  1751                                  
  1752                                  .low_freq_nonzero:
  1753 00000E4E A3[BC440500]                            mov     [_@@vlc_table], eax ; =1..15
  1754 00000E53 83F80E                                  cmp     eax, 14         ; only table 14..15 have linbits
  1755 00000E56 0F83FA000000                            jnb     .with_linbits  ; so table 0..13 can use faster code...
  1756                                  
  1757                                  .low_freq_lop_j_small:
  1758 00000E5C 3B35[C0440500]                          cmp     esi, [_@@coarse_end] ; loop @@JJJ times..
  1759 00000E62 0F87CF000000                            ja      .small_near_end
  1760                                  
  1761                                  .small_not_end:
  1762 00000E68 3B3D[C4440500]                          cmp     edi, [_@rle_point] ; @@get_runlength small
  1763 00000E6E 0F8386030000                            jnb     .rle_fetch_next_small
  1764                                  
  1765                                  .rle_back_small:
  1766 00000E74 8B15[BC440500]                          mov     edx, [_@@vlc_table] ; get huffcode
  1767                                  
  1768                                  .get_child_lop:
  1769 00000E7A 8A0C95[A2440100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; mp3mac_get_huffcode
  1770                                                                          ; in: edx=table, out: eax=data
  1771                                                                          ; bits (table size) (-7..-1)
  1772 00000E81 668B1495[A0440100]                      mov     dx, word [huff_tree_buf+edx*4] ; code (child table)
  1773 00000E89 89E8                                    mov     eax, ebp        ; mov eax,mp3_col32 ; peek bitstream
  1774 00000E8B D3E8                                    shr     eax, cl
  1775 00000E8D 01C2                                    add     edx, eax
  1776 00000E8F 8A0C95[A2440100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; bits (of entry)
  1777 00000E96 80F900                                  cmp     cl, 0
  1778 00000E99 7823                                    js      short .got_child
  1779 00000E9B 0FB70495[A0440100]                      movzx   eax, word [huff_tree_buf+edx*4] ; return data value
  1780 00000EA3 D3E5                                    shl     ebp, cl         ; shl mp3_col32,cl ; discard cl bits
  1781 00000EA5 28CD                                    sub     ch, cl          ; sub mp3_colNN,cl
  1782 00000EA7 7932                                    jns     short .got_done
  1783 00000EA9 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1784                                                                          ; mov cl,mp3_colNN ; byte ptr [mp3_numbits_collected]
  1785 00000EAB 80C510                                  add     ch, 16          ; byte ptr [mp3_numbits_collected]
  1786 00000EAE D3C5                                    rol     ebp, cl         ; dword ptr [mp3_collected_data]
  1787 00000EB0 668B2E                                  mov     bp, [esi]
  1788 00000EB3 83C602                                  add     esi, 2
  1789 00000EB6 66C1CD08                                ror     bp, 8           ; ror mp3_col16,8 ; endianess
  1790 00000EBA D3CD                                    ror     ebp, cl         ; ror mp3_col32,cl ; dword ptr [mp3_collected_data]
  1791 00000EBC EB1D                                    jmp     short .got_done
  1792                                  
  1793                                  .got_child:
  1794 00000EBE C1E509                                  shl     ebp, 9          ; shl mp3_col32,CHILD_BITS
  1795                                                                          ; discard 7 bits
  1796                                                                          ; (assuming that parents are always 7bit wide)
  1797 00000EC1 80ED09                                  sub     ch, 9
  1798 00000EC4 79B4                                    jns     short .get_child_lop
  1799 00000EC6 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1800 00000EC8 80C510                                  add     ch, 10h
  1801 00000ECB D3C5                                    rol     ebp, cl
  1802 00000ECD 668B2E                                  mov     bp, [esi]
  1803 00000ED0 83C602                                  add     esi, 2
  1804 00000ED3 66C1CD08                                ror     bp, 8
  1805 00000ED7 D3CD                                    ror     ebp, cl
  1806 00000ED9 EB9F                                    jmp     short .get_child_lop
  1807                                  
  1808                                  .got_done:
  1809 00000EDB 50                                      push    eax
  1810 00000EDC C1E804                                  shr     eax, 4          ; x
  1811 00000EDF 7417                                    jz      short .this_sign ; @@getexpval 0 ; @@getexpval macro has_linbits
  1812                                                                          ; eax=0 (without sign) ; when x=0
  1813 00000EE1 8B15[D0440500]                          mov     edx, [_@@rle_val_x_40h]
  1814 00000EE7 8B8482[0C880400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1815 00000EEE FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
  1816                                                                          ; ;jnc short @@this_sign
  1817                                                                          ; ;neg  eax
  1818 00000EF0 D1E5                                    shl     ebp, 1          ; dec mp3_colNN ; shl mp3_col32,1 ; cy=data
  1819 00000EF2 19D2                                    sbb     edx, edx        ; cy=0,1 --> 0,FFFFFFFF
  1820 00000EF4 31D0                                    xor     eax, edx        ; invert if cy was 1 ; get sign (negate if sign=1)
  1821 00000EF6 29D0                                    sub     eax, edx        ; add 1 if cy was 1
  1822                                  
  1823                                  .this_sign:
  1824 00000EF8 8984BBA0000000                          mov     [ebx+edi*4+160], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+0]
  1825 00000EFF 58                                      pop     eax
  1826 00000F00 83E00F                                  and     eax, 0Fh        ; y
  1827 00000F03 7417                                    jz      short .this_sign@ ; @@getexpval 0
  1828 00000F05 8B15[D0440500]                          mov     edx, [_@@rle_val_x_40h]
  1829 00000F0B 8B8482[0C880400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1830 00000F12 FECD                                    dec     ch
  1831 00000F14 D1E5                                    shl     ebp, 1
  1832 00000F16 19D2                                    sbb     edx, edx
  1833 00000F18 31D0                                    xor     eax, edx
  1834 00000F1A 29D0                                    sub     eax, edx
  1835                                  
  1836                                  .this_sign@:
  1837 00000F1C 8984BBA4000000                          mov     [ebx+edi*4+164], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+4]
  1838 00000F23 83C702                                  add     edi, 2
  1839 00000F26 FF0D[B4440500]                          dec     dword [_@@JJJ]
  1840 00000F2C 0F852AFFFFFF                            jnz     .low_freq_lop_j_small
  1841 00000F32 E9B2010000                              jmp     .low_freq_next_i
  1842                                  
  1843                                  .small_near_end:
  1844 00000F37 89F0                                    mov     eax, esi        ; mp3mac_bitstream_get_position
  1845 00000F39 2B05[88190100]                          sub     eax, [mp3_bitstream_start]
  1846 00000F3F 0FBED5                                  movsx   edx, ch         ; mp3_colNN
  1847 00000F42 F7DA                                    neg     edx
  1848 00000F44 8D44C2F0                                lea     eax, [edx+eax*8-16]
  1849 00000F48 3B4308                                  cmp     eax, [ebx+8]    ; [ebx+$mp3gr_part2_3_end]
  1850 00000F4B 0F8217FFFFFF                            jb      .small_not_end
  1851 00000F51 E993010000                              jmp     .low_freq_next_i
  1852                                  
  1853                                  .with_linbits:
  1854 00000F56 0FB68412[C9A40000]                      movzx   eax, byte [(mp3_huff_data+1)+edx*2]
  1855 00000F5E A3[B8440500]                            mov     [_@@linbits], eax
  1856                                  
  1857                                  .low_freq_lop_j:
  1858 00000F63 3B35[C0440500]                          cmp     esi, [_@@coarse_end] ; mp3mac_bitstream_get_position
  1859                                                                          ; loop @@JJJ times...
  1860 00000F69 0F870D030000                            ja      .lop_j_near_end
  1861                                  
  1862                                  .small_not_end@:
  1863 00000F6F 3B3D[C4440500]                          cmp     edi, [_@rle_point] ; @@get_runlength small
  1864 00000F75 0F83AD020000                            jnb     .rle_fetch_next_full
  1865                                  
  1866                                  .rle_back_full:
  1867 00000F7B 8B15[BC440500]                          mov     edx, [_@@vlc_table] ; get huffcode
  1868                                  
  1869                                  .get_child_lop@:
  1870 00000F81 8A0C95[A2440100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; mp3mac_get_huffcode
  1871                                                                          ; in: edx=table, out: eax=data
  1872                                                                          ; bits (table size) (-7..-1)
  1873 00000F88 668B1495[A0440100]                      mov     dx, word [huff_tree_buf+edx*4] ; code (child table)
  1874 00000F90 89E8                                    mov     eax, ebp
  1875 00000F92 D3E8                                    shr     eax, cl
  1876 00000F94 01C2                                    add     edx, eax
  1877 00000F96 8A0C95[A2440100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; bits (of entry)
  1878 00000F9D 80F900                                  cmp     cl, 0
  1879 00000FA0 7823                                    js      short .got_child@
  1880 00000FA2 0FB70495[A0440100]                      movzx   eax, word [huff_tree_buf+edx*4] ; return data value
  1881 00000FAA D3E5                                    shl     ebp, cl         ; discard cl bits
  1882 00000FAC 28CD                                    sub     ch, cl
  1883 00000FAE 7932                                    jns     short .got_done@
  1884 00000FB0 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1885 00000FB2 80C510                                  add     ch, 10h
  1886 00000FB5 D3C5                                    rol     ebp, cl
  1887 00000FB7 668B2E                                  mov     bp, [esi]
  1888 00000FBA 83C602                                  add     esi, 2
  1889 00000FBD 66C1CD08                                ror     bp, 8
  1890 00000FC1 D3CD                                    ror     ebp, cl
  1891 00000FC3 EB1D                                    jmp     short .got_done@
  1892                                  
  1893                                  .got_child@:
  1894 00000FC5 C1E509                                  shl     ebp, 9
  1895 00000FC8 80ED09                                  sub     ch, 9
  1896 00000FCB 79B4                                    jns     short .get_child_lop@
  1897 00000FCD 88E9                                    mov     cl, ch
  1898 00000FCF 80C510                                  add     ch, 10h
  1899 00000FD2 D3C5                                    rol     ebp, cl
  1900 00000FD4 668B2E                                  mov     bp, [esi]
  1901 00000FD7 83C602                                  add     esi, 2
  1902 00000FDA 66C1CD08                                ror     bp, 8
  1903 00000FDE D3CD                                    ror     ebp, cl
  1904 00000FE0 EB9F                                    jmp     short .get_child_lop@
  1905                                  
  1906                                  .got_done@:
  1907 00000FE2 50                                      push    eax
  1908 00000FE3 C1E804                                  shr     eax, 4          ; x
  1909 00000FE6 746F                                    jz      short .@this_sign ; @@getexpval 1
  1910 00000FE8 8B15[CC440500]                          mov     edx, [_@@rle_val]
  1911 00000FEE 83F80F                                  cmp     eax, 15
  1912 00000FF1 7250                                    jb      short .small    ; when x=1..14
  1913 00000FF3 8A0D[B8440500]                          mov     cl, byte [_@@linbits] ; =0..13 ; when x=15, with linbits
  1914 00000FF9 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl ; value = 0..1FFFh
  1915 00000FFB D3E5                                    shl     ebp, cl         ; mp3mac_collect_more
  1916 00000FFD D3C0                                    rol     eax, cl
  1917 00000FFF 31E8                                    xor     eax, ebp
  1918 00001001 28CD                                    sub     ch, cl
  1919 00001003 7913                                    jns     short .cont
  1920 00001005 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1921 00001007 80C510                                  add     ch, 16
  1922 0000100A D3C5                                    rol     ebp, cl
  1923 0000100C 668B2E                                  mov     bp, [esi]
  1924 0000100F 83C602                                  add     esi, 2
  1925 00001012 66C1CD08                                ror     bp, 8
  1926 00001016 D3CD                                    ror     ebp, cl
  1927                                  
  1928                                  .cont:
  1929 00001018 88D1                                    mov     cl, dl          ; exponent.lsb
  1930 0000101A 80E103                                  and     cl, 3           ; exponent.lsb
  1931 0000101D C1EA02                                  shr     edx, 2          ; exponent.msb
  1932 00001020 8D04853C000000                          lea     eax, [eax*4+60] ; (value+15)*4
  1933 00001027 08C8                                    or      al, cl          ; exponent.lsb+(value+15)*4
  1934 00001029 8A88[E0FE0100]                          mov     cl, [mp3_table_4_3_exp+eax]
  1935 0000102F 8B0485[1C7F0200]                        mov     eax, [mp3_table_4_3_value+eax*4]
  1936 00001036 28D1                                    sub     cl, dl          ; sub exponent.msb
  1937 00001038 D3E8                                    shr     eax, cl
  1938 0000103A 80F91F                                  cmp     cl, 31
  1939 0000103D 760E                                    jbe     short .get_sign
  1940 0000103F 31C0                                    xor     eax, eax
  1941 00001041 EB0A                                    jmp     short .get_sign
  1942                                  
  1943                                  .small:
  1944 00001043 C1E206                                  shl     edx, 6          ; shl edx,4+2 ; mul16*4 ; when x<15 aka x=1..14
  1945 00001046 8B8482[0C880400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1946                                  
  1947                                  .get_sign:
  1948 0000104D FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
  1949 0000104F D1E5                                    shl     ebp, 1
  1950 00001051 19D2                                    sbb     edx, edx        ; get sign (negate if sign=1)
  1951 00001053 31D0                                    xor     eax, edx
  1952 00001055 29D0                                    sub     eax, edx
  1953                                  
  1954                                  .@this_sign:
  1955 00001057 8984BBA0000000                          mov     [ebx+edi*4+160], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+0]
  1956 0000105E 58                                      pop     eax
  1957 0000105F 83E00F                                  and     eax, 0Fh        ; y
  1958 00001062 746F                                    jz      short .@this_sign@ ; @@getexpval 1
  1959 00001064 8B15[CC440500]                          mov     edx, [_@@rle_val]
  1960 0000106A 83F80F                                  cmp     eax, 0Fh
  1961 0000106D 7250                                    jb      short .small@
  1962 0000106F 8A0D[B8440500]                          mov     cl, byte [_@@linbits]
  1963 00001075 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  1964 00001077 D3E5                                    shl     ebp, cl
  1965 00001079 D3C0                                    rol     eax, cl
  1966 0000107B 31E8                                    xor     eax, ebp
  1967 0000107D 28CD                                    sub     ch, cl
  1968 0000107F 7913                                    jns     short .cont@
  1969 00001081 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  1970 00001083 80C510                                  add     ch, 10h
  1971 00001086 D3C5                                    rol     ebp, cl
  1972 00001088 668B2E                                  mov     bp, [esi]
  1973 0000108B 83C602                                  add     esi, 2
  1974 0000108E 66C1CD08                                ror     bp, 8
  1975 00001092 D3CD                                    ror     ebp, cl
  1976                                  
  1977                                  .cont@:
  1978 00001094 88D1                                    mov     cl, dl
  1979 00001096 80E103                                  and     cl, 3
  1980 00001099 C1EA02                                  shr     edx, 2
  1981 0000109C 8D04853C000000                          lea     eax, [eax*4+60]
  1982 000010A3 08C8                                    or      al, cl
  1983 000010A5 8A88[E0FE0100]                          mov     cl, [mp3_table_4_3_exp+eax]
  1984 000010AB 8B0485[1C7F0200]                        mov     eax, [mp3_table_4_3_value+eax*4]
  1985 000010B2 28D1                                    sub     cl, dl
  1986 000010B4 D3E8                                    shr     eax, cl
  1987 000010B6 80F91F                                  cmp     cl, 31
  1988 000010B9 760E                                    jbe     short .get_sign@
  1989 000010BB 31C0                                    xor     eax, eax
  1990 000010BD EB0A                                    jmp     short .get_sign@
  1991                                  
  1992                                  .small@:
  1993 000010BF C1E206                                  shl     edx, 6
  1994 000010C2 8B8482[0C880400]                        mov     eax, [mp3_expval_table+edx+eax*4]
  1995                                  
  1996                                  .get_sign@:                           
  1997 000010C9 FECD                                    dec     ch              ; dec mp3_colNN
  1998 000010CB D1E5                                    shl     ebp, 1          ; shl mp3_col32,1 ; cy=data
  1999 000010CD 19D2                                    sbb     edx, edx        ; cy=0,1 --> 0,FFFFFFFF
  2000 000010CF 31D0                                    xor     eax, edx        ; invert if cy was 1
  2001 000010D1 29D0                                    sub     eax, edx        ; add 1 if cy was 1
  2002                                  
  2003                                  .@this_sign@:
  2004 000010D3 8984BBA4000000                          mov	[ebx+edi*4+164], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+4]
  2005 000010DA 83C702                                  add	edi, 2          ; next j
  2006 000010DD FF0D[B4440500]                          dec	dword [_@@JJJ]
  2007 000010E3 0F857AFEFFFF                            jnz	.low_freq_lop_j
  2008                                  
  2009                                  .low_freq_next_i:
  2010 000010E9 FF05[B0440500]                          inc	dword [_@@III]	; next i
  2011 000010EF 833D[B0440500]03                        cmp	dword [_@@III], 3
  2012 000010F6 0F8201FDFFFF                            jb	.low_freq_lop_i
  2013 000010FC 81FF3C020000                            cmp	edi, 572	; aka 576-4 ; skip if less than 4 entries left
  2014 00001102 0F87DA000000                            ja	.high_freq_done
  2015                                  
  2016                                  .high_freq_lop:
  2017 00001108 3B35[C0440500]                          cmp     esi, [_@@coarse_end]
  2018 0000110E 7629                                    jbe     short .high_freq_inrange
  2019 00001110 89F0                                    mov     eax, esi        ; mp3mac_bitstream_get_position
  2020 00001112 2B05[88190100]                          sub     eax, [mp3_bitstream_start]
  2021 00001118 0FBED5                                  movsx   edx, ch         ; mp3_colNN
  2022 0000111B F7DA                                    neg     edx
  2023 0000111D 8D44C2F0                                lea     eax, [edx+eax*8-16]
  2024 00001121 3B4308                                  cmp     eax, [ebx+8]    ; [ebx+$mp3gr_part2_3_end] ; check end
  2025 00001124 7213                                    jb      short .high_freq_inrange ; not yet end
  2026 00001126 0F84B6000000                            jz      .high_freq_done ; okay, exact end
  2027 0000112C 83FF04                                  cmp     edi, 4
  2028 0000112F 7203                                    jb      short .high_freq_cannot_stepback
  2029 00001131 83EF04                                  sub     edi, 4          ; stepback, s_index-4 ; dst stepback
  2030                                  
  2031                                  .high_freq_cannot_stepback:
  2032 00001134 E9A9000000                              jmp     .high_freq_done
  2033                                  
  2034                                  .high_freq_inrange:
  2035 00001139 8B5324                                  mov     edx, [ebx+24h]  ; [ebx+$mp3gr_count1table_select]
  2036                                                                          ; get huffcode (quad_vlc)
  2037                                  
  2038                                  .get_child_lop@@:
  2039 0000113C 8A0C95[A2440100]                        mov     cl, [(huff_tree_buf+2)+edx*4] ; mp3mac_get_huffcode
  2040 00001143 668B1495[A0440100]                      mov     dx, word [huff_tree_buf+edx*4]
  2041 0000114B 89E8                                    mov     eax, ebp
  2042 0000114D D3E8                                    shr     eax, cl
  2043 0000114F 01C2                                    add     edx, eax
  2044 00001151 8A0C95[A2440100]                        mov     cl, [(huff_tree_buf+2)+edx*4]
  2045 00001158 80F900                                  cmp     cl, 0
  2046 0000115B 7823                                    js      short .got_child@@
  2047 0000115D 0FB70495[A0440100]                      movzx   eax, word [huff_tree_buf+edx*4]
  2048 00001165 D3E5                                    shl     ebp, cl
  2049 00001167 28CD                                    sub     ch, cl
  2050 00001169 7932                                    jns     short .got_done@@
  2051 0000116B 88E9                                    mov     cl, ch
  2052 0000116D 80C510                                  add     ch, 10h
  2053 00001170 D3C5                                    rol     ebp, cl
  2054 00001172 668B2E                                  mov     bp, [esi]
  2055 00001175 83C602                                  add     esi, 2
  2056 00001178 66C1CD08                                ror     bp, 8
  2057 0000117C D3CD                                    ror     ebp, cl
  2058 0000117E EB1D                                    jmp     short .got_done@@
  2059                                  
  2060                                  .got_child@@:
  2061 00001180 C1E509                                  shl     ebp, 9
  2062 00001183 80ED09                                  sub     ch, 9
  2063 00001186 79B4                                    jns     short .get_child_lop@@
  2064 00001188 88E9                                    mov     cl, ch
  2065 0000118A 80C510                                  add     ch, 10h
  2066 0000118D D3C5                                    rol     ebp, cl
  2067 0000118F 668B2E                                  mov     bp, [esi]
  2068 00001192 83C602                                  add     esi, 2
  2069 00001195 66C1CD08                                ror     bp, 8
  2070 00001199 D3CD                                    ror     ebp, cl
  2071 0000119B EB9F                                    jmp     short .get_child_lop@@
  2072                                  
  2073                                  .got_done@@:
  2074 0000119D 88C2                                    mov     dl, al          ; flags
  2075 0000119F C0E204                                  shl     dl, 4           ; flags, to upper 4bit
  2076 000011A2 B604                                    mov     dh, 4           ; lopcount
  2077                                  
  2078                                  .high_freq_flag_lop:
  2079 000011A4 31C0                                    xor     eax, eax
  2080 000011A6 D0E2                                    shl     dl, 1           ; flag
  2081 000011A8 7320                                    jnb     short .high_freq_flag_this
  2082 000011AA 3B3D[C4440500]                          cmp     edi, [_@rle_point] ; @@get_runlength quads
  2083 000011B0 0F83A0000000                            jnb     .rle_fetch_next_quads
  2084                                  
  2085                                  .rle_back_quads:
  2086 000011B6 A1[CC440500]                            mov     eax, [_@@rle_val]
  2087 000011BB 8B0485[0C800400]                        mov     eax, [mp3_exp_table+eax*4] ; xlat and get sign
  2088 000011C2 FECD                                    dec     ch              ; mp3mac_get_bit_to_cy
  2089 000011C4 D1E5                                    shl     ebp, 1
  2090 000011C6 7302                                    jnb     short .high_freq_flag_this ;
  2091                                                                          ; sbb edx, edx ; cy=0,1 --> 0,FFFFFFFF
  2092                                                                          ; xor eax, edx ; invert if cy was 1
  2093                                                                          ; sub eax, edx ; add 1 if cy was 1
  2094 000011C8 F7D8                                    neg     eax
  2095                                  
  2096                                  .high_freq_flag_this:
  2097 000011CA 8984BBA0000000                          mov     [ebx+edi*4+160], eax ; [ebx+$mp3gr_sb_hybrid+edi*4+0]
  2098 000011D1 47                                      inc     edi
  2099 000011D2 FECE                                    dec     dh
  2100 000011D4 75CE                                    jnz     short .high_freq_flag_lop
  2101 000011D6 81FF3C020000                            cmp     edi, 572        ; aka 576-4 ; loop while space for another 4 values
  2102 000011DC 0F8626FFFFFF                            jbe     .high_freq_lop
  2103                                  
  2104                                  .high_freq_done:
  2105 000011E2 897B5C                                  mov     [ebx+92], edi   ; [ebx+$mp3gr_num_nonzero_hybrids]
  2106 000011E5 51                                      push    ecx
  2107 000011E6 B940020000                              mov     ecx, 576        ; end
  2108 000011EB 29F9                                    sub     ecx, edi        ; remain = end-curr
  2109                                                                          ; zeropad remaining entries (can be 0 or 2 dwords,
  2110                                                                          ; or more. If above loop was aborted)
  2111 000011ED 8DBCBBA0000000                          lea     edi, [ebx+edi*4+160] ; [ebx+$mp3gr_sb_hybrid+edi*4]
  2112 000011F4 31C0                                    xor     eax, eax
  2113 000011F6 F3AB                                    rep stosd
  2114 000011F8 59                                      pop     ecx
  2115                                  
  2116                                  		; 16/02/2025
  2117                                  .no_rdtsc_supported@:
  2118                                                  ;clc			; out: cy=0=okay
  2119 000011F9 C3                                      retn
  2120                                  
  2121                                  .rle_fetch_next_small:
  2122 000011FA A1[C8440500]                            mov     eax, [_@@rle_ptr] ; @@next_runlength small
  2123 000011FF 8305[C8440500]04                        add     dword [_@@rle_ptr], 4
  2124 00001206 8B00                                    mov     eax, [eax]
  2125 00001208 6639C7                                  cmp     di, ax
  2126 0000120B 73ED                                    jnb     short .rle_fetch_next_small
  2127 0000120D 66A3[C4440500]                          mov     word [_@rle_point], ax
  2128 00001213 C1E810                                  shr     eax, 16
  2129 00001216 A3[CC440500]                            mov     [_@@rle_val], eax
  2130 0000121B C1E006                                  shl     eax, 6
  2131 0000121E A3[D0440500]                            mov     [_@@rle_val_x_40h], eax
  2132 00001223 E94CFCFFFF                              jmp     .rle_back_small
  2133                                  
  2134                                  .rle_fetch_next_full:
  2135 00001228 A1[C8440500]                            mov     eax, [_@@rle_ptr] ; @@next_runlength full
  2136 0000122D 8305[C8440500]04                        add	dword [_@@rle_ptr], 4
  2137 00001234 8B00                                    mov     eax, [eax]
  2138 00001236 6639C7                                  cmp     di, ax
  2139 00001239 73ED                                    jnb     short .rle_fetch_next_full
  2140 0000123B 66A3[C4440500]                          mov     word [_@rle_point], ax
  2141 00001241 C1E810                                  shr     eax, 16
  2142 00001244 A3[CC440500]                            mov     [_@@rle_val], eax
  2143 00001249 C1E006                                  shl     eax, 6
  2144 0000124C A3[D0440500]                            mov     [_@@rle_val_x_40h], eax
  2145 00001251 E925FDFFFF                              jmp     .rle_back_full
  2146                                  
  2147                                  .rle_fetch_next_quads:
  2148 00001256 A1[C8440500]                            mov	eax, [_@@rle_ptr] ; msw=val, lsw=point
  2149 0000125B 8305[C8440500]04                        add	dword [_@@rle_ptr], 4 ; 2+2
  2150 00001262 8B00                                    mov	eax, [eax]
  2151 00001264 6639C7                                  cmp	di, ax          ; needed if rle fetching was skipped
  2152 00001267 73ED                                    jnb	short .rle_fetch_next_quads
  2153 00001269 66A3[C4440500]                          mov	word [_@rle_point], ax
  2154 0000126F C1E810                                  shr	eax, 16
  2155 00001272 A3[CC440500]                            mov	[_@@rle_val], eax
  2156 00001277 E93AFFFFFF                              jmp	.rle_back_quads
  2157                                  
  2158                                  .lop_j_near_end:
  2159 0000127C 89F0                                    mov     eax, esi
  2160 0000127E 2B05[88190100]                          sub     eax, [mp3_bitstream_start]
  2161 00001284 0FBED5                                  movsx   edx, ch
  2162 00001287 F7DA                                    neg     edx
  2163 00001289 8D44C2F0                                lea     eax, [edx+eax*8-16]
  2164 0000128D 3B4308                                  cmp     eax, [ebx+8]
  2165 00001290 0F82D9FCFFFF                            jb      .small_not_end@
  2166 00001296 E94EFEFFFF                              jmp     .low_freq_next_i
  2167                                  
  2168                                  
  2169                                  ; =============== S U B R O U T I N E =======================================
  2170                                  
  2171                                  
  2172                                  mp3_compute_stereo:
  2173                                  		; 16/02/2025
  2174 0000129B 833D[BCC20000]02                        cmp	dword [mp3_num_channels], 2 ; in: ebx=granule(s)
  2175 000012A2 7515                                    jnz	short .no_stereo
  2176 000012A4 833D[D0C20000]02                        cmp	dword [mp3_hdr_mode_ext], 2 ; MODE_EXT_MS_STEREO
  2177                                                                          ; only MS stereo
  2178 000012AB 740D                                    jz	short mp3_compute_ms_stereo
  2179 000012AD F705[D0C20000]0100-                     test	dword [mp3_hdr_mode_ext], 1 ; MODE_EXT_I_STEREO
  2179 000012B5 0000               
  2180                                                                          ; intensity stereo (optionally with MS stereo)
  2181 000012B7 7539                                    jnz	short mp3_compute_i_stereo
  2182                                  
  2183                                  .no_stereo:
  2184 000012B9 C3                                      retn
  2185                                  
  2186                                  mp3_compute_ms_stereo:
  2187                                  		; 16/02/2025
  2188                                  
  2189                                  .no_rdtsc_supported:
  2190 000012BA 8DBBE0130000                            lea     edi, [ebx+5088] ; [ebx+$mp3gr_sb_hybrid+$mp3gr_entrysiz*2]
  2191                                                                          ; for ch1 (2nd channel)
  2192 000012C0 8B4B5C                                  mov     ecx, [ebx+92]   ; [ebx+$mp3gr_num_nonzero_hybrids] ; ch0
  2193 000012C3 8B839C130000                            mov     eax, [ebx+5020] ; [ebx+$mp3gr_num_nonzero_hybrids+($mp3gr_entrysiz*2)] ; ch1
  2194 000012C9 39C1                                    cmp     ecx, eax
  2195 000012CB 7702                                    ja      short .this_len
  2196 000012CD 89C1                                    mov     ecx, eax
  2197                                  
  2198                                  .this_len:
  2199 000012CF E320                                    jecxz   .ms_stereo_done
  2200 000012D1 894B5C                                  mov     [ebx+92], ecx   ; [ebx+$mp3gr_num_nonzero_hybrids] ; ch0
  2201 000012D4 898B9C130000                            mov     [ebx+5020], ecx ; [ebx+$mp3gr_num_nonzero_hybrids+($mp3gr_entrysiz*2)] ; ch1
  2202                                  
  2203                                  .ms_stereo_lop:
  2204 000012DA 8B87C0ECFFFF                            mov     eax, [edi-4928] ; for i=0 to 576-1
  2205                                                                          ; [edi+@@ch0]
  2206                                                                          ; @@ch0 equ (-$mp3gr_entrysiz*2) ; granule for channel=0
  2207                                                                          ; tmp0 = granule.ch0.sb_hybrid[i]
  2208 000012E0 8B17                                    mov     edx, [edi]      ; @@ch1 equ 0 ; granule for channel=1
  2209                                                                          ; [edi+@@ch1]
  2210                                                                          ; tmp1 = granule.ch1.sb_hybrid[i]
  2211 000012E2 29D0                                    sub     eax, edx        ; tmp0 - tmp1
  2212 000012E4 8D1450                                  lea     edx, [eax+edx*2] ; tmp0 + tmp1
  2213 000012E7 8997C0ECFFFF                            mov     [edi-4928], edx ; [edi+@@ch0]
  2214                                                                          ; granule.ch0.sb_hybrid[i] = tmp0 + tmp1
  2215 000012ED AB                                      stosd                   ; [edi+@@ch1]
  2216                                                                          ; granule.ch1.sb_hybrid[i] = tmp0 - tmp1
  2217 000012EE 49                                      dec     ecx
  2218 000012EF 75E9                                    jnz     short .ms_stereo_lop
  2219                                  
  2220                                  .ms_stereo_done:
  2221                                  		; 16/02/2025
  2222                                  
  2223                                  .no_rdtsc_supported@:
  2224 000012F1 C3                                      retn
  2225                                  
  2226                                  mp3_compute_i_stereo:
  2227                                  		; 16/02/2025
  2228                                  
  2229                                  .no_rdtsc_supported@@@:
  2230 000012F2 C7435C40020000                          mov     dword [ebx+92], 576 ; ch0
  2231                                                                          ; [ebx+$mp3gr_num_nonzero_hybrids]
  2232 000012F9 C7839C130000400200-                     mov     dword [ebx+5020], 576 ; ch1
  2232 00001302 00                 
  2233                                                                          ; [ebx+$mp3gr_num_nonzero_hybrids+($mp3gr_entrysiz*2)]
  2234 00001303 8B4320                                  mov     eax, [ebx+32]   ; [ebx+$mp3gr_long_end]
  2235 00001306 A3[0C450500]                            mov     [_@@n_long_sfb], eax
  2236 0000130B B80D000000                              mov     eax, 13         ; 39/3
  2237 00001310 2B431C                                  sub     eax, [ebx+28]   ; [ebx+$mp3gr_short_start]
  2238 00001313 8D0440                                  lea     eax, [eax+eax*2] ; mul3
  2239 00001316 A3[10450500]                            mov     [_@@n_short_sfb], eax
  2240 0000131B 0305[0C450500]                          add     eax, [_@@n_long_sfb]
  2241 00001321 A3[14450500]                            mov     [_@@n_sfb], eax ;
  2242                                                                          ; n_sfb = gr->n_long_sfb + gr->n_short_sfb;
  2243 00001326 803D[10450500]00                        cmp     byte [_@@n_short_sfb], 0
  2244 0000132D B801000000                              mov     eax, 1
  2245 00001332 7405                                    jz      short .without_short
  2246 00001334 B803000000                              mov     eax, 3          ; max_blocks = gr->n_short_sfb ? 3 : 1;
  2247                                  
  2248                                  .without_short:
  2249 00001339 A3[D8440500]                            mov     [_@@max_blocks], eax
  2250 0000133E BF[E0440500]                            mov     edi, _@@sfb_array
  2251 00001343 A1[B4C20000]                            mov     eax, [mp3_hdr_sample_rate_index] ; bstab
  2252 00001348 6BC016                                  imul    eax, 22
  2253 0000134B 8DB0[08A50000]                          lea     esi, [mp3_band_size_long+eax]
  2254 00001351 8B0D[0C450500]                          mov     ecx, [_@@n_long_sfb]
  2255 00001357 F3A4                                    rep movsb
  2256 00001359 A1[B4C20000]                            mov     eax, [mp3_hdr_sample_rate_index]
  2257 0000135E 6BC00D                                  imul    eax, 13
  2258 00001361 8DB0[D8A50000]                          lea     esi, [mp3_band_size_short+eax] ; merge lieff-style
  2259 00001367 8B0D[10450500]                          mov     ecx, [_@@n_short_sfb]
  2260 0000136D E30C                                    jecxz   .make_sfb_done ; doing that here is a bit slow,
  2261                                                                          ; it would be better to pre-compute
  2262                                                                          ; all merged-combinations
  2263 0000136F 03731C                                  add     esi, [ebx+28]   ; [ebx+$mp3gr_short_start]
  2264                                  
  2265                                  .make_sfb_lop:
  2266 00001372 AC                                      lodsb
  2267 00001373 AA                                      stosb
  2268 00001374 AA                                      stosb
  2269 00001375 AA                                      stosb
  2270 00001376 83E903                                  sub     ecx, 3
  2271 00001379 75F7                                    jnz     short .make_sfb_lop
  2272                                  
  2273                                  .make_sfb_done:
  2274 0000137B E871000000                              call    _@@find_top_bands ;
  2275                                                                          ; L3_stereo_top_band(left+576,gr->sfbtab,n_sfb,max_band);
  2276 00001380 803D[0C450500]00                        cmp     byte [_@@n_long_sfb], 0
  2277 00001387 7420                                    jz      short .without_long
  2278 00001389 A1[D4440500]                            mov     eax, dword [_@@max_bands]
  2279 0000138E 38C4                                    cmp     ah, al          ; if (gr->n_long_sfb)
  2280 00001390 7F02                                    jg      short .not_max1 ; max_band[0] = max_band[1] = max_band[2] = MINIMP3_MAX
  2281                                                                          ; (MINIMP3_MAX(max_band[0], max_band[1]), max_band[2]);
  2282 00001392 88C4                                    mov     ah, al
  2283                                  
  2284                                  .not_max1:
  2285 00001394 C1E808                                  shr     eax, 8
  2286 00001397 38C4                                    cmp     ah, al
  2287 00001399 7F02                                    jg      short .not_max2
  2288 0000139B 88C4                                    mov     ah, al
  2289                                  
  2290                                  .not_max2:
  2291 0000139D 88E0                                    mov     al, ah
  2292 0000139F C1E008                                  shl     eax, 8
  2293 000013A2 88E0                                    mov     al, ah
  2294 000013A4 A3[D4440500]                            mov     dword [_@@max_bands], eax
  2295                                  
  2296                                  .without_long:
  2297 000013A9 31ED                                    xor     ebp, ebp        ; blk
  2298                                  
  2299                                  .adjust_last_prev_lop:
  2300 000013AB 8B15[14450500]                          mov     edx, [_@@n_sfb]
  2301 000013B1 2B15[D8440500]                          sub     edx, [_@@max_blocks] ; itop = n_sfb - max_blocks + blk
  2302 000013B7 01EA                                    add     edx, ebp
  2303 000013B9 89D1                                    mov     ecx, edx
  2304 000013BB 2B0D[D8440500]                          sub     ecx, [_@@max_blocks] ; prev = itop - max_blocks;
  2305 000013C1 A1[D4C20000]                            mov     eax, [mp3_hdr_flag_lsf]
  2306 000013C6 8D0440                                  lea     eax, [eax+eax*2] ; 0,1 --> 0,3
  2307                                                                          ; default_pos = HDR_TEST_MPEG1(hdr) ? 3
  2308 000013C9 3403                                    xor     al, 3           ; 0,3 --> 3,0
  2309 000013CB 363A8D[D4440500]                        cmp     cl, [ss:_@@max_bands+ebp]
  2310 000013D2 7E07                                    jle     short .use_default_pos ; ist_pos[itop] = max_band[blk] >=
  2311                                                                          ; prev ? default_pos : ist_pos[prev]
  2312 000013D4 8A840BB0130000                          mov     al, [ebx+ecx+5040] ; [ebx+@@right+$mp3gr_scale_factors+ecx]
  2313                                  
  2314                                  .use_default_pos:
  2315 000013DB 888413B0130000                          mov     [ebx+edx+5040], al ; [ebx+@@right+$mp3gr_scale_factors+edx]
  2316 000013E2 45                                      inc     ebp             ; blk
  2317 000013E3 3B2D[D8440500]                          cmp     ebp, [_@@max_blocks]
  2318 000013E9 72C0                                    jb      short .adjust_last_prev_lop
  2319 000013EB E850000000                              call    _@@apply_i_stereo
  2320                                  
  2321                                  		; 16/02/2025
  2322                                  
  2323                                  .no_rdtsc_supported@@@@:
  2324 000013F0 C3                                      retn
  2325                                  
  2326                                  
  2327                                  ; =============== S U B R O U T I N E =======================================
  2328                                  
  2329                                  
  2330                                  _@@find_top_bands:
  2331 000013F1 C705[D4440500]FFFF-                     mov     dword [_@@max_bands], 0FFFFFFh ; set maxband[0..2]=(-1)
  2331 000013F9 FF00               
  2332 000013FB 8DB3E0130000                            lea     esi, [ebx+5088] ; [ebx+@@right+$mp3gr_sb_hybrid]
  2333 00001401 31D2                                    xor     edx, edx
  2334                                  
  2335                                  .find_top_lop_iii:                    
  2336 00001403 31C9                                    xor     ecx, ecx        ; for (i = 0; i < nbands; i++)
  2337                                  
  2338                                  .find_top_lop_kkk:                    
  2339 00001405 8B048E                                  mov     eax, [esi+ecx*4] ; for (k = 0; k < sfb[i]; k += 2)
  2340 00001408 0B448E04                                or      eax, [esi+ecx*4+4]
  2341 0000140C 750D                                    jnz     short .found_nonzero
  2342 0000140E 83C102                                  add     ecx, 2
  2343 00001411 3A8A[E0440500]                          cmp     cl, [_@@sfb_array+edx]
  2344 00001417 72EC                                    jb      short .find_top_lop_kkk
  2345 00001419 EB11                                    jmp     short .find_top_next
  2346                                  
  2347                                  .found_nonzero:
  2348 0000141B 89D0                                    mov     eax, edx
  2349 0000141D F635[B0AE0000]                          div     byte [_@@const_3]
  2350 00001423 0FB6C4                                  movzx   eax, ah         ; remainder (mod 3)
  2351 00001426 8890[D4440500]                          mov     [_@@max_bands+eax], dl ; max_bands[0..2]=i
  2352                                  
  2353                                  .find_top_next:
  2354 0000142C 0FB682[E0440500]                        movzx   eax, byte [_@@sfb_array+edx]
  2355 00001433 8D3486                                  lea     esi, [esi+eax*4]
  2356 00001436 42                                      inc     edx             ; next
  2357 00001437 3B15[14450500]                          cmp     edx, [_@@n_sfb]
  2358 0000143D 72C4                                    jb      short .find_top_lop_iii
  2359 0000143F C3                                      retn
  2360                                  
  2361                                  ; =============== S U B R O U T I N E =======================================
  2362                                  
  2363                                  
  2364                                  _@@apply_i_stereo:
  2365 00001440 B8[C8A80000]                            mov     eax, mp3_is_table_normal
  2366 00001445 B907000000                              mov     ecx, 7
  2367 0000144A 833D[D4C20000]00                        cmp     dword [mp3_hdr_flag_lsf], 0
  2368 00001451 7425                                    jz      short .this_lsf
  2369 00001453 8B8354130000                            mov     eax, [ebx+4948] ; [ebx+@@right+$mp3gr_scalefac_compress]
  2370 00001459 83E001                                  and     eax, 1          ; bit0
  2371 0000145C F705[D0C20000]0200-                     test    dword [mp3_hdr_mode_ext], 2 ; MODE_EXT_MS_STEREO
  2371 00001464 0000               
  2372 00001466 7403                                    jz      short .no_ms
  2373 00001468 83C802                                  or      eax, 2          ; bit1=mul_1.414
  2374                                  
  2375                                  .no_ms:
  2376 0000146B C1E009                                  shl     eax, 9          ; N*40h*2*4
  2377 0000146E 05[8C0C0500]                            add     eax, mp3_is_table_lsf
  2378 00001473 B940000000                              mov     ecx, 64         ; max (must be below NO_INTENSITY_FLAG)
  2379                                  
  2380                                  .this_lsf:
  2381 00001478 890D[DC440500]                          mov     [_@@max_pos], ecx ; 7 or 64
  2382 0000147E A3[08450500]                            mov     [_@@is_tab], eax ; table
  2383 00001483 8DB3A0000000                            lea     esi, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid]
  2384 00001489 31C9                                    xor     ecx, ecx        ; iii ; for (i = 0; sfb[i]; i++)
  2385                                  
  2386                                  .apply_lop_i:
  2387 0000148B 0FB6A9[E0440500]                        movzx   ebp, byte [_@@sfb_array+ecx] ; if ((int)i > max_band[i % 3]
  2388                                                                          ; && ipos < max_pos)
  2389 00001492 89C8                                    mov     eax, ecx
  2390 00001494 F635[B0AE0000]                          div     byte [_@@const_3] ; max_band[i % 3]
  2391 0000149A 0FB6C4                                  movzx   eax, ah         ; remainder (mod 3)
  2392 0000149D 3A88[D4440500]                          cmp     cl, [_@@max_bands+eax] ; iii,max_bands[0..2];
  2393 000014A3 7E38                                    jle     short .apply_ms_stereo
  2394 000014A5 0FB6BC0BB0130000                        movzx   edi, byte [ebx+ecx+5040] ; [ebx+@@right+$mp3gr_scale_factors+ecx]
  2395                                                                          ; @@right = $mp3gr_entrysiz*2 = 4928
  2396                                                                          ; $mp3gr_scale_factors = 112
  2397 000014AD 3B3D[DC440500]                          cmp     edi, [_@@max_pos] ; check ipos
  2398 000014B3 7328                                    jnb     short .apply_ms_stereo
  2399 000014B5 C1E703                                  shl     edi, 3          ; mul 2*4
  2400 000014B8 033D[08450500]                          add     edi, [_@@is_tab]
  2401                                  
  2402                                  .apply_pan_lop:
  2403 000014BE 8B06                                    mov     eax, [esi]      ; tmp = granule.ch0.sb_hybrid
  2404 000014C0 C1E002                                  shl     eax, 2
  2405 000014C3 F76F04                                  imul    dword [edi+4] ; v1
  2406 000014C6 899640130000                            mov     [esi+4928], edx ; [esi+@@right]
  2407                                                                          ; granule.ch1.sb_hybrid = tmp*v1
  2408 000014CC 8B06                                    mov     eax, [esi]      ; tmp = granule.ch0.sb_hybrid
  2409 000014CE C1E002                                  shl     eax, 2
  2410 000014D1 F72F                                    imul    dword [edi] ; v0
  2411 000014D3 8916                                    mov     [esi], edx      ; granule.ch0.sb_hybrid = tmp*v0
  2412 000014D5 83C604                                  add     esi, 4
  2413 000014D8 4D                                      dec     ebp
  2414 000014D9 75E3                                    jnz     short .apply_pan_lop
  2415 000014DB EB2C                                    jmp     short .apply_next
  2416                                  
  2417                                  .apply_ms_stereo:
  2418 000014DD F705[D0C20000]0200-                     test	dword [mp3_hdr_mode_ext], 2 ; MODE_EXT_MS_STEREO
  2418 000014E5 0000               
  2419 000014E7 741D                                    jz	short .apply_none
  2420                                  
  2421                                  .ms_stereo_lop:
  2422 000014E9 8B06                                    mov     eax, [esi]      ; tmp0 = granule.ch0.sb_hybrid[i]
  2423 000014EB 8B9640130000                            mov     edx, [esi+4928] ; [esi+@@right]
  2424                                                                          ; tmp1 = granule.ch1.sb_hybrid[i]
  2425 000014F1 29D0                                    sub     eax, edx        ; tmp0 - tmp1
  2426 000014F3 8D1450                                  lea     edx, [eax+edx*2] ; tmp0 + tmp1
  2427 000014F6 8916                                    mov     [esi], edx      ; granule.ch0.sb_hybrid[i] = tmp0 + tmp1
  2428 000014F8 898640130000                            mov     [esi+4928], eax ; [esi+@@right]
  2429                                                                          ; granule.ch1.sb_hybrid[i] = tmp0 - tmp1
  2430 000014FE 83C604                                  add     esi, 4
  2431 00001501 4D                                      dec     ebp
  2432 00001502 75E5                                    jnz     short .ms_stereo_lop
  2433 00001504 EB03                                    jmp     short .apply_next
  2434                                  
  2435                                  .apply_none:
  2436 00001506 8D34AE                                  lea     esi, [esi+ebp*4] ; skip, keep unchanged
  2437                                  
  2438                                  .apply_next:
  2439 00001509 41                                      inc     ecx             ; iii
  2440 0000150A 3B0D[14450500]                          cmp     ecx, [_@@n_sfb]
  2441 00001510 0F8275FFFFFF                            jb      .apply_lop_i   ; next
  2442 00001516 C3                                      retn
  2443                                  
  2444                                  ; =============== S U B R O U T I N E =======================================
  2445                                  
  2446                                  
  2447                                  mp3_reorder_block:
  2448                                  		; 16/02/2025
  2449                                  
  2450                                  .no_rdtsc_supported:
  2451 00001517 807B2C02                                cmp	byte [ebx+44], 2 ; ebx+$mp3gr_block_type] ; only for type 2
  2452 0000151B 7565                                    jnz	short .no_reorder
  2453 0000151D 8DB3A0000000                            lea	esi, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid] ; ptr+0
  2454 00001523 807B3000                                cmp	byte [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
  2455 00001527 7412                                    jz	short .this_src
  2456 00001529 81C690000000                            add	esi, 144        ; 36*4 ; ptr+36*4
  2457 0000152F 833D[B4C20000]08                        cmp	dword [mp3_hdr_sample_rate_index], 8
  2458 00001536 7503                                    jnz	short .this_src
  2459 00001538 83C630                                  add	esi, 48         ; 12*4 ; additionally to above 36*4 ; ptr+48*4
  2460                                  
  2461                                  .this_src:
  2462 0000153B 8B531C                                  mov     edx, [ebx+28]   ; [ebx+$mp3gr_short_start] ; can be 13
  2463 0000153E 83FA0D                                  cmp     edx, 13
  2464 00001541 733F                                    jnb     short .no_reorder
  2465 00001543 C7435C40020000                          mov     dword [ebx+92], 576 ; [ebx+$mp3gr_num_nonzero_hybrids]
  2466                                  
  2467                                  .outer_lop:
  2468 0000154A A1[B4C20000]                            mov     eax, [mp3_hdr_sample_rate_index]
  2469 0000154F 6BC00D                                  imul    eax, 13         ; X*13
  2470 00001552 0FB68C10[D8A50000]                      movzx   ecx, byte [mp3_band_size_short+eax+edx] ; [X*13+Y]
  2471 0000155A BF[18450500]                            mov     edi, _@@tmp
  2472 0000155F 60                                      pusha
  2473 00001560 89CA                                    mov     edx, ecx        ; step=len (4..44) ; copy LEN*3 dwords to tmp
  2474                                  
  2475                                  .inner_lop:
  2476 00001562 8B06                                    mov     eax, [esi]
  2477 00001564 AB                                      stosd
  2478 00001565 8B0496                                  mov     eax, [esi+edx*4] ; copy 3 dwords
  2479 00001568 AB                                      stosd
  2480 00001569 8B04D6                                  mov     eax, [esi+edx*8]
  2481 0000156C AB                                      stosd
  2482 0000156D 83C604                                  add     esi, 4
  2483 00001570 E2F0                                    loop    .inner_lop
  2484 00001572 61                                      popa
  2485 00001573 8D0C49                                  lea     ecx, [ecx+ecx*2] ; len*3
  2486 00001576 87FE                                    xchg    esi, edi        ; copy LEN*3 dwords back from tmp
  2487 00001578 F3A5                                    rep movsd
  2488 0000157A 87FE                                    xchg    esi, edi
  2489 0000157C 42                                      inc     edx
  2490 0000157D 83FA0D                                  cmp     edx, 13
  2491 00001580 72C8                                    jb      short .outer_lop ; next
  2492                                  
  2493                                  .no_reorder:
  2494                                  		; 16/02/2025
  2495                                  
  2496                                  .no_rdtsc_supported@:
  2497 00001582 C3                                      retn
  2498                                  
  2499                                  
  2500                                  ; =============== S U B R O U T I N E =======================================
  2501                                  
  2502                                  
  2503                                  mp3_compute_antialias:
  2504                                  		; 16/02/2025
  2505                                  
  2506                                  .no_rdtsc_supported:
  2507 00001583 8B435C                                  mov     eax, [ebx+92]   ; [ebx+$mp3gr_num_nonzero_hybrids]
  2508 00001586 83C008                                  add     eax, 8          ; 9-1 ; 0..576+8
  2509 00001589 31D2                                    xor     edx, edx
  2510 0000158B B909000000                              mov     ecx, 9
  2511 00001590 F7F1                                    div     ecx             ; (num/9) ; 0..64
  2512 00001592 894360                                  mov     [ebx+60h], eax
  2513 00001595 D1E8                                    shr     eax, 1          ; (num/18) ; 0..32
  2514 00001597 0F84B8010000                            jz      .no_antialias  ; 0 (when num/9 = 0..1)
  2515 0000159D 89C1                                    mov     ecx, eax        ; 1..32
  2516 0000159F C1E805                                  shr     eax, 5          ; 0..1
  2517 000015A2 29C1                                    sub     ecx, eax        ; 1..31 ; len excluding zeropadding
  2518 000015A4 807B2C02                                cmp     byte [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  2519 000015A8 750F                                    jnz     short .this_len ; antialias only "long" bands
  2520 000015AA 807B3000                                cmp     byte [ebx+48], 0 ; [ebx+$mp3gr_switch_point]
  2521 000015AE 0F84A1010000                            jz      .no_antialias
  2522 000015B4 B901000000                              mov     ecx, 1          ; check this for 8000Hz case
  2523                                  
  2524                                  .this_len:
  2525 000015B9 8D440901                                lea     eax, [1+ecx*2]
  2526 000015BD 394360                                  cmp     [ebx+96], eax   ; [ebx+$mp3gr_num_nonzero_hybrids_div9]
  2527 000015C0 7703                                    ja      short .is_bigger
  2528 000015C2 894360                                  mov     [ebx+96], eax   ; opdate highest
  2529                                                                          ; (nonzero required for l3-si_huff.bit)
  2530                                  
  2531                                  .is_bigger:
  2532 000015C5 53                                      push    ebx
  2533 000015C6 8D9BA0000000                            lea     ebx, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid]
  2534                                  
  2535                                  .lop:
  2536 000015CC 83C348                                  add     ebx, 72         ; 18*4
  2537 000015CF 8B73FC                                  mov     esi, [ebx-4]    ; IRP nn,0,1,2,3,4,5,6,7 ; INT_AA(nn=0..7)
  2538 000015D2 8B3B                                    mov     edi, [ebx]      ; @@def_csa macro nn,cs,ca
  2539                                                                          ;   mp3_csa_&nn&_cs equ cs
  2540                                                                          ;   mp3_csa_&nn&_ca equ ca
  2541                                                                          ;  endm
  2542                                                                          ; constants for mp3_csa_table
  2543 000015D4 C1E602                                  shl     esi, 2          ; tmp0 = ptr[-nn-1]*4
  2544 000015D7 C1E702                                  shl     edi, 2          ; tmp1 = ptr[+nn]*4
  2545 000015DA 8D043E                                  lea     eax, [esi+edi]  ; tmp2 = tmp0+tmp1
  2546 000015DD BD032AE136                              mov     ebp, 36E12A03h  ; @@def_csa 0,36E12A03h,-20ED7F9Ah  ;-0.6
  2547                                                                          ; mp3_csa_&nn&_cs
  2548 000015E2 F7ED                                    imul    ebp             ; tmp2 = (tmp2*csa[0])
  2549 000015E4 89D5                                    mov     ebp, edx
  2550 000015E6 B8635631A8                              mov     eax, -57CEA99Dh ; mp3_csa_&nn&_ca-mp3_csa_&nn&_cs
  2551 000015EB F7EE                                    imul    esi             ; tmp0 = (tmp2+(tmp0*csa[3]))
  2552 000015ED 01EA                                    add     edx, ebp
  2553 000015EF 8913                                    mov     [ebx], edx      ; [ebx+(nn)*4]
  2554 000015F1 B869AAF315                              mov     eax, 15F3AA69h  ; mp3_csa_&nn&_ca+mp3_csa_&nn&_cs
  2555 000015F6 F7EF                                    imul    edi             ; tmp1 = (tmp2-(tmp1*csa[2]))
  2556 000015F8 29D5                                    sub     ebp, edx
  2557 000015FA 896BFC                                  mov     [ebx-4], ebp    ; [ebx-(nn+1)*4]
  2558 000015FD 8B73F8                                  mov     esi, [ebx-8]
  2559 00001600 8B7B04                                  mov     edi, [ebx+4]
  2560 00001603 C1E602                                  shl     esi, 2
  2561 00001606 C1E702                                  shl     edi, 2
  2562 00001609 8D043E                                  lea     eax, [esi+edi]
  2563 0000160C BDFD756E38                              mov     ebp, 386E75FDh  ; @@def_csa 1,386E75FDh,-1E30DB48h  ;-0.535
  2564 00001611 F7ED                                    imul    ebp
  2565 00001613 89D5                                    mov     ebp, edx
  2566 00001615 B8BBAE60A9                              mov     eax, -569F5145h
  2567 0000161A F7EE                                    imul    esi
  2568 0000161C 01EA                                    add     edx, ebp
  2569 0000161E 895304                                  mov     [ebx+4], edx    ; [ebx+(nn)*4]
  2570 00001621 B8B59A3D1A                              mov     eax, 1A3D9AB5h
  2571 00001626 F7EF                                    imul    edi
  2572 00001628 29D5                                    sub     ebp, edx
  2573 0000162A 896BF8                                  mov     [ebx-8], ebp    ; [ebx-(nn+1)*4]
  2574 0000162D 8B73F4                                  mov     esi, [ebx-12]
  2575 00001630 8B7B08                                  mov     edi, [ebx+8]
  2576 00001633 C1E602                                  shl     esi, 2
  2577 00001636 C1E702                                  shl     edi, 2
  2578 00001639 8D043E                                  lea     eax, [esi+edi]
  2579 0000163C BD3EB7C63C                              mov     ebp, 3CC6B73Eh  ;  @@def_csa 2,3CC6B73Eh,-140E604Fh  ;-0.33
  2580 00001641 F7ED                                    imul    ebp
  2581 00001643 89D5                                    mov     ebp, edx
  2582 00001645 B873E82AAF                              mov     eax, -50D5178Dh
  2583 0000164A F7EE                                    imul    esi
  2584 0000164C 01EA                                    add     edx, ebp
  2585 0000164E 895308                                  mov     [ebx+8], edx    ; [ebx+(nn)*4]
  2586 00001651 B8EF56B828                              mov     eax, 28B856EFh
  2587 00001656 F7EF                                    imul    edi
  2588 00001658 29D5                                    sub     ebp, edx
  2589 0000165A 896BF4                                  mov     [ebx-12], ebp   ; [ebx-(nn+1)*4]
  2590 0000165D 8B73F0                                  mov     esi, [ebx-16]
  2591 00001660 8B7B0C                                  mov     edi, [ebx+12]
  2592 00001663 C1E602                                  shl     esi, 2
  2593 00001666 C1E702                                  shl     edi, 2
  2594 00001669 8D043E                                  lea     eax, [esi+edi]
  2595 0000166C BD55A0EE3E                              mov     ebp, 3EEEA055h  ; @@def_csa 3,3EEEA055h,-0BA47742h  ;-0.185
  2596 00001671 F7ED                                    imul    ebp
  2597 00001673 89D5                                    mov     ebp, edx
  2598 00001675 B869E86CB5                              mov     eax, -4A931797h
  2599 0000167A F7EE                                    imul    esi
  2600 0000167C 01EA                                    add     edx, ebp
  2601 0000167E 89530C                                  mov     [ebx+12], edx   ; [ebx+(nn)*4]
  2602 00001681 B813294A33                              mov     eax, 334A2913h
  2603 00001686 F7EF                                    imul    edi
  2604 00001688 29D5                                    sub     ebp, edx
  2605 0000168A 896BF0                                  mov     [ebx-16], ebp   ; [ebx-(nn+1)*4]
  2606 0000168D 8B73EC                                  mov     esi, [ebx-20]   ; ebx-(nn+1)*4] ; tmp0 = ptr[-nn-1]
  2607 00001690 8B7B10                                  mov     edi, [ebx+16]   ; [ebx+(nn)*4] ; tmp1 = ptr[+nn]
  2608 00001693 C1E602                                  shl     esi, 2
  2609 00001696 C1E702                                  shl     edi, 2
  2610 00001699 8D043E                                  lea     eax, [esi+edi]  ; tmp2 = tmp0+tmp1
  2611 0000169C BD5C90B63F                              mov     ebp, 3FB6905Ch  ; @@def_csa 4,3FB6905Ch,-060D80E9h  ;-0.095
  2612 000016A1 F7ED                                    imul    ebp             ; tmp2 = (tmp2*csa[0])
  2613 000016A3 89D5                                    mov     ebp, edx
  2614 000016A5 B8BBEE3BBA                              mov     eax, -45C41145h
  2615 000016AA F7EE                                    imul    esi             ; tmp0 = (tmp2+(tmp0*csa[3]))
  2616 000016AC 01EA                                    add     edx, ebp
  2617 000016AE 895310                                  mov     [ebx+16], edx   ; [ebx+(nn)*4]
  2618 000016B1 B8730FA939                              mov     eax, 39A90F73h
  2619 000016B6 F7EF                                    imul    edi             ; tmp1 = (tmp2-(tmp1*csa[2]))
  2620 000016B8 29D5                                    sub     ebp, edx
  2621 000016BA 896BEC                                  mov     [ebx-20], ebp   ; [ebx-(nn+1)*4]
  2622 000016BD 8B73E8                                  mov     esi, [ebx-24]
  2623 000016C0 8B7B14                                  mov     edi, [ebx+20]
  2624 000016C3 C1E602                                  shl     esi, 2
  2625 000016C6 C1E702                                  shl     edi, 2
  2626 000016C9 8D043E                                  lea     eax, [esi+edi]
  2627 000016CC BD213FF23F                              mov     ebp, 3FF23F21h  ; @@def_csa 5,3FF23F21h,-029F2E1Bh  ;-0.041
  2628 000016D1 F7ED                                    imul    ebp
  2629 000016D3 89D5                                    mov     ebp, edx
  2630 000016D5 B8C4926EBD                              mov     eax, -42916D3Ch
  2631 000016DA F7EE                                    imul    esi
  2632 000016DC 01EA                                    add     edx, ebp
  2633 000016DE 895314                                  mov     [ebx+20], edx   ; [ebx+(nn)*4]
  2634 000016E1 B80611533D                              mov     eax, 3D531106h
  2635 000016E6 F7EF                                    imul    edi
  2636 000016E8 29D5                                    sub     ebp, edx
  2637 000016EA 896BE8                                  mov     [ebx-24], ebp   ; [ebx-(nn+1)*4]
  2638 000016ED 8B73E4                                  mov     esi, [ebx-28]
  2639 000016F0 8B7B18                                  mov     edi, [ebx+24]
  2640 000016F3 C1E602                                  shl     esi, 2
  2641 000016F6 C1E702                                  shl     edi, 2
  2642 000016F9 8D043E                                  lea     eax, [esi+edi]
  2643 000016FC BD3259FE3F                              mov     ebp, 3FFE5932h  ; @@def_csa 6,3FFE5932h,-00E8A11Ch  ;-0.0142
  2644 00001701 F7ED                                    imul    ebp
  2645 00001703 89D5                                    mov     ebp, edx
  2646 00001705 B8B20519BF                              mov     eax, -40E6FA4Eh
  2647 0000170A F7EE                                    imul    esi
  2648 0000170C 01EA                                    add     edx, ebp
  2649 0000170E 895318                                  mov     [ebx+24], edx   ; [ebx+(nn)*4]
  2650 00001711 B816B8153F                              mov     eax, 3F15B816h
  2651 00001716 F7EF                                    imul    edi
  2652 00001718 29D5                                    sub     ebp, edx
  2653 0000171A 896BE4                                  mov     [ebx-28], ebp   ; [ebx-(nn+1)*4]
  2654 0000171D 8B73E0                                  mov     esi, [ebx-32]
  2655 00001720 8B7B1C                                  mov     edi, [ebx+28]
  2656 00001723 C1E602                                  shl     esi, 2
  2657 00001726 C1E702                                  shl     edi, 2
  2658 00001729 8D043E                                  lea     eax, [esi+edi]
  2659 0000172C BD4BE3FF3F                              mov     ebp, 3FFFE34Bh  ; @@def_csa 7,3FFFE34Bh,-003C9ED1h  ;-0.0037
  2660 00001731 F7ED                                    imul    ebp
  2661 00001733 89D5                                    mov     ebp, edx
  2662 00001735 B8E47DC3BF                              mov     eax, -403C821Ch
  2663 0000173A F7EE                                    imul    esi
  2664 0000173C 01EA                                    add     edx, ebp
  2665 0000173E 89531C                                  mov     [ebx+28], edx   ; [ebx+(nn)*4]
  2666 00001741 B87A44C33F                              mov     eax, 3FC3447Ah
  2667 00001746 F7EF                                    imul    edi
  2668 00001748 29D5                                    sub     ebp, edx
  2669 0000174A 896BE0                                  mov     [ebx-32], ebp   ; [ebx-(nn+1)*4]
  2670 0000174D 49                                      dec     ecx
  2671 0000174E 0F8578FEFFFF                            jnz     .lop
  2672 00001754 5B                                      pop     ebx
  2673                                  
  2674                                  .no_antialias:
  2675                                  		; 16/02/2025
  2676                                  
  2677                                  .no_rdtsc_supported@:
  2678 00001755 C3                                      retn
  2679                                  
  2680                                  
  2681                                  ; =============== S U B R O U T I N E =======================================
  2682                                  
  2683                                  
  2684                                  mp3_imdct36:
  2685 00001756 8B06                                    mov     eax, [esi]      ; in: esi=src (sb_hybrid)
  2686                                                                          ; in: edi=dst (sb_samples)
  2687                                                                          ; in: ebx=buf (mdct_buf)
  2688                                                                          ; in: ebp=win (mdct_win)
  2689                                                                          ;
  2690                                                                          ; [esi+0*4]
  2691 00001758 8B5604                                  mov     edx, [esi+4]    ; IRP i,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17
  2692 0000175B 01D0                                    add     eax, edx        ; IF i AND 1 (*) ; mov edx,[esi+i*4] ; val[i]
  2693                                                                          ;  add val[i-1]
  2694 0000175D 894604                                  mov     [esi+4], eax    ;  IF i GT 1
  2695                                                                          ;   add  ecx,eax ; add val[i-2]
  2696                                                                          ;   mov  [esi+(i)*4],ecx
  2697                                                                          ;  ELSE
  2698                                                                          ;   mov  [esi+(i)*4],eax
  2699 00001760 89C1                                    mov     ecx, eax        ;  memorize as val[i-2]
  2700 00001762 8B4608                                  mov     eax, [esi+8]    ; ELSE (*) ; [esi+i*4] ; val[i]
  2701 00001765 01C2                                    add     edx, eax        ;  add val[i-1]
  2702 00001767 895608                                  mov     [esi+8], edx    ; [esi+(i)*4
  2703 0000176A 8B560C                                  mov     edx, [esi+12]
  2704 0000176D 01D0                                    add     eax, edx
  2705 0000176F 01C1                                    add     ecx, eax
  2706 00001771 894E0C                                  mov     [esi+12], ecx
  2707 00001774 89C1                                    mov     ecx, eax
  2708 00001776 8B4610                                  mov     eax, [esi+16]
  2709 00001779 01C2                                    add     edx, eax
  2710 0000177B 895610                                  mov     [esi+16], edx
  2711 0000177E 8B5614                                  mov     edx, [esi+20]
  2712 00001781 01D0                                    add     eax, edx
  2713 00001783 01C1                                    add     ecx, eax
  2714 00001785 894E14                                  mov     [esi+20], ecx
  2715 00001788 89C1                                    mov     ecx, eax
  2716 0000178A 8B4618                                  mov     eax, [esi+24]
  2717 0000178D 01C2                                    add     edx, eax
  2718 0000178F 895618                                  mov     [esi+24], edx
  2719 00001792 8B561C                                  mov     edx, [esi+28]
  2720 00001795 01D0                                    add     eax, edx
  2721 00001797 01C1                                    add     ecx, eax
  2722 00001799 894E1C                                  mov     [esi+28], ecx
  2723 0000179C 89C1                                    mov     ecx, eax
  2724 0000179E 8B4620                                  mov     eax, [esi+32]
  2725 000017A1 01C2                                    add     edx, eax
  2726 000017A3 895620                                  mov     [esi+32], edx
  2727 000017A6 8B5624                                  mov     edx, [esi+36]
  2728 000017A9 01D0                                    add     eax, edx
  2729 000017AB 01C1                                    add     ecx, eax
  2730 000017AD 894E24                                  mov     [esi+36], ecx
  2731 000017B0 89C1                                    mov     ecx, eax
  2732 000017B2 8B4628                                  mov     eax, [esi+40]
  2733 000017B5 01C2                                    add     edx, eax
  2734 000017B7 895628                                  mov     [esi+40], edx
  2735 000017BA 8B562C                                  mov     edx, [esi+44]
  2736 000017BD 01D0                                    add     eax, edx
  2737 000017BF 01C1                                    add     ecx, eax
  2738 000017C1 894E2C                                  mov     [esi+44], ecx
  2739 000017C4 89C1                                    mov     ecx, eax
  2740 000017C6 8B4630                                  mov     eax, [esi+48]
  2741 000017C9 01C2                                    add     edx, eax
  2742 000017CB 895630                                  mov     [esi+48], edx
  2743 000017CE 8B5634                                  mov     edx, [esi+52]
  2744 000017D1 01D0                                    add     eax, edx
  2745 000017D3 01C1                                    add     ecx, eax
  2746 000017D5 894E34                                  mov     [esi+52], ecx
  2747 000017D8 89C1                                    mov     ecx, eax
  2748 000017DA 8B4638                                  mov     eax, [esi+56]
  2749 000017DD 01C2                                    add     edx, eax
  2750 000017DF 895638                                  mov     [esi+56], edx
  2751 000017E2 8B563C                                  mov     edx, [esi+60]
  2752 000017E5 01D0                                    add     eax, edx
  2753 000017E7 01C1                                    add     ecx, eax
  2754 000017E9 894E3C                                  mov     [esi+60], ecx
  2755 000017EC 89C1                                    mov     ecx, eax
  2756 000017EE 8B4640                                  mov     eax, [esi+64]
  2757 000017F1 01C2                                    add     edx, eax
  2758 000017F3 895640                                  mov     [esi+64], edx
  2759 000017F6 8B5644                                  mov     edx, [esi+68]
  2760 000017F9 01D0                                    add     eax, edx
  2761 000017FB 01C1                                    add     ecx, eax
  2762 000017FD 894E44                                  mov     [esi+68], ecx
  2763 00001800 89C1                                    mov     ecx, eax
  2764 00001802 53                                      push    ebx
  2765 00001803 55                                      push    ebp
  2766 00001804 57                                      push    edi
  2767 00001805 8B0E                                    mov     ecx, [esi]      ; IRP j,0,1
  2768 00001807 8B5E30                                  mov     ebx, [esi+48]   ; t1 = [esi+(0*2+j)*4], t0 = [esi+(6*2+j)*4]
  2769 0000180A 8B7E20                                  mov     edi, [esi+32]   ; t2 = [esi+(4*2+j)*4]
  2770 0000180D 037E40                                  add     edi, [esi+64]   ; + [esi+(8*2+j)*4]
  2771 00001810 2B7E10                                  sub     edi, [esi+16]   ; - [esi+(2*2+j)*4]
  2772 00001813 8D2C4B                                  lea     ebp, [ebx+ecx*2] ; t2 = src[4*2+j] + src[8*2+j] - src[2*2+j]
  2773                                                                          ; t3 = [t1*2+t0]
  2774 00001816 D1FD                                    sar     ebp, 1          ; sar @@t3,1
  2775 00001818 29D9                                    sub     ecx, ebx        ; sub @@t1,@@t0
  2776 0000181A 89C8                                    mov     eax, ecx        ; @@SUM [@@tmp+(16+j)*4],@@t1,add,@@t2
  2777 0000181C 01F8                                    add     eax, edi
  2778 0000181E A3[644E0500]                            mov     [_@@@tmp+40h], eax ; [@@tmp+(16+j)*4]
  2779 00001823 D1FF                                    sar     edi, 1          ; sar @@t2,1
  2780 00001825 89C8                                    mov     eax, ecx        ; @@SUM [@@tmp+(6+j)*4],@@t1,sub,@@t2
  2781 00001827 29F8                                    sub     eax, edi
  2782 00001829 A3[3C4E0500]                            mov     [_@@@tmp+18h], eax ; [@@tmp+(6+j)*4]
  2783 0000182E 8B4610                                  mov     eax, [esi+16]   ; [esi+(4*2+j)*4]
  2784 00001831 034620                                  add     eax, [esi+32]   ; [esi+(2*2+j)*4]
  2785 00001834 D1E0                                    shl     eax, 1
  2786 00001836 BA0AD94778                              mov     edx, 7847D90Ah  ; C2
  2787 0000183B F7EA                                    imul    edx
  2788 0000183D 89D3                                    mov     ebx, edx
  2789 0000183F 8B4620                                  mov     eax, [esi+32]
  2790 00001842 2B4640                                  sub     eax, [esi+64]
  2791 00001845 BA04CB8BD3                              mov     edx, 0D38BCB04h ; negC8
  2792 0000184A F7EA                                    imul    edx
  2793 0000184C 89D1                                    mov     ecx, edx
  2794 0000184E 8B4610                                  mov     eax, [esi+16]
  2795 00001851 034640                                  add     eax, [esi+64]
  2796 00001854 D1E0                                    shl     eax, 1
  2797 00001856 BA7541F29D                              mov     edx, 9DF24175h  ; negC4
  2798 0000185B F7EA                                    imul    edx
  2799 0000185D 89E8                                    mov     eax, ebp
  2800 0000185F 01D8                                    add     eax, ebx
  2801 00001861 01C8                                    add     eax, ecx
  2802 00001863 A3[2C4E0500]                            mov     [_@@@tmp+8], eax
  2803 00001868 89E8                                    mov     eax, ebp
  2804 0000186A 29D8                                    sub     eax, ebx
  2805 0000186C 29D0                                    sub     eax, edx
  2806 0000186E A3[4C4E0500]                            mov     [_@@@tmp+28h], eax
  2807 00001873 89E8                                    mov     eax, ebp
  2808 00001875 01D0                                    add     eax, edx
  2809 00001877 29C8                                    sub     eax, ecx
  2810 00001879 A3[5C4E0500]                            mov     [_@@@tmp+38h], eax
  2811 0000187E 8B4628                                  mov     eax, [esi+40]
  2812 00001881 034638                                  add     eax, [esi+56]
  2813 00001884 2B4608                                  sub     eax, [esi+8]
  2814 00001887 D1E0                                    shl     eax, 1
  2815 00001889 BA5F142691                              mov     edx, 9126145Fh  ; negC3
  2816 0000188E F7EA                                    imul    edx
  2817 00001890 8915[344E0500]                          mov     [_@@@tmp+10h], edx
  2818 00001896 8B4608                                  mov     eax, [esi+8]
  2819 00001899 034628                                  add     eax, [esi+40]
  2820 0000189C D1E0                                    shl     eax, 1
  2821 0000189E BA332E0E7E                              mov     edx, 7E0E2E33h  ; C1
  2822 000018A3 F7EA                                    imul    edx
  2823 000018A5 89D7                                    mov     edi, edx
  2824 000018A7 8B4628                                  mov     eax, [esi+40]
  2825 000018AA 2B4638                                  sub     eax, [esi+56]
  2826 000018AD BA2E5E71A8                              mov     edx, 0A8715E2Eh ; negC7
  2827 000018B2 F7EA                                    imul    edx
  2828 000018B4 89D5                                    mov     ebp, edx
  2829 000018B6 8B4608                                  mov     eax, [esi+8]
  2830 000018B9 034638                                  add     eax, [esi+56]
  2831 000018BC D1E0                                    shl     eax, 1
  2832 000018BE BAB822B9AD                              mov     edx, 0ADB922B8h ; negC5
  2833 000018C3 F7EA                                    imul    edx
  2834 000018C5 89D1                                    mov     ecx, edx
  2835 000018C7 8B4618                                  mov     eax, [esi+24]
  2836 000018CA D1E0                                    shl     eax, 1
  2837 000018CC BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  2838 000018D1 F7EA                                    imul    edx
  2839 000018D3 89E8                                    mov     eax, ebp
  2840 000018D5 01F8                                    add     eax, edi
  2841 000018D7 01D0                                    add     eax, edx
  2842 000018D9 A3[244E0500]                            mov     [_@@@tmp], eax
  2843 000018DE 89E8                                    mov     eax, ebp
  2844 000018E0 29C8                                    sub     eax, ecx
  2845 000018E2 29D0                                    sub     eax, edx
  2846 000018E4 A3[444E0500]                            mov     [_@@@tmp+20h], eax
  2847 000018E9 89F8                                    mov     eax, edi
  2848 000018EB 01C8                                    add     eax, ecx
  2849 000018ED 29D0                                    sub     eax, edx
  2850 000018EF A3[544E0500]                            mov     [_@@@tmp+30h], eax
  2851 000018F4 8B4E04                                  mov     ecx, [esi+4]
  2852 000018F7 8B5E34                                  mov     ebx, [esi+52]
  2853 000018FA 8B7E24                                  mov     edi, [esi+36]
  2854 000018FD 037E44                                  add     edi, [esi+68]
  2855 00001900 2B7E14                                  sub     edi, [esi+20]
  2856 00001903 8D2C4B                                  lea     ebp, [ebx+ecx*2]
  2857 00001906 D1FD                                    sar     ebp, 1
  2858 00001908 29D9                                    sub     ecx, ebx
  2859 0000190A 89C8                                    mov     eax, ecx
  2860 0000190C 01F8                                    add     eax, edi
  2861 0000190E A3[684E0500]                            mov     [_@@@tmp+44h], eax
  2862 00001913 D1FF                                    sar     edi, 1
  2863 00001915 89C8                                    mov     eax, ecx
  2864 00001917 29F8                                    sub     eax, edi
  2865 00001919 A3[404E0500]                            mov     [_@@@tmp+1Ch], eax
  2866 0000191E 8B4614                                  mov     eax, [esi+20]   ; t0 = MULH(2*(src[2*2+j]+src[4*2+j]),C2)
  2867 00001921 034624                                  add     eax, [esi+36]
  2868 00001924 D1E0                                    shl     eax, 1
  2869 00001926 BA0AD94778                              mov     edx, 7847D90Ah  ; C2
  2870 0000192B F7EA                                    imul    edx
  2871 0000192D 89D3                                    mov     ebx, edx
  2872 0000192F 8B4624                                  mov     eax, [esi+36]   ; t1 = MULH(src[4*2+j]-src[8*2+j],negC8)
  2873 00001932 2B4644                                  sub     eax, [esi+68]
  2874 00001935 BA04CB8BD3                              mov     edx, 0D38BCB04h ; negC8
  2875 0000193A F7EA                                    imul    edx
  2876 0000193C 89D1                                    mov     ecx, edx
  2877 0000193E 8B4614                                  mov     eax, [esi+20]   ; t2 = MULH(2*(src[2*2+j]+src[8*2+j]),negC4)
  2878 00001941 034644                                  add     eax, [esi+68]
  2879 00001944 D1E0                                    shl     eax, 1
  2880 00001946 BA7541F29D                              mov     edx, 9DF24175h  ; negC4
  2881 0000194B F7EA                                    imul    edx
  2882 0000194D 89E8                                    mov     eax, ebp        ; tmp[2+j] = t3+t0+t1
  2883 0000194F 01D8                                    add     eax, ebx
  2884 00001951 01C8                                    add     eax, ecx
  2885 00001953 A3[304E0500]                            mov     [_@@@tmp+0Ch], eax
  2886 00001958 89E8                                    mov     eax, ebp        ; tmp[10+j] = t3-t0-t2
  2887 0000195A 29D8                                    sub     eax, ebx
  2888 0000195C 29D0                                    sub     eax, edx
  2889 0000195E A3[504E0500]                            mov     [_@@@tmp+2Ch], eax
  2890 00001963 89E8                                    mov     eax, ebp        ; tmp[14+j] = t3+t2-t1
  2891 00001965 01D0                                    add     eax, edx
  2892 00001967 29C8                                    sub     eax, ecx
  2893 00001969 A3[604E0500]                            mov     [_@@@tmp+3Ch], eax
  2894 0000196E 8B462C                                  mov     eax, [esi+44]   ; tmp[4+j] = MULH(2*(src[5*2+j]+src[7*2+j]-src[1*2+j]),negC3)
  2895 00001971 03463C                                  add     eax, [esi+60]
  2896 00001974 2B460C                                  sub     eax, [esi+12]
  2897 00001977 D1E0                                    shl     eax, 1
  2898 00001979 BA5F142691                              mov     edx, 9126145Fh  ; negC3
  2899 0000197E F7EA                                    imul    edx
  2900 00001980 8915[384E0500]                          mov     [_@@@tmp+14h], edx
  2901 00001986 8B460C                                  mov     eax, [esi+12]   ; @@MULH @@t2,[esi+(1*2+j)*4],add,[esi+(5*2+j)*4],-,-              ,1,C1,-
  2902                                                                          ; t2 = MULH(2*(src[1*2+j],add,src[5*2+j]),-,-,1,C1)
  2903 00001989 03462C                                  add     eax, [esi+44]
  2904 0000198C D1E0                                    shl     eax, 1
  2905 0000198E BA332E0E7E                              mov     edx, 7E0E2E33h  ; C1
  2906 00001993 F7EA                                    imul    edx
  2907 00001995 89D7                                    mov     edi, edx
  2908 00001997 8B462C                                  mov     eax, [esi+44]   ; @@MULH @@t3,[esi+(5*2+j)*4],sub,[esi+(7*2+j)*4],-,-,
  2909                                                                          ; ,0,negC7,-
  2910                                                                          ;
  2911                                                                          ; t3 = MULH( src[5*2+j],sub,src[7*2+j],-,-,0,negC7)
  2912 0000199A 2B463C                                  sub     eax, [esi+60]
  2913 0000199D BA2E5E71A8                              mov     edx, 0A8715E2Eh ; negC7
  2914 000019A2 F7EA                                    imul    edx
  2915 000019A4 89D5                                    mov     ebp, edx
  2916 000019A6 8B460C                                  mov     eax, [esi+12]   ; t1 = MULH(2*(src[1*2+j],add,src[7*2+j]),-,-,1,negC5)
  2917 000019A9 03463C                                  add     eax, [esi+60]
  2918 000019AC D1E0                                    shl     eax, 1          ; shift = 1
  2919 000019AE BAB822B9AD                              mov     edx, 0ADB922B8h ; negC5
  2920 000019B3 F7EA                                    imul    edx
  2921 000019B5 89D1                                    mov     ecx, edx
  2922 000019B7 8B461C                                  mov     eax, [esi+28]   ; t0 = MULH(2*src[3*2+j],-,-,-,-,1,C3)
  2923 000019BA D1E0                                    shl     eax, 1
  2924 000019BC BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  2925 000019C1 F7EA                                    imul    edx
  2926 000019C3 89E8                                    mov     eax, ebp
  2927 000019C5 01F8                                    add     eax, edi
  2928 000019C7 01D0                                    add     eax, edx
  2929 000019C9 A3[284E0500]                            mov     [_@@@tmp+4], eax
  2930 000019CE 89E8                                    mov     eax, ebp
  2931 000019D0 29C8                                    sub     eax, ecx
  2932 000019D2 29D0                                    sub     eax, edx
  2933 000019D4 A3[484E0500]                            mov     [_@@@tmp+24h], eax
  2934 000019D9 89F8                                    mov     eax, edi        ; @@SUM [@@tmp+(12+j)*4],@@t2,add,@@t1,sub,edx
  2935 000019DB 01C8                                    add     eax, ecx
  2936 000019DD 29D0                                    sub     eax, edx
  2937 000019DF A3[584E0500]                            mov     [_@@@tmp+34h], eax
  2938 000019E4 5F                                      pop     edi
  2939 000019E5 5D                                      pop     ebp
  2940 000019E6 5B                                      pop     ebx
  2941 000019E7 56                                      push    esi             ; IRP j,0,1,2,3 ; j = 0
  2942 000019E8 8B15[244E0500]                          mov     edx, [_@@@tmp] ; t0 = [@@tmp+(j*4+0)*4]
  2943 000019EE 8B35[284E0500]                          mov     esi, [_@@@tmp+4] ; t1 = [@@tmp+(j*4+1)*4]
  2944 000019F4 A1[2C4E0500]                            mov     eax, [_@@@tmp+8] ; t2 = [@@tmp+(j*4+2)*4]
  2945 000019F9 8B0D[304E0500]                          mov     ecx, [_@@@tmp+0Ch] ; t2 = [@@tmp+(j*4+3)*4]
  2946 000019FF 29D0                                    sub     eax, edx        ; s2 = t2 - t0
  2947 00001A01 8D1450                                  lea     edx, [eax+edx*2] ; s0 = t2 + t0
  2948 00001A04 A3[1C4E0500]                            mov     [_@@s2], eax ; @@MULH esi,eax ,-,-,-,-,1,icos36h_&j,-
  2949                                                                          ; s2 = MULH(s2*2, icos36h[j])
  2950 00001A09 8915[184E0500]                          mov     [_@@s0], edx
  2951 00001A0F 29F1                                    sub     ecx, esi
  2952 00001A11 8D0471                                  lea     eax, [ecx+esi*2]
  2953 00001A14 D1E0                                    shl     eax, 1
  2954 00001A16 BA90953E40                              mov     edx, 403E9590h  ; icos36h_0
  2955 00001A1B F7EA                                    imul    edx
  2956 00001A1D 89D6                                    mov     esi, edx
  2957 00001A1F 89C8                                    mov     eax, ecx        ; @@MULH @@s3,ecx,-,-,-,-,shift_for_8minus&j,icos36h_8minus&j,-
  2958                                                                          ; s3 = MULL(s3,icos36[8-j]) ; <-- "MULL" with "icos36"
  2959 00001A21 C1E004                                  shl     eax, 4
  2960 00001A24 BA2C2ACA5B                              mov     edx, 5BCA2A2Ch  ; icos36h_8 (8-0)
  2961 00001A29 F7EA                                    imul    edx
  2962 00001A2B 8915[204E0500]                          mov     [_@@s3], edx
  2963 00001A31 8B0D[184E0500]                          mov     ecx, [_@@s0]
  2964 00001A37 29F1                                    sub     ecx, esi
  2965 00001A39 8D3471                                  lea     esi, [ecx+esi*2]
  2966 00001A3C 8B4524                                  mov     eax, [ebp+36]   ; @@MULH [edi+(9+j)*SBLIMIT*4],[ebp+(9+j)*4],
  2967                                                                          ; -,-,-,-,0,ecx,[ebx+(9+j)*4]
  2968                                                                          ; out[(9+j)*SBLIMIT] = MULH(t0, win[9+j])+buf[9+j]
  2969 00001A3F F7E9                                    imul    ecx
  2970 00001A41 035324                                  add     edx, [ebx+36]   ; [ebx+(9+j)*4]
  2971 00001A44 899780040000                            mov     [edi+1152], edx ; SBLIMIT=32 ; 9*SBLIMIT*4 = 1152
  2972 00001A4A 8B4520                                  mov     eax, [ebp+32]   ; @@MULH [edi+(8-j)*SBLIMIT*4],[ebp+(8-j)*4]
  2973                                                                          ; ,-,-,-,-,0,ecx,[ebx+(8-j)*4]
  2974 00001A4D F7E9                                    imul    ecx
  2975 00001A4F 035320                                  add     edx, [ebx+32]
  2976 00001A52 899700040000                            mov     [edi+1024], edx ; SBLIMIT=32 ; 8*SBLIMIT*4 = 1024
  2977 00001A58 8B456C                                  mov     eax, [ebp+108]
  2978 00001A5B F7EE                                    imul    esi
  2979 00001A5D 895324                                  mov     [ebx+36], edx
  2980 00001A60 8B4568                                  mov     eax, [ebp+104]  ; @@MULH [ebx+(8-j)*4],[ebp+(8-j+18)*4],-,-,-,-,0,esi,-
  2981 00001A63 F7EE                                    imul    esi
  2982 00001A65 895320                                  mov     [ebx+32], edx
  2983 00001A68 8B0D[1C4E0500]                          mov     ecx, [_@@s2]
  2984 00001A6E 8B35[204E0500]                          mov     esi, [_@@s3]
  2985 00001A74 29F1                                    sub     ecx, esi        ; t2 = s2 - s3
  2986 00001A76 8D3471                                  lea     esi, [ecx+esi*2] ; t3 = s2 + s3
  2987 00001A79 8B4500                                  mov     eax, [ebp+0]    ; @@MULH [edi+(0+j)*SBLIMIT*4],[ebp+(0+j)*4],
  2988                                                                          ; -,-,-,-,0,ecx,[ebx+(0+j)*4]
  2989 00001A7C F7E9                                    imul    ecx
  2990 00001A7E 0313                                    add     edx, [ebx]
  2991 00001A80 8917                                    mov     [edi], edx
  2992 00001A82 8B4544                                  mov     eax, [ebp+68]   ; @@MULH [edi+(17-j)*SBLIMIT*4],[ebp+(17-j)*4]
  2993                                                                          ; ,-,-,-,-,0,ecx,[ebx+(17-j)*4]
  2994 00001A85 F7E9                                    imul    ecx
  2995 00001A87 035344                                  add     edx, [ebx+68]
  2996 00001A8A 899780080000                            mov     [edi+2176], edx ; 17*SBLIMIT*4 = 2176
  2997 00001A90 8B4548                                  mov     eax, [ebp+72]   ; @@MULH [ebx+(0+j)*4],[ebp+(0+j+18)*4],-,-,-,-,0,esi,-
  2998 00001A93 F7EE                                    imul    esi
  2999 00001A95 8913                                    mov     [ebx], edx
  3000 00001A97 8B858C000000                            mov     eax, [ebp+140]  ; @@MULH [ebx+(17-j)*4],[ebp+(17-j+18)*4],-,-,-,-,0,esi,-
  3001 00001A9D F7EE                                    imul    esi
  3002 00001A9F 895344                                  mov     [ebx+68], edx
  3003 00001AA2 8B15[344E0500]                          mov     edx, [_@@@tmp+10h] ; IRP j,0,1,2,3 ; j = 1
  3004 00001AA8 8B35[384E0500]                          mov     esi, [_@@@tmp+14h]
  3005 00001AAE A1[3C4E0500]                            mov     eax, [_@@@tmp+18h]
  3006 00001AB3 8B0D[404E0500]                          mov     ecx, [_@@@tmp+1Ch]
  3007 00001AB9 29D0                                    sub     eax, edx
  3008 00001ABB 8D1450                                  lea     edx, [eax+edx*2]
  3009 00001ABE A3[1C4E0500]                            mov     [_@@s2], eax
  3010 00001AC3 8915[184E0500]                          mov     [_@@s0], edx
  3011 00001AC9 29F1                                    sub     ecx, esi
  3012 00001ACB 8D0471                                  lea     eax, [ecx+esi*2]
  3013 00001ACE D1E0                                    shl     eax, 1
  3014 00001AD0 BA07F74142                              mov     edx, 4241F707h  ; icos36h_1
  3015 00001AD5 F7EA                                    imul    edx
  3016 00001AD7 89D6                                    mov     esi, edx
  3017 00001AD9 89C8                                    mov     eax, ecx
  3018 00001ADB C1E002                                  shl     eax, 2
  3019 00001ADE BA1E75A37B                              mov     edx, 7BA3751Eh  ; icos36h_7 (8-1)
  3020 00001AE3 F7EA                                    imul    edx
  3021 00001AE5 8915[204E0500]                          mov     [_@@s3], edx
  3022 00001AEB 8B0D[184E0500]                          mov     ecx, [_@@s0]
  3023 00001AF1 29F1                                    sub     ecx, esi
  3024 00001AF3 8D3471                                  lea     esi, [ecx+esi*2]
  3025 00001AF6 8B4528                                  mov     eax, [ebp+40]
  3026 00001AF9 F7E9                                    imul    ecx
  3027 00001AFB 035328                                  add     edx, [ebx+40]
  3028 00001AFE 899700050000                            mov     [edi+1280], edx
  3029 00001B04 8B451C                                  mov     eax, [ebp+28]
  3030 00001B07 F7E9                                    imul    ecx
  3031 00001B09 03531C                                  add     edx, [ebx+28]
  3032 00001B0C 899780030000                            mov     [edi+896], edx
  3033 00001B12 8B4570                                  mov     eax, [ebp+112]
  3034 00001B15 F7EE                                    imul    esi
  3035 00001B17 895328                                  mov     [ebx+40], edx
  3036 00001B1A 8B4564                                  mov     eax, [ebp+100]
  3037 00001B1D F7EE                                    imul    esi
  3038 00001B1F 89531C                                  mov     [ebx+28], edx
  3039 00001B22 8B0D[1C4E0500]                          mov     ecx, [_@@s2]
  3040 00001B28 8B35[204E0500]                          mov     esi, [_@@s3]
  3041 00001B2E 29F1                                    sub     ecx, esi
  3042 00001B30 8D3471                                  lea     esi, [ecx+esi*2]
  3043 00001B33 8B4504                                  mov     eax, [ebp+4]
  3044 00001B36 F7E9                                    imul    ecx
  3045 00001B38 035304                                  add     edx, [ebx+4]
  3046 00001B3B 899780000000                            mov     [edi+128], edx
  3047 00001B41 8B4540                                  mov     eax, [ebp+64]
  3048 00001B44 F7E9                                    imul    ecx
  3049 00001B46 035340                                  add     edx, [ebx+64]
  3050 00001B49 899700080000                            mov     [edi+2048], edx
  3051 00001B4F 8B454C                                  mov     eax, [ebp+76]
  3052 00001B52 F7EE                                    imul    esi
  3053 00001B54 895304                                  mov     [ebx+4], edx
  3054 00001B57 8B8588000000                            mov     eax, [ebp+136]
  3055 00001B5D F7EE                                    imul    esi
  3056 00001B5F 895340                                  mov     [ebx+64], edx
  3057 00001B62 8B15[444E0500]                          mov     edx, [_@@@tmp+20h] ; IRP j,0,1,2,3 ; j = 2
  3058 00001B68 8B35[484E0500]                          mov     esi, [_@@@tmp+24h]
  3059 00001B6E A1[4C4E0500]                            mov     eax, [_@@@tmp+28h]
  3060 00001B73 8B0D[504E0500]                          mov     ecx, [_@@@tmp+2Ch]
  3061 00001B79 29D0                                    sub     eax, edx
  3062 00001B7B 8D1450                                  lea     edx, [eax+edx*2]
  3063 00001B7E A3[1C4E0500]                            mov     [_@@s2], eax
  3064 00001B83 8915[184E0500]                          mov     [_@@s0], edx
  3065 00001B89 29F1                                    sub     ecx, esi
  3066 00001B8B 8D0471                                  lea     eax, [ecx+esi*2]
  3067 00001B8E D1E0                                    shl     eax, 1
  3068 00001B90 BA6CBE9D46                              mov     edx, 469DBE6Ch  ; icos36h_2
  3069 00001B95 F7EA                                    imul    edx
  3070 00001B97 89D6                                    mov     esi, edx
  3071 00001B99 89C8                                    mov     eax, ecx
  3072 00001B9B C1E002                                  shl     eax, 2
  3073 00001B9E BA62ECB74B                              mov     edx, 4BB7EC62h  ; icos36h_6 (8-2)
  3074 00001BA3 F7EA                                    imul    edx
  3075 00001BA5 8915[204E0500]                          mov     [_@@s3], edx
  3076 00001BAB 8B0D[184E0500]                          mov     ecx, [_@@s0]
  3077 00001BB1 29F1                                    sub     ecx, esi
  3078 00001BB3 8D3471                                  lea     esi, [ecx+esi*2]
  3079 00001BB6 8B452C                                  mov     eax, [ebp+44]
  3080 00001BB9 F7E9                                    imul    ecx
  3081 00001BBB 03532C                                  add     edx, [ebx+44]
  3082 00001BBE 899780050000                            mov     [edi+1408], edx
  3083 00001BC4 8B4518                                  mov     eax, [ebp+24]
  3084 00001BC7 F7E9                                    imul    ecx
  3085 00001BC9 035318                                  add     edx, [ebx+24]
  3086 00001BCC 899700030000                            mov     [edi+768], edx
  3087 00001BD2 8B4574                                  mov     eax, [ebp+116]
  3088 00001BD5 F7EE                                    imul    esi
  3089 00001BD7 89532C                                  mov     [ebx+44], edx
  3090 00001BDA 8B4560                                  mov     eax, [ebp+96]
  3091 00001BDD F7EE                                    imul    esi
  3092 00001BDF 895318                                  mov     [ebx+24], edx
  3093 00001BE2 8B0D[1C4E0500]                          mov     ecx, [_@@s2]
  3094 00001BE8 8B35[204E0500]                          mov     esi, [_@@s3]
  3095 00001BEE 29F1                                    sub     ecx, esi
  3096 00001BF0 8D3471                                  lea     esi, [ecx+esi*2]
  3097 00001BF3 8B4508                                  mov     eax, [ebp+8]
  3098 00001BF6 F7E9                                    imul    ecx
  3099 00001BF8 035308                                  add     edx, [ebx+8]
  3100 00001BFB 899700010000                            mov     [edi+256], edx
  3101 00001C01 8B453C                                  mov     eax, [ebp+60]
  3102 00001C04 F7E9                                    imul    ecx
  3103 00001C06 03533C                                  add     edx, [ebx+60]
  3104 00001C09 899780070000                            mov     [edi+1920], edx
  3105 00001C0F 8B4550                                  mov     eax, [ebp+80]
  3106 00001C12 F7EE                                    imul    esi
  3107 00001C14 895308                                  mov     [ebx+8], edx
  3108 00001C17 8B8584000000                            mov     eax, [ebp+132]
  3109 00001C1D F7EE                                    imul    esi
  3110 00001C1F 89533C                                  mov     [ebx+60], edx
  3111 00001C22 8B15[544E0500]                          mov     edx, [_@@@tmp+30h] ; IRP j,0,1,2,3 ; j = 3
  3112 00001C28 8B35[584E0500]                          mov     esi, [_@@@tmp+34h]
  3113 00001C2E A1[5C4E0500]                            mov     eax, [_@@@tmp+38h]
  3114 00001C33 8B0D[604E0500]                          mov     ecx, [_@@@tmp+3Ch]
  3115 00001C39 29D0                                    sub     eax, edx
  3116 00001C3B 8D1450                                  lea     edx, [eax+edx*2]
  3117 00001C3E A3[1C4E0500]                            mov     [_@@s2], eax
  3118 00001C43 8915[184E0500]                          mov     [_@@s0], edx
  3119 00001C49 29F1                                    sub     ecx, esi
  3120 00001C4B 8D0471                                  lea     eax, [ecx+esi*2]
  3121 00001C4E D1E0                                    shl     eax, 1
  3122 00001C50 BABE2B214E                              mov     edx, 4E212BBEh  ; icos36h_3
  3123 00001C55 F7EA                                    imul    edx
  3124 00001C57 89D6                                    mov     esi, edx
  3125 00001C59 89C8                                    mov     eax, ecx
  3126 00001C5B D1E0                                    shl     eax, 1
  3127 00001C5D BADFA1946F                              mov     edx, 6F94A1DFh  ; icos36h_5 (8-3)
  3128 00001C62 F7EA                                    imul    edx
  3129 00001C64 8915[204E0500]                          mov     [_@@s3], edx
  3130 00001C6A 8B0D[184E0500]                          mov     ecx, [_@@s0]
  3131 00001C70 29F1                                    sub     ecx, esi
  3132 00001C72 8D3471                                  lea     esi, [ecx+esi*2]
  3133 00001C75 8B4530                                  mov     eax, [ebp+48]
  3134 00001C78 F7E9                                    imul    ecx
  3135 00001C7A 035330                                  add     edx, [ebx+48]
  3136 00001C7D 899700060000                            mov     [edi+1536], edx
  3137 00001C83 8B4514                                  mov     eax, [ebp+20]
  3138 00001C86 F7E9                                    imul    ecx
  3139 00001C88 035314                                  add     edx, [ebx+20]
  3140 00001C8B 899780020000                            mov     [edi+640], edx
  3141 00001C91 8B4578                                  mov     eax, [ebp+120]
  3142 00001C94 F7EE                                    imul    esi
  3143 00001C96 895330                                  mov     [ebx+30h], edx
  3144 00001C99 8B455C                                  mov     eax, [ebp+92]
  3145 00001C9C F7EE                                    imul    esi
  3146 00001C9E 895314                                  mov     [ebx+20], edx
  3147 00001CA1 8B0D[1C4E0500]                          mov     ecx, [_@@s2]
  3148 00001CA7 8B35[204E0500]                          mov     esi, [_@@s3]
  3149 00001CAD 29F1                                    sub     ecx, esi
  3150 00001CAF 8D3471                                  lea     esi, [ecx+esi*2]
  3151 00001CB2 8B450C                                  mov     eax, [ebp+12]
  3152 00001CB5 F7E9                                    imul    ecx
  3153 00001CB7 03530C                                  add     edx, [ebx+12]
  3154 00001CBA 899780010000                            mov     [edi+384], edx
  3155 00001CC0 8B4538                                  mov     eax, [ebp+56]
  3156 00001CC3 F7E9                                    imul    ecx
  3157 00001CC5 035338                                  add     edx, [ebx+56]
  3158 00001CC8 899700070000                            mov     [edi+1792], edx
  3159 00001CCE 8B4554                                  mov     eax, [ebp+84]
  3160 00001CD1 F7EE                                    imul    esi
  3161 00001CD3 89530C                                  mov     [ebx+12], edx
  3162 00001CD6 8B8580000000                            mov     eax, [ebp+128]
  3163 00001CDC F7EE                                    imul    esi
  3164 00001CDE 895338                                  mov     [ebx+56], edx
  3165 00001CE1 8B0D[644E0500]                          mov     ecx, [_@@@tmp+40h] ; IRP j,4
  3166                                                                          ; [@@tmp+(j*4+0)*4]
  3167 00001CE7 A1[684E0500]                            mov     eax, [_@@@tmp+44h] ; [@@tmp+(j*4+1)*4]
  3168 00001CEC D1E0                                    shl     eax, 1
  3169 00001CEE BA9A79825A                              mov     edx, 5A82799Ah  ; icos36h_4 (8-4)
  3170 00001CF3 F7EA                                    imul    edx
  3171 00001CF5 29D1                                    sub     ecx, edx
  3172 00001CF7 8D3451                                  lea     esi, [ecx+edx*2]
  3173 00001CFA 8B4534                                  mov     eax, [ebp+52]   ; @@MULH [edi+(9+j)*SBLIMIT*4],[ebp+(9+j)*4],
  3174                                                                          ; -,-,-,-,0,ecx,[ebx+(9+j)*4]
  3175                                                                          ; out[(9+4)*SBLIMIT] = MULH(t0,win[9+4])+buf[9+4]
  3176 00001CFD F7E9                                    imul    ecx
  3177 00001CFF 035334                                  add     edx, [ebx+52]
  3178 00001D02 899780060000                            mov     [edi+1664], edx ; 13*SBLIMIT*4 = 1664
  3179 00001D08 8B4510                                  mov     eax, [ebp+16]   ; @MULH [edi+(8-j)*SBLIMIT*4],[ebp+(8-j)*4],
  3180                                                                          ; -,-,-,-,0,ecx,[ebx+(8-j)*4]
  3181 00001D0B F7E9                                    imul    ecx
  3182 00001D0D 035310                                  add     edx, [ebx+16]
  3183 00001D10 899700020000                            mov     [edi+512], edx
  3184 00001D16 8B457C                                  mov     eax, [ebp+124]  ; @@MULH [ebx+(9+j)*4],[ebp+(9+j+18)*4] ,-,-,-,-,0,esi,-
  3185 00001D19 F7EE                                    imul    esi
  3186 00001D1B 895334                                  mov     [ebx+52], edx
  3187 00001D1E 8B4558                                  mov     eax, [ebp+88]   ; @@MULH [ebx+(8-j)*4],[ebp+(8-j+18)*4],-,-,-,-,0,esi,-
  3188 00001D21 F7EE                                    imul    esi
  3189 00001D23 895310                                  mov     [ebx+16], edx
  3190 00001D26 5E                                      pop     esi
  3191 00001D27 C3                                      retn
  3192                                  
  3193                                  
  3194                                  ; =============== S U B R O U T I N E =======================================
  3195                                  
  3196                                  
  3197                                  mp3_imdct12:
  3198 00001D28 8B06                                    mov     eax, [esi]      ; in: esi=src - out: [out2_...]
  3199 00001D2A A3[6C4E0500]                            mov     [_@@tmp0], eax  ; IRP nn,0,1,2,3,4,5
  3200                                                                          ;  @@tmp&nn rd 1
  3201                                                                          ; ENDM
  3202                                                                          ; mov  eax,[esi+0*3*4] ; = src[0*3]
  3203 00001D2F 8B560C                                  mov     edx, [esi+12]   ; [esi+1*3*4] ; = src[1*3]
  3204 00001D32 01D0                                    add     eax, edx        ; = src[0*3]+src[1*3]
  3205 00001D34 A3[704E0500]                            mov     [_@@tmp1], eax
  3206 00001D39 8B4618                                  mov     eax, [esi+24]
  3207 00001D3C 01C2                                    add     edx, eax
  3208 00001D3E 8915[744E0500]                          mov     [_@@tmp2], edx
  3209 00001D44 8B5624                                  mov     edx, [esi+36]   ; [esi+3*3*4]
  3210 00001D47 01D0                                    add     eax, edx
  3211 00001D49 A3[784E0500]                            mov     [_@@tmp3], eax
  3212 00001D4E 8B4630                                  mov     eax, [esi+48]
  3213 00001D51 01C2                                    add     edx, eax
  3214 00001D53 8915[7C4E0500]                          mov     [_@@tmp4], edx
  3215 00001D59 8B563C                                  mov     edx, [esi+60]   ; [esi+5*3*4]
  3216 00001D5C 01D0                                    add     eax, edx        ; = src[4*3]+src[5*3]
  3217 00001D5E 0305[784E0500]                          add     eax, [_@@tmp3]
  3218 00001D64 A3[804E0500]                            mov     [_@@tmp5], eax  ; tmp5 = src[4*3]+src[5*3]+tmp3
  3219 00001D69 8B15[704E0500]                          mov     edx, [_@@tmp1]
  3220 00001D6F 0115[784E0500]                          add     [_@@tmp3], edx
  3221 00001D75 A1[744E0500]                            mov     eax, [_@@tmp2]  ; @@MULH @@tmp2,@@tmp2,-,-,-,-,1,C3,-
  3222                                                                          ; tmp2 = MULH(2*tmp2,C3)
  3223 00001D7A D1E0                                    shl     eax, 1
  3224 00001D7C BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  3225 00001D81 F7EA                                    imul    edx
  3226 00001D83 8915[744E0500]                          mov     [_@@tmp2], edx
  3227 00001D89 A1[784E0500]                            mov     eax, [_@@tmp3]  ; @@MULH @@tmp3,@@tmp3,-,-,-,-,2,C3,-
  3228                                                                          ; tmp3 = MULH(4*tmp3,C3)
  3229 00001D8E C1E002                                  shl     eax, 2
  3230 00001D91 BAA2EBD96E                              mov     edx, 6ED9EBA2h  ; C3
  3231 00001D96 F7EA                                    imul    edx
  3232 00001D98 8915[784E0500]                          mov     [_@@tmp3], edx
  3233 00001D9E A1[704E0500]                            mov     eax, [_@@tmp1]  ; @@MULH edx,@@tmp1,sub,@@tmp5,-,-,1,icos36h_4,-
  3234 00001DA3 2B05[804E0500]                          sub     eax, [_@@tmp5]  ; t2 = MULH(2*(tmp1-tmp5),icos36h_4)
  3235 00001DA9 D1E0                                    shl     eax, 1
  3236 00001DAB BA9A79825A                              mov     edx, 5A82799Ah  ; icos36h_4
  3237 00001DB0 F7EA                                    imul    edx
  3238 00001DB2 A1[6C4E0500]                            mov     eax, [_@@tmp0]  ; @@SUM eax,@@tmp0,sub,@@tmp4,-,-
  3239 00001DB7 2B05[7C4E0500]                          sub     eax, [_@@tmp4]  ; t1 = tmp0 - tmp4
  3240 00001DBD 29D0                                    sub     eax, edx        ; @@CAST macro t1,t2,dst0,dst1,dst2,dst3
  3241                                                                          ;   sub  t1,t2                           ;t1-t2
  3242                                                                          ;   lea  t2,[t1+t2*2]                    ;t1+t2
  3243                                                                          ;   mov  dword ptr [mp3_out2_a&dst0],t1  ;t1-t2
  3244                                                                          ;   mov  dword ptr [mp3_out2_b&dst0],t2  ;t1+t2
  3245                                                                          ; endm
  3246 00001DBF 8D1450                                  lea     edx, [eax+edx*2] ; @@CAST eax,edx,1,4,7,10
  3247                                                                          ; out2[1,4,7,10]=t1-t2,t1-t2,t1+t2,t1+t2
  3248 00001DC2 A3[884E0500]                            mov     [mp3_out2_a1], eax
  3249 00001DC7 8915[944E0500]                          mov     [mp3_out2_b1], edx
  3250 00001DCD A1[7C4E0500]                            mov     eax, [_@@tmp4]
  3251 00001DD2 8B15[704E0500]                          mov     edx, [_@@tmp1]
  3252 00001DD8 D1F8                                    sar     eax, 1
  3253 00001DDA D1E2                                    shl     edx, 1
  3254 00001DDC 0105[6C4E0500]                          add     [_@@tmp0], eax  ; tmp0 = tmp0 + tmp4/2
  3255 00001DE2 0115[804E0500]                          add     [_@@tmp5], edx  ; tmp5 = tmp5 + tmp1*2
  3256 00001DE8 A1[804E0500]                            mov     eax, [_@@tmp5]  ; @@MULH edx,@@tmp5,add,@@tmp3,-,-,0,icos36h_1,-
  3257 00001DED 0305[784E0500]                          add     eax, [_@@tmp3]
  3258 00001DF3 BA07F74142                              mov     edx, 4241F707h  ; icos36h_1
  3259 00001DF8 F7EA                                    imul    edx
  3260 00001DFA A1[6C4E0500]                            mov     eax, [_@@tmp0]  ; @@SUM eax,@@tmp0,add,@@tmp2,-,-
  3261 00001DFF 0305[744E0500]                          add     eax, [_@@tmp2]
  3262 00001E05 29D0                                    sub     eax, edx        ; @@CAST eax,edx,2,3,8,9
  3263 00001E07 8D1450                                  lea     edx, [eax+edx*2]
  3264 00001E0A A3[8C4E0500]                            mov     [mp3_out2_a2], eax
  3265 00001E0F 8915[984E0500]                          mov     [mp3_out2_b2], edx
  3266 00001E15 A1[804E0500]                            mov     eax, [_@@tmp5]  ; @@MULH edx,@@tmp5,sub,@@tmp3,-,-,1,icos36h_7,-
  3267 00001E1A 2B05[784E0500]                          sub     eax, [_@@tmp3]
  3268 00001E20 D1E0                                    shl     eax, 1
  3269 00001E22 BA1E75A37B                              mov     edx, 7BA3751Eh  ; icos36h_7
  3270 00001E27 F7EA                                    imul    edx
  3271 00001E29 A1[6C4E0500]                            mov     eax, [_@@tmp0]  ; @@SUM eax,@@tmp0,sub,@@tmp2,-,-
  3272 00001E2E 2B05[744E0500]                          sub     eax, [_@@tmp2]
  3273 00001E34 29D0                                    sub     eax, edx        ; @@CAST eax,edx,0,5,6,11
  3274 00001E36 8D1450                                  lea     edx, [eax+edx*2]
  3275 00001E39 A3[844E0500]                            mov     [mp3_out2_a0], eax
  3276 00001E3E 8915[904E0500]                          mov     [mp3_out2_b0], edx
  3277 00001E44 C3                                      retn
  3278                                  
  3279                                  
  3280                                  ; =============== S U B R O U T I N E =======================================
  3281                                  
  3282                                  
  3283                                  mp3_compute_imdct:
  3284                                  		; 16/02/2025
  3285                                  
  3286                                  .no_rdtsc_supported:
  3287 00001E45 53                                      push    ebx
  3288 00001E46 8B4B60                                  mov     ecx, [ebx+96]   ; [ebx+$mp3gr_num_nonzero_hybrids_div9]
  3289 00001E49 6BC109                                  imul    eax, ecx, 9
  3290 00001E4C 8DBC83A0000000                          lea     edi, [ebx+eax*4+160] ; [ebx+$mp3gr_sb_hybrid+eax*4]
  3291 00001E53 E322                                    jecxz   .breakout
  3292                                  
  3293                                  .scan_zero_lop:
  3294 00001E55 83EF24                                  sub     edi, 36         ; index-9
  3295 00001E58 8B07                                    mov     eax, [edi]      ; [edi+0*4]
  3296 00001E5A 0B4704                                  or      eax, [edi+4]
  3297 00001E5D 0B4708                                  or      eax, [edi+8]
  3298 00001E60 0B470C                                  or      eax, [edi+12]
  3299 00001E63 0B4710                                  or      eax, [edi+16]
  3300 00001E66 0B4714                                  or      eax, [edi+20]
  3301 00001E69 0B4718                                  or      eax, [edi+24]
  3302 00001E6C 0B471C                                  or      eax, [edi+28]
  3303 00001E6F 0B4720                                  or      eax, [edi+32]   ; [edi+8*4]
  3304 00001E72 7503                                    jnz     short .breakout
  3305 00001E74 49                                      dec     ecx
  3306 00001E75 75DE                                    jnz     short .scan_zero_lop
  3307                                  
  3308                                  .breakout:
  3309 00001E77 41                                      inc     ecx             ; div9+1
  3310 00001E78 D1E9                                    shr     ecx, 1          ; div18
  3311 00001E7A 890D[B04E0500]                          mov     [_@@sblimit], ecx
  3312 00001E80 837B2C02                                cmp     dword [ebx+44], 2 ; [ebx+$mp3gr_block_type]
  3313 00001E84 7505                                    jnz     short .this_long_end
  3314 00001E86 8B4B30                                  mov     ecx, [ebx+48]   ; [ebx+$mp3gr_switch_point]
  3315 00001E89 D1E1                                    shl     ecx, 1          ; 0,1 --> 0,2
  3316                                  
  3317                                  .this_long_end:
  3318 00001E8B 890D[AC4E0500]                          mov     [_@@mdct_long_end], ecx
  3319 00001E91 8B4330                                  mov     eax, [ebx+48]   ; [ebx+$mp3gr_switch_point]
  3320 00001E94 A3[B44E0500]                            mov     [_@@switch_point], eax
  3321 00001E99 8B432C                                  mov     eax, [ebx+44]   ; [ebx+$mp3gr_block_type]
  3322 00001E9C 69C090000000                            imul    eax, 144        ; 1*36*4
  3323 00001EA2 A3[A84E0500]                            mov     [_@@www], eax
  3324 00001EA7 8B0D[7C190100]                          mov     ecx, [mp3_curr_channel]
  3325 00001EAD A1[80190100]                            mov     eax, [mp3_curr_granule]
  3326 00001EB2 69C900120000                            imul    ecx, 4608       ; 36*SBLIMIT*4 ; channel ; sb_samples[ch][gr*18]
  3327 00001EB8 69C000090000                            imul    eax, 2304       ; 18*SBLIMIT*4 ; frame=granule*18
  3328 00001EBE 8DBC01[E0E20000]                        lea     edi, [mp3_sb_samples+ecx+eax]
  3329 00001EC5 8DB3A0000000                            lea     esi, [ebx+160]  ; [ebx+$mp3gr_sb_hybrid]
  3330 00001ECB A1[7C190100]                            mov     eax, [mp3_curr_channel]
  3331 00001ED0 69C000090000                            imul    eax, 2304       ; SBLIMIT*18*4
  3332 00001ED6 8D98[E0060100]                          lea     ebx, [mp3_mdct_buf+eax]
  3333                                  		
  3334                                  		; 16/02/2025
  3335                                  .no_rdtsc_supported@:
  3336 00001EDC C705[A44E0500]0000-                     mov	dword [_@@@JJJ], 0
  3336 00001EE4 0000               
  3337 00001EE6 833D[AC4E0500]00                        cmp	dword [_@@mdct_long_end], 0
  3338 00001EED 744D                                    jz      short .imdct36_done
  3339                                  
  3340                                  .imdct36_lop:
  3341 00001EEF BD[0C080500]                            mov	ebp, mp3_mdct_win ; for j=0 to mdct_long_end-1
  3342 00001EF4 833D[A44E0500]02                        cmp	dword [_@@@JJJ], 2
  3343 00001EFB 19C0                                    sbb	eax, eax
  3344 00001EFD 2305[B44E0500]                          and	eax, [_@@switch_point]
  3345 00001F03 7506                                    jnz	short .this_window ; force window 0
  3346 00001F05 032D[A84E0500]                          add	ebp, [_@@www] ; mdct_win
  3347                                  
  3348                                  .this_window:
  3349 00001F0B A1[A44E0500]                            mov	eax, [_@@@JJJ]
  3350 00001F10 D1E8                                    shr	eax, 1          ; cy=0,1
  3351 00001F12 19C0                                    sbb	eax, eax        ; eax=0,FFFFFFFFh
  3352 00001F14 2540020000                              and	eax, 576        ; 4*36*4
  3353 00001F19 01C5                                    add	ebp, eax
  3354 00001F1B E836F8FFFF                              call	mp3_imdct36
  3355 00001F20 83C704                                  add	edi, 4          ; 1*4 ; dst
  3356 00001F23 83C648                                  add	esi, 72         ; 18*4 ; sb_hybrid
  3357 00001F26 83C348                                  add	ebx, 72         ; mdct_buf ; next
  3358 00001F29 FF05[A44E0500]                          inc	dword [_@@@JJJ]
  3359 00001F2F A1[A44E0500]                            mov	eax, [_@@@JJJ]
  3360 00001F34 3B05[AC4E0500]                          cmp	eax, [_@@mdct_long_end]
  3361 00001F3A 72B3                                    jb	short .imdct36_lop
  3362                                  
  3363                                  .imdct36_done:
  3364                                  		; 16/02/2025
  3365                                  .no_rdtsc_supported@@:
  3366                                  
  3367                                  		; 16/02/2025
  3368                                  .no_rdtsc_supported@@@:
  3369 00001F3C A1[A44E0500]                            mov     eax, [_@@@JJJ]
  3370 00001F41 3B05[B04E0500]                          cmp     eax, [_@@sblimit]
  3371 00001F47 0F83D7020000                            jnb     .imdct12_done
  3372                                  
  3373                                  .imdct12_lop:
  3374 00001F4D BD[2C090500]                            mov     ebp, (mp3_mdct_win+120h) ; for j=mdct_long_end to sblimit-1
  3375 00001F52 A1[A44E0500]                            mov     eax, [_@@@JJJ]
  3376 00001F57 D1E8                                    shr     eax, 1          ; cy=0,1
  3377 00001F59 19C0                                    sbb     eax, eax        ; eax=0,FFFFFFFFh
  3378 00001F5B 2540020000                              and     eax, 576        ; 4*36*4
  3379 00001F60 01C5                                    add     ebp, eax        ; mdct_win
  3380 00001F62 8B03                                    mov     eax, [ebx]      ; IRP i,0,1,2,3,4,5
  3381 00001F64 8907                                    mov     [edi], eax      ; @@SUM [edi+i*SBLIMIT*4],[ebx+(i+0)*4],-,-,-,-
  3382 00001F66 8B4304                                  mov     eax, [ebx+4]
  3383 00001F69 898780000000                            mov     [edi+128], eax
  3384 00001F6F 8B4308                                  mov     eax, [ebx+8]
  3385 00001F72 898700010000                            mov     [edi+256], eax
  3386 00001F78 8B430C                                  mov     eax, [ebx+12]
  3387 00001F7B 898780010000                            mov     [edi+384], eax
  3388 00001F81 8B4310                                  mov     eax, [ebx+16]
  3389 00001F84 898700020000                            mov     [edi+512], eax
  3390 00001F8A 8B4314                                  mov     eax, [ebx+20]
  3391 00001F8D 898780020000                            mov     [edi+640], eax  ; ENDM
  3392 00001F93 81C700030000                            add     edi, 768        ; 6*SBLIMIT*4
  3393 00001F99 E88AFDFFFF                              call    mp3_imdct12
  3394 00001F9E A1[844E0500]                            mov     eax, [mp3_out2_a0] ; IRP i,0,1,2,3,4,5
  3395 00001FA3 8B5500                                  mov     edx, [ebp+0]    ; @@MULH [edi+i*SBLIMIT*4],[mp3_out2_a&i],
  3396                                                                          ; -,-,-,-,0,[ebp+(i+0)*4],[ebx+(1*6+i)*4]
  3397 00001FA6 F7EA                                    imul    edx
  3398 00001FA8 035318                                  add     edx, [ebx+24]
  3399 00001FAB 8917                                    mov     [edi], edx
  3400 00001FAD A1[904E0500]                            mov     eax, [mp3_out2_b0] ; @@MULH [ebx+(2*6+i)*4],[mp3_out2_b&i],
  3401                                                                          ; -,-,-,-,0,[ebp+(i+6)*4],-
  3402 00001FB2 8B5518                                  mov     edx, [ebp+24]
  3403 00001FB5 F7EA                                    imul    edx
  3404 00001FB7 895330                                  mov     [ebx+48], edx
  3405 00001FBA A1[884E0500]                            mov     eax, [mp3_out2_a1] ; i = 1
  3406 00001FBF 8B5504                                  mov     edx, [ebp+4]
  3407 00001FC2 F7EA                                    imul    edx
  3408 00001FC4 03531C                                  add     edx, [ebx+28]
  3409 00001FC7 899780000000                            mov     [edi+128], edx
  3410 00001FCD A1[944E0500]                            mov     eax, [mp3_out2_b1]
  3411 00001FD2 8B551C                                  mov     edx, [ebp+28]
  3412 00001FD5 F7EA                                    imul    edx
  3413 00001FD7 895334                                  mov     [ebx+52], edx
  3414 00001FDA A1[8C4E0500]                            mov     eax, [mp3_out2_a2] ; i = 2
  3415 00001FDF 8B5508                                  mov     edx, [ebp+8]
  3416 00001FE2 F7EA                                    imul    edx
  3417 00001FE4 035320                                  add     edx, [ebx+32]
  3418 00001FE7 899700010000                            mov     [edi+256], edx
  3419 00001FED A1[984E0500]                            mov     eax, [mp3_out2_b2]
  3420 00001FF2 8B5520                                  mov     edx, [ebp+32]
  3421 00001FF5 F7EA                                    imul    edx
  3422 00001FF7 895338                                  mov     [ebx+56], edx
  3423 00001FFA A1[8C4E0500]                            mov     eax, [mp3_out2_a2] ; i = 3 ; mp3_out2_a3 equ mp3_out2_a2
  3424 00001FFF 8B550C                                  mov     edx, [ebp+12]
  3425 00002002 F7EA                                    imul    edx
  3426 00002004 035324                                  add     edx, [ebx+36]
  3427 00002007 899780010000                            mov     [edi+384], edx
  3428 0000200D A1[984E0500]                            mov     eax, [mp3_out2_b2] ; mp3_out2_b3 equ mp3_out2_b2
  3429 00002012 8B5524                                  mov     edx, [ebp+36]
  3430 00002015 F7EA                                    imul    edx
  3431 00002017 89533C                                  mov     [ebx+60], edx
  3432 0000201A A1[884E0500]                            mov     eax, [mp3_out2_a1] ; i = 4 ; mp3_out2_a4 equ mp3_out2_a1
  3433 0000201F 8B5510                                  mov     edx, [ebp+16]
  3434 00002022 F7EA                                    imul    edx
  3435 00002024 035328                                  add     edx, [ebx+40]
  3436 00002027 899700020000                            mov     [edi+512], edx
  3437 0000202D A1[944E0500]                            mov     eax, [mp3_out2_b1] ; mp3_out2_b4 equ mp3_out2_b1
  3438 00002032 8B5528                                  mov     edx, [ebp+40]
  3439 00002035 F7EA                                    imul    edx
  3440 00002037 895340                                  mov     [ebx+64], edx
  3441 0000203A A1[844E0500]                            mov     eax, [mp3_out2_a0] ; i = 5 ; mp3_out2_a5 equ mp3_out2_a0
  3442 0000203F 8B5514                                  mov     edx, [ebp+20]
  3443 00002042 F7EA                                    imul    edx
  3444 00002044 03532C                                  add     edx, [ebx+44]
  3445 00002047 899780020000                            mov     [edi+640], edx
  3446 0000204D A1[904E0500]                            mov     eax, [mp3_out2_b0] ; mp3_out2_b5 equ mp3_out2_b0
  3447 00002052 8B552C                                  mov     edx, [ebp+44]
  3448 00002055 F7EA                                    imul    edx
  3449 00002057 895344                                  mov     [ebx+68], edx   ; ENDM
  3450 0000205A 81C700030000                            add     edi, 768        ; 6*SBLIMIT*4
  3451 00002060 83C604                                  add     esi, 4          ; sb_hybrid
  3452 00002063 E8C0FCFFFF                              call    mp3_imdct12
  3453 00002068 A1[844E0500]                            mov     eax, [mp3_out2_a0] ; IRP i,0,1,2,3,4,5
  3454 0000206D 8B5500                                  mov     edx, [ebp+0]    ; @@MULH [edi+i*SBLIMIT*4],[mp3_out2_a&i],
  3455                                                                          ; -,-,-,-,0,[ebp+(i+0)*4],[ebx+(2*6+i)*4]
  3456 00002070 F7EA                                    imul    edx             ; @@MULH [ebx+(0*6+i)*4],[mp3_out2_b&i],
  3457                                                                          ; -,-,-,-,0,[ebp+(i+6)*4],-
  3458 00002072 035330                                  add     edx, [ebx+48]
  3459 00002075 8917                                    mov     [edi], edx
  3460 00002077 A1[904E0500]                            mov     eax, [mp3_out2_b0]
  3461 0000207C 8B5518                                  mov     edx, [ebp+18h]
  3462 0000207F F7EA                                    imul    edx
  3463 00002081 8913                                    mov     [ebx], edx
  3464 00002083 A1[884E0500]                            mov     eax, [mp3_out2_a1] ; i = 1
  3465 00002088 8B5504                                  mov     edx, [ebp+4]
  3466 0000208B F7EA                                    imul    edx
  3467 0000208D 035334                                  add     edx, [ebx+52]
  3468 00002090 899780000000                            mov     [edi+128], edx
  3469 00002096 A1[944E0500]                            mov     eax, [mp3_out2_b1]
  3470 0000209B 8B551C                                  mov     edx, [ebp+28]
  3471 0000209E F7EA                                    imul    edx
  3472 000020A0 895304                                  mov     [ebx+4], edx
  3473 000020A3 A1[8C4E0500]                            mov     eax, [mp3_out2_a2] ; i = 2
  3474 000020A8 8B5508                                  mov     edx, [ebp+8]
  3475 000020AB F7EA                                    imul    edx
  3476 000020AD 035338                                  add     edx, [ebx+56]
  3477 000020B0 899700010000                            mov     [edi+256], edx
  3478 000020B6 A1[984E0500]                            mov     eax, [mp3_out2_b2]
  3479 000020BB 8B5520                                  mov     edx, [ebp+32]
  3480 000020BE F7EA                                    imul    edx
  3481 000020C0 895308                                  mov     [ebx+8], edx
  3482 000020C3 A1[8C4E0500]                            mov     eax, [mp3_out2_a2] ; i = 3
  3483 000020C8 8B550C                                  mov     edx, [ebp+12]
  3484 000020CB F7EA                                    imul    edx
  3485 000020CD 03533C                                  add     edx, [ebx+60]
  3486 000020D0 899780010000                            mov     [edi+384], edx
  3487 000020D6 A1[984E0500]                            mov     eax, [mp3_out2_b2]
  3488 000020DB 8B5524                                  mov     edx, [ebp+36]
  3489 000020DE F7EA                                    imul    edx
  3490 000020E0 89530C                                  mov     [ebx+12], edx
  3491 000020E3 A1[884E0500]                            mov     eax, [mp3_out2_a1] ; i = 4
  3492 000020E8 8B5510                                  mov     edx, [ebp+16]
  3493 000020EB F7EA                                    imul    edx
  3494 000020ED 035340                                  add     edx, [ebx+64]
  3495 000020F0 899700020000                            mov     [edi+512], edx
  3496 000020F6 A1[944E0500]                            mov     eax, [mp3_out2_b1]
  3497 000020FB 8B5528                                  mov     edx, [ebp+40]
  3498 000020FE F7EA                                    imul    edx
  3499 00002100 895310                                  mov     [ebx+16], edx
  3500 00002103 A1[844E0500]                            mov     eax, [mp3_out2_a0] ; i = 5
  3501 00002108 8B5514                                  mov     edx, [ebp+20]
  3502 0000210B F7EA                                    imul    edx
  3503 0000210D 035344                                  add     edx, [ebx+68]
  3504 00002110 899780020000                            mov     [edi+640], edx
  3505 00002116 A1[904E0500]                            mov     eax, [mp3_out2_b0]
  3506 0000211B 8B552C                                  mov     edx, [ebp+44]
  3507 0000211E F7EA                                    imul    edx
  3508 00002120 895314                                  mov     [ebx+20], edx   ; ENDM
  3509 00002123 83C604                                  add     esi, 4
  3510 00002126 E8FDFBFFFF                              call    mp3_imdct12
  3511 0000212B A1[844E0500]                            mov     eax, [mp3_out2_a0] ; IRP i,0,1,2,3,4,5
  3512 00002130 8B5500                                  mov     edx, [ebp+0]    ; @@MULH [ebx+(0*6+i)*4],[mp3_out2_a&i],
  3513                                                                          ; -,-,-,-,0,[ebp+(i+0)*4],[ebx+(0*6+i)*4]
  3514 00002133 F7EA                                    imul    edx
  3515 00002135 0313                                    add     edx, [ebx]
  3516 00002137 8913                                    mov     [ebx], edx
  3517 00002139 A1[904E0500]                            mov     eax, [mp3_out2_b0] ; @@MULH [ebx+(1*6+i)*4],[mp3_out2_b&i],
  3518                                                                          ; -,-,-,-,0,[ebp+(i+6)*4],-
  3519 0000213E 8B5518                                  mov     edx, [ebp+24]
  3520 00002141 F7EA                                    imul    edx
  3521 00002143 895318                                  mov     [ebx+24], edx
  3522 00002146 C7433000000000                          mov     dword [ebx+48], 0 ; [ebx+(2*6+i)*4]
  3523 0000214D A1[884E0500]                            mov     eax, [mp3_out2_a1] ; i = 1
  3524 00002152 8B5504                                  mov     edx, [ebp+4]
  3525 00002155 F7EA                                    imul    edx
  3526 00002157 035304                                  add     edx, [ebx+4]
  3527 0000215A 895304                                  mov     [ebx+4], edx
  3528 0000215D A1[944E0500]                            mov     eax, [mp3_out2_b1]
  3529 00002162 8B551C                                  mov     edx, [ebp+28]
  3530 00002165 F7EA                                    imul    edx
  3531 00002167 89531C                                  mov     [ebx+28], edx
  3532 0000216A C7433400000000                          mov     dword [ebx+52], 0 ; [ebx+(2*6+i)*4]
  3533 00002171 A1[8C4E0500]                            mov     eax, [mp3_out2_a2] ; i = 2
  3534 00002176 8B5508                                  mov     edx, [ebp+8]
  3535 00002179 F7EA                                    imul    edx
  3536 0000217B 035308                                  add     edx, [ebx+8]
  3537 0000217E 895308                                  mov     [ebx+8], edx
  3538 00002181 A1[984E0500]                            mov     eax, [mp3_out2_b2]
  3539 00002186 8B5520                                  mov     edx, [ebp+32]
  3540 00002189 F7EA                                    imul    edx
  3541 0000218B 895320                                  mov     [ebx+32], edx
  3542 0000218E C7433800000000                          mov     dword [ebx+56], 0
  3543 00002195 A1[8C4E0500]                            mov     eax, [mp3_out2_a2] ; i = 3
  3544 0000219A 8B550C                                  mov     edx, [ebp+12]
  3545 0000219D F7EA                                    imul    edx
  3546 0000219F 03530C                                  add     edx, [ebx+0Ch]
  3547 000021A2 89530C                                  mov     [ebx+12], edx
  3548 000021A5 A1[984E0500]                            mov     eax, [mp3_out2_b2]
  3549 000021AA 8B5524                                  mov     edx, [ebp+36]
  3550 000021AD F7EA                                    imul    edx
  3551 000021AF 895324                                  mov     [ebx+36], edx
  3552 000021B2 C7433C00000000                          mov     dword [ebx+60], 0 ; [ebx+(2*6+i)*4]
  3553 000021B9 A1[884E0500]                            mov     eax, [mp3_out2_a1] ; i = 4
  3554 000021BE 8B5510                                  mov     edx, [ebp+16]
  3555 000021C1 F7EA                                    imul    edx
  3556 000021C3 035310                                  add     edx, [ebx+16]
  3557 000021C6 895310                                  mov     [ebx+16], edx
  3558 000021C9 A1[944E0500]                            mov     eax, [mp3_out2_b1]
  3559 000021CE 8B5528                                  mov     edx, [ebp+40]
  3560 000021D1 F7EA                                    imul    edx
  3561 000021D3 895328                                  mov     [ebx+40], edx
  3562 000021D6 C7434000000000                          mov     dword [ebx+64], 0
  3563 000021DD A1[844E0500]                            mov     eax, [mp3_out2_a0] ; i = 5
  3564 000021E2 8B5514                                  mov     edx, [ebp+20]
  3565 000021E5 F7EA                                    imul    edx
  3566 000021E7 035314                                  add     edx, [ebx+20]
  3567 000021EA 895314                                  mov     [ebx+20], edx
  3568 000021ED A1[904E0500]                            mov     eax, [mp3_out2_b0]
  3569 000021F2 8B552C                                  mov     edx, [ebp+44]
  3570 000021F5 F7EA                                    imul    edx
  3571 000021F7 89532C                                  mov     [ebx+44], edx
  3572 000021FA C7434400000000                          mov     dword [ebx+68], 0 ; [ebx+(2*6+i)*4]
  3573 00002201 81C704FAFFFF                            add     edi, -1532      ; (1*4) - (2*6*SBLIMIT*4) ; dst
  3574 00002207 83C640                                  add     esi, 64         ; 18*4 - (2*4) ; sb_hybrid
  3575 0000220A 83C348                                  add     ebx, 72         ; 18*4 ; mdct_buf
  3576 0000220D FF05[A44E0500]                          inc     dword [_@@@JJJ]	; next
  3577 00002213 A1[A44E0500]                            mov     eax, [_@@@JJJ]
  3578 00002218 3B05[B04E0500]                          cmp     eax, [_@@sblimit]
  3579 0000221E 0F8229FDFFFF                            jb      .imdct12_lop
  3580                                  
  3581                                  .imdct12_done:
  3582                                  		; 16/02/2025
  3583                                  
  3584                                  .no_rdtsc_supported@@@@:
  3585                                  
  3586                                  		; 16/02/2025
  3587                                  .no_rdtsc_supported@@@@@:
  3588 00002224 833D[A44E0500]20                        cmp     dword [_@@@JJJ], 32 ; SBLIMIT
  3589 0000222B 0F8333010000                            jnb     .zero_outer_done
  3590                                  
  3591                                  .zero_outer_lop:
  3592 00002231 8B03                                    mov     eax, [ebx]      ; zero bands
  3593                                                                          ; IRP nn,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17
  3594                                                                          ;  mov  eax,dword ptr [ebx+nn*4]
  3595                                                                          ;  mov  dword ptr [ebx+nn*4],0
  3596                                                                          ;  mov  dword ptr [edi+nn*SBLIMIT*4],eax ; [dst]
  3597                                                                          ; ENDM
  3598 00002233 C70300000000                            mov     dword [ebx], 0 ; nn = 0
  3599 00002239 8907                                    mov     [edi], eax
  3600 0000223B 8B4304                                  mov     eax, [ebx+4]    ; nn = 1
  3601 0000223E C7430400000000                          mov     dword [ebx+4], 0
  3602 00002245 898780000000                            mov     [edi+128], eax
  3603 0000224B 8B4308                                  mov     eax, [ebx+8]
  3604 0000224E C7430800000000                          mov     dword [ebx+8], 0
  3605 00002255 898700010000                            mov     [edi+256], eax
  3606 0000225B 8B430C                                  mov     eax, [ebx+12]
  3607 0000225E C7430C00000000                          mov     dword [ebx+12], 0
  3608 00002265 898780010000                            mov     [edi+384], eax
  3609 0000226B 8B4310                                  mov     eax, [ebx+16]   ; nn = 4
  3610 0000226E C7431000000000                          mov     dword [ebx+16], 0
  3611 00002275 898700020000                            mov     [edi+512], eax
  3612 0000227B 8B4314                                  mov     eax, [ebx+20]
  3613 0000227E C7431400000000                          mov     dword [ebx+20], 0
  3614 00002285 898780020000                            mov     [edi+640], eax  ; [edi+5*SBLIMIT*4]
  3615 0000228B 8B4318                                  mov     eax, [ebx+24]
  3616 0000228E C7431800000000                          mov     dword [ebx+24], 0
  3617 00002295 898700030000                            mov     [edi+768], eax
  3618 0000229B 8B431C                                  mov     eax, [ebx+28]   ; nn = 7
  3619 0000229E C7431C00000000                          mov     dword [ebx+28], 0
  3620 000022A5 898780030000                            mov     [edi+896], eax
  3621 000022AB 8B4320                                  mov     eax, [ebx+32]
  3622 000022AE C7432000000000                          mov     dword [ebx+32], 0
  3623 000022B5 898700040000                            mov     [edi+1024], eax ; [edi+8*SBLIMIT*4]
  3624 000022BB 8B4324                                  mov     eax, [ebx+36]
  3625 000022BE C7432400000000                          mov     dword [ebx+36], 0
  3626 000022C5 898780040000                            mov     [edi+1152], eax
  3627 000022CB 8B4328                                  mov     eax, [ebx+40]
  3628 000022CE C7432800000000                          mov     dword [ebx+40], 0
  3629 000022D5 898700050000                            mov     [edi+1280], eax
  3630 000022DB 8B432C                                  mov     eax, [ebx+44]
  3631 000022DE C7432C00000000                          mov     dword [ebx+44], 0
  3632 000022E5 898780050000                            mov     [edi+1408], eax
  3633 000022EB 8B4330                                  mov     eax, [ebx+48]
  3634 000022EE C7433000000000                          mov     dword [ebx+48], 0
  3635 000022F5 898700060000                            mov     [edi+1536], eax
  3636 000022FB 8B4334                                  mov     eax, [ebx+52]
  3637 000022FE C7433400000000                          mov     dword [ebx+52], 0
  3638 00002305 898780060000                            mov     [edi+1664], eax
  3639 0000230B 8B4338                                  mov     eax, [ebx+56]
  3640 0000230E C7433800000000                          mov     dword [ebx+56], 0
  3641 00002315 898700070000                            mov     [edi+1792], eax
  3642 0000231B 8B433C                                  mov     eax, [ebx+60]
  3643 0000231E C7433C00000000                          mov     dword [ebx+60], 0
  3644 00002325 898780070000                            mov     [edi+1920], eax
  3645 0000232B 8B4340                                  mov     eax, [ebx+64]
  3646 0000232E C7434000000000                          mov     dword [ebx+64], 0 ; [edi+16*SBLIMIT*4]
  3647 00002335 898700080000                            mov     [edi+2048], eax
  3648 0000233B 8B4344                                  mov     eax, [ebx+68]   ; nn = 17
  3649 0000233E C7434400000000                          mov     dword [ebx+68], 0
  3650 00002345 898780080000                            mov     [edi+2176], eax ; ENDM
  3651 0000234B 83C348                                  add     ebx, 72         ; 18*4
  3652 0000234E 83C704                                  add     edi, 4
  3653 00002351 FF05[A44E0500]                          inc     dword [_@@@JJJ]
  3654 00002357 833D[A44E0500]20                        cmp     dword [_@@@JJJ], 32
  3655 0000235E 0F82CDFEFFFF                            jb      .zero_outer_lop
  3656                                  
  3657                                  .zero_outer_done:
  3658                                  		; 16/02/2025
  3659                                  
  3660                                  .no_rdtsc_supported@@@@@@:
  3661 00002364 5B                                      pop     ebx
  3662                                  
  3663                                  		; 16/02/2025
  3664                                  .no_rdtsc_supported@@@@@@@:
  3665 00002365 C3                                      retn
  3666                                  
  3667                                  
  3668                                  ; =============== S U B R O U T I N E =======================================
  3669                                  
  3670                                  
  3671                                  mp3_dct32_shift_0:
  3672 00002366 8B06                                    mov     eax, [esi]      ; mp3_dct32_macro macro rate_shift ; rate_shift = 0
  3673 00002368 8B567C                                  mov     edx, [esi+124]  ; @@BF macro a,b,sign,cos,shift
  3674                                                                          ; @@BF 0,31,+,COS0_0,1
  3675                                                                          ; @@need_a equ (rate_shift EQ 0) or (a LT 16) ; a = 0
  3676                                                                          ; @@need_b equ (rate_shift EQ 0) or (b LT 16) ; b = 31
  3677                                                                          ; IF @@need_a AND @@need_b ; rate_shift = 0
  3678                                                                          ;    mov eax,dword ptr [esi+a*4]
  3679                                                                          ;    mov edx,dword ptr [esi+b*4]
  3680                                                                          ;    add dword ptr [esi+a*4],edx
  3681 0000236B 0116                                    add     [esi], edx
  3682 0000236D 29D0                                    sub     eax, edx
  3683 0000236F D1E0                                    shl     eax, 1          ; shl  eax,shift
  3684                                                                          ; (needed when COS.fraction is less than 32bit)
  3685 00002371 BA51C21340                              mov     edx, 4013C251h  ; sign&&cos ; +COS0_0 = 4013C251h
  3686 00002376 F7EA                                    imul    edx
  3687 00002378 89567C                                  mov     [esi+124], edx  ; [esi+b*4] ; upper 32bit of multiply result
  3688 0000237B 8B463C                                  mov     eax, [esi+60]   ; @@BF 15,16,+,COS0_15,5
  3689                                                                          ; [esi+a*4]
  3690 0000237E 8B5640                                  mov     edx, [esi+64]   ; [esi+b*4]
  3691 00002381 01563C                                  add     [esi+60], edx   ; [esi+a*4]
  3692 00002384 29D0                                    sub     eax, edx
  3693 00002386 C1E005                                  shl     eax, 5          ; shl eax,shift
  3694 00002389 BAFB228551                              mov     edx, 518522FBh  ; sign&&cos ; +COS0_15 = 518522FBh
  3695 0000238E F7EA                                    imul    edx
  3696 00002390 895640                                  mov     [esi+64], edx   ; [esi+b*4]
  3697 00002393 8B06                                    mov     eax, [esi]      ; @@BF 0,15,+,COS1_0,1
  3698 00002395 8B563C                                  mov     edx, [esi+60]
  3699 00002398 0116                                    add     [esi], edx
  3700 0000239A 29D0                                    sub     eax, edx
  3701 0000239C D1E0                                    shl     eax, 1
  3702 0000239E BA72464F40                              mov     edx, 404F4672h  ; +COS1_0
  3703 000023A3 F7EA                                    imul    edx
  3704 000023A5 89563C                                  mov     [esi+60], edx
  3705 000023A8 8B4640                                  mov     eax, [esi+64]   ; @@BF 16,31,-,COS1_0,1
  3706 000023AB 8B567C                                  mov     edx, [esi+124]
  3707 000023AE 015640                                  add     [esi+64], edx
  3708 000023B1 29D0                                    sub     eax, edx
  3709 000023B3 D1E0                                    shl     eax, 1
  3710 000023B5 BA8EB9B0BF                              mov     edx, 0BFB0B98Eh ; -COS1_0
  3711 000023BA F7EA                                    imul    edx
  3712 000023BC 89567C                                  mov     [esi+124], edx
  3713 000023BF 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,24,+,COS0_7,1
  3714 000023C2 8B5660                                  mov     edx, [esi+96]
  3715 000023C5 01561C                                  add     [esi+28], edx
  3716 000023C8 29D0                                    sub     eax, edx
  3717 000023CA D1E0                                    shl     eax, 1
  3718 000023CC BAA71E6056                              mov     edx, 56601EA7h
  3719 000023D1 F7EA                                    imul    edx
  3720 000023D3 895660                                  mov     [esi+96], edx
  3721 000023D6 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,23,+,COS0_8,1
  3722 000023D9 8B565C                                  mov     edx, [esi+92]
  3723 000023DC 015620                                  add     [esi+32], edx
  3724 000023DF 29D0                                    sub     eax, edx
  3725 000023E1 D1E0                                    shl     eax, 1
  3726 000023E3 BAECF64C5F                              mov     edx, 5F4CF6ECh
  3727 000023E8 F7EA                                    imul    edx
  3728 000023EA 89565C                                  mov     [esi+92], edx
  3729 000023ED 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,8,+,COS1_7,4
  3730 000023F0 8B5620                                  mov     edx, [esi+32]
  3731 000023F3 01561C                                  add     [esi+28], edx
  3732 000023F6 29D0                                    sub     eax, edx
  3733 000023F8 C1E004                                  shl     eax, 4
  3734 000023FB BA044E9E51                              mov     edx, 519E4E04h
  3735 00002400 F7EA                                    imul    edx
  3736 00002402 895620                                  mov     [esi+32], edx
  3737 00002405 8B465C                                  mov     eax, [esi+92]   ; @@BF 23,24,-,COS1_7,4
  3738 00002408 8B5660                                  mov     edx, [esi+96]
  3739 0000240B 01565C                                  add     [esi+92], edx
  3740 0000240E 29D0                                    sub     eax, edx
  3741 00002410 C1E004                                  shl     eax, 4
  3742 00002413 BAFCB161AE                              mov     edx, 0AE61B1FCh
  3743 00002418 F7EA                                    imul    edx
  3744 0000241A 895660                                  mov     [esi+96], edx
  3745 0000241D 8B06                                    mov     eax, [esi]      ; @@BF 0,7,+,COS2_0,1
  3746 0000241F 8B561C                                  mov     edx, [esi+28]
  3747 00002422 0116                                    add     [esi], edx
  3748 00002424 29D0                                    sub     eax, edx
  3749 00002426 D1E0                                    shl     eax, 1
  3750 00002428 BA46FB4041                              mov     edx, 4140FB46h
  3751 0000242D F7EA                                    imul    edx
  3752 0000242F 89561C                                  mov     [esi+28], edx
  3753 00002432 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,15,-,COS2_0,1
  3754 00002435 8B563C                                  mov     edx, [esi+60]
  3755 00002438 015620                                  add     [esi+32], edx
  3756 0000243B 29D0                                    sub     eax, edx
  3757 0000243D D1E0                                    shl     eax, 1
  3758 0000243F BABA04BFBE                              mov     edx, 0BEBF04BAh
  3759 00002444 F7EA                                    imul    edx
  3760 00002446 89563C                                  mov     [esi+60], edx
  3761 00002449 8B4640                                  mov     eax, [esi+64]   ; @@BF 16,23,+,COS2_0,1
  3762 0000244C 8B565C                                  mov     edx, [esi+92]
  3763 0000244F 015640                                  add     [esi+40h], edx
  3764 00002452 29D0                                    sub     eax, edx
  3765 00002454 D1E0                                    shl     eax, 1
  3766 00002456 BA46FB4041                              mov     edx, 4140FB46h
  3767 0000245B F7EA                                    imul    edx
  3768 0000245D 89565C                                  mov     [esi+92], edx
  3769 00002460 8B4660                                  mov     eax, [esi+96]   ; @@BF 24,31,-,COS2_0,1
  3770 00002463 8B567C                                  mov     edx, [esi+124]
  3771 00002466 015660                                  add     [esi+96], edx
  3772 00002469 29D0                                    sub     eax, edx
  3773 0000246B D1E0                                    shl     eax, 1
  3774 0000246D BABA04BFBE                              mov     edx, 0BEBF04BAh
  3775 00002472 F7EA                                    imul    edx
  3776 00002474 89567C                                  mov     [esi+124], edx
  3777 00002477 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,28,+,COS0_3,1
  3778 0000247A 8B5670                                  mov     edx, [esi+112]
  3779 0000247D 01560C                                  add     [esi+12], edx
  3780 00002480 29D0                                    sub     eax, edx
  3781 00002482 D1E0                                    shl     eax, 1
  3782 00002484 BA2134F943                              mov     edx, 43F93421h
  3783 00002489 F7EA                                    imul    edx
  3784 0000248B 895670                                  mov     [esi+112], edx
  3785 0000248E 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,19,+,COS0_12,2
  3786 00002491 8B564C                                  mov     edx, [esi+76]
  3787 00002494 015630                                  add     [esi+48], edx
  3788 00002497 29D0                                    sub     eax, edx
  3789 00002499 C1E002                                  shl     eax, 2
  3790 0000249C BA978DFC5E                              mov     edx, 5EFC8D97h
  3791 000024A1 F7EA                                    imul    edx
  3792 000024A3 89564C                                  mov     [esi+76], edx
  3793 000024A6 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,12,+,COS1_3,1
  3794 000024A9 8B5630                                  mov     edx, [esi+48]
  3795 000024AC 01560C                                  add     [esi+12], edx
  3796 000024AF 29D0                                    sub     eax, edx
  3797 000024B1 D1E0                                    shl     eax, 1
  3798 000024B3 BA630ECB52                              mov     edx, 52CB0E63h
  3799 000024B8 F7EA                                    imul    edx
  3800 000024BA 895630                                  mov     [esi+48], edx
  3801 000024BD 8B464C                                  mov     eax, [esi+76]   ; @@BF 19,28,-,COS1_3,1
  3802 000024C0 8B5670                                  mov     edx, [esi+112]
  3803 000024C3 01564C                                  add     [esi+76], edx
  3804 000024C6 29D0                                    sub     eax, edx
  3805 000024C8 D1E0                                    shl     eax, 1
  3806 000024CA BA9DF134AD                              mov     edx, 0AD34F19Dh
  3807 000024CF F7EA                                    imul    edx
  3808 000024D1 895670                                  mov     [esi+112], edx
  3809 000024D4 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,27,+,COS0_4,1
  3810 000024D7 8B566C                                  mov     edx, [esi+108]
  3811 000024DA 015610                                  add     [esi+16], edx
  3812 000024DD 29D0                                    sub     eax, edx
  3813 000024DF D1E0                                    shl     eax, 1
  3814 000024E1 BAC51BCC46                              mov     edx, 46CC1BC5h
  3815 000024E6 F7EA                                    imul    edx
  3816 000024E8 89566C                                  mov     [esi+108], edx
  3817 000024EB 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,20,+,COS0_11,2
  3818 000024EE 8B5650                                  mov     edx, [esi+80]
  3819 000024F1 01562C                                  add     [esi+44], edx
  3820 000024F4 29D0                                    sub     eax, edx
  3821 000024F6 C1E002                                  shl     eax, 2
  3822 000024F9 BA981AD84A                              mov     edx, 4AD81A98h
  3823 000024FE F7EA                                    imul    edx
  3824 00002500 895650                                  mov     [esi+80], edx
  3825 00002503 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,11,+,COS1_4,1
  3826 00002506 8B562C                                  mov     edx, [esi+44]
  3827 00002509 015610                                  add     [esi+16], edx
  3828 0000250C 29D0                                    sub     eax, edx
  3829 0000250E D1E0                                    shl     eax, 1
  3830 00002510 BA2E40E264                              mov     edx, 64E2402Eh
  3831 00002515 F7EA                                    imul    edx
  3832 00002517 89562C                                  mov     [esi+44], edx
  3833 0000251A 8B4650                                  mov     eax, [esi+80]   ; @@BF 20,27,-,COS1_4,1
  3834 0000251D 8B566C                                  mov     edx, [esi+108]
  3835 00002520 015650                                  add     [esi+80], edx
  3836 00002523 29D0                                    sub     eax, edx
  3837 00002525 D1E0                                    shl     eax, 1
  3838 00002527 BAD2BF1D9B                              mov     edx, 9B1DBFD2h
  3839 0000252C F7EA                                    imul    edx
  3840 0000252E 89566C                                  mov     [esi+108], edx
  3841 00002531 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,4,+,COS2_3,3
  3842 00002534 8B5610                                  mov     edx, [esi+16]
  3843 00002537 01560C                                  add     [esi+12], edx
  3844 0000253A 29D0                                    sub     eax, edx
  3845 0000253C C1E003                                  shl     eax, 3
  3846 0000253F BA42670352                              mov     edx, 52036742h
  3847 00002544 F7EA                                    imul    edx
  3848 00002546 895610                                  mov     [esi+16], edx
  3849 00002549 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,12,-,COS2_3,3
  3850 0000254C 8B5630                                  mov     edx, [esi+48]
  3851 0000254F 01562C                                  add     [esi+44], edx
  3852 00002552 29D0                                    sub     eax, edx
  3853 00002554 C1E003                                  shl     eax, 3
  3854 00002557 BABE98FCAD                              mov     edx, 0ADFC98BEh ; -COS2_3
  3855 0000255C F7EA                                    imul    edx
  3856 0000255E 895630                                  mov     [esi+48], edx
  3857 00002561 8B464C                                  mov     eax, [esi+76]   ; @@BF 19,20,+,COS2_3,3
  3858 00002564 8B5650                                  mov     edx, [esi+80]
  3859 00002567 01564C                                  add     [esi+4Ch], edx
  3860 0000256A 29D0                                    sub     eax, edx
  3861 0000256C C1E003                                  shl     eax, 3
  3862 0000256F BA42670352                              mov     edx, 52036742h  ; +COS2_3
  3863 00002574 F7EA                                    imul    edx
  3864 00002576 895650                                  mov     [esi+80], edx
  3865 00002579 8B466C                                  mov     eax, [esi+108]  ; @@BF 27,28,-,COS2_3,3
  3866 0000257C 8B5670                                  mov     edx, [esi+112]
  3867 0000257F 01566C                                  add     [esi+108], edx
  3868 00002582 29D0                                    sub     eax, edx
  3869 00002584 C1E003                                  shl     eax, 3
  3870 00002587 BABE98FCAD                              mov     edx, 0ADFC98BEh
  3871 0000258C F7EA                                    imul    edx
  3872 0000258E 895670                                  mov     [esi+112], edx
  3873 00002591 8B06                                    mov     eax, [esi]      ; @@BF 0,3,+,COS3_0,1
  3874 00002593 8B560C                                  mov     edx, [esi+12]
  3875 00002596 0116                                    add     [esi], edx
  3876 00002598 29D0                                    sub     eax, edx
  3877 0000259A D1E0                                    shl     eax, 1
  3878 0000259C BAF0E94545                              mov     edx, 4545E9F0h
  3879 000025A1 F7EA                                    imul    edx
  3880 000025A3 89560C                                  mov     [esi+12], edx
  3881 000025A6 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,7,-,COS3_0,1
  3882 000025A9 8B561C                                  mov     edx, [esi+28]
  3883 000025AC 015610                                  add     [esi+16], edx
  3884 000025AF 29D0                                    sub     eax, edx
  3885 000025B1 D1E0                                    shl     eax, 1
  3886 000025B3 BA1016BABA                              mov     edx, 0BABA1610h
  3887 000025B8 F7EA                                    imul    edx
  3888 000025BA 89561C                                  mov     [esi+28], edx
  3889 000025BD 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,11,+,COS3_0,1
  3890 000025C0 8B562C                                  mov     edx, [esi+44]
  3891 000025C3 015620                                  add     [esi+32], edx
  3892 000025C6 29D0                                    sub     eax, edx
  3893 000025C8 D1E0                                    shl     eax, 1
  3894 000025CA BAF0E94545                              mov     edx, 4545E9F0h
  3895 000025CF F7EA                                    imul    edx
  3896 000025D1 89562C                                  mov     [esi+44], edx
  3897 000025D4 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,15,-,COS3_0,1
  3898 000025D7 8B563C                                  mov     edx, [esi+60]
  3899 000025DA 015630                                  add     [esi+48], edx
  3900 000025DD 29D0                                    sub     eax, edx
  3901 000025DF D1E0                                    shl     eax, 1
  3902 000025E1 BA1016BABA                              mov     edx, 0BABA1610h
  3903 000025E6 F7EA                                    imul    edx
  3904 000025E8 89563C                                  mov     [esi+60], edx
  3905 000025EB 8B4640                                  mov     eax, [esi+64]   ; @@BF 16,19,+,COS3_0,1
  3906 000025EE 8B564C                                  mov     edx, [esi+76]
  3907 000025F1 015640                                  add     [esi+64], edx
  3908 000025F4 29D0                                    sub     eax, edx
  3909 000025F6 D1E0                                    shl     eax, 1
  3910 000025F8 BAF0E94545                              mov     edx, 4545E9F0h
  3911 000025FD F7EA                                    imul    edx
  3912 000025FF 89564C                                  mov     [esi+76], edx
  3913 00002602 8B4650                                  mov     eax, [esi+80]   ; @@BF 20,23,-,COS3_0,1
  3914 00002605 8B565C                                  mov     edx, [esi+92]
  3915 00002608 015650                                  add     [esi+80], edx
  3916 0000260B 29D0                                    sub     eax, edx
  3917 0000260D D1E0                                    shl     eax, 1
  3918 0000260F BA1016BABA                              mov     edx, 0BABA1610h ; -COS3_0
  3919 00002614 F7EA                                    imul    edx
  3920 00002616 89565C                                  mov     [esi+92], edx
  3921 00002619 8B4660                                  mov     eax, [esi+96]   ; @@BF 24,27,+,COS3_0,1
  3922 0000261C 8B566C                                  mov     edx, [esi+108]
  3923 0000261F 015660                                  add     [esi+96], edx
  3924 00002622 29D0                                    sub     eax, edx
  3925 00002624 D1E0                                    shl     eax, 1
  3926 00002626 BAF0E94545                              mov     edx, 4545E9F0h  ; +COS3_0
  3927 0000262B F7EA                                    imul    edx
  3928 0000262D 89566C                                  mov     [esi+108], edx
  3929 00002630 8B4670                                  mov     eax, [esi+112]  ; @@BF 28,31,-,COS3_0,1
  3930 00002633 8B567C                                  mov     edx, [esi+124]
  3931 00002636 015670                                  add     [esi+112], edx
  3932 00002639 29D0                                    sub     eax, edx
  3933 0000263B D1E0                                    shl     eax, 1
  3934 0000263D BA1016BABA                              mov     edx, 0BABA1610h
  3935 00002642 F7EA                                    imul    edx
  3936 00002644 89567C                                  mov     [esi+124], edx
  3937 00002647 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,30,+,COS0_1,1
  3938 0000264A 8B5678                                  mov     edx, [esi+120]
  3939 0000264D 015604                                  add     [esi+4], edx
  3940 00002650 29D0                                    sub     eax, edx
  3941 00002652 D1E0                                    shl     eax, 1
  3942 00002654 BABD45B340                              mov     edx, 40B345BDh
  3943 00002659 F7EA                                    imul    edx
  3944 0000265B 895678                                  mov     [esi+120], edx
  3945 0000265E 8B4638                                  mov     eax, [esi+56]   ; @@BF 14,17,+,COS0_14,3
  3946 00002661 8B5644                                  mov     edx, [esi+68]
  3947 00002664 015638                                  add     [esi+56], edx
  3948 00002667 29D0                                    sub     eax, edx
  3949 00002669 C1E003                                  shl     eax, 3
  3950 0000266C BAD0200B6D                              mov     edx, 6D0B20D0h
  3951 00002671 F7EA                                    imul    edx
  3952 00002673 895644                                  mov     [esi+68], edx
  3953 00002676 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,14,+,COS1_1,1
  3954 00002679 8B5638                                  mov     edx, [esi+56]
  3955 0000267C 015604                                  add     [esi+4], edx
  3956 0000267F 29D0                                    sub     eax, edx
  3957 00002681 D1E0                                    shl     eax, 1
  3958 00002683 BA103CE142                              mov     edx, 42E13C10h
  3959 00002688 F7EA                                    imul    edx
  3960 0000268A 895638                                  mov     [esi+56], edx
  3961 0000268D 8B4644                                  mov     eax, [esi+68]   ; @@BF 17,30,-,COS1_1,1
  3962 00002690 8B5678                                  mov     edx, [esi+120]
  3963 00002693 015644                                  add     [esi+68], edx
  3964 00002696 29D0                                    sub     eax, edx
  3965 00002698 D1E0                                    shl     eax, 1
  3966 0000269A BAF0C31EBD                              mov     edx, 0BD1EC3F0h
  3967 0000269F F7EA                                    imul    edx
  3968 000026A1 895678                                  mov     [esi+120], edx
  3969 000026A4 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,25,+,COS0_6,1
  3970 000026A7 8B5664                                  mov     edx, [esi+100]
  3971 000026AA 015618                                  add     [esi+24], edx
  3972 000026AD 29D0                                    sub     eax, edx
  3973 000026AF D1E0                                    shl     eax, 1
  3974 000026B1 BA1237AE4F                              mov     edx, 4FAE3712h
  3975 000026B6 F7EA                                    imul    edx
  3976 000026B8 895664                                  mov     [esi+100], edx
  3977 000026BB 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,22,+,COS0_9,1
  3978 000026BE 8B5658                                  mov     edx, [esi+88]
  3979 000026C1 015624                                  add     [esi+36], edx
  3980 000026C4 29D0                                    sub     eax, edx
  3981 000026C6 D1E0                                    shl     eax, 1
  3982 000026C8 BA27CF6F6B                              mov     edx, 6B6FCF27h
  3983 000026CD F7EA                                    imul    edx
  3984 000026CF 895658                                  mov     [esi+88], edx
  3985 000026D2 8B4618                                  mov     eax, [esi+24]   ; @@BF 6, 9,+,COS1_6,2
  3986 000026D5 8B5624                                  mov     edx, [esi+36]
  3987 000026D8 015618                                  add     [esi+24], edx
  3988 000026DB 29D0                                    sub     eax, edx
  3989 000026DD C1E002                                  shl     eax, 2
  3990 000026E0 BAC2923C6E                              mov     edx, 6E3C92C2h
  3991 000026E5 F7EA                                    imul    edx
  3992 000026E7 895624                                  mov     [esi+36], edx
  3993 000026EA 8B4658                                  mov     eax, [esi+88]   ; @@BF 22,25,-,COS1_6,2
  3994 000026ED 8B5664                                  mov     edx, [esi+100]
  3995 000026F0 015658                                  add     [esi+88], edx
  3996 000026F3 29D0                                    sub     eax, edx
  3997 000026F5 C1E002                                  shl     eax, 2
  3998 000026F8 BA3E6DC391                              mov     edx, 91C36D3Eh
  3999 000026FD F7EA                                    imul    edx
  4000 000026FF 895664                                  mov     [esi+100], edx
  4001 00002702 8B4604                                  mov     eax, [esi+4]    ; @@BF 1, 6,+,COS2_1,1
  4002 00002705 8B5618                                  mov     edx, [esi+24]
  4003 00002708 015604                                  add     [esi+4], edx
  4004 0000270B 29D0                                    sub     eax, edx
  4005 0000270D D1E0                                    shl     eax, 1
  4006 0000270F BA88DEF84C                              mov     edx, 4CF8DE88h
  4007 00002714 F7EA                                    imul    edx
  4008 00002716 895618                                  mov     [esi+24], edx
  4009 00002719 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,14,-,COS2_1,1
  4010 0000271C 8B5638                                  mov     edx, [esi+56]
  4011 0000271F 015624                                  add     [esi+36], edx
  4012 00002722 29D0                                    sub     eax, edx
  4013 00002724 D1E0                                    shl     eax, 1
  4014 00002726 BA782107B3                              mov     edx, 0B3072178h
  4015 0000272B F7EA                                    imul    edx
  4016 0000272D 895638                                  mov     [esi+56], edx
  4017 00002730 8B4644                                  mov     eax, [esi+68]   ; @@BF 17,22,+,COS2_1,1
  4018 00002733 8B5658                                  mov     edx, [esi+88]
  4019 00002736 015644                                  add     [esi+68], edx
  4020 00002739 29D0                                    sub     eax, edx
  4021 0000273B D1E0                                    shl     eax, 1
  4022 0000273D BA88DEF84C                              mov     edx, 4CF8DE88h
  4023 00002742 F7EA                                    imul    edx
  4024 00002744 895658                                  mov     [esi+88], edx
  4025 00002747 8B4664                                  mov     eax, [esi+100]  ; @@BF 25,30,-,COS2_1,1
  4026 0000274A 8B5678                                  mov     edx, [esi+120]
  4027 0000274D 015664                                  add     [esi+100], edx
  4028 00002750 29D0                                    sub     eax, edx
  4029 00002752 D1E0                                    shl     eax, 1
  4030 00002754 BA782107B3                              mov     edx, 0B3072178h
  4031 00002759 F7EA                                    imul    edx
  4032 0000275B 895678                                  mov     [esi+120], edx
  4033 0000275E 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,29,+,COS0_2,1
  4034 00002761 8B5674                                  mov     edx, [esi+116]
  4035 00002764 015608                                  add     [esi+8], edx
  4036 00002767 29D0                                    sub     eax, edx
  4037 00002769 D1E0                                    shl     eax, 1
  4038 0000276B BA6E2DFA41                              mov     edx, 41FA2D6Eh
  4039 00002770 F7EA                                    imul    edx
  4040 00002772 895674                                  mov     [esi+116], edx
  4041 00002775 8B4634                                  mov     eax, [esi+52]   ; @@BF 13,18,+,COS0_13,3
  4042 00002778 8B5648                                  mov     edx, [esi+72]
  4043 0000277B 015634                                  add     [esi+52], edx
  4044 0000277E 29D0                                    sub     eax, edx
  4045 00002780 C1E003                                  shl     eax, 3
  4046 00002783 BA9057D941                              mov     edx, 41D95790h
  4047 00002788 F7EA                                    imul    edx
  4048 0000278A 895648                                  mov     [esi+72], edx
  4049 0000278D 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,13,+,COS1_2,1
  4050 00002790 8B5634                                  mov     edx, [esi+52]
  4051 00002793 015608                                  add     [esi+8], edx
  4052 00002796 29D0                                    sub     eax, edx
  4053 00002798 D1E0                                    shl     eax, 1
  4054 0000279A BA459F9148                              mov     edx, 48919F45h
  4055 0000279F F7EA                                    imul    edx
  4056 000027A1 895634                                  mov     [esi+52], edx
  4057 000027A4 8B4648                                  mov     eax, [esi+72]   ; @@BF 18,29,-,COS1_2,1
  4058 000027A7 8B5674                                  mov     edx, [esi+116]
  4059 000027AA 015648                                  add     [esi+72], edx
  4060 000027AD 29D0                                    sub     eax, edx
  4061 000027AF D1E0                                    shl     eax, 1
  4062 000027B1 BABB606EB7                              mov     edx, 0B76E60BBh
  4063 000027B6 F7EA                                    imul    edx
  4064 000027B8 895674                                  mov     [esi+116], edx
  4065 000027BB 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,26,+,COS0_5,1
  4066 000027BE 8B5668                                  mov     edx, [esi+104]
  4067 000027C1 015614                                  add     [esi+20], edx
  4068 000027C4 29D0                                    sub     eax, edx
  4069 000027C6 D1E0                                    shl     eax, 1
  4070 000027C8 BAF19C9D4A                              mov     edx, 4A9D9CF1h
  4071 000027CD F7EA                                    imul    edx
  4072 000027CF 895668                                  mov     [esi+104], edx
  4073 000027D2 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,21,+,COS0_10,1
  4074 000027D5 8B5654                                  mov     edx, [esi+84]
  4075 000027D8 015628                                  add     [esi+40], edx
  4076 000027DB 29D0                                    sub     eax, edx
  4077 000027DD D1E0                                    shl     eax, 1
  4078 000027DF BAB41D7D7C                              mov     edx, 7C7D1DB4h
  4079 000027E4 F7EA                                    imul    edx
  4080 000027E6 895654                                  mov     [esi+84], edx
  4081 000027E9 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,10,+,COS1_5,2
  4082 000027EC 8B5628                                  mov     edx, [esi+40]
  4083 000027EF 015614                                  add     [esi+20], edx
  4084 000027F2 29D0                                    sub     eax, edx
  4085 000027F4 C1E002                                  shl     eax, 2
  4086 000027F7 BAAA24E243                              mov     edx, 43E224AAh
  4087 000027FC F7EA                                    imul    edx
  4088 000027FE 895628                                  mov     [esi+40], edx
  4089 00002801 8B4654                                  mov     eax, [esi+84]   ; @@BF 21,26,-,COS1_5,2
  4090 00002804 8B5668                                  mov     edx, [esi+104]
  4091 00002807 015654                                  add     [esi+84], edx
  4092 0000280A 29D0                                    sub     eax, edx
  4093 0000280C C1E002                                  shl     eax, 2
  4094 0000280F BA56DB1DBC                              mov     edx, 0BC1DDB56h
  4095 00002814 F7EA                                    imul    edx
  4096 00002816 895668                                  mov     [esi+104], edx
  4097 00002819 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,5,+,COS2_2,1
  4098 0000281C 8B5614                                  mov     edx, [esi+20]
  4099 0000281F 015608                                  add     [esi+8], edx
  4100 00002822 29D0                                    sub     eax, edx
  4101 00002824 D1E0                                    shl     eax, 1
  4102 00002826 BABF6B3273                              mov     edx, 73326BBFh  ; +COS2_2
  4103 0000282B F7EA                                    imul    edx
  4104 0000282D 895614                                  mov     [esi+20], edx
  4105 00002830 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,13,-,COS2_2,1
  4106 00002833 8B5634                                  mov     edx, [esi+52]
  4107 00002836 015628                                  add     [esi+40], edx
  4108 00002839 29D0                                    sub     eax, edx
  4109 0000283B D1E0                                    shl     eax, 1
  4110 0000283D BA4194CD8C                              mov     edx, 8CCD9441h  ; -COS2_2
  4111 00002842 F7EA                                    imul    edx
  4112 00002844 895634                                  mov     [esi+52], edx
  4113 00002847 8B4648                                  mov     eax, [esi+72]   ; @@BF 18,21,+,COS2_2,1
  4114 0000284A 8B5654                                  mov     edx, [esi+84]
  4115 0000284D 015648                                  add     [esi+72], edx
  4116 00002850 29D0                                    sub     eax, edx
  4117 00002852 D1E0                                    shl     eax, 1
  4118 00002854 BABF6B3273                              mov     edx, 73326BBFh
  4119 00002859 F7EA                                    imul    edx
  4120 0000285B 895654                                  mov     [esi+84], edx
  4121 0000285E 8B4668                                  mov     eax, [esi+104]  ; @@BF 26,29,-,COS2_2,1
  4122 00002861 8B5674                                  mov     edx, [esi+116]
  4123 00002864 015668                                  add     [esi+104], edx
  4124 00002867 29D0                                    sub     eax, edx
  4125 00002869 D1E0                                    shl     eax, 1
  4126 0000286B BA4194CD8C                              mov     edx, 8CCD9441h
  4127 00002870 F7EA                                    imul    edx
  4128 00002872 895674                                  mov     [esi+116], edx
  4129 00002875 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,2,+,COS3_1,2
  4130 00002878 8B5608                                  mov     edx, [esi+8]
  4131 0000287B 015604                                  add     [esi+4], edx
  4132 0000287E 29D0                                    sub     eax, edx
  4133 00002880 C1E002                                  shl     eax, 2
  4134 00002883 BA46BA9E53                              mov     edx, 539EBA46h
  4135 00002888 F7EA                                    imul    edx
  4136 0000288A 895608                                  mov     [esi+8], edx
  4137 0000288D 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,6,-,COS3_1,2
  4138 00002890 8B5618                                  mov     edx, [esi+24]
  4139 00002893 015614                                  add     [esi+20], edx
  4140 00002896 29D0                                    sub     eax, edx
  4141 00002898 C1E002                                  shl     eax, 2
  4142 0000289B BABA4561AC                              mov     edx, 0AC6145BAh
  4143 000028A0 F7EA                                    imul    edx
  4144 000028A2 895618                                  mov     [esi+24], edx
  4145 000028A5 8B4624                                  mov     eax, [esi+36]   ; IF rate_shift LT 2
  4146                                                                          ; @@BF 9,10,+,COS3_1,2
  4147 000028A8 8B5628                                  mov     edx, [esi+40]
  4148 000028AB 015624                                  add     [esi+36], edx
  4149 000028AE 29D0                                    sub     eax, edx
  4150 000028B0 C1E002                                  shl     eax, 2
  4151 000028B3 BA46BA9E53                              mov     edx, 539EBA46h
  4152 000028B8 F7EA                                    imul    edx
  4153 000028BA 895628                                  mov     [esi+40], edx
  4154 000028BD 8B4634                                  mov     eax, [esi+52]   ; @@BF 13,14,-,COS3_1,2
  4155 000028C0 8B5638                                  mov     edx, [esi+56]
  4156 000028C3 015634                                  add     [esi+52], edx
  4157 000028C6 29D0                                    sub     eax, edx
  4158 000028C8 C1E002                                  shl     eax, 2
  4159 000028CB BABA4561AC                              mov     edx, 0AC6145BAh
  4160 000028D0 F7EA                                    imul    edx
  4161 000028D2 895638                                  mov     [esi+56], edx   ; ENDIF
  4162 000028D5 8B4644                                  mov     eax, [esi+68]   ; @@BF 17,18,+,COS3_1,2
  4163 000028D8 8B5648                                  mov     edx, [esi+72]
  4164 000028DB 015644                                  add     [esi+68], edx
  4165 000028DE 29D0                                    sub     eax, edx
  4166 000028E0 C1E002                                  shl     eax, 2
  4167 000028E3 BA46BA9E53                              mov     edx, 539EBA46h
  4168 000028E8 F7EA                                    imul    edx
  4169 000028EA 895648                                  mov     [esi+72], edx
  4170 000028ED 8B4654                                  mov     eax, [esi+84]   ; @@BF 21,22,-,COS3_1,2
  4171 000028F0 8B5658                                  mov     edx, [esi+88]
  4172 000028F3 015654                                  add     [esi+84], edx
  4173 000028F6 29D0                                    sub     eax, edx
  4174 000028F8 C1E002                                  shl     eax, 2
  4175 000028FB BABA4561AC                              mov     edx, 0AC6145BAh
  4176 00002900 F7EA                                    imul    edx
  4177 00002902 895658                                  mov     [esi+88], edx
  4178 00002905 8B4664                                  mov     eax, [esi+100]  ; @@BF 25,26,+,COS3_1,2
  4179 00002908 8B5668                                  mov     edx, [esi+104]
  4180 0000290B 015664                                  add     [esi+100], edx
  4181 0000290E 29D0                                    sub     eax, edx
  4182 00002910 C1E002                                  shl     eax, 2
  4183 00002913 BA46BA9E53                              mov     edx, 539EBA46h
  4184 00002918 F7EA                                    imul    edx
  4185 0000291A 895668                                  mov     [esi+104], edx
  4186 0000291D 8B4674                                  mov     eax, [esi+116]  ; @@BF 29,30,-,COS3_1,2
  4187 00002920 8B5678                                  mov     edx, [esi+120]
  4188 00002923 015674                                  add     [esi+116], edx
  4189 00002926 29D0                                    sub     eax, edx
  4190 00002928 C1E002                                  shl     eax, 2
  4191 0000292B BABA4561AC                              mov     edx, 0AC6145BAh
  4192 00002930 F7EA                                    imul    edx
  4193 00002932 895678                                  mov     [esi+120], edx
  4194 00002935 8B06                                    mov     eax, [esi]      ; @@BF1 macro a, b, c, d
  4195                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4196                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4197                                                                          ;   @@ADD c, d
  4198                                                                          ;  endm
  4199                                                                          ; @@BF1 0,1,2,3
  4200 00002937 8B5604                                  mov     edx, [esi+4]    ; @@BF 0,1,+,COS4_0,1
  4201 0000293A 0116                                    add     [esi], edx
  4202 0000293C 29D0                                    sub     eax, edx
  4203 0000293E D1E0                                    shl     eax, 1
  4204 00002940 BA9A79825A                              mov     edx, 5A82799Ah  ; +COS4_0
  4205 00002945 F7EA                                    imul    edx
  4206 00002947 895604                                  mov     [esi+4], edx
  4207 0000294A 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,3,-,COS4_0,1
  4208 0000294D 8B560C                                  mov     edx, [esi+12]
  4209 00002950 015608                                  add     [esi+8], edx
  4210 00002953 29D0                                    sub     eax, edx
  4211 00002955 D1E0                                    shl     eax, 1
  4212 00002957 BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  4213 0000295C F7EA                                    imul    edx
  4214 0000295E 89560C                                  mov     [esi+12], edx
  4215 00002961 8B460C                                  mov     eax, [esi+12]   ; @@ADD 2,3
  4216 00002964 014608                                  add     [esi+8], eax
  4217 00002967 8B4610                                  mov     eax, [esi+16]   ; @@BF2 macro a, b, c, d
  4218                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4219                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4220                                                                          ;   @@ADD c, d
  4221                                                                          ;   @@ADD a, c
  4222                                                                          ;   @@ADD c, b
  4223                                                                          ;   @@ADD b, d
  4224                                                                          ;  endm
  4225                                                                          ; @@BF2 4,5,6,7
  4226 0000296A 8B5614                                  mov     edx, [esi+20]   ; @@BF 4,5,+,COS4_0,1
  4227 0000296D 015610                                  add     [esi+16], edx
  4228 00002970 29D0                                    sub     eax, edx
  4229 00002972 D1E0                                    shl     eax, 1
  4230 00002974 BA9A79825A                              mov     edx, 5A82799Ah
  4231 00002979 F7EA                                    imul    edx
  4232 0000297B 895614                                  mov     [esi+20], edx
  4233 0000297E 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,7,-,COS4_0,1
  4234 00002981 8B561C                                  mov     edx, [esi+28]
  4235 00002984 015618                                  add     [esi+24], edx
  4236 00002987 29D0                                    sub     eax, edx
  4237 00002989 D1E0                                    shl     eax, 1
  4238 0000298B BA66867DA5                              mov     edx, 0A57D8666h
  4239 00002990 F7EA                                    imul    edx
  4240 00002992 89561C                                  mov     [esi+28], edx
  4241 00002995 8B461C                                  mov     eax, [esi+28]   ; @@ADD macro dst,src
  4242                                                                          ;   IF (rate_shift EQ 0) or (dst LT 16)
  4243                                                                          ;    ;tab[a] += tab[b]
  4244                                                                          ;    mov  eax,dword ptr [esi+src*4]
  4245                                                                          ;    add  dword ptr [esi+dst*4],eax
  4246                                                                          ;   ENDIF
  4247                                                                          ;  endm
  4248                                                                          ; @@ADD 6,7
  4249 00002998 014618                                  add     [esi+24], eax
  4250 0000299B 8B4618                                  mov     eax, [esi+24]   ; @@ADD 4,6
  4251 0000299E 014610                                  add     [esi+16], eax
  4252 000029A1 8B4614                                  mov     eax, [esi+20]   ; @@ADD 6,5
  4253 000029A4 014618                                  add     [esi+24], eax
  4254 000029A7 8B461C                                  mov     eax, [esi+28]   ; @@ADD 5,7
  4255 000029AA 014614                                  add     [esi+20], eax
  4256 000029AD 8B4620                                  mov     eax, [esi+32]   ; IF rate_shift LT 2
  4257                                                                          ; @@BF1 8,9,10,11
  4258 000029B0 8B5624                                  mov     edx, [esi+36]   ; @@BF 8,9,+,COS4_0,1
  4259 000029B3 015620                                  add     [esi+32], edx
  4260 000029B6 29D0                                    sub     eax, edx
  4261 000029B8 D1E0                                    shl     eax, 1
  4262 000029BA BA9A79825A                              mov     edx, 5A82799Ah
  4263 000029BF F7EA                                    imul    edx
  4264 000029C1 895624                                  mov     [esi+36], edx
  4265 000029C4 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,11,-,COS4_0,1
  4266 000029C7 8B562C                                  mov     edx, [esi+44]
  4267 000029CA 015628                                  add     [esi+40], edx
  4268 000029CD 29D0                                    sub     eax, edx
  4269 000029CF D1E0                                    shl     eax, 1
  4270 000029D1 BA66867DA5                              mov     edx, 0A57D8666h
  4271 000029D6 F7EA                                    imul    edx
  4272 000029D8 89562C                                  mov     [esi+44], edx
  4273 000029DB 8B462C                                  mov     eax, [esi+44]   ; @@ADD 10,11
  4274 000029DE 014628                                  add     [esi+40], eax
  4275 000029E1 8B4630                                  mov     eax, [esi+48]   ; @@BF2 12,13,14,15
  4276 000029E4 8B5634                                  mov     edx, [esi+52]   ; @@BF 12,13,+,COS4_0,1
  4277 000029E7 015630                                  add     [esi+48], edx
  4278 000029EA 29D0                                    sub     eax, edx
  4279 000029EC D1E0                                    shl     eax, 1
  4280 000029EE BA9A79825A                              mov     edx, 5A82799Ah
  4281 000029F3 F7EA                                    imul    edx
  4282 000029F5 895634                                  mov     [esi+52], edx
  4283 000029F8 8B4638                                  mov     eax, [esi+56]   ; @@BF 14,15,-,COS4_0,1
  4284 000029FB 8B563C                                  mov     edx, [esi+60]
  4285 000029FE 015638                                  add     [esi+56], edx
  4286 00002A01 29D0                                    sub     eax, edx
  4287 00002A03 D1E0                                    shl     eax, 1
  4288 00002A05 BA66867DA5                              mov     edx, 0A57D8666h
  4289 00002A0A F7EA                                    imul    edx
  4290 00002A0C 89563C                                  mov     [esi+60], edx
  4291 00002A0F 8B463C                                  mov     eax, [esi+60]   ; @@ADD 14,15
  4292 00002A12 014638                                  add     [esi+56], eax
  4293 00002A15 8B4638                                  mov     eax, [esi+56]   ; @@ADD 12,14
  4294 00002A18 014630                                  add     [esi+48], eax
  4295 00002A1B 8B4634                                  mov     eax, [esi+52]   ; @@ADD 14,13
  4296 00002A1E 014638                                  add     [esi+56], eax
  4297 00002A21 8B463C                                  mov     eax, [esi+60]   ; @@ADD 13,15
  4298 00002A24 014634                                  add     [esi+52], eax   ; ENDIF
  4299 00002A27 8B4640                                  mov     eax, [esi+64]   ; @@BF1 16,17,18,19
  4300 00002A2A 8B5644                                  mov     edx, [esi+68]
  4301 00002A2D 015640                                  add     [esi+64], edx
  4302 00002A30 29D0                                    sub     eax, edx
  4303 00002A32 D1E0                                    shl     eax, 1
  4304 00002A34 BA9A79825A                              mov     edx, 5A82799Ah  ; +COS4_0
  4305 00002A39 F7EA                                    imul    edx
  4306 00002A3B 895644                                  mov     [esi+68], edx
  4307 00002A3E 8B4648                                  mov     eax, [esi+72]
  4308 00002A41 8B564C                                  mov     edx, [esi+76]
  4309 00002A44 015648                                  add     [esi+72], edx
  4310 00002A47 29D0                                    sub     eax, edx
  4311 00002A49 D1E0                                    shl     eax, 1
  4312 00002A4B BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  4313 00002A50 F7EA                                    imul    edx
  4314 00002A52 89564C                                  mov     [esi+76], edx
  4315 00002A55 8B464C                                  mov     eax, [esi+76]   ; @@ADD 18,19
  4316 00002A58 014648                                  add     [esi+72], eax
  4317 00002A5B 8B4650                                  mov     eax, [esi+80]   ; @@BF2 20,21,22,23
  4318 00002A5E 8B5654                                  mov     edx, [esi+84]
  4319 00002A61 015650                                  add     [esi+80], edx
  4320 00002A64 29D0                                    sub     eax, edx
  4321 00002A66 D1E0                                    shl     eax, 1
  4322 00002A68 BA9A79825A                              mov     edx, 5A82799Ah
  4323 00002A6D F7EA                                    imul    edx
  4324 00002A6F 895654                                  mov     [esi+84], edx
  4325 00002A72 8B4658                                  mov     eax, [esi+88]
  4326 00002A75 8B565C                                  mov     edx, [esi+92]
  4327 00002A78 015658                                  add     [esi+88], edx
  4328 00002A7B 29D0                                    sub     eax, edx
  4329 00002A7D D1E0                                    shl     eax, 1
  4330 00002A7F BA66867DA5                              mov     edx, 0A57D8666h
  4331 00002A84 F7EA                                    imul    edx
  4332 00002A86 89565C                                  mov     [esi+92], edx
  4333 00002A89 8B465C                                  mov     eax, [esi+92]   ; @@ADD 22,23
  4334 00002A8C 014658                                  add     [esi+88], eax
  4335 00002A8F 8B4658                                  mov     eax, [esi+88]   ; @@ADD 20,22
  4336 00002A92 014650                                  add     [esi+80], eax
  4337 00002A95 8B4654                                  mov     eax, [esi+84]
  4338 00002A98 014658                                  add     [esi+88], eax
  4339 00002A9B 8B465C                                  mov     eax, [esi+92]
  4340 00002A9E 014654                                  add     [esi+84], eax
  4341 00002AA1 8B4660                                  mov     eax, [esi+96]   ; @@BF1 24,25,26,27
  4342 00002AA4 8B5664                                  mov     edx, [esi+100]
  4343 00002AA7 015660                                  add     [esi+96], edx
  4344 00002AAA 29D0                                    sub     eax, edx
  4345 00002AAC D1E0                                    shl     eax, 1
  4346 00002AAE BA9A79825A                              mov     edx, 5A82799Ah
  4347 00002AB3 F7EA                                    imul    edx
  4348 00002AB5 895664                                  mov     [esi+100], edx
  4349 00002AB8 8B4668                                  mov     eax, [esi+104]
  4350 00002ABB 8B566C                                  mov     edx, [esi+108]
  4351 00002ABE 015668                                  add     [esi+104], edx
  4352 00002AC1 29D0                                    sub     eax, edx
  4353 00002AC3 D1E0                                    shl     eax, 1
  4354 00002AC5 BA66867DA5                              mov     edx, 0A57D8666h
  4355 00002ACA F7EA                                    imul    edx
  4356 00002ACC 89566C                                  mov     [esi+108], edx
  4357 00002ACF 8B466C                                  mov     eax, [esi+108]
  4358 00002AD2 014668                                  add     [esi+104], eax
  4359 00002AD5 8B4670                                  mov     eax, [esi+112]  ; @@BF2 28,29,30,31
  4360 00002AD8 8B5674                                  mov     edx, [esi+116]
  4361 00002ADB 015670                                  add     [esi+112], edx
  4362 00002ADE 29D0                                    sub     eax, edx
  4363 00002AE0 D1E0                                    shl     eax, 1
  4364 00002AE2 BA9A79825A                              mov     edx, 5A82799Ah
  4365 00002AE7 F7EA                                    imul    edx
  4366 00002AE9 895674                                  mov     [esi+116], edx
  4367 00002AEC 8B4678                                  mov     eax, [esi+120]
  4368 00002AEF 8B567C                                  mov     edx, [esi+124]
  4369 00002AF2 015678                                  add     [esi+120], edx
  4370 00002AF5 29D0                                    sub     eax, edx
  4371 00002AF7 D1E0                                    shl     eax, 1
  4372 00002AF9 BA66867DA5                              mov     edx, 0A57D8666h
  4373 00002AFE F7EA                                    imul    edx
  4374 00002B00 89567C                                  mov     [esi+124], edx
  4375 00002B03 8B467C                                  mov     eax, [esi+124]
  4376 00002B06 014678                                  add     [esi+120], eax
  4377 00002B09 8B4678                                  mov     eax, [esi+120]
  4378 00002B0C 014670                                  add     [esi+112], eax
  4379 00002B0F 8B4674                                  mov     eax, [esi+116]
  4380 00002B12 014678                                  add     [esi+120], eax
  4381 00002B15 8B467C                                  mov     eax, [esi+124]
  4382 00002B18 014674                                  add     [esi+116], eax
  4383 00002B1B 8B06                                    mov     eax, [esi]      ; @@OUT macro dst,src1,src2
  4384                                                                          ; IF ((dst AND ((1 SHL rate_shift)-1)) EQ 0)
  4385                                                                          ;    mov eax,dword ptr [esi+src1*4]
  4386                                                                          ;    IFDIFI <src2>,<->
  4387                                                                          ;      add eax,dword ptr [esi+src2*4]
  4388                                                                          ;    ENDIF
  4389                                                                          ;    IF SYNTH32
  4390                                                                          ;       mov dword ptr [edi+dst*4],eax
  4391                                                                          ;       IF (LONG_WINDOW EQ 0)
  4392                                                                          ;          mov dword ptr [edi+dst*4+512*4],eax
  4393                                                                          ;       ENDIF
  4394                                                                          ;    ELSE
  4395                                                                          ;        ......
  4396                                                                          ;    ENDIF
  4397                                                                          ; @@OUT 0,0,-
  4398 00002B1D 8907                                    mov     [edi], eax      ; mov dword ptr [edi+dst*4],eax
  4399 00002B1F 8B4604                                  mov     eax, [esi+4]    ; @@OUT 16,1, -
  4400                                                                          ; mov eax,dword ptr [esi+src1*4]
  4401 00002B22 894740                                  mov     [edi+64], eax   ; mov dword ptr [edi+dst*4],eax
  4402 00002B25 8B4608                                  mov     eax, [esi+8]    ; @@OUT 8,2,-
  4403 00002B28 894720                                  mov     [edi+32], eax
  4404 00002B2B 8B460C                                  mov     eax, [esi+12]   ; @@OUT 24,3,-
  4405 00002B2E 894760                                  mov     [edi+96], eax
  4406 00002B31 8B4610                                  mov     eax, [esi+16]   ; @@OUT 4,4,-
  4407 00002B34 894710                                  mov     [edi+16], eax
  4408 00002B37 8B4614                                  mov     eax, [esi+20]   ; @@OUT 20,5,-
  4409 00002B3A 894750                                  mov     [edi+80], eax
  4410 00002B3D 8B4618                                  mov     eax, [esi+24]   ; @@OUT 12,6,-
  4411 00002B40 894730                                  mov     [edi+48], eax
  4412 00002B43 8B461C                                  mov     eax, [esi+28]   ; @@OUT 28,7,-
  4413 00002B46 894770                                  mov     [edi+112], eax
  4414 00002B49 8B4620                                  mov     eax, [esi+32]   ; @@OUT 2,8,12
  4415 00002B4C 034630                                  add     eax, [esi+48]   ; add eax,dword ptr [esi+src2*4]
  4416 00002B4F 894708                                  mov     [edi+8], eax
  4417 00002B52 8B4624                                  mov     eax, [esi+36]   ; @@OUT 18,9,13
  4418 00002B55 034634                                  add     eax, [esi+52]   ; add eax,dword ptr [esi+src2*4]
  4419 00002B58 894748                                  mov     [edi+72], eax
  4420 00002B5B 8B4628                                  mov     eax, [esi+40]   ; @@OUT 10,10,14
  4421 00002B5E 034638                                  add     eax, [esi+56]
  4422 00002B61 894728                                  mov     [edi+40], eax
  4423 00002B64 8B462C                                  mov     eax, [esi+44]   ; @@OUT 26,11,15
  4424 00002B67 03463C                                  add     eax, [esi+60]
  4425 00002B6A 894768                                  mov     [edi+104], eax
  4426 00002B6D 8B4630                                  mov     eax, [esi+48]   ; @@OUT 6,12,10
  4427 00002B70 034628                                  add     eax, [esi+40]
  4428 00002B73 894718                                  mov     [edi+24], eax
  4429 00002B76 8B4634                                  mov     eax, [esi+52]   ; @@OUT 22,13,11
  4430 00002B79 03462C                                  add     eax, [esi+44]
  4431 00002B7C 894758                                  mov     [edi+88], eax
  4432 00002B7F 8B4638                                  mov     eax, [esi+56]   ; @@OUT 14,14,9
  4433 00002B82 034624                                  add     eax, [esi+36]
  4434 00002B85 894738                                  mov     [edi+56], eax
  4435 00002B88 8B463C                                  mov     eax, [esi+60]   ; @@OUT 30,15,-
  4436 00002B8B 894778                                  mov     [edi+120], eax
  4437 00002B8E 8B4670                                  mov     eax, [esi+112]  ; @@ADD 24,28
  4438 00002B91 014660                                  add     [esi+96], eax
  4439 00002B94 8B4668                                  mov     eax, [esi+104]  ; @@ADD 28,26
  4440 00002B97 014670                                  add     [esi+112], eax
  4441 00002B9A 8B4678                                  mov     eax, [esi+120]  ; @@ADD 26,30
  4442 00002B9D 014668                                  add     [esi+104], eax
  4443 00002BA0 8B4664                                  mov     eax, [esi+100]  ; @@ADD 30,25
  4444 00002BA3 014678                                  add     [esi+120], eax
  4445 00002BA6 8B4674                                  mov     eax, [esi+116]  ; @@ADD 25,29
  4446 00002BA9 014664                                  add     [esi+100], eax
  4447 00002BAC 8B466C                                  mov     eax, [esi+108]  ; @@ADD 29,27
  4448 00002BAF 014674                                  add     [esi+116], eax
  4449 00002BB2 8B467C                                  mov     eax, [esi+124]  ; @@ADD 27,31
  4450 00002BB5 01466C                                  add     [esi+108], eax
  4451 00002BB8 8B4640                                  mov     eax, [esi+64]   ; @@OUT 1,16,24
  4452 00002BBB 034660                                  add     eax, [esi+96]
  4453 00002BBE 894704                                  mov     [edi+4], eax
  4454 00002BC1 8B4644                                  mov     eax, [esi+68]   ; @@OUT 17,17,25
  4455 00002BC4 034664                                  add     eax, [esi+100]
  4456 00002BC7 894744                                  mov     [edi+68], eax
  4457 00002BCA 8B4648                                  mov     eax, [esi+72]   ; @@OUT 9,18,26
  4458 00002BCD 034668                                  add     eax, [esi+104]
  4459 00002BD0 894724                                  mov     [edi+36], eax
  4460 00002BD3 8B464C                                  mov     eax, [esi+76]   ; @@OUT 25,19,27
  4461 00002BD6 03466C                                  add     eax, [esi+108]
  4462 00002BD9 894764                                  mov     [edi+100], eax
  4463 00002BDC 8B4650                                  mov     eax, [esi+80]   ; @@OUT 5,20,28
  4464 00002BDF 034670                                  add     eax, [esi+112]
  4465 00002BE2 894714                                  mov     [edi+20], eax
  4466 00002BE5 8B4654                                  mov     eax, [esi+84]   ; @@OUT 21,21,29
  4467 00002BE8 034674                                  add     eax, [esi+116]
  4468 00002BEB 894754                                  mov     [edi+84], eax
  4469 00002BEE 8B4658                                  mov     eax, [esi+88]   ; @@OUT 13,22,30
  4470 00002BF1 034678                                  add     eax, [esi+120]
  4471 00002BF4 894734                                  mov     [edi+52], eax
  4472 00002BF7 8B465C                                  mov     eax, [esi+92]   ; @@OUT 29,23,31
  4473 00002BFA 03467C                                  add     eax, [esi+124]
  4474 00002BFD 894774                                  mov     [edi+116], eax
  4475 00002C00 8B4660                                  mov     eax, [esi+96]   ; @@OUT 3,24,20
  4476 00002C03 034650                                  add     eax, [esi+80]
  4477 00002C06 89470C                                  mov     [edi+12], eax
  4478 00002C09 8B4664                                  mov     eax, [esi+100]  ; @@OUT 19,25,21
  4479 00002C0C 034654                                  add     eax, [esi+84]
  4480 00002C0F 89474C                                  mov     [edi+76], eax
  4481 00002C12 8B4668                                  mov     eax, [esi+104]  ; @@OUT 11,26,22
  4482 00002C15 034658                                  add     eax, [esi+88]
  4483 00002C18 89472C                                  mov     [edi+44], eax
  4484 00002C1B 8B466C                                  mov     eax, [esi+108]  ; @@OUT 27,27,23
  4485 00002C1E 03465C                                  add     eax, [esi+92]
  4486 00002C21 89476C                                  mov     [edi+108], eax
  4487 00002C24 8B4670                                  mov     eax, [esi+112]  ; @@OUT 7,28,18
  4488 00002C27 034648                                  add     eax, [esi+72]
  4489 00002C2A 89471C                                  mov     [edi+28], eax
  4490 00002C2D 8B4674                                  mov     eax, [esi+116]  ; @@OUT 23,29,19
  4491 00002C30 03464C                                  add     eax, [esi+76]
  4492 00002C33 89475C                                  mov     [edi+92], eax
  4493 00002C36 8B4678                                  mov     eax, [esi+120]  ; @@OUT 15,30,17
  4494 00002C39 034644                                  add     eax, [esi+68]
  4495 00002C3C 89473C                                  mov     [edi+60], eax
  4496 00002C3F 8B467C                                  mov     eax, [esi+124]  ; @@OUT 31,31,-
  4497 00002C42 89477C                                  mov     [edi+124], eax
  4498 00002C45 C3                                      retn
  4499                                  
  4500                                  
  4501                                  ; =============== S U B R O U T I N E =======================================
  4502                                  
  4503                                  
  4504                                  mp3_dct32_shift_1:
  4505 00002C46 8B467C                                  mov     eax, [esi+124]  ; mp3_dct32_macro macro rate_shift ; rate_shift = 1
  4506 00002C49 0106                                    add     [esi], eax      ; @@BF macro a,b,sign,cos,shift
  4507                                                                          ; @@need_a equ (rate_shift EQ 0) or (a LT 16) ; a = 0
  4508                                                                          ; @@need_b equ (rate_shift EQ 0) or (b LT 16) ; b = 31
  4509                                                                          ; IF @@need_a AND @@need_b ; rate_shift = 0
  4510                                                                          ;    mov eax,dword ptr [esi+a*4]
  4511                                                                          ;    mov edx,dword ptr [esi+b*4]
  4512                                                                          ;    add dword ptr [esi+a*4],edx
  4513                                                                          ; ELSEIF @@need_a
  4514                                                                          ;    mov eax,dword ptr [esi+b*4]
  4515                                                                          ;    add dword ptr [esi+a*4],eax
  4516                                                                          ;
  4517                                                                          ; @@BF 0,31,+,COS0_0,1
  4518 00002C4B 8B4640                                  mov     eax, [esi+64]   ; @@BF 15,16,+,COS0_15,5
  4519 00002C4E 01463C                                  add     [esi+60], eax
  4520 00002C51 8B06                                    mov     eax, [esi]      ; @@BF 0,15,+,COS1_0,1
  4521 00002C53 8B563C                                  mov     edx, [esi+60]
  4522 00002C56 0116                                    add     [esi], edx
  4523 00002C58 29D0                                    sub     eax, edx
  4524 00002C5A D1E0                                    shl     eax, 1
  4525 00002C5C BA72464F40                              mov     edx, 404F4672h  ; COS1_0
  4526 00002C61 F7EA                                    imul    edx
  4527 00002C63 89563C                                  mov     [esi+60], edx
  4528 00002C66 8B4660                                  mov     eax, [esi+96]   ; skip @@BF 16,31,-,COS1_0,1
  4529                                                                          ; @@BF 7,24,+,COS0_7,1
  4530 00002C69 01461C                                  add     [esi+28], eax
  4531 00002C6C 8B465C                                  mov     eax, [esi+92]   ; @@BF 8,23,+,COS0_8,1
  4532 00002C6F 014620                                  add     [esi+32], eax
  4533 00002C72 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,8,+,COS1_7,4
  4534 00002C75 8B5620                                  mov     edx, [esi+32]
  4535 00002C78 01561C                                  add     [esi+28], edx
  4536 00002C7B 29D0                                    sub     eax, edx
  4537 00002C7D C1E004                                  shl     eax, 4
  4538 00002C80 BA044E9E51                              mov     edx, 519E4E04h  ; COS1_7
  4539 00002C85 F7EA                                    imul    edx
  4540 00002C87 895620                                  mov     [esi+32], edx
  4541 00002C8A 8B06                                    mov     eax, [esi]      ; skip @@BF 23,24,-,COS1_7,4
  4542                                                                          ; @@BF 0,7,+,COS2_0,1
  4543 00002C8C 8B561C                                  mov     edx, [esi+28]
  4544 00002C8F 0116                                    add     [esi], edx
  4545 00002C91 29D0                                    sub     eax, edx
  4546 00002C93 D1E0                                    shl     eax, 1
  4547 00002C95 BA46FB4041                              mov     edx, 4140FB46h  ; COS2_0
  4548 00002C9A F7EA                                    imul    edx
  4549 00002C9C 89561C                                  mov     [esi+28], edx
  4550 00002C9F 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,15,-,COS2_0,1
  4551 00002CA2 8B563C                                  mov     edx, [esi+60]
  4552 00002CA5 015620                                  add     [esi+32], edx
  4553 00002CA8 29D0                                    sub     eax, edx
  4554 00002CAA D1E0                                    shl     eax, 1
  4555 00002CAC BABA04BFBE                              mov     edx, 0BEBF04BAh ; -COS2_0
  4556 00002CB1 F7EA                                    imul    edx
  4557 00002CB3 89563C                                  mov     [esi+60], edx
  4558 00002CB6 8B4670                                  mov     eax, [esi+112]  ; skip @@BF 16,23,+,COS2_0,1
  4559                                                                          ;      @@BF 24,31,-,COS2_0,1
  4560                                                                          ; @@BF 3,28,+,COS0_3,1
  4561 00002CB9 01460C                                  add     [esi+12], eax
  4562 00002CBC 8B464C                                  mov     eax, [esi+76]   ; @@BF 12,19,+,COS0_12,2
  4563 00002CBF 014630                                  add     [esi+48], eax
  4564 00002CC2 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,12,+,COS1_3,1
  4565 00002CC5 8B5630                                  mov     edx, [esi+48]
  4566 00002CC8 01560C                                  add     [esi+12], edx
  4567 00002CCB 29D0                                    sub     eax, edx
  4568 00002CCD D1E0                                    shl     eax, 1
  4569 00002CCF BA630ECB52                              mov     edx, 52CB0E63h
  4570 00002CD4 F7EA                                    imul    edx
  4571 00002CD6 895630                                  mov     [esi+48], edx
  4572 00002CD9 8B466C                                  mov     eax, [esi+108]  ; @@BF 4,27,+,COS0_4,1
  4573 00002CDC 014610                                  add     [esi+16], eax
  4574 00002CDF 8B4650                                  mov     eax, [esi+80]   ; @@BF 11,20,+,COS0_11,2
  4575 00002CE2 01462C                                  add     [esi+44], eax
  4576 00002CE5 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,11,+,COS1_4,1
  4577 00002CE8 8B562C                                  mov     edx, [esi+44]
  4578 00002CEB 015610                                  add     [esi+16], edx
  4579 00002CEE 29D0                                    sub     eax, edx
  4580 00002CF0 D1E0                                    shl     eax, 1
  4581 00002CF2 BA2E40E264                              mov     edx, 64E2402Eh  ; COS1_4
  4582 00002CF7 F7EA                                    imul    edx
  4583 00002CF9 89562C                                  mov     [esi+44], edx
  4584 00002CFC 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,4,+,COS2_3,3
  4585 00002CFF 8B5610                                  mov     edx, [esi+16]
  4586 00002D02 01560C                                  add     [esi+12], edx
  4587 00002D05 29D0                                    sub     eax, edx
  4588 00002D07 C1E003                                  shl     eax, 3
  4589 00002D0A BA42670352                              mov     edx, 52036742h
  4590 00002D0F F7EA                                    imul    edx
  4591 00002D11 895610                                  mov     [esi+16], edx
  4592 00002D14 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,12,-,COS2_3,3
  4593 00002D17 8B5630                                  mov     edx, [esi+48]
  4594 00002D1A 01562C                                  add     [esi+44], edx
  4595 00002D1D 29D0                                    sub     eax, edx
  4596 00002D1F C1E003                                  shl     eax, 3
  4597 00002D22 BABE98FCAD                              mov     edx, 0ADFC98BEh ; -COS2_3
  4598 00002D27 F7EA                                    imul    edx
  4599 00002D29 895630                                  mov     [esi+48], edx
  4600 00002D2C 8B06                                    mov     eax, [esi]      ; @@BF 0,3,+,COS3_0,1
  4601 00002D2E 8B560C                                  mov     edx, [esi+12]
  4602 00002D31 0116                                    add     [esi], edx
  4603 00002D33 29D0                                    sub     eax, edx
  4604 00002D35 D1E0                                    shl     eax, 1
  4605 00002D37 BAF0E94545                              mov     edx, 4545E9F0h
  4606 00002D3C F7EA                                    imul    edx
  4607 00002D3E 89560C                                  mov     [esi+12], edx
  4608 00002D41 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,7,-,COS3_0,1
  4609 00002D44 8B561C                                  mov     edx, [esi+28]
  4610 00002D47 015610                                  add     [esi+16], edx
  4611 00002D4A 29D0                                    sub     eax, edx
  4612 00002D4C D1E0                                    shl     eax, 1
  4613 00002D4E BA1016BABA                              mov     edx, 0BABA1610h
  4614 00002D53 F7EA                                    imul    edx
  4615 00002D55 89561C                                  mov     [esi+28], edx
  4616 00002D58 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,11,+,COS3_0,1
  4617 00002D5B 8B562C                                  mov     edx, [esi+44]
  4618 00002D5E 015620                                  add     [esi+32], edx
  4619 00002D61 29D0                                    sub     eax, edx
  4620 00002D63 D1E0                                    shl     eax, 1
  4621 00002D65 BAF0E94545                              mov     edx, 4545E9F0h
  4622 00002D6A F7EA                                    imul    edx
  4623 00002D6C 89562C                                  mov     [esi+44], edx
  4624 00002D6F 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,15,-,COS3_0,1
  4625 00002D72 8B563C                                  mov     edx, [esi+60]
  4626 00002D75 015630                                  add     [esi+48], edx
  4627 00002D78 29D0                                    sub     eax, edx
  4628 00002D7A D1E0                                    shl     eax, 1
  4629 00002D7C BA1016BABA                              mov     edx, 0BABA1610h ; -COS3_0
  4630 00002D81 F7EA                                    imul    edx
  4631 00002D83 89563C                                  mov     [esi+60], edx
  4632 00002D86 8B4678                                  mov     eax, [esi+120]  ; @@BF 1,30,+,COS0_1,1
  4633 00002D89 014604                                  add     [esi+4], eax
  4634 00002D8C 8B4644                                  mov     eax, [esi+68]   ; @@BF 14,17,+,COS0_14,3
  4635 00002D8F 014638                                  add     [esi+56], eax
  4636 00002D92 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,14,+,COS1_1,1
  4637 00002D95 8B5638                                  mov     edx, [esi+56]
  4638 00002D98 015604                                  add     [esi+4], edx
  4639 00002D9B 29D0                                    sub     eax, edx
  4640 00002D9D D1E0                                    shl     eax, 1
  4641 00002D9F BA103CE142                              mov     edx, 42E13C10h
  4642 00002DA4 F7EA                                    imul    edx
  4643 00002DA6 895638                                  mov     [esi+56], edx
  4644 00002DA9 8B4664                                  mov     eax, [esi+100]  ; @@BF 6,25,+,COS0_6,1
  4645 00002DAC 014618                                  add     [esi+24], eax
  4646 00002DAF 8B4658                                  mov     eax, [esi+88]   ; @@BF 9,22,+,COS0_9,1
  4647 00002DB2 014624                                  add     [esi+36], eax
  4648 00002DB5 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,9,+,COS1_6,2
  4649 00002DB8 8B5624                                  mov     edx, [esi+36]
  4650 00002DBB 015618                                  add     [esi+24], edx
  4651 00002DBE 29D0                                    sub     eax, edx
  4652 00002DC0 C1E002                                  shl     eax, 2
  4653 00002DC3 BAC2923C6E                              mov     edx, 6E3C92C2h  ; +COS1_6
  4654 00002DC8 F7EA                                    imul    edx
  4655 00002DCA 895624                                  mov     [esi+36], edx
  4656 00002DCD 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,6,+,COS2_1,1
  4657 00002DD0 8B5618                                  mov     edx, [esi+24]
  4658 00002DD3 015604                                  add     [esi+4], edx
  4659 00002DD6 29D0                                    sub     eax, edx
  4660 00002DD8 D1E0                                    shl     eax, 1
  4661 00002DDA BA88DEF84C                              mov     edx, 4CF8DE88h
  4662 00002DDF F7EA                                    imul    edx
  4663 00002DE1 895618                                  mov     [esi+24], edx
  4664 00002DE4 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,14,-,COS2_1,1
  4665 00002DE7 8B5638                                  mov     edx, [esi+56]
  4666 00002DEA 015624                                  add     [esi+36], edx
  4667 00002DED 29D0                                    sub     eax, edx
  4668 00002DEF D1E0                                    shl     eax, 1
  4669 00002DF1 BA782107B3                              mov     edx, 0B3072178h ; -COS2_1
  4670 00002DF6 F7EA                                    imul    edx
  4671 00002DF8 895638                                  mov     [esi+56], edx
  4672 00002DFB 8B4674                                  mov     eax, [esi+116]  ; @@BF 2,29,+,COS0_2,1
  4673 00002DFE 014608                                  add     [esi+8], eax
  4674 00002E01 8B4648                                  mov     eax, [esi+72]   ; @@BF 13,18,+,COS0_13,3
  4675 00002E04 014634                                  add     [esi+52], eax
  4676 00002E07 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,13,+,COS1_2,1
  4677 00002E0A 8B5634                                  mov     edx, [esi+52]
  4678 00002E0D 015608                                  add     [esi+8], edx
  4679 00002E10 29D0                                    sub     eax, edx
  4680 00002E12 D1E0                                    shl     eax, 1
  4681 00002E14 BA459F9148                              mov     edx, 48919F45h
  4682 00002E19 F7EA                                    imul    edx
  4683 00002E1B 895634                                  mov     [esi+52], edx
  4684 00002E1E 8B4668                                  mov     eax, [esi+104]  ; @@BF 5,26,+,COS0_5,1
  4685 00002E21 014614                                  add     [esi+20], eax
  4686 00002E24 8B4654                                  mov     eax, [esi+84]   ; @@BF 10,21,+,COS0_10,1
  4687 00002E27 014628                                  add     [esi+40], eax
  4688 00002E2A 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,10,+,COS1_5,2
  4689 00002E2D 8B5628                                  mov     edx, [esi+40]
  4690 00002E30 015614                                  add     [esi+20], edx
  4691 00002E33 29D0                                    sub     eax, edx
  4692 00002E35 C1E002                                  shl     eax, 2
  4693 00002E38 BAAA24E243                              mov     edx, 43E224AAh
  4694 00002E3D F7EA                                    imul    edx
  4695 00002E3F 895628                                  mov     [esi+40], edx
  4696 00002E42 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,5,+,COS2_2,1
  4697 00002E45 8B5614                                  mov     edx, [esi+20]
  4698 00002E48 015608                                  add     [esi+8], edx
  4699 00002E4B 29D0                                    sub     eax, edx
  4700 00002E4D D1E0                                    shl     eax, 1
  4701 00002E4F BABF6B3273                              mov     edx, 73326BBFh  ; COS2_2
  4702 00002E54 F7EA                                    imul    edx
  4703 00002E56 895614                                  mov     [esi+20], edx
  4704 00002E59 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,13,-,COS2_2,1
  4705 00002E5C 8B5634                                  mov     edx, [esi+52]
  4706 00002E5F 015628                                  add     [esi+40], edx
  4707 00002E62 29D0                                    sub     eax, edx
  4708 00002E64 D1E0                                    shl     eax, 1
  4709 00002E66 BA4194CD8C                              mov     edx, 8CCD9441h  ; -COS2_2
  4710 00002E6B F7EA                                    imul    edx
  4711 00002E6D 895634                                  mov     [esi+52], edx
  4712 00002E70 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,2,+,COS3_1,2
  4713 00002E73 8B5608                                  mov     edx, [esi+8]
  4714 00002E76 015604                                  add     [esi+4], edx
  4715 00002E79 29D0                                    sub     eax, edx
  4716 00002E7B C1E002                                  shl     eax, 2
  4717 00002E7E BA46BA9E53                              mov     edx, 539EBA46h
  4718 00002E83 F7EA                                    imul    edx
  4719 00002E85 895608                                  mov     [esi+8], edx
  4720 00002E88 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,6,-,COS3_1,2
  4721 00002E8B 8B5618                                  mov     edx, [esi+24]
  4722 00002E8E 015614                                  add     [esi+20], edx
  4723 00002E91 29D0                                    sub     eax, edx
  4724 00002E93 C1E002                                  shl     eax, 2
  4725 00002E96 BABA4561AC                              mov     edx, 0AC6145BAh
  4726 00002E9B F7EA                                    imul    edx
  4727 00002E9D 895618                                  mov     [esi+24], edx
  4728 00002EA0 8B4624                                  mov     eax, [esi+36]   ; IF rate_shift LT 2
  4729                                                                          ; @@BF 9,10,+,COS3_1,2
  4730 00002EA3 8B5628                                  mov     edx, [esi+40]
  4731 00002EA6 015624                                  add     [esi+36], edx
  4732 00002EA9 29D0                                    sub     eax, edx
  4733 00002EAB C1E002                                  shl     eax, 2
  4734 00002EAE BA46BA9E53                              mov     edx, 539EBA46h  ; +COS3_1
  4735 00002EB3 F7EA                                    imul    edx
  4736 00002EB5 895628                                  mov     [esi+40], edx
  4737 00002EB8 8B4634                                  mov     eax, [esi+52]   ; @@BF 13,14,-,COS3_1,2
  4738 00002EBB 8B5638                                  mov     edx, [esi+56]
  4739 00002EBE 015634                                  add     [esi+52], edx
  4740 00002EC1 29D0                                    sub     eax, edx
  4741 00002EC3 C1E002                                  shl     eax, 2
  4742 00002EC6 BABA4561AC                              mov     edx, 0AC6145BAh ; -COS3_1
  4743 00002ECB F7EA                                    imul    edx
  4744 00002ECD 895638                                  mov     [esi+56], edx   ; ENDIF
  4745 00002ED0 8B06                                    mov     eax, [esi]      ; @@BF1 macro a, b, c, d
  4746                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4747                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4748                                                                          ;   @@ADD c, d
  4749                                                                          ;  endm
  4750                                                                          ; @@BF1 0,1,2,3
  4751 00002ED2 8B5604                                  mov     edx, [esi+4]    ; @@BF 0,1,+,COS4_0,1
  4752 00002ED5 0116                                    add     [esi], edx
  4753 00002ED7 29D0                                    sub     eax, edx
  4754 00002ED9 D1E0                                    shl     eax, 1
  4755 00002EDB BA9A79825A                              mov     edx, 5A82799Ah
  4756 00002EE0 F7EA                                    imul    edx
  4757 00002EE2 895604                                  mov     [esi+4], edx
  4758 00002EE5 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,3,+,COS4_0,1
  4759 00002EE8 8B560C                                  mov     edx, [esi+12]
  4760 00002EEB 015608                                  add     [esi+8], edx
  4761 00002EEE 29D0                                    sub     eax, edx
  4762 00002EF0 D1E0                                    shl     eax, 1
  4763 00002EF2 BA66867DA5                              mov     edx, 0A57D8666h
  4764 00002EF7 F7EA                                    imul    edx
  4765 00002EF9 89560C                                  mov     [esi+12], edx
  4766 00002EFC 8B460C                                  mov     eax, [esi+12]   ; @@ADD 2,3
  4767 00002EFF 014608                                  add     [esi+8], eax
  4768 00002F02 8B4610                                  mov     eax, [esi+16]   ; @@BF2 macro a, b, c, d
  4769                                                                          ;   @@BF  a, b,+,COS4_0, 1
  4770                                                                          ;   @@BF  c, d,-,COS4_0, 1
  4771                                                                          ;   @@ADD c, d
  4772                                                                          ;   @@ADD a, c
  4773                                                                          ;   @@ADD c, b
  4774                                                                          ;   @@ADD b, d
  4775                                                                          ;  endm
  4776                                                                          ; @@BF2 4,5,6,7
  4777 00002F05 8B5614                                  mov     edx, [esi+20]   ; @@BF 4,5,+,COS4_0,1
  4778 00002F08 015610                                  add     [esi+16], edx
  4779 00002F0B 29D0                                    sub     eax, edx
  4780 00002F0D D1E0                                    shl     eax, 1
  4781 00002F0F BA9A79825A                              mov     edx, 5A82799Ah  ; +COS4_0
  4782 00002F14 F7EA                                    imul    edx
  4783 00002F16 895614                                  mov     [esi+20], edx
  4784 00002F19 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,7,-,COS4_0,1
  4785 00002F1C 8B561C                                  mov     edx, [esi+28]
  4786 00002F1F 015618                                  add     [esi+24], edx
  4787 00002F22 29D0                                    sub     eax, edx
  4788 00002F24 D1E0                                    shl     eax, 1
  4789 00002F26 BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  4790 00002F2B F7EA                                    imul    edx
  4791 00002F2D 89561C                                  mov     [esi+28], edx
  4792 00002F30 8B461C                                  mov     eax, [esi+28]   ; @@ADD macro dst,src
  4793                                                                          ;   IF (rate_shift EQ 0) or (dst LT 16)
  4794                                                                          ;    ;tab[a] += tab[b]
  4795                                                                          ;    mov  eax,dword ptr [esi+src*4]
  4796                                                                          ;    add  dword ptr [esi+dst*4],eax
  4797                                                                          ;   ENDIF
  4798                                                                          ;  endm
  4799                                                                          ; @@ADD 6,7
  4800 00002F33 014618                                  add     [esi+24], eax
  4801 00002F36 8B4618                                  mov     eax, [esi+24]   ; @@ADD 4,6
  4802 00002F39 014610                                  add     [esi+16], eax
  4803 00002F3C 8B4614                                  mov     eax, [esi+20]   ; @@ADD 6,5
  4804 00002F3F 014618                                  add     [esi+24], eax
  4805 00002F42 8B461C                                  mov     eax, [esi+28]   ; @@ADD 5,7
  4806 00002F45 014614                                  add     [esi+20], eax
  4807 00002F48 8B4620                                  mov     eax, [esi+32]   ; IF rate_shift LT 2
  4808                                                                          ; @@BF1 8,9,10,11
  4809 00002F4B 8B5624                                  mov     edx, [esi+36]
  4810 00002F4E 015620                                  add     [esi+32], edx
  4811 00002F51 29D0                                    sub     eax, edx
  4812 00002F53 D1E0                                    shl     eax, 1
  4813 00002F55 BA9A79825A                              mov     edx, 5A82799Ah
  4814 00002F5A F7EA                                    imul    edx
  4815 00002F5C 895624                                  mov     [esi+36], edx
  4816 00002F5F 8B4628                                  mov     eax, [esi+40]
  4817 00002F62 8B562C                                  mov     edx, [esi+44]
  4818 00002F65 015628                                  add     [esi+40], edx
  4819 00002F68 29D0                                    sub     eax, edx
  4820 00002F6A D1E0                                    shl     eax, 1
  4821 00002F6C BA66867DA5                              mov     edx, 0A57D8666h
  4822 00002F71 F7EA                                    imul    edx
  4823 00002F73 89562C                                  mov     [esi+44], edx
  4824 00002F76 8B462C                                  mov     eax, [esi+44]
  4825 00002F79 014628                                  add     [esi+40], eax
  4826 00002F7C 8B4630                                  mov     eax, [esi+48]   ; @@BF2 12,13,14,15
  4827 00002F7F 8B5634                                  mov     edx, [esi+52]
  4828 00002F82 015630                                  add     [esi+48], edx
  4829 00002F85 29D0                                    sub     eax, edx
  4830 00002F87 D1E0                                    shl     eax, 1
  4831 00002F89 BA9A79825A                              mov     edx, 5A82799Ah
  4832 00002F8E F7EA                                    imul    edx
  4833 00002F90 895634                                  mov     [esi+52], edx
  4834 00002F93 8B4638                                  mov     eax, [esi+56]
  4835 00002F96 8B563C                                  mov     edx, [esi+60]
  4836 00002F99 015638                                  add     [esi+56], edx
  4837 00002F9C 29D0                                    sub     eax, edx
  4838 00002F9E D1E0                                    shl     eax, 1
  4839 00002FA0 BA66867DA5                              mov     edx, 0A57D8666h
  4840 00002FA5 F7EA                                    imul    edx
  4841 00002FA7 89563C                                  mov     [esi+60], edx
  4842 00002FAA 8B463C                                  mov     eax, [esi+60]
  4843 00002FAD 014638                                  add     [esi+56], eax
  4844 00002FB0 8B4638                                  mov     eax, [esi+56]
  4845 00002FB3 014630                                  add     [esi+48], eax
  4846 00002FB6 8B4634                                  mov     eax, [esi+52]
  4847 00002FB9 014638                                  add     [esi+56], eax
  4848 00002FBC 8B463C                                  mov     eax, [esi+60]
  4849 00002FBF 014634                                  add     [esi+52], eax
  4850 00002FC2 8B06                                    mov     eax, [esi]      ; @@OUT macro dst,src1,src2
  4851                                                                          ; IF ((dst AND ((1 SHL rate_shift)-1)) EQ 0)
  4852                                                                          ;    mov eax,dword ptr [esi+src1*4]
  4853                                                                          ;    IFDIFI <src2>,<->
  4854                                                                          ;      add eax,dword ptr [esi+src2*4]
  4855                                                                          ;    ENDIF
  4856                                                                          ;    IF SYNTH32
  4857                                                                          ;       mov dword ptr [edi+dst*4],eax
  4858                                                                          ;       IF (LONG_WINDOW EQ 0)
  4859                                                                          ;          mov dword ptr [edi+dst*4+512*4],eax
  4860                                                                          ;       ENDIF
  4861                                                                          ;    ELSE
  4862                                                                          ;        ......
  4863                                                                          ;    ENDIF
  4864                                                                          ; @@OUT 0,0,-
  4865 00002FC4 8907                                    mov     [edi], eax
  4866 00002FC6 8B4604                                  mov     eax, [esi+4]    ; @@OUT 16,1,-
  4867 00002FC9 894740                                  mov     [edi+64], eax
  4868 00002FCC 8B4608                                  mov     eax, [esi+8]    ; @@OUT 8,2,-
  4869 00002FCF 894720                                  mov     [edi+32], eax
  4870 00002FD2 8B460C                                  mov     eax, [esi+12]   ; @@OUT 24,3,-
  4871 00002FD5 894760                                  mov     [edi+96], eax
  4872 00002FD8 8B4610                                  mov     eax, [esi+16]   ; @@OUT 4,4,-
  4873 00002FDB 894710                                  mov     [edi+16], eax
  4874 00002FDE 8B4614                                  mov     eax, [esi+20]   ; @@OUT 20,5,-
  4875 00002FE1 894750                                  mov     [edi+80], eax
  4876 00002FE4 8B4618                                  mov     eax, [esi+24]   ; @@OUT 12,6,-
  4877 00002FE7 894730                                  mov     [edi+48], eax
  4878 00002FEA 8B461C                                  mov     eax, [esi+28]   ; @@OUT 28,7,-
  4879 00002FED 894770                                  mov     [edi+112], eax
  4880 00002FF0 8B4620                                  mov     eax, [esi+32]   ; @@OUT 2,8,12
  4881 00002FF3 034630                                  add     eax, [esi+48]
  4882 00002FF6 894708                                  mov     [edi+8], eax
  4883 00002FF9 8B4624                                  mov     eax, [esi+36]   ; @@OUT 18,9,13
  4884 00002FFC 034634                                  add     eax, [esi+52]
  4885 00002FFF 894748                                  mov     [edi+72], eax
  4886 00003002 8B4628                                  mov     eax, [esi+40]   ; @@OUT 10,10,14
  4887 00003005 034638                                  add     eax, [esi+56]
  4888 00003008 894728                                  mov     [edi+40], eax
  4889 0000300B 8B462C                                  mov     eax, [esi+44]   ; @@OUT 26,11,15
  4890 0000300E 03463C                                  add     eax, [esi+60]
  4891 00003011 894768                                  mov     [edi+104], eax
  4892 00003014 8B4630                                  mov     eax, [esi+48]   ; @@OUT 6,12,10
  4893 00003017 034628                                  add     eax, [esi+40]
  4894 0000301A 894718                                  mov     [edi+24], eax
  4895 0000301D 8B4634                                  mov     eax, [esi+52]   ; @@OUT 22,13,11
  4896 00003020 03462C                                  add     eax, [esi+44]
  4897 00003023 894758                                  mov     [edi+88], eax
  4898 00003026 8B4638                                  mov     eax, [esi+56]   ; @@OUT 14,14,9
  4899 00003029 034624                                  add     eax, [esi+36]
  4900 0000302C 894738                                  mov     [edi+56], eax
  4901 0000302F 8B463C                                  mov     eax, [esi+60]   ; @@OUT 30,15,-
  4902 00003032 894778                                  mov     [edi+120], eax
  4903 00003035 C3                                      retn
  4904                                  
  4905                                  
  4906                                  ; =============== S U B R O U T I N E =======================================
  4907                                  
  4908                                  
  4909                                  mp3_dct32_shift_2:
  4910 00003036 8B467C                                  mov     eax, [esi+124]  ; mp3_dct32_macro macro rate_shift ; rate_shift = 2
  4911 00003039 0106                                    add     [esi], eax      ; @@BF macro a,b,sign,cos,shift
  4912                                                                          ; @@need_a equ (rate_shift EQ 0) or (a LT 16) ; a = 0
  4913                                                                          ; @@need_b equ (rate_shift EQ 0) or (b LT 16) ; b = 31
  4914                                                                          ; IF @@need_a AND @@need_b ; rate_shift = 0
  4915                                                                          ;    mov eax,dword ptr [esi+a*4]
  4916                                                                          ;    mov edx,dword ptr [esi+b*4]
  4917                                                                          ;    add dword ptr [esi+a*4],edx
  4918                                                                          ; ELSEIF @@need_a
  4919                                                                          ;    mov eax,dword ptr [esi+b*4]
  4920                                                                          ;    add dword ptr [esi+a*4],eax
  4921                                                                          ;
  4922                                                                          ; @@BF 0,31,+,COS0_0,1
  4923 0000303B 8B4640                                  mov     eax, [esi+64]   ; @@BF 15,16,+,COS0_15,5
  4924 0000303E 01463C                                  add     [esi+60], eax
  4925 00003041 8B06                                    mov     eax, [esi]      ; @@BF 0,15,+,COS1_0,1
  4926 00003043 8B563C                                  mov     edx, [esi+60]
  4927 00003046 0116                                    add     [esi], edx
  4928 00003048 29D0                                    sub     eax, edx
  4929 0000304A D1E0                                    shl     eax, 1
  4930 0000304C BA72464F40                              mov     edx, 404F4672h  ; COS1_0
  4931 00003051 F7EA                                    imul    edx
  4932 00003053 89563C                                  mov     [esi+60], edx
  4933 00003056 8B4660                                  mov     eax, [esi+96]   ; @@BF 7,24,+,COS0_7,1
  4934 00003059 01461C                                  add     [esi+28], eax
  4935 0000305C 8B465C                                  mov     eax, [esi+92]   ; @@BF 8,23,+,COS0_8,1
  4936 0000305F 014620                                  add     [esi+32], eax
  4937 00003062 8B461C                                  mov     eax, [esi+28]   ; @@BF 7,8,+,COS1_7,4
  4938 00003065 8B5620                                  mov     edx, [esi+32]
  4939 00003068 01561C                                  add     [esi+28], edx
  4940 0000306B 29D0                                    sub     eax, edx
  4941 0000306D C1E004                                  shl     eax, 4
  4942 00003070 BA044E9E51                              mov     edx, 519E4E04h  ; COS1_7
  4943 00003075 F7EA                                    imul    edx
  4944 00003077 895620                                  mov     [esi+32], edx
  4945 0000307A 8B06                                    mov     eax, [esi]      ; @@BF 0,7,+,COS2_0,1
  4946 0000307C 8B561C                                  mov     edx, [esi+28]
  4947 0000307F 0116                                    add     [esi], edx
  4948 00003081 29D0                                    sub     eax, edx
  4949 00003083 D1E0                                    shl     eax, 1
  4950 00003085 BA46FB4041                              mov     edx, 4140FB46h  ; COS2_0
  4951 0000308A F7EA                                    imul    edx
  4952 0000308C 89561C                                  mov     [esi+28], edx
  4953 0000308F 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,15,-,COS2_0,1
  4954 00003092 8B563C                                  mov     edx, [esi+60]
  4955 00003095 015620                                  add     [esi+32], edx
  4956 00003098 29D0                                    sub     eax, edx
  4957 0000309A D1E0                                    shl     eax, 1
  4958 0000309C BABA04BFBE                              mov     edx, 0BEBF04BAh
  4959 000030A1 F7EA                                    imul    edx
  4960 000030A3 89563C                                  mov     [esi+60], edx
  4961 000030A6 8B4670                                  mov     eax, [esi+112]  ; @@BF 3,28,+,COS0_3,1
  4962 000030A9 01460C                                  add     [esi+12], eax
  4963 000030AC 8B464C                                  mov     eax, [esi+76]   ; @@BF 12,19,+,COS0_12,2
  4964 000030AF 014630                                  add     [esi+48], eax
  4965 000030B2 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,12,+,COS1_3,1
  4966 000030B5 8B5630                                  mov     edx, [esi+48]
  4967 000030B8 01560C                                  add     [esi+12], edx
  4968 000030BB 29D0                                    sub     eax, edx
  4969 000030BD D1E0                                    shl     eax, 1
  4970 000030BF BA630ECB52                              mov     edx, 52CB0E63h  ; COS1_3
  4971 000030C4 F7EA                                    imul    edx
  4972 000030C6 895630                                  mov     [esi+48], edx
  4973 000030C9 8B466C                                  mov     eax, [esi+108]  ; @@BF 4,27,+,COS0_4,1
  4974 000030CC 014610                                  add     [esi+16], eax
  4975 000030CF 8B4650                                  mov     eax, [esi+80]   ; @@BF 11,20,+,COS0_11,2
  4976 000030D2 01462C                                  add     [esi+44], eax
  4977 000030D5 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,11,+,COS1_4,1
  4978 000030D8 8B562C                                  mov     edx, [esi+44]
  4979 000030DB 015610                                  add     [esi+16], edx
  4980 000030DE 29D0                                    sub     eax, edx
  4981 000030E0 D1E0                                    shl     eax, 1
  4982 000030E2 BA2E40E264                              mov     edx, 64E2402Eh
  4983 000030E7 F7EA                                    imul    edx
  4984 000030E9 89562C                                  mov     [esi+44], edx
  4985 000030EC 8B460C                                  mov     eax, [esi+12]   ; @@BF 3,4,+,COS2_3,3
  4986 000030EF 8B5610                                  mov     edx, [esi+16]
  4987 000030F2 01560C                                  add     [esi+12], edx
  4988 000030F5 29D0                                    sub     eax, edx
  4989 000030F7 C1E003                                  shl     eax, 3
  4990 000030FA BA42670352                              mov     edx, 52036742h
  4991 000030FF F7EA                                    imul    edx
  4992 00003101 895610                                  mov     [esi+16], edx
  4993 00003104 8B462C                                  mov     eax, [esi+44]   ; @@BF 11,12,-,COS2_3,3
  4994 00003107 8B5630                                  mov     edx, [esi+48]
  4995 0000310A 01562C                                  add     [esi+44], edx
  4996 0000310D 29D0                                    sub     eax, edx
  4997 0000310F C1E003                                  shl     eax, 3
  4998 00003112 BABE98FCAD                              mov     edx, 0ADFC98BEh ; -COS2_3
  4999 00003117 F7EA                                    imul    edx
  5000 00003119 895630                                  mov     [esi+48], edx
  5001 0000311C 8B06                                    mov     eax, [esi]      ; @@BF 0,3,+,COS3_0,1
  5002 0000311E 8B560C                                  mov     edx, [esi+12]
  5003 00003121 0116                                    add     [esi], edx
  5004 00003123 29D0                                    sub     eax, edx
  5005 00003125 D1E0                                    shl     eax, 1
  5006 00003127 BAF0E94545                              mov     edx, 4545E9F0h
  5007 0000312C F7EA                                    imul    edx
  5008 0000312E 89560C                                  mov     [esi+12], edx
  5009 00003131 8B4610                                  mov     eax, [esi+16]   ; @@BF 4,7,-,COS3_0,1
  5010 00003134 8B561C                                  mov     edx, [esi+28]
  5011 00003137 015610                                  add     [esi+16], edx
  5012 0000313A 29D0                                    sub     eax, edx
  5013 0000313C D1E0                                    shl     eax, 1
  5014 0000313E BA1016BABA                              mov     edx, 0BABA1610h
  5015 00003143 F7EA                                    imul    edx
  5016 00003145 89561C                                  mov     [esi+28], edx
  5017 00003148 8B4620                                  mov     eax, [esi+32]   ; @@BF 8,11,+,COS3_0,1
  5018 0000314B 8B562C                                  mov     edx, [esi+44]
  5019 0000314E 015620                                  add     [esi+32], edx
  5020 00003151 29D0                                    sub     eax, edx
  5021 00003153 D1E0                                    shl     eax, 1
  5022 00003155 BAF0E94545                              mov     edx, 4545E9F0h
  5023 0000315A F7EA                                    imul    edx
  5024 0000315C 89562C                                  mov     [esi+44], edx
  5025 0000315F 8B4630                                  mov     eax, [esi+48]   ; @@BF 12,15,-,COS3_0,1
  5026 00003162 8B563C                                  mov     edx, [esi+60]
  5027 00003165 015630                                  add     [esi+48], edx
  5028 00003168 29D0                                    sub     eax, edx
  5029 0000316A D1E0                                    shl     eax, 1
  5030 0000316C BA1016BABA                              mov     edx, 0BABA1610h
  5031 00003171 F7EA                                    imul    edx
  5032 00003173 89563C                                  mov     [esi+60], edx
  5033 00003176 8B4678                                  mov     eax, [esi+120]  ; @@BF 1,30,+,COS0_1,1
  5034 00003179 014604                                  add     [esi+4], eax
  5035 0000317C 8B4644                                  mov     eax, [esi+68]   ; @@BF 14,17,+,COS0_14,3
  5036 0000317F 014638                                  add     [esi+56], eax
  5037 00003182 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,14,+,COS1_1,1
  5038 00003185 8B5638                                  mov     edx, [esi+56]
  5039 00003188 015604                                  add     [esi+4], edx
  5040 0000318B 29D0                                    sub     eax, edx
  5041 0000318D D1E0                                    shl     eax, 1
  5042 0000318F BA103CE142                              mov     edx, 42E13C10h  ; COS1_1
  5043 00003194 F7EA                                    imul    edx
  5044 00003196 895638                                  mov     [esi+56], edx
  5045 00003199 8B4664                                  mov     eax, [esi+100]  ; @@BF 6,25,+,COS0_6,1
  5046 0000319C 014618                                  add     [esi+24], eax
  5047 0000319F 8B4658                                  mov     eax, [esi+88]   ; @@BF 9,22,+,COS0_9,1
  5048 000031A2 014624                                  add     [esi+36], eax
  5049 000031A5 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,9,+,COS1_6,2
  5050 000031A8 8B5624                                  mov     edx, [esi+36]
  5051 000031AB 015618                                  add     [esi+24], edx
  5052 000031AE 29D0                                    sub     eax, edx
  5053 000031B0 C1E002                                  shl     eax, 2
  5054 000031B3 BAC2923C6E                              mov     edx, 6E3C92C2h
  5055 000031B8 F7EA                                    imul    edx
  5056 000031BA 895624                                  mov     [esi+36], edx
  5057 000031BD 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,6,+,COS2_1,1
  5058 000031C0 8B5618                                  mov     edx, [esi+24]
  5059 000031C3 015604                                  add     [esi+4], edx
  5060 000031C6 29D0                                    sub     eax, edx
  5061 000031C8 D1E0                                    shl     eax, 1
  5062 000031CA BA88DEF84C                              mov     edx, 4CF8DE88h  ; COS2_1
  5063 000031CF F7EA                                    imul    edx
  5064 000031D1 895618                                  mov     [esi+24], edx
  5065 000031D4 8B4624                                  mov     eax, [esi+36]   ; @@BF 9,14,-,COS2_1,1
  5066 000031D7 8B5638                                  mov     edx, [esi+56]
  5067 000031DA 015624                                  add     [esi+36], edx
  5068 000031DD 29D0                                    sub     eax, edx
  5069 000031DF D1E0                                    shl     eax, 1
  5070 000031E1 BA782107B3                              mov     edx, 0B3072178h ; -COS2_1
  5071 000031E6 F7EA                                    imul    edx
  5072 000031E8 895638                                  mov     [esi+56], edx
  5073 000031EB 8B4674                                  mov     eax, [esi+116]  ; @@BF 2,29,+,COS0_2,1
  5074 000031EE 014608                                  add     [esi+8], eax
  5075 000031F1 8B4648                                  mov     eax, [esi+72]   ; @@BF 13,18,+,COS0_13,3
  5076 000031F4 014634                                  add     [esi+52], eax
  5077 000031F7 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,13,+,COS1_2,1
  5078 000031FA 8B5634                                  mov     edx, [esi+52]
  5079 000031FD 015608                                  add     [esi+8], edx
  5080 00003200 29D0                                    sub     eax, edx
  5081 00003202 D1E0                                    shl     eax, 1
  5082 00003204 BA459F9148                              mov     edx, 48919F45h
  5083 00003209 F7EA                                    imul    edx
  5084 0000320B 895634                                  mov     [esi+52], edx
  5085 0000320E 8B4668                                  mov     eax, [esi+104]  ; @@BF 5,26,+,COS0_5,1
  5086 00003211 014614                                  add     [esi+20], eax
  5087 00003214 8B4654                                  mov     eax, [esi+84]   ; @@BF 10,21,+,COS0_10,1
  5088 00003217 014628                                  add     [esi+40], eax
  5089 0000321A 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,10,+,COS1_5,2
  5090 0000321D 8B5628                                  mov     edx, [esi+40]
  5091 00003220 015614                                  add     [esi+20], edx
  5092 00003223 29D0                                    sub     eax, edx
  5093 00003225 C1E002                                  shl     eax, 2
  5094 00003228 BAAA24E243                              mov     edx, 43E224AAh
  5095 0000322D F7EA                                    imul    edx
  5096 0000322F 895628                                  mov     [esi+40], edx
  5097 00003232 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,5,+,COS2_2,1
  5098 00003235 8B5614                                  mov     edx, [esi+20]
  5099 00003238 015608                                  add     [esi+8], edx
  5100 0000323B 29D0                                    sub     eax, edx
  5101 0000323D D1E0                                    shl     eax, 1
  5102 0000323F BABF6B3273                              mov     edx, 73326BBFh  ; COS2_2
  5103 00003244 F7EA                                    imul    edx
  5104 00003246 895614                                  mov     [esi+20], edx
  5105 00003249 8B4628                                  mov     eax, [esi+40]   ; @@BF 10,13,-,COS2_2,1
  5106 0000324C 8B5634                                  mov     edx, [esi+52]
  5107 0000324F 015628                                  add     [esi+40], edx
  5108 00003252 29D0                                    sub     eax, edx
  5109 00003254 D1E0                                    shl     eax, 1
  5110 00003256 BA4194CD8C                              mov     edx, 8CCD9441h  ; -COS2_2
  5111 0000325B F7EA                                    imul    edx
  5112 0000325D 895634                                  mov     [esi+52], edx
  5113 00003260 8B4604                                  mov     eax, [esi+4]    ; @@BF 1,2,+,COS3_1,2
  5114 00003263 8B5608                                  mov     edx, [esi+8]
  5115 00003266 015604                                  add     [esi+4], edx
  5116 00003269 29D0                                    sub     eax, edx
  5117 0000326B C1E002                                  shl     eax, 2
  5118 0000326E BA46BA9E53                              mov     edx, 539EBA46h  ; COS3_1
  5119 00003273 F7EA                                    imul    edx
  5120 00003275 895608                                  mov     [esi+8], edx
  5121 00003278 8B4614                                  mov     eax, [esi+20]   ; @@BF 5,6,-,COS3_1,2
  5122 0000327B 8B5618                                  mov     edx, [esi+24]
  5123 0000327E 015614                                  add     [esi+14h], edx
  5124 00003281 29D0                                    sub     eax, edx
  5125 00003283 C1E002                                  shl     eax, 2
  5126 00003286 BABA4561AC                              mov     edx, 0AC6145BAh ; -COS3_1
  5127 0000328B F7EA                                    imul    edx
  5128 0000328D 895618                                  mov     [esi+24], edx
  5129 00003290 8B06                                    mov     eax, [esi]      ; @@BF1 macro a, b, c, d
  5130                                                                          ;   @@BF  a, b,+,COS4_0, 1
  5131                                                                          ;   @@BF  c, d,-,COS4_0, 1
  5132                                                                          ;   @@ADD c, d
  5133                                                                          ;  endm
  5134                                                                          ; @@BF1 0,1,2,3
  5135 00003292 8B5604                                  mov     edx, [esi+4]    ; @@BF 0,1,+,COS4_0,1
  5136 00003295 0116                                    add     [esi], edx
  5137 00003297 29D0                                    sub     eax, edx
  5138 00003299 D1E0                                    shl     eax, 1
  5139 0000329B BA9A79825A                              mov     edx, 5A82799Ah
  5140 000032A0 F7EA                                    imul    edx
  5141 000032A2 895604                                  mov     [esi+4], edx
  5142 000032A5 8B4608                                  mov     eax, [esi+8]    ; @@BF 2,3,-,COS4_0,1
  5143 000032A8 8B560C                                  mov     edx, [esi+12]
  5144 000032AB 015608                                  add     [esi+8], edx
  5145 000032AE 29D0                                    sub     eax, edx
  5146 000032B0 D1E0                                    shl     eax, 1
  5147 000032B2 BA66867DA5                              mov     edx, 0A57D8666h
  5148 000032B7 F7EA                                    imul    edx
  5149 000032B9 89560C                                  mov     [esi+12], edx
  5150 000032BC 8B460C                                  mov     eax, [esi+12]   ; @@ADD 2,3
  5151 000032BF 014608                                  add     [esi+8], eax
  5152 000032C2 8B4610                                  mov     eax, [esi+16]   ; @@BF2 macro a, b, c, d
  5153                                                                          ;   @@BF  a, b,+,COS4_0, 1
  5154                                                                          ;   @@BF  c, d,-,COS4_0, 1
  5155                                                                          ;   @@ADD c, d
  5156                                                                          ;   @@ADD a, c
  5157                                                                          ;   @@ADD c, b
  5158                                                                          ;   @@ADD b, d
  5159                                                                          ;  endm
  5160                                                                          ; @@BF2 4,5,6,7
  5161 000032C5 8B5614                                  mov     edx, [esi+20]   ; @@BF 4,5,+,COS4_0,1
  5162 000032C8 015610                                  add     [esi+16], edx
  5163 000032CB 29D0                                    sub     eax, edx
  5164 000032CD D1E0                                    shl     eax, 1
  5165 000032CF BA9A79825A                              mov     edx, 5A82799Ah  ; COS4_0
  5166 000032D4 F7EA                                    imul    edx
  5167 000032D6 895614                                  mov     [esi+20], edx
  5168 000032D9 8B4618                                  mov     eax, [esi+24]   ; @@BF 6,7,-,COS4_0,1
  5169 000032DC 8B561C                                  mov     edx, [esi+28]
  5170 000032DF 015618                                  add     [esi+18h], edx
  5171 000032E2 29D0                                    sub     eax, edx
  5172 000032E4 D1E0                                    shl     eax, 1
  5173 000032E6 BA66867DA5                              mov     edx, 0A57D8666h ; -COS4_0
  5174 000032EB F7EA                                    imul    edx
  5175 000032ED 89561C                                  mov     [esi+28], edx
  5176 000032F0 8B461C                                  mov     eax, [esi+28]   ; @@ADD 6,7
  5177 000032F3 014618                                  add     [esi+24], eax
  5178 000032F6 8B4618                                  mov     eax, [esi+24]   ; @@ADD 4,6
  5179 000032F9 014610                                  add     [esi+16], eax
  5180 000032FC 8B4614                                  mov     eax, [esi+20]   ; @@ADD 6,5
  5181 000032FF 014618                                  add     [esi+24], eax
  5182 00003302 8B461C                                  mov     eax, [esi+28]   ; @@ADD 5,7
  5183 00003305 014614                                  add     [esi+20], eax
  5184 00003308 8B06                                    mov     eax, [esi]      ; @@OUT macro dst,src1,src2
  5185                                                                          ; IF ((dst AND ((1 SHL rate_shift)-1)) EQ 0)
  5186                                                                          ;    mov eax,dword ptr [esi+src1*4]
  5187                                                                          ;    IFDIFI <src2>,<->
  5188                                                                          ;      add eax,dword ptr [esi+src2*4]
  5189                                                                          ;    ENDIF
  5190                                                                          ;    IF SYNTH32
  5191                                                                          ;       mov dword ptr [edi+dst*4],eax
  5192                                                                          ;       IF (LONG_WINDOW EQ 0)
  5193                                                                          ;          mov dword ptr [edi+dst*4+512*4],eax
  5194                                                                          ;       ENDIF
  5195                                                                          ;    ELSE
  5196                                                                          ;        ......
  5197                                                                          ;    ENDIF
  5198                                                                          ; @@OUT 0,0,-
  5199 0000330A 8907                                    mov     [edi], eax
  5200 0000330C 8B4604                                  mov     eax, [esi+4]    ; @@OUT 16,1,-
  5201 0000330F 894740                                  mov     [edi+64], eax
  5202 00003312 8B4608                                  mov     eax, [esi+8]    ; @@OUT 8,2,-
  5203 00003315 894720                                  mov     [edi+32], eax
  5204 00003318 8B460C                                  mov     eax, [esi+12]   ; @@OUT 24,3,-
  5205 0000331B 894760                                  mov     [edi+96], eax
  5206 0000331E 8B4610                                  mov     eax, [esi+16]   ; @@OUT 4,4,-
  5207 00003321 894710                                  mov     [edi+16], eax
  5208 00003324 8B4614                                  mov     eax, [esi+20]   ; @@OUT 20,5,-
  5209 00003327 894750                                  mov     [edi+80], eax
  5210 0000332A 8B4618                                  mov     eax, [esi+24]   ; @@OUT 12,6,-
  5211 0000332D 894730                                  mov     [edi+48], eax
  5212 00003330 8B461C                                  mov     eax, [esi+28]   ; @@OUT 28,7,-
  5213 00003333 894770                                  mov     [edi+112], eax
  5214 00003336 C3                                      retn
  5215                                  
  5216                                  ; =============== S U B R O U T I N E =======================================
  5217                                  
  5218                                  		; 15/02/2025
  5219                                  mp3_synth_filter_proc:
  5220                                  		;;;;
  5221                                  synth_16bit_shift_0_slow:
  5222                                  
  5223                                                 	; 16/02/2025
  5224                                  .no_rdtsc_supported:
  5225 00003337 BE[E0E20000]                            mov	esi, mp3_sb_samples
  5226 0000333C 8B3D[70190100]                          mov	edi, [mp3_samples_dst]
  5227 00003342 C705[7C190100]0000-                     mov	dword [mp3_curr_channel], 0
  5227 0000334A 0000               
  5228                                  
  5229                                  .synth_channel_lop:
  5230 0000334C 56                                      push	esi
  5231 0000334D 57                                      push	edi
  5232 0000334E 893D[C4C20000]                          mov	[mp3_curr_syn_dst], edi
  5233 00003354 C705[84190100]0000-                     mov	dword [mp3_curr_frame], 0
  5233 0000335C 0000               
  5234                                  
  5235                                  .synth_frame_lop:
  5236 0000335E 56                                      push    esi
  5237                                  	
  5238                                  		; 16/02/2025
  5239                                  .no_rdtsc_supported@:
  5240 0000335F 8B15[7C190100]                          mov     edx, [mp3_curr_channel]
  5241 00003365 8B0495[D8E20000]                        mov     eax, [mp3_synth_index+edx*4]
  5242 0000336C 832C95[D8E20000]20                      sub     dword [mp3_synth_index+edx*4], 32
  5243 00003374 C1E20A                                  shl     edx, 10         ; channel*1024
  5244 00003377 25E0010000                              and     eax, 1E0h       ; 1FFh-1Fh
  5245 0000337C 09D0                                    or      eax, edx
  5246 0000337E A3[C0C20000]                            mov     [mp3_curr_syn_index], eax
  5247 00003383 8B3D[C0C20000]                          mov     edi, [mp3_curr_syn_index]
  5248 00003389 8D3CBD[D8C20000]                        lea     edi, [mp3_synth_buf+edi*4]
  5249 00003390 E8D1EFFFFF                              call    mp3_dct32_shift_0 ; mp3_dct32_shift_&rate_shift
  5250                                  		
  5251                                  		; 16/02/2025		
  5252                                  .no_rdtsc_supported@@:
  5253                                  
  5254                                  		; 16/02/2025
  5255                                  .no_rdtsc_supported@@@:
  5256 00003395 E84A000000                              call    mp3_synth_filter_this_16bit_shift_0_slow
  5257                                  	
  5258                                  		; 16/02/2025
  5259                                  .no_rdtsc_supported@@@@:
  5260 0000339A 5E                                      pop     esi
  5261 0000339B A1[78190100]                            mov     eax, [mp3_samples_dst_step]
  5262 000033A0 C1E005                                  shl     eax, 5
  5263                                  		; 15/02/2025
  5264 000033A3 0105[C4C20000]                          add     [mp3_curr_syn_dst], eax
  5265 000033A9 81C680000000                            add     esi, 128        ; SBLIMIT*4
  5266 000033AF FF05[84190100]                          inc     dword [mp3_curr_frame]
  5267 000033B5 A1[84190100]                            mov     eax, [mp3_curr_frame]
  5268 000033BA 3B05[C8C20000]                          cmp     eax, [mp3_nb_frames]
  5269 000033C0 729C                                    jb      .synth_frame_lop
  5270 000033C2 5F                                      pop     edi
  5271 000033C3 5E                                      pop     esi
  5272                                  		;add	edi, [mp3_bytes_per_sample]
  5273                                  		; 17/02/2025
  5274                                  		;add	edi, 2 ; [mp3_bytes_per_sample] = 2
  5275 000033C4 47                                      inc	edi
  5276 000033C5 47                      		inc	edi
  5277 000033C6 81C600120000            		add     esi, 4608       ; 36*SBLIMIT*4
  5278 000033CC FF05[7C190100]                          inc     dword [mp3_curr_channel]
  5279 000033D2 A1[7C190100]                            mov     eax, [mp3_curr_channel]
  5280                                  		; 16/02/2025
  5281 000033D7 3B05[BCC20000]                          cmp     eax, [mp3_num_channels]
  5282 000033DD 0F8269FFFFFF                            jb      .synth_channel_lop
  5283                                  	
  5284                                  		; 16/02/2025
  5285                                  .no_rdtsc_supported@@@@@:
  5286 000033E3 C3                                      retn
  5287                                  
  5288                                  
  5289                                  ; =============== S U B R O U T I N E =======================================
  5290                                  
  5291                                  
  5292                                  mp3_synth_filter_this_16bit_shift_0_slow:
  5293 000033E4 A1[C0C20000]                            mov     eax, [mp3_curr_syn_index]
  5294 000033E9 A9E0010000                              test    eax, 1E0h       ; 1FFh-1Fh
  5295 000033EE 0F847C010000                            jz      .append_copy_to_window
  5296 000033F4 90                                      nop
  5297                                  
  5298                                  .append_copy_to_window_back:
  5299 000033F5 89C5                                    mov     ebp, eax        ; mov @@win1,eax
  5300 000033F7 81E5C0010000                            and     ebp, 1C0h       ; and @@win1,1FFh-1Fh-20h
  5301 000033FD 2520040000                              and     eax, 420h       ; and eax,20h+(1 shl 10) ; bit5, and channel
  5302 00003402 8D7010                                  lea     esi, [eax+10h]  ; lea @@syn1,[eax+10h]
  5303 00003405 8D7830                                  lea     edi, [eax+30h]  ; lea @@syn2,[eax+30h]
  5304 00003408 F7DD                                    neg     ebp
  5305 0000340A 81E5C0010000                            and     ebp, 1C0h       ; and @@win1,1FFh-1Fh-20h
  5306 00003410 8B0D[C4C20000]                          mov     ecx, [mp3_curr_syn_dst]
  5307                                  
  5308                                  .samples_lop:
  5309 00003416 BB10001000                              mov     ebx, 100010h    ; mov @@sum,(8000h SHL (@@out_shift))+(1 SHL (@@out_shift-1))
  5310                                                                          ; @@out_shift = 5
  5311                                  
  5312                                  .SUM8_@:                                ; @@SUM8 macro sum,win,ww,syn
  5313 0000341B 8B14B5[D8C20000]                        mov     edx, [mp3_synth_buf+esi*4] ; IRP nn,0,1,2,3,4,5,6,7
  5314                                                                          ; @@SUM8 @@sum,@@win1,0, @@syn1
  5315 00003422 8B04AD[8C140500]                        mov     eax, [mp3_synth_win+ebp*4] ; [mp3_synth_buf+syn*4+(nn*64*4)]
  5316 00003429 F7EA                                    imul    edx             ; [mp3_synth_win+win*4+(nn*64*4)+ww*4]
  5317 0000342B 01D3                                    add     ebx, edx
  5318 0000342D 8B14B5[D8C30000]                        mov     edx, [(mp3_synth_buf+100h)+esi*4]
  5319 00003434 8B04AD[8C150500]                        mov     eax, [(mp3_synth_win+100h)+ebp*4]
  5320 0000343B F7EA                                    imul    edx
  5321 0000343D 01D3                                    add     ebx, edx        ; add sum,edx
  5322 0000343F 8B14B5[D8C40000]                        mov     edx, [(mp3_synth_buf+200h)+esi*4]
  5323 00003446 8B04AD[8C160500]                        mov     eax, [(mp3_synth_win+200h)+ebp*4] ; [mp3_synth_win+win*4+(nn*64*4)+ww*4]
  5324 0000344D F7EA                                    imul    edx             ; 64bit = 32bit * 32bit
  5325 0000344F 01D3                                    add     ebx, edx
  5326 00003451 8B14B5[D8C50000]                        mov     edx, [(mp3_synth_buf+300h)+esi*4]
  5327 00003458 8B04AD[8C170500]                        mov     eax, [(mp3_synth_win+300h)+ebp*4]
  5328 0000345F F7EA                                    imul    edx
  5329 00003461 01D3                                    add     ebx, edx
  5330 00003463 8B14B5[D8C60000]                        mov     edx, [(mp3_synth_buf+400h)+esi*4]
  5331 0000346A 8B04AD[8C180500]                        mov     eax, [(mp3_synth_win+400h)+ebp*4]
  5332 00003471 F7EA                                    imul    edx
  5333 00003473 01D3                                    add     ebx, edx
  5334 00003475 8B14B5[D8C70000]                        mov     edx, [(mp3_synth_buf+500h)+esi*4]
  5335 0000347C 8B04AD[8C190500]                        mov     eax, [(mp3_synth_win+500h)+ebp*4]
  5336 00003483 F7EA                                    imul    edx
  5337 00003485 01D3                                    add     ebx, edx
  5338 00003487 8B14B5[D8C80000]                        mov     edx, [(mp3_synth_buf+600h)+esi*4]
  5339 0000348E 8B04AD[8C1A0500]                        mov     eax, [(mp3_synth_win+600h)+ebp*4]
  5340 00003495 F7EA                                    imul    edx
  5341 00003497 01D3                                    add     ebx, edx
  5342 00003499 8B14B5[D8C90000]                        mov     edx, [(mp3_synth_buf+700h)+esi*4]
  5343 000034A0 8B04AD[8C1B0500]                        mov     eax, [(mp3_synth_win+700h)+ebp*4]
  5344 000034A7 F7EA                                    imul    edx
  5345 000034A9 01D3                                    add     ebx, edx
  5346                                  
  5347                                  .skippp:                               ; @@SUM8 macro sum,win,ww,syn
  5348 000034AB 8B14BD[D8C20000]                        mov     edx, [mp3_synth_buf+edi*4] ; @@SUM8 @@sum,@@win1,32,@@syn2
  5349                                                                          ; [mp3_synth_buf+syn*4+(nn*64*4)]
  5350 000034B2 8B04AD[0C150500]                        mov     eax, [(mp3_synth_win+80h)+ebp*4] ; [mp3_synth_win+win*4+(nn*64*4)+ww*4]
  5351 000034B9 F7EA                                    imul    edx
  5352 000034BB 01D3                                    add     ebx, edx
  5353 000034BD 8B14BD[D8C30000]                        mov     edx, [(mp3_synth_buf+100h)+edi*4]
  5354 000034C4 8B04AD[0C160500]                        mov     eax, [(mp3_synth_win+180h)+ebp*4]
  5355 000034CB F7EA                                    imul    edx
  5356 000034CD 01D3                                    add     ebx, edx
  5357 000034CF 8B14BD[D8C40000]                        mov     edx, [(mp3_synth_buf+200h)+edi*4]
  5358 000034D6 8B04AD[0C170500]                        mov     eax, [(mp3_synth_win+280h)+ebp*4]
  5359 000034DD F7EA                                    imul    edx
  5360 000034DF 01D3                                    add     ebx, edx
  5361 000034E1 8B14BD[D8C50000]                        mov     edx, [(mp3_synth_buf+300h)+edi*4]
  5362 000034E8 8B04AD[0C180500]                        mov     eax, [(mp3_synth_win+380h)+ebp*4]
  5363 000034EF F7EA                                    imul    edx
  5364 000034F1 01D3                                    add     ebx, edx
  5365 000034F3 8B14BD[D8C60000]                        mov     edx, [(mp3_synth_buf+400h)+edi*4]
  5366 000034FA 8B04AD[0C190500]                        mov     eax, [(mp3_synth_win+480h)+ebp*4]
  5367 00003501 F7EA                                    imul    edx
  5368 00003503 01D3                                    add     ebx, edx
  5369 00003505 8B14BD[D8C70000]                        mov     edx, [(mp3_synth_buf+500h)+edi*4]
  5370 0000350C 8B04AD[0C1A0500]                        mov     eax, [(mp3_synth_win+580h)+ebp*4]
  5371 00003513 F7EA                                    imul    edx
  5372 00003515 01D3                                    add     ebx, edx
  5373 00003517 8B14BD[D8C80000]                        mov     edx, [(mp3_synth_buf+600h)+edi*4]
  5374 0000351E 8B04AD[0C1B0500]                        mov     eax, [(mp3_synth_win+680h)+ebp*4]
  5375 00003525 F7EA                                    imul    edx
  5376 00003527 01D3                                    add     ebx, edx
  5377 00003529 8B14BD[D8C90000]                        mov     edx, [(mp3_synth_buf+700h)+edi*4]
  5378 00003530 8B04AD[0C1C0500]                        mov     eax, [(mp3_synth_win+780h)+ebp*4]
  5379 00003537 F7EA                                    imul    edx
  5380 00003539 01D3                                    add     ebx, edx
  5381 0000353B 81FB00002000                            cmp     ebx, 200000h    ; cmp @@sum,10000h SHL (@@out_shift)
  5382 00003541 7322                                    jnb     short .sat
  5383 00003543 C1FB05                                  sar     ebx, 5          ; sar @@sum,(@@out_shift)
  5384 00003546 81EB00800000                            sub     ebx, 8000h      ; make 16bit signed
  5385                                  
  5386                                  .sat_back:
  5387 0000354C 668919                                  mov     [ecx], bx
  5388 0000354F 030D[78190100]                          add     ecx, [mp3_samples_dst_step]
  5389 00003555 46                                      inc     esi             ; inc @@syn1
  5390 00003556 4F                                      dec     edi             ; dec @@syn2
  5391 00003557 45                                      inc     ebp             ; inc @@win1
  5392 00003558 F7C51F000000                            test    ebp, 1Fh        ; test @@win1,1Fh
  5393 0000355E 0F85B2FEFFFF                            jnz     .samples_lop
  5394 00003564 C3                                      retn
  5395                                  
  5396                                  .sat:
  5397 00003565 C1FB1F                                  sar     ebx, 31         ; FFFFFFFFh,00000000h
  5398 00003568 81F3FF7F0000                            xor     ebx, 7FFFh      ; FFFF8000h,00007FFFh (signed 16bit)
  5399 0000356E EBDC                                    jmp     short .sat_back
  5400                                  
  5401                                  .append_copy_to_window:
  5402 00003570 8D3485[D8C20000]                        lea     esi, [mp3_synth_buf+eax*4]
  5403 00003577 8DBE00080000                            lea     edi, [esi+2048] ; [esi+512*4]
  5404 0000357D B912000000                              mov     ecx, 18         ; (12h*4)/4
  5405 00003582 F3A5                                    rep movsd
  5406 00003584 E96CFEFFFF                              jmp     .append_copy_to_window_back
  5407                                  
  5408                                  
  5409                                  ; =============== S U B R O U T I N E =======================================
  5410                                  
  5411                                  
  5412                                  mp3_any_init_synth_window:
  5413 00003589 31D2                                    xor     edx, edx        ; index (0..100h)
  5414 0000358B 31C9                                    xor     ecx, ecx        ; delta.val
  5415 0000358D 898C12[8C140500]                        mov     [mp3_synth_win+edx*2], ecx
  5416                                  
  5417                                  .synth_lop:
  5418 00003594 0FBF9C12[D69C0000]                      movsx   ebx, word [mp3_synth_win_src+edx*2]
  5419 0000359C 01D9                                    add     ecx, ebx
  5420 0000359E 89C8                                    mov     eax, ecx
  5421                                  
  5422                                  		; 15/02/2025
  5423 000035A0 C1E00E                                  shl	eax, 14         ; (WFRAC_BITS_slow-WFRAC_BITS_default)
  5424                                  
  5425 000035A3 42                                      inc     edx             ; index (1..100h)
  5426 000035A4 BB00020000                              mov     ebx, 200h
  5427 000035A9 29D3                                    sub     ebx, edx        ; 1FFh..100h
  5428 000035AB 89049D[8C140500]                        mov     [mp3_synth_win+ebx*4], eax
  5429 000035B2 F7C23F000000                            test    edx, 3Fh
  5430 000035B8 7402                                    jz      short .synth_keep_sign
  5431 000035BA F7D8                                    neg     eax
  5432                                  
  5433                                  .synth_keep_sign:
  5434 000035BC 890495[8C140500]                        mov     [mp3_synth_win+edx*4], eax
  5435 000035C3 81FA00010000                            cmp     edx, 100h
  5436 000035C9 72C9                                    jb      short .synth_lop
  5437 000035CB 31D2                                    xor     edx, edx
  5438                                  
  5439                                  .synth_neg_lop:
  5440 000035CD F7C230000000                            test    edx, 30h        ; skip 0..0Fh (only negate 10h..3Fh)
  5441 000035D3 7407                                    jz      short .synth_neg_next
  5442 000035D5 F71C95[8C140500]                        neg     dword [mp3_synth_win+edx*4]
  5443                                  
  5444                                  .synth_neg_next:
  5445 000035DC 42                                      inc     edx
  5446 000035DD 81FA00020000                            cmp     edx, 200h
  5447 000035E3 72E8                                    jb      short .synth_neg_lop
  5448 000035E5 31D2                                    xor     edx, edx
  5449                                  
  5450                                  .synth_swap_lop:
  5451 000035E7 89D0                                    mov     eax, edx
  5452 000035E9 83E03F                                  and     eax, 3Fh
  5453 000035EC 83E811                                  sub     eax, 17         ; swap win [(17..31)] with win[(17..31)+32)
  5454 000035EF 83F80E                                  cmp     eax, 14         ; 31-17
  5455 000035F2 7715                                    ja      short .synth_swap_next
  5456 000035F4 8B0495[8C140500]                        mov     eax, [mp3_synth_win+edx*4]
  5457 000035FB 870495[0C150500]                        xchg    eax, [(mp3_synth_win+80h)+edx*4]
  5458 00003602 890495[8C140500]                        mov     [mp3_synth_win+edx*4], eax
  5459                                  
  5460                                  .synth_swap_next:
  5461 00003609 42                                      inc     edx
  5462 0000360A 81FA00020000                            cmp     edx, 200h
  5463 00003610 72D5                                    jb      short .synth_swap_lop
  5464 00003612 31D2                                    xor     edx, edx
  5465                                  
  5466                                  .synth_zero_lop:
  5467 00003614 C70495[CC140500]00-                     mov	dword [(mp3_synth_win+40h)+edx*4], 0
  5467 0000361C 000000             
  5468 0000361F 83C240                                  add	edx, 40h
  5469 00003622 81FA00020000                            cmp	edx, 200h
  5470 00003628 72EA                                    jb	short .synth_zero_lop
  5471 0000362A BE[8C140500]                            mov	esi, mp3_synth_win
  5472 0000362F 8DBE00080000                            lea	edi, [esi+2048] ; [esi+512*4]
  5473 00003635 B900020000                              mov	ecx, 512        ; append another copy
  5474 0000363A F3A5                                    rep movsd
  5475 0000363C C3                                      retn
  5476                                  
  5477                                  
  5478                                  ; =============== S U B R O U T I N E =======================================
  5479                                  
  5480                                  
  5481                                  mp3_any_init_band_indices:
  5482 0000363D BE[08A50000]                            mov     esi, mp3_band_size_long
  5483 00003642 BF[A0FC0100]                            mov     edi, mp3_band_index_long
  5484 00003647 BB09000000                              mov     ebx, 9
  5485                                  
  5486                                  .band_index_lop_i:
  5487 0000364C 31C0                                    xor     eax, eax
  5488 0000364E B916000000                              mov     ecx, 22
  5489                                  
  5490                                  .band_index_lop_j:
  5491 00003653 66AB                                    stosw
  5492 00003655 0FB616                                  movzx   edx, byte [esi]
  5493 00003658 01D0                                    add     eax, edx
  5494 0000365A 46                                      inc     esi
  5495 0000365B E2F6                                    loop    .band_index_lop_j
  5496 0000365D 83C10A                                  add     ecx, 10
  5497 00003660 F366AB                                  rep stosw
  5498 00003663 4B                                      dec     ebx
  5499 00003664 75E6                                    jnz     short .band_index_lop_i
  5500 00003666 C3                                      retn
  5501                                  
  5502                                  
  5503                                  ; =============== S U B R O U T I N E =======================================
  5504                                  
  5505                                  
  5506                                  mp3_any_init_lsf_sf_expand:
  5507 00003667 BE[A69C0000]                            mov     esi, mp3_lsf_sf_expand_init_table
  5508 0000366C BF[8C240500]                            mov     edi, mp3_lsf_sf_expand_exploded_table
  5509 00003671 31D2                                    xor     edx, edx        ; curr.index
  5510 00003673 31DB                                    xor     ebx, ebx        ; curr.base
  5511                                  
  5512                                  .lop:
  5513 00003675 663B5606                                cmp     dx, [esi+6]     ; nextbase
  5514 00003679 7207                                    jb      short .inrange
  5515 0000367B 668B5E06                                mov     bx, [esi+6]
  5516 0000367F 83C608                                  add     esi, 8          ; next entry
  5517                                  
  5518                                  .inrange:
  5519 00003682 89D0                                    mov     eax, edx
  5520 00003684 29D8                                    sub     eax, ebx
  5521 00003686 8A0E                                    mov     cl, [esi]
  5522 00003688 D3E8                                    shr     eax, cl         ; div2
  5523 0000368A F67603                                  div     byte [esi+3] ; mod3 ; [2]=slen[3]
  5524 0000368D 886703                                  mov     [edi+3], ah
  5525 00003690 B400                                    mov     ah, 0           ; eax=div.result
  5526 00003692 F67602                                  div     byte [esi+2] ; mod2 ; [2]=slen[2]
  5527 00003695 886702                                  mov     [edi+2], ah     ; remainder
  5528 00003698 B400                                    mov     ah, 0
  5529 0000369A F67601                                  div     byte [esi+1] ; mod1 ; [1]=slen[1]
  5530 0000369D 668907                                  mov     [edi], ax       ; [0]=slen[0]
  5531 000036A0 668B4604                                mov     ax, [esi+4]     ; [4]=tindex2
  5532 000036A4 66894704                                mov     [edi+4], ax     ; [5]=force_preflag
  5533 000036A8 83C708                                  add     edi, 8
  5534 000036AB 42                                      inc     edx             ; curr.index ; next
  5535 000036AC 81FA00040000                            cmp     edx, 1024       ; 512+512
  5536 000036B2 72C1                                    jb      short .lop
  5537 000036B4 C3                                      retn
  5538                                  
  5539                                  
  5540                                  ; =============== S U B R O U T I N E =======================================
  5541                                  
  5542                                  
  5543                                  mp3_any_init_huff_tables:
  5544 000036B5 BD[409F0000]                            mov     ebp, huff_tree_list_data
  5545 000036BA BE[2EA90000]                            mov     esi, huff_tree_list_numbits
  5546 000036BF BA01000000                              mov     edx, 1          ; idx (table 01h..11h)
  5547                                  
  5548                                  .huffman_table_lop:
  5549 000036C4 31C0                                    xor     eax, eax
  5550 000036C6 BF[B84E0500]                            mov     edi, mp3_huff_tmp_bits
  5551 000036CB B940000000                              mov     ecx, 40h        ; 100h/4 ; 100h x 8bit
  5552 000036D0 F3AB                                    rep stosd
  5553 000036D2 BF[B84F0500]                            mov     edi, mp3_huff_tmp_codes
  5554 000036D7 B980000000                              mov     ecx, 80h        ; 100h/2 ; 100h x 16bit
  5555 000036DC F3AB                                    rep stosd
  5556 000036DE 31DB                                    xor     ebx, ebx
  5557                                  
  5558                                  .huff_entry_lop:
  5559 000036E0 0FB67D00                                movzx   edi, byte [ebp+0]
  5560 000036E4 45                                      inc     ebp             ; dst=data
  5561 000036E5 AC                                      lodsb                   ; numbits
  5562 000036E6 8887[B84E0500]                          mov     [mp3_huff_tmp_bits+edi], al
  5563 000036EC B120                                    mov     cl, 32
  5564 000036EE 28C1                                    sub     cl, al          ; 32-numbits
  5565 000036F0 D3EB                                    shr     ebx, cl
  5566 000036F2 66899C3F[B84F0500]                      mov     word [mp3_huff_tmp_codes+edi*2], bx
  5567 000036FA 43                                      inc     ebx             ; next.code
  5568 000036FB D3E3                                    shl     ebx, cl         ; shift back to MSBs
  5569 000036FD 75E1                                    jnz     short .huff_entry_lop
  5570 000036FF 60                                      pusha
  5571 00003700 B800010000                              mov     eax, 100h       ; nb_codes
  5572 00003705 BB[B84E0500]                            mov     ebx, mp3_huff_tmp_bits ; bits
  5573 0000370A BE[B84F0500]                            mov     esi, mp3_huff_tmp_codes ; codes
  5574 0000370F E82C020000                              call    mp3_build_huff_table_root ; make table
  5575 00003714 61                                      popa
  5576 00003715 42                                      inc     edx             ; idx
  5577 00003716 83FA12                                  cmp     edx, 12h
  5578 00003719 75A9                                    jnz     short .huffman_table_lop ; next table
  5579 0000371B C3                                      retn
  5580                                  
  5581                                  
  5582                                  ; =============== S U B R O U T I N E =======================================
  5583                                  
  5584                                  
  5585                                  mp3_integer_init_is_stereo_lsf:
  5586 0000371C 31FF                                    xor     edi, edi
  5587                                  
  5588                                  .lsf_lop:
  5589 0000371E 89FE                                    mov     esi, edi
  5590 00003720 83E63F                                  and     esi, 3Fh
  5591 00003723 46                                      inc     esi
  5592 00003724 D1EE                                    shr     esi, 1
  5593 00003726 F7C740000000                            test    edi, 40h
  5594 0000372C 7402                                    jz      short .lsf_no_shift
  5595 0000372E D1E6                                    shl     esi, 1
  5596                                  
  5597                                  .lsf_no_shift:
  5598 00003730 BA00000040                              mov     edx, 40000000h  ; aka mul 1.000
  5599 00003735 83C604                                  add     esi, 4
  5600 00003738 F7C780000000                            test    edi, 80h        ; 2*40h
  5601 0000373E 7408                                    jz      short .no_ms_stereo
  5602 00003740 BA9A79825A                              mov     edx, 5A82799Ah  ; 2D413CCDh*2 ; aka mul 1.414
  5603 00003745 83EE02                                  sub     esi, 2
  5604                                  
  5605                                  .no_ms_stereo:
  5606 00003748 89F1                                    mov     ecx, esi
  5607 0000374A C1E902                                  shr     ecx, 2          ; msbs
  5608 0000374D 83E603                                  and     esi, 3          ; lsbs
  5609 00003750 8B04B5[00A90000]                        mov     eax, [mp3_is_table_lsf_src+esi*4]
  5610 00003757 D3E8                                    shr     eax, cl
  5611 00003759 F7C701000000                            test    edi, 1
  5612 0000375F 7501                                    jnz     short .lsf_no_swap
  5613 00003761 92                                      xchg    eax, edx
  5614                                  
  5615                                  .lsf_no_swap:
  5616 00003762 8904FD[8C0C0500]                        mov     [mp3_is_table_lsf+edi*8], eax
  5617 00003769 8914FD[900C0500]                        mov     [(mp3_is_table_lsf+4)+edi*8], edx
  5618 00003770 47                                      inc     edi
  5619 00003771 81FF00010000                            cmp     edi, 100h
  5620 00003777 72A5                                    jb      short .lsf_lop
  5621 00003779 C3                                      retn
  5622                                  
  5623                                  
  5624                                  ; =============== S U B R O U T I N E =======================================
  5625                                  
  5626                                  
  5627                                  mp3_integer_init_mdct_windows:
  5628 0000377A BF[0C080500]                            mov     edi, mp3_mdct_win
  5629 0000377F BE[88A60000]                            mov     esi, mp3_mdct_win_src
  5630 00003784 B990000000                              mov     ecx, 144        ; 36*4
  5631 00003789 F3A5                                    rep movsd
  5632 0000378B BE[0C080500]                            mov     esi, mp3_mdct_win
  5633 00003790 BF[4C0A0500]                            mov     edi, (mp3_mdct_win+240h)
  5634 00003795 B948000000                              mov     ecx, 72         ; 4*36/2 ; that is, 4*36 entry pairs
  5635                                  
  5636                                  .mdct_lop_dupe:                       
  5637 0000379A A5                                      movsd                   ; copy normal, [4..7][even] = +[0..3][even
  5638 0000379B AD                                      lodsd
  5639 0000379C F7D8                                    neg     eax             ; copy negated, [4..7][odd] = -[0..3][odd]
  5640 0000379E AB                                      stosd
  5641 0000379F E2F9                                    loop    .mdct_lop_dupe
  5642 000037A1 C3                                      retn
  5643                                  
  5644                                  
  5645                                  ; =============== S U B R O U T I N E =======================================
  5646                                  
  5647                                  
  5648                                  mp3_integer_init_table_4_3:
  5649                                  		; 15/02/2025
  5650 000037A2 B048                                    mov	al, 72          ; 100-6-VFRAC_BITS_slow
  5651                                   .this_vfrac:
  5652 000037A4 A2[E4180100]                            mov     [mp3_curr_vfrac_bits], al
  5653 000037A9 31FF                                    xor     edi, edi
  5654                                  
  5655                                  .table_4_3_lop:
  5656 000037AB 57                                      push    edi             ; for i=1 to TABLE_4_3_SIZE-1
  5657 000037AC 89F8                                    mov     eax, edi
  5658 000037AE C1E802                                  shr     eax, 2
  5659 000037B1 F7E0                                    mul     eax
  5660 000037B3 F7E0                                    mul     eax
  5661 000037B5 31DB                                    xor     ebx, ebx
  5662 000037B7 E8A2000000                              call    cbrt96
  5663 000037BC 020D[E4180100]                          add     cl, [mp3_curr_vfrac_bits]
  5664 000037C2 5F                                      pop     edi
  5665                                  
  5666                                  .inner_lop:
  5667 000037C3 89F8                                    mov     eax, edi
  5668 000037C5 83E003                                  and     eax, 3
  5669 000037C8 8B0485[10A90000]                        mov     eax, [mp3_pow2_quarters+eax*4]
  5670 000037CF F7E3                                    mul     ebx
  5671 000037D1 88CD                                    mov     ch, cl
  5672 000037D3 09D2                                    or      edx, edx
  5673 000037D5 7904                                    jns     short .this
  5674 000037D7 D1EA                                    shr     edx, 1
  5675 000037D9 FECD                                    dec     ch
  5676                                  
  5677                                  .this:
  5678 000037DB 8914BD[1C7F0200]                        mov     [mp3_table_4_3_value+edi*4], edx
  5679 000037E2 88AF[E0FE0100]                          mov     [mp3_table_4_3_exp+edi], ch
  5680 000037E8 47                                      inc     edi
  5681 000037E9 F7C703000000                            test    edi, 3
  5682 000037EF 75D2                                    jnz     short .inner_lop
  5683 000037F1 81FF3C800000                            cmp     edi, 803Ch
  5684 000037F7 72B2                                    jb      short .table_4_3_lop
  5685 000037F9 C3                                      retn
  5686                                  
  5687                                  
  5688                                  ; =============== S U B R O U T I N E =======================================
  5689                                  
  5690                                  
  5691                                  mp3_integer_init_exponent:
  5692 000037FA BF[0C880400]                            mov     edi, mp3_expval_table
  5693 000037FF 31D2                                    xor     edx, edx
  5694                                  
  5695                                  .exponent_lop:
  5696 00003801 89D0                                    mov     eax, edx        ; val=i
  5697 00003803 89D3                                    mov     ebx, edx
  5698 00003805 89D1                                    mov     ecx, edx
  5699 00003807 C1EB04                                  shr     ebx, 4
  5700 0000380A C1E906                                  shr     ecx, 6          ; 4+2
  5701 0000380D 83E00F                                  and     eax, 0Fh        ; val=i AND 0Fh
  5702 00003810 83E303                                  and     ebx, 3
  5703 00003813 8D1C83                                  lea     ebx, [ebx+eax*4] ; (0..0Fh)*4+(0..3)
  5704 00003816 8B049D[1C7F0200]                        mov     eax, [mp3_table_4_3_value+ebx*4]
  5705 0000381D 09C0                                    or      eax, eax
  5706 0000381F 741A                                    jz      short .this
  5707 00003821 2A8B[E0FE0100]                          sub     cl, [mp3_table_4_3_exp+ebx]
  5708 00003827 770D                                    ja      short .left_shift
  5709 00003829 F6D9                                    neg     cl
  5710 0000382B D3E8                                    shr     eax, cl
  5711 0000382D 80F91F                                  cmp     cl, 1Fh
  5712 00003830 7609                                    jbe     short .this
  5713 00003832 31C0                                    xor     eax, eax
  5714 00003834 EB05                                    jmp     short .this
  5715                                  
  5716                                  .left_shift:
  5717 00003836 B8FFFFFF7F                              mov     eax, 7FFFFFFFh
  5718                                  
  5719                                  .this:
  5720 0000383B AB                                      stosd
  5721 0000383C 42                                      inc     edx
  5722 0000383D 81FA00200000                            cmp     edx, 2000h
  5723 00003843 72BC                                    jb      short .exponent_lop
  5724 00003845 BE[0C880400]                            mov     esi, mp3_expval_table
  5725 0000384A BF[0C800400]                            mov     edi, mp3_exp_table
  5726 0000384F B900020000                              mov     ecx, 200h
  5727                                  
  5728                                  .exponent_dupe_lop:
  5729 00003854 8B4604                                  mov     eax, [esi+4]
  5730 00003857 AB                                      stosd
  5731 00003858 83C640                                  add     esi, 40h
  5732 0000385B E2F7                                    loop    .exponent_dupe_lop
  5733 0000385D C3                                      retn
  5734                                  
  5735                                  
  5736                                  ; =============== S U B R O U T I N E =======================================
  5737                                  
  5738                                  
  5739                                  cbrt96:
  5740 0000385E 83EC18                                  sub     esp, 18h        ; cube root, val^(1/3), from https://gist.github.com/anonymous/729557
  5741                                                                          ; in:  ebx:edx:eax = unsigned 96bit input (integer)
  5742                                                                          ; out: ebx         = unsigned 32bit result (with fractional bits)
  5743                                                                          ; out: cl          = number of fractional bits
  5744 00003861 890424                                  mov     [esp], eax
  5745 00003864 89542404                                mov     [esp+4], edx
  5746 00003868 895C2408                                mov     [esp+8], ebx
  5747 0000386C C744240C00000000                        mov     dword [esp+0Ch], 0
  5748 00003874 C744241000000000                        mov     dword [esp+10h], 0
  5749 0000387C C744241400000000                        mov     dword [esp+14h], 0
  5750 00003884 31DB                                    xor     ebx, ebx        ; result.value
  5751 00003886 B100                                    mov     cl, 0           ; result.fraction
  5752 00003888 09D0                                    or      eax, edx        ; skip if zero
  5753 0000388A 742F                                    jz      short .pre_shift_done
  5754                                  
  5755                                  .pre_shift_lop:
  5756 0000388C F7442408000000E0                        test    dword [esp+8], 0E0000000h
  5757 00003894 7525                                    jnz     short .pre_shift_done
  5758 00003896 D12424                                  shl     dword [esp], 1
  5759 00003899 D1542404                                rcl     dword [esp+4], 1
  5760 0000389D D1542408                                rcl     dword [esp+8], 1
  5761 000038A1 D12424                                  shl     dword [esp], 1
  5762 000038A4 D1542404                                rcl     dword [esp+4], 1
  5763 000038A8 D1542408                                rcl     dword [esp+8], 1
  5764 000038AC D12424                                  shl     dword [esp], 1
  5765 000038AF D1542404                                rcl     dword [esp+4], 1
  5766 000038B3 D1542408                                rcl     dword [esp+8], 1
  5767 000038B7 FEC1                                    inc     cl
  5768 000038B9 EBD1                                    jmp     short .pre_shift_lop
  5769                                  
  5770                                  .pre_shift_done:
  5771 000038BB B520                                    mov     ch, 20h         ; loopcount
  5772                                  
  5773                                  .lop:
  5774 000038BD 01DB                                    add     ebx, ebx        ; result*2
  5775 000038BF 89D8                                    mov     eax, ebx        ; y
  5776 000038C1 43                                      inc     ebx             ; result+1
  5777 000038C2 F7E3                                    mul     ebx             ; y*(y+1)
  5778 000038C4 89C6                                    mov     esi, eax
  5779 000038C6 89D7                                    mov     edi, edx
  5780 000038C8 31ED                                    xor     ebp, ebp
  5781 000038CA F9                                      stc
  5782 000038CB 11F6                                    adc     esi, esi        ; y*(y+1)*2+1
  5783 000038CD 11FF                                    adc     edi, edi
  5784 000038CF 11ED                                    adc     ebp, ebp
  5785 000038D1 01C6                                    add     esi, eax
  5786 000038D3 11D7                                    adc     edi, edx        ; y*(y+1)*3+1
  5787 000038D5 83D500                                  adc     ebp, 0
  5788 000038D8 D12424                                  shl     dword [esp], 1
  5789 000038DB D1542404                                rcl     dword [esp+4], 1
  5790 000038DF D1542408                                rcl     dword [esp+8], 1 ; shl 3
  5791 000038E3 D154240C                                rcl     dword [esp+0Ch], 1
  5792 000038E7 D1542410                                rcl     dword [esp+10h], 1
  5793 000038EB D1542414                                rcl     dword [esp+14h], 1
  5794 000038EF D12424                                  shl     dword [esp], 1
  5795 000038F2 D1542404                                rcl     dword [esp+4], 1
  5796 000038F6 D1542408                                rcl     dword [esp+8], 1
  5797 000038FA D154240C                                rcl     dword [esp+0Ch], 1
  5798 000038FE D1542410                                rcl     dword [esp+10h], 1
  5799 00003902 D1542414                                rcl     dword [esp+14h], 1
  5800 00003906 D12424                                  shl     dword [esp], 1
  5801 00003909 D1542404                                rcl     dword [esp+4], 1
  5802 0000390D D1542408                                rcl     dword [esp+8], 1
  5803 00003911 D154240C                                rcl     dword [esp+0Ch], 1
  5804 00003915 D1542410                                rcl     dword [esp+10h], 1
  5805 00003919 D1542414                                rcl     dword [esp+14h], 1
  5806 0000391D 2974240C                                sub     [esp+0Ch], esi
  5807 00003921 197C2410                                sbb     [esp+10h], edi  ; sub/compare
  5808 00003925 196C2414                                sbb     [esp+14h], ebp
  5809 00003929 730D                                    jnb     short .next
  5810 0000392B 4B                                      dec     ebx
  5811 0000392C 0174240C                                add     [esp+0Ch], esi
  5812 00003930 117C2410                                adc     [esp+10h], edi  ; undo
  5813 00003934 116C2414                                adc     [esp+14h], ebp
  5814                                  
  5815                                  .next:
  5816 00003938 FECD                                    dec     ch
  5817 0000393A 7581                                    jnz     short .lop
  5818 0000393C 83C418                                  add     esp, 18h
  5819                                  mp3_init_log_constants:
  5820 0000393F C3                                      retn
  5821                                  
  5822                                  ;mp3_init_log_constants:
  5823                                  ;                retn
  5824                                  
  5825                                  ; =============== S U B R O U T I N E =======================================
  5826                                  
  5827                                  
  5828                                  mp3_build_huff_table_root:
  5829 00003940 A3[BC510500]                            mov     [_@@nb_codes], eax ; "init_vlc"
  5830 00003945 C705[C0510500]0000-                     mov     dword [_@@prefix_numbits], 0
  5830 0000394D 0000               
  5831 0000394F C705[C4510500]0000-                     mov     dword [_@@prefix_pattern], 0
  5831 00003957 0000               
  5832 00003959 60                                      pusha
  5833 0000395A 89C1                                    mov     ecx, eax
  5834 0000395C 31C0                                    xor     eax, eax
  5835                                  
  5836                                  .prescan_lop:
  5837 0000395E 3A03                                    cmp     al, [ebx]
  5838 00003960 7702                                    ja      short .prescan_next
  5839 00003962 8A03                                    mov     al, [ebx]
  5840                                  
  5841                                  .prescan_next:
  5842 00003964 43                                      inc     ebx
  5843 00003965 E2F7                                    loop    .prescan_lop
  5844 00003967 3C09                                    cmp     al, 9           ; CHILD_BITS
  5845 00003969 7202                                    jb      short .prescan_this_limit
  5846 0000396B B009                                    mov     al, 9
  5847                                  
  5848                                  .prescan_this_limit:
  5849 0000396D A3[B8510500]                            mov     [_@@table_nb_bits], eax
  5850 00003972 61                                      popa
  5851                                  
  5852                                  mp3_build_huff_table_recursive_child:
  5853 00003973 8B0D[B8510500]                          mov     ecx, [_@@table_nb_bits]
  5854 00003979 B801000000                              mov     eax, 1
  5855 0000397E D3E0                                    shl     eax, cl
  5856 00003980 A3[C8510500]                            mov     [_@@curr_table_size], eax
  5857 00003985 48                                      dec     eax
  5858 00003986 A3[CC510500]                            mov     [_@@curr_table_mask], eax
  5859 0000398B 60                                      pusha
  5860 0000398C 8B1D[24A90000]                          mov     ebx, [mp3_huff_num_entries]
  5861 00003992 891D[D0510500]                          mov     [_@@curr_table_index], ebx
  5862 00003998 031D[C8510500]                          add     ebx, [_@@curr_table_size]
  5863 0000399E 891D[24A90000]                          mov     [mp3_huff_num_entries], ebx
  5864 000039A4 813D[24A90000]002E-                     cmp     dword [mp3_huff_num_entries], 11776 ; HUFF_TREE_SIZE/4
  5864 000039AC 0000               
  5865 000039AE 0F87F5D2FFFF                            ja      fatalunexpected
  5866 000039B4 61                                      popa
  5867 000039B5 BF[A0440100]                            mov     edi, huff_tree_buf
  5868 000039BA A1[D0510500]                            mov     eax, [_@@curr_table_index]
  5869 000039BF 66890497                                mov     [edi+edx*4], ax
  5870 000039C3 A1[B8510500]                            mov     eax, [_@@table_nb_bits]
  5871 000039C8 F7D8                                    neg     eax
  5872 000039CA 6689449702                              mov     [edi+edx*4+2], ax
  5873 000039CF BF[A0440100]                            mov     edi, huff_tree_buf
  5874 000039D4 8B15[D0510500]                          mov     edx, [_@@curr_table_index]
  5875 000039DA 8B0D[C8510500]                          mov     ecx, [_@@curr_table_size]
  5876                                  
  5877                                  .clear_table_lop:
  5878 000039E0 66C70497FFFF                            mov     word [edi+edx*4], 0FFFFh
  5879 000039E6 66C74497020000                          mov     word [edi+edx*4+2], 0
  5880 000039ED 42                                      inc     edx
  5881 000039EE E2F0                                    loop    .clear_table_lop
  5882 000039F0 53                                      push    ebx
  5883 000039F1 56                                      push    esi
  5884 000039F2 31D2                                    xor     edx, edx
  5885                                  
  5886                                  .make_table_lop:
  5887 000039F4 0FB60B                                  movzx   ecx, byte [ebx]
  5888 000039F7 0FB706                                  movzx   eax, word [esi]
  5889 000039FA 2B0D[C0510500]                          sub     ecx, [_@@prefix_numbits]
  5890 00003A00 7E74                                    jle     short .make_table_lop_next
  5891 00003A02 D3E8                                    shr     eax, cl
  5892 00003A04 3B05[C4510500]                          cmp     eax, [_@@prefix_pattern]
  5893 00003A0A 756A                                    jnz     short .make_table_lop_next
  5894 00003A0C BF[A0440100]                            mov     edi, huff_tree_buf
  5895 00003A11 0FB706                                  movzx   eax, word [esi]
  5896 00003A14 2B0D[B8510500]                          sub     ecx, [_@@table_nb_bits]
  5897 00003A1A 773E                                    ja      short .create_child_table
  5898 00003A1C F7D9                                    neg     ecx
  5899 00003A1E D3E0                                    shl     eax, cl
  5900 00003A20 2305[CC510500]                          and     eax, [_@@curr_table_mask]
  5901 00003A26 0305[D0510500]                          add     eax, [_@@curr_table_index]
  5902 00003A2C 8D3C87                                  lea     edi, [edi+eax*4]
  5903 00003A2F B801000000                              mov     eax, 1
  5904 00003A34 D3E0                                    shl     eax, cl
  5905 00003A36 89C1                                    mov     ecx, eax
  5906 00003A38 0FB603                                  movzx   eax, byte [ebx]
  5907 00003A3B 2B05[C0510500]                          sub     eax, [_@@prefix_numbits]
  5908                                  
  5909                                  .make_rept_lop:
  5910 00003A41 66837F0200                              cmp     word [edi+2], 0
  5911 00003A46 0F855DD2FFFF                            jnz     fatalunexpected
  5912 00003A4C 668917                                  mov     [edi], dx
  5913 00003A4F 66894702                                mov     [edi+2], ax
  5914 00003A53 83C704                                  add     edi, 4
  5915 00003A56 E2E9                                    loop    .make_rept_lop
  5916 00003A58 EB1C                                    jmp     short .make_table_lop_next
  5917                                  
  5918                                  .create_child_table:
  5919 00003A5A D3E8                                    shr     eax, cl
  5920 00003A5C 2305[CC510500]                          and     eax, [_@@curr_table_mask]
  5921 00003A62 0305[D0510500]                          add     eax, [_@@curr_table_index]
  5922 00003A68 F7D9                                    neg     ecx
  5923 00003A6A 66394C8702                              cmp     [edi+eax*4+2], cx
  5924 00003A6F 7C05                                    jl      short .make_table_lop_next
  5925 00003A71 66894C8702                              mov     [edi+eax*4+2], cx
  5926                                  
  5927                                  .make_table_lop_next:
  5928 00003A76 83C602                                  add     esi, 2
  5929 00003A79 43                                      inc     ebx
  5930 00003A7A 42                                      inc     edx
  5931 00003A7B 3B15[BC510500]                          cmp     edx, [_@@nb_codes]
  5932 00003A81 0F826DFFFFFF                            jb      .make_table_lop
  5933 00003A87 5E                                      pop     esi
  5934 00003A88 5B                                      pop     ebx
  5935 00003A89 8B0D[C8510500]                          mov     ecx, [_@@curr_table_size]
  5936 00003A8F 8B15[D0510500]                          mov     edx, [_@@curr_table_index]
  5937                                  
  5938                                  .make_child_tables_lop:
  5939 00003A95 BF[A0440100]                            mov     edi, huff_tree_buf
  5940 00003A9A 0FBF449702                              movsx   eax, word [edi+edx*4+2]
  5941 00003A9F 83F800                                  cmp     eax, 0
  5942 00003AA2 796D                                    jns     short .make_child_tables_lop_next
  5943 00003AA4 F7D8                                    neg     eax
  5944 00003AA6 3B05[B8510500]                          cmp     eax, [_@@table_nb_bits]
  5945 00003AAC 7605                                    jbe     short .make_child_tables_this
  5946 00003AAE A1[B8510500]                            mov     eax, [_@@table_nb_bits]
  5947                                  
  5948                                  .make_child_tables_this:
  5949 00003AB3 51                                      push	ecx
  5950 00003AB4 52                                      push	edx
  5951 00003AB5 FF35[D0510500]                          push	dword [_@@curr_table_index]
  5952 00003ABB FF35[B8510500]                          push	dword [_@@table_nb_bits]
  5953 00003AC1 FF35[C0510500]                          push	dword [_@@prefix_numbits]
  5954 00003AC7 FF35[C4510500]                          push	dword [_@@prefix_pattern]
  5955 00003ACD 8B0D[B8510500]                          mov	ecx, [_@@table_nb_bits]
  5956 00003AD3 A3[B8510500]                            mov	[_@@table_nb_bits], eax
  5957 00003AD8 010D[C0510500]                          add	[_@@prefix_numbits], ecx
  5958 00003ADE D325[C4510500]                          shl	dword [_@@prefix_pattern], cl
  5959 00003AE4 89D0                                    mov	eax, edx
  5960 00003AE6 2B05[D0510500]                          sub	eax, [_@@curr_table_index]
  5961 00003AEC 0905[C4510500]                          or	[_@@prefix_pattern], eax
  5962 00003AF2 E87CFEFFFF                              call	mp3_build_huff_table_recursive_child
  5963 00003AF7 8F05[C4510500]                          pop	dword [_@@prefix_pattern]
  5964 00003AFD 8F05[C0510500]                          pop	dword [_@@prefix_numbits]
  5965 00003B03 8F05[B8510500]                          pop	dword [_@@table_nb_bits]
  5966 00003B09 8F05[D0510500]                          pop	dword [_@@curr_table_index]
  5967 00003B0F 5A                                      pop	edx
  5968 00003B10 59                                      pop	ecx
  5969                                  
  5970                                  .make_child_tables_lop_next:
  5971 00003B11 42                                      inc	edx
  5972 00003B12 E281                                    loop	.make_child_tables_lop
  5973 00003B14 C3                                      retn
  5974                                  
  5975                                  
  5976                                  ; =============== S U B R O U T I N E =======================================
  5977                                  
  5978                                  
  5979                                  mp3_exclude_id3_and_tag:
  5980 00003B15 8B35[E0510500]                          mov     esi, [stream_pos]
  5981 00003B1B 8B0D[E4510500]                          mov     ecx, [bytes_left]
  5982 00003B21 83F90A                                  cmp     ecx, 10
  5983 00003B24 7240                                    jb      short .no_id3
  5984 00003B26 8B06                                    mov     eax, [esi]
  5985 00003B28 25FFFFFF00                              and     eax, 0FFFFFFh
  5986                                                  ;cmp    eax, '3DI'     ; "ID3"
  5987                                                  ; 20/10/2024 
  5988 00003B2D 3D49443300                              cmp     eax, 'ID3'     ; FASM & NASM syntax
  5989 00003B32 7532                                    jnz     short .no_id3
  5990 00003B34 8B4606                                  mov     eax, [esi+6]
  5991 00003B37 A980808080                              test    eax, 80808080h
  5992 00003B3C 7528                                    jnz     short .no_id3
  5993                                  
  5994                                  .xlat_4x7bit_to_28bit:
  5995 00003B3E 86E0                                    xchg    al, ah
  5996 00003B40 D0E0                                    shl     al, 1
  5997 00003B42 66D1E0                                  shl     ax, 1
  5998 00003B45 66C1E802                                shr     ax, 2
  5999 00003B49 C1C810                                  ror     eax, 16
  6000 00003B4C 86E0                                    xchg    al, ah
  6001 00003B4E D0E0                                    shl     al, 1
  6002 00003B50 66D1E0                                  shl     ax, 1
  6003 00003B53 C1E802                                  shr     eax, 2
  6004 00003B56 83C00A                                  add     eax, 10
  6005 00003B59 39C1                                    cmp     ecx, eax
  6006 00003B5B 7209                                    jb      short .no_id3
  6007 00003B5D 01C6                                    add     esi, eax
  6008 00003B5F 29C1                                    sub     ecx, eax
  6009 00003B61 A3[64190100]                            mov     [mp3_id3_size], eax
  6010                                  
  6011                                  .no_id3:
  6012 00003B66 BA80000000                              mov     edx, 80h
  6013 00003B6B 39D1                                    cmp     ecx, edx
  6014 00003B6D 721F                                    jb      short .no_tag_or_ext
  6015 00003B6F 8B440E80                                mov     eax, [esi+ecx-80h]
  6016 00003B73 25FFFFFF00                              and     eax, 0FFFFFFh
  6017                                                  ;cmp    eax, 'GAT'     ; "TAG"
  6018                                                  ; 20/10/2024
  6019 00003B78 3D54414700                              cmp     eax, 'TAG'     ; FASM & NASM syntax
  6020 00003B7D 0F8421010000                            jz      .got_tag_size_edx
  6021                                                  ;cmp    eax, 'TXE'
  6022 00003B83 3D45585400                              cmp     eax, 'EXT'
  6023 00003B88 0F8416010000                            jz      .got_tag_size_edx
  6024                                  
  6025                                  .no_tag_or_ext:
  6026 00003B8E BAE3000000                              mov     edx, 0E3h
  6027 00003B93 39D1                                    cmp     ecx, edx
  6028 00003B95 7211                                    jb      short .no_tagplus
  6029                                                  ;cmp    dword [esi+ecx-0E3h], '+GAT' ; "TAG+"
  6030                                                  ; 20/10/2024
  6031 00003B97 81BC0E1DFFFFFF5441-                     cmp     dword [esi+ecx-0E3h], 'TAG+'
  6031 00003BA0 472B               
  6032 00003BA2 0F84FC000000                            jz      .got_tag_size_edx
  6033                                  
  6034                                  .no_tagplus:
  6035 00003BA8 BA14000000                              mov     edx, 20        ; 10+10
  6036 00003BAD 39D1                                    cmp     ecx, edx
  6037 00003BAF 723C                                    jb      short .no_3di  ; "3DI",04h
  6038 00003BB1 817C0EF633444904                        cmp     dword [esi+ecx-10], 4494433h ; 'ID3'+04000000h
  6039 00003BB9 7532                                    jnz     short .no_3di
  6040 00003BBB F6440EFB10                              test    byte [esi+ecx-5], 10h ; bit 4
  6041 00003BC0 742B                                    jz      short .no_3di
  6042 00003BC2 8B440EFC                                mov     eax, [esi+ecx-4]
  6043 00003BC6 A980808080                              test    eax, 80808080h
  6044 00003BCB 7520                                    jnz     short .no_3di
  6045                                  
  6046                                  .@xlat_4x7bit_to_28bit:
  6047 00003BCD 86E0                                    xchg    al, ah
  6048 00003BCF D0E0                                    shl     al, 1
  6049 00003BD1 66D1E0                                  shl     ax, 1
  6050 00003BD4 66C1E802                                shr     ax, 2
  6051 00003BD8 C1C810                                  ror     eax, 10h
  6052 00003BDB 86E0                                    xchg    al, ah
  6053 00003BDD D0E0                                    shl     al, 1
  6054 00003BDF 66D1E0                                  shl     ax, 1
  6055 00003BE2 C1E802                                  shr     eax, 2
  6056 00003BE5 8D5014                                  lea     edx, [eax+20]  ; [eax+10+10] ; hdr+footer siz
  6057 00003BE8 E9B7000000                              jmp     .got_tag_size_edx
  6058                                  
  6059                                  .no_3di:
  6060                                                  ;cmp    dword [esi+ecx-32], 'TEPA' ; [esi+ecx-32+0]
  6061                                                  ; 20/10/2024
  6062 00003BED 817C0EE041504554                        cmp     dword [esi+ecx-32], 'APET'
  6063                                                                         ; check "APETAGEX"
  6064 00003BF5 7520                                    jnz     short .no_ape
  6065                                                  ;cmp    dword [esi+ecx-28], 'XEGA' ; [esi+ecx-32+4]
  6066 00003BF7 817C0EE441474558                        cmp     dword [esi+ecx-28], 'AGEX'
  6067 00003BFF 7516                                    jnz     short .no_ape
  6068 00003C01 8B540EEC                                mov     edx, [esi+ecx-20] ; [esi+ecx-32+12] ; get size
  6069 00003C05 F7440EF400000080                        test    dword [esi+ecx-12], 80000000h ; [esi+ecx-32+20],1 shl 31
  6070 00003C0D 7403                                    jz      short .no_ape_header
  6071 00003C0F 83C220                                  add     edx, 32        ; hdr.size
  6072                                  
  6073                                  .no_ape_header: 
  6074 00003C12 E98D000000                              jmp     .got_tag_size_edx
  6075                                  
  6076                                  .no_ape:
  6077 00003C17 BA14000000                              mov     edx, 20        ; 11+9
  6078 00003C1C 39D1                                    cmp     ecx, edx       ; "LYRICSEND" or "LYRICS200"
  6079                                                                         ; (11+N+9 bytes each)
  6080 00003C1E 7258                                    jb      short .no_lyrics
  6081                                                  ;cmp    dword [esi+ecx-9], 'IRYL'
  6082                                                  ; 20/10/2024
  6083 00003C20 817C0EF74C595249                        cmp     dword [esi+ecx-9], 'LYRI' ; FASM & NASM syntax
  6084 00003C28 754E                                    jnz     short .no_lyrics
  6085 00003C2A 807C0EFB43                              cmp     byte [esi+ecx-5], 'C'
  6086 00003C2F 7547                                    jnz     short .no_lyrics
  6087                                                  ;cmp    dword [esi+ecx-4], 'DNES'
  6088 00003C31 817C0EFC53454E44                        cmp     dword [esi+ecx-4], 'SEND'
  6089 00003C39 740C                                    jz      short .lyrics3_v1
  6090                                                  ;cmp    dword [esi+ecx-4], '002S'
  6091 00003C3B 817C0EFC53323030                        cmp     dword [esi+ecx-4], 'S200'
  6092 00003C43 7440                                    jz      short .lyrics3_v2
  6093 00003C45 7531                                    jnz     short .no_lyrics
  6094                                  
  6095                                  .lyrics3_v1:
  6096 00003C47 BA14000000                              mov     edx, 20        ; 11+9
  6097                                  
  6098                                  .lyrics3_v1_size_lop:
  6099 00003C4C 8D040E                                  lea     eax, [esi+ecx]
  6100 00003C4F 29D0                                    sub     eax, edx
  6101                                                  ;cmp    dword [eax], 'IRYL' ; "LYRICSBEGIN"
  6102                                                  ; 20/10/2024
  6103 00003C51 81384C595249                            cmp     dword [eax], 'LYRI'
  6104 00003C57 7512                                    jnz     short .lyrics3_v1_size_next
  6105                                                  ;cmp    dword [eax+4], 'EBSC'
  6106 00003C59 81780443534245                          cmp     dword [eax+4], 'CSBE'
  6107 00003C60 7509                                    jnz     short .lyrics3_v1_size_next
  6108                                                  ;cmp    dword [eax+7], 'NIGE'
  6109 00003C62 8178074547494E                          cmp     dword [eax+7], 'EGIN'
  6110 00003C69 7439                                    jz      short .got_tag_size_edx
  6111                                  
  6112                                  .lyrics3_v1_size_next:
  6113 00003C6B 42                                      inc     edx
  6114 00003C6C 81FA00140000                            cmp     edx, 5120
  6115 00003C72 7704                                    ja      short .no_lyrics
  6116 00003C74 39CA                                    cmp     edx, ecx
  6117 00003C76 76D4                                    jbe     short .lyrics3_v1_size_lop
  6118                                                  ;jmp     short .no_lyrics
  6119                                  
  6120                                  .no_lyrics:
  6121                                                  ;jmp    short .footer_tag_all_done
  6122                                  		; 22/10/2024
  6123                                  .footer_tag_all_done:
  6124 00003C78 8935[E0510500]                          mov     [stream_pos], esi
  6125 00003C7E 890D[E4510500]                          mov     [bytes_left], ecx
  6126 00003C84 C3                                      retn
  6127                                  
  6128                                  .lyrics3_v2:
  6129 00003C85 51                                      push    ecx
  6130 00003C86 56                                      push    esi
  6131 00003C87 8D740EF1                                lea     esi, [esi+ecx-15] ; [esi+ecx-6-9]
  6132 00003C8B B906000000                              mov     ecx, 6
  6133 00003C90 31D2                                    xor     edx, edx
  6134                                  
  6135                                  .lyrics3_v2_size_lop:
  6136 00003C92 6BD20A                                  imul    edx, 10
  6137 00003C95 0FB606                                  movzx   eax, byte [esi]
  6138 00003C98 46                                      inc     esi
  6139 00003C99 2C30                                    sub     al, 30h
  6140 00003C9B 01C2                                    add     edx, eax
  6141 00003C9D E2F3                                    loop    .lyrics3_v2_size_lop
  6142 00003C9F 5E                                      pop     esi
  6143 00003CA0 59                                      pop     ecx
  6144 00003CA1 83C20F                                  add     edx, 0Fh       ; 6+9
  6145                                                  ;jmp    short .got_tag_size_edx
  6146                                  
  6147                                  .got_tag_size_edx:
  6148                                  		;;;
  6149                                  		; 22/10/2024
  6150 00003CA4 29D1                                    sub    ecx, edx
  6151 00003CA6 731B                                    jnb    short .cont
  6152                                  		;;;
  6153                                  		; 16/02/2025
  6154                                  		sys	_msg, tag_size_err, 255, 0Ch
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00003CA8 BB[CE3C0000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00003CAD B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00003CB2 BA0C000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00003CB7 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00003CBC CD40                <1>  int 40h
  6155                                                  ;;;
  6156                                  		;sub    ecx, edx
  6157                                                  ;jb     fatalunexpected
  6158 00003CBE E9E6CFFFFF              		jmp	fatalunexpected
  6159                                  .cont:
  6160                                  		;;;
  6161 00003CC3 0115[68190100]                          add     [mp3_tag_size], edx
  6162 00003CC9 E998FEFFFF                              jmp     .no_id3
  6163                                  
  6164                                  ; ---------------------------------------------------------------------------
  6165                                  
  6166                                  		; 16/02/2025
  6167 00003CCE 0D0A                    tag_size_err:	db 0Dh, 0Ah
  6168 00003CD0 5461672053697A6520-     		db "Tag Size Error!?"
  6168 00003CD9 4572726F72213F     
  6169 00003CE0 0D0A00                  		db 0Dh, 0Ah, 0
  6170                                  
  6171                                  ; =============== S U B R O U T I N E =======================================
  6172                                  
  6173                                  
  6174                                  mp3_detect_free_format_block_size:
  6175 00003CE3 833D[E0180100]00                        cmp     dword [mp3_free_format_frame_size], 0
  6176 00003CEA 0F85A5000000                            jnz     .already_detected
  6177 00003CF0 31D2                                    xor     edx, edx
  6178                                  
  6179                                  .find_distance_lop:
  6180 00003CF2 3B15[8C190100]                          cmp     edx, [mp3_src_remain]
  6181 00003CF8 742B                                    jz      short .match_eof
  6182 00003CFA 8D4204                                  lea     eax, [edx+4]
  6183 00003CFD 3B05[8C190100]                          cmp     eax, [mp3_src_remain]
  6184 00003D03 771E                                    ja      short .find_distance_failed
  6185 00003D05 8B0416                                  mov     eax, [esi+edx]
  6186 00003D08 E893C5FFFF                              call    bswap_eax
  6187 00003D0D 3305[A0C20000]                          xor     eax, [mp3_hdr_32bit_header]
  6188 00003D13 25000CFEFF                              and     eax, 0FFFE0C00h
  6189 00003D18 740B                                    jz      short .match_eof
  6190                                  
  6191                                  .find_distance_next:
  6192 00003D1A 42                                      inc     edx
  6193 00003D1B 81FA00100000                            cmp     edx, 1000h
  6194 00003D21 76CF                                    jbe     short .find_distance_lop
  6195                                  
  6196                                  .find_distance_failed:
  6197 00003D23 F9                                      stc
  6198 00003D24 C3                                      retn
  6199                                  
  6200                                  .match_eof:
  6201 00003D25 89D0                                    mov     eax, edx
  6202 00003D27 2B05[ACC20000]                          sub     eax, [mp3_hdr_flag_padding]
  6203 00003D2D 83F804                                  cmp     eax, 4
  6204 00003D30 72E8                                    jb      short .find_distance_next
  6205 00003D32 A3[E0180100]                            mov     [mp3_free_format_frame_size], eax
  6206 00003D37 31DB                                    xor     ebx, ebx
  6207                                  
  6208                                  .confirm_distance_lop:
  6209 00003D39 8B041E                                  mov     eax, [esi+ebx]
  6210 00003D3C E85FC5FFFF                              call    bswap_eax
  6211 00003D41 C1E80A                                  shr     eax, 10         ; 9+1
  6212 00003D44 131D[E0180100]                          adc     ebx, [mp3_free_format_frame_size]
  6213 00003D4A 3B1D[8C190100]                          cmp     ebx, [mp3_src_remain]
  6214 00003D50 7422                                    jz      short .confirm_distance_match_eof
  6215 00003D52 8D4304                                  lea     eax, [ebx+4]
  6216 00003D55 3B05[8C190100]                          cmp     eax, [mp3_src_remain]
  6217 00003D5B 77BD                                    ja      short .find_distance_next
  6218 00003D5D 8B041E                                  mov     eax, [esi+ebx]
  6219 00003D60 E83BC5FFFF                              call    bswap_eax
  6220 00003D65 3305[A0C20000]                          xor     eax, [mp3_hdr_32bit_header]
  6221 00003D6B 25000CFEFF                              and     eax, 0FFFE0C00h
  6222 00003D70 75A8                                    jnz     short .find_distance_next
  6223 00003D72 EBC5                                    jmp     short .confirm_distance_lop
  6224                                  
  6225                                  .confirm_distance_match_eof:
  6226 00003D74 A1[E0180100]                            mov     eax, [mp3_free_format_frame_size]
  6227 00003D79 C1E003                                  shl     eax, 3
  6228 00003D7C F725[B0C20000]                          mul     dword [mp3_sample_rate]
  6229 00003D82 8B0D[9C190100]                          mov     ecx, [mp3_nb_granules]
  6230 00003D88 69C940020000                            imul    ecx, 240h
  6231 00003D8E F7F1                                    div     ecx
  6232 00003D90 A3[B8C20000]                            mov     [mp3_bit_rate], eax
  6233                                  
  6234                                  .already_detected:
  6235 00003D95 F8                                      clc
  6236 00003D96 C3                                      retn
  6237                                  
  6238                                  
  6239                                  ; =============== S U B R O U T I N E =======================================
  6240                                  
  6241                                  
  6242                                  mp3_check_xing_info:
  6243 00003D97 C705[E8180100]0000-                     mov     dword [mp3_xing_id], 0
  6243 00003D9F 0000               
  6244 00003DA1 C705[F0180100]0000-                     mov     dword [mp3_xing_frames], 0
  6244 00003DA9 0000               
  6245 00003DAB C705[F4180100]0000-                     mov     dword [mp3_xing_filesize], 0
  6245 00003DB3 0000               
  6246 00003DB5 8B35[94C20000]                          mov     esi, [mp3_src_data_location]
  6247 00003DBB AD                                      lodsd
  6248                                                  ;cmp    eax, 'gniX'
  6249                                  		; 20/10/2024
  6250 00003DBC 3D58696E67              		cmp	eax, 'Xing'     ; FASM & NASM syntax
  6251 00003DC1 7401                                    jz      short .xing
  6252 00003DC3 C3                                      retn
  6253                                  
  6254                                  .xing:
  6255 00003DC4 A3[E8180100]                            mov     [mp3_xing_id], eax
  6256 00003DC9 AD                                      lodsd
  6257 00003DCA E8D1C4FFFF                              call    bswap_eax
  6258 00003DCF A3[EC180100]                            mov     [mp3_xing_flags], eax
  6259 00003DD4 89C2                                    mov     edx, eax
  6260 00003DD6 F7C201000000                            test    edx, 1
  6261 00003DDC 740B                                    jz      short .no_xing_frames
  6262 00003DDE AD                                      lodsd
  6263 00003DDF E8BCC4FFFF                              call    bswap_eax
  6264 00003DE4 A3[F0180100]                            mov     [mp3_xing_frames], eax
  6265                                  
  6266                                  .no_xing_frames:
  6267 00003DE9 F7C202000000                            test    edx, 2          ; 1 shl 1
  6268 00003DEF 740B                                    jz      short .no_xing_filesize
  6269 00003DF1 AD                                      lodsd
  6270 00003DF2 E8A9C4FFFF                              call    bswap_eax
  6271 00003DF7 A3[F4180100]                            mov     [mp3_xing_filesize], eax
  6272                                  
  6273                                  .no_xing_filesize:
  6274 00003DFC F7C204000000                            test    edx, 4          ; 1 shl 2
  6275 00003E02 740C                                    jz      short .no_xing_toc
  6276 00003E04 B964000000                              mov     ecx, 100
  6277 00003E09 BF[F8180100]                            mov     edi, mp3_xing_toc
  6278 00003E0E F3A4                                    rep movsb
  6279                                  
  6280                                  .no_xing_toc:
  6281 00003E10 F7C208000000                            test    edx, 8          ; 1 shl 3
  6282 00003E16 740B                                    jz      short .no_xing_vbr_scale
  6283 00003E18 AD                                      lodsd
  6284 00003E19 E882C4FFFF                              call    bswap_eax
  6285 00003E1E A3[5C190100]                            mov     [mp3_xing_vbr_scale], eax
  6286                                  
  6287                                  .no_xing_vbr_scale:
  6288 00003E23 C705[B8C20000]0000-                     mov	dword [mp3_bit_rate], 0
  6288 00003E2B 0000               
  6289 00003E2D A1[B0C20000]                            mov	eax, [mp3_sample_rate]
  6290 00003E32 C1E003                                  shl	eax, 3
  6291 00003E35 F725[F4180100]                          mul	dword [mp3_xing_filesize]
  6292 00003E3B 8B0D[F0180100]                          mov	ecx, [mp3_xing_frames]
  6293 00003E41 0FAF0D[9C190100]                        imul	ecx, [mp3_nb_granules]
  6294 00003E48 69C940020000                            imul	ecx, 576        ; 18*32
  6295 00003E4E 39CA                                    cmp	edx, ecx
  6296 00003E50 7307                                    jnb	short .overflow
  6297 00003E52 F7F1                                    div	ecx
  6298 00003E54 A3[B8C20000]                            mov	[mp3_bit_rate], eax
  6299                                  .overflow:
  6300 00003E59 C3                                      retn
  6301                                  
  6302                                  
  6303                                  ; =============== S U B R O U T I N E =======================================
  6304                                  
  6305                                  		; 16/02/2025
  6306                                  		; 20/10/2024
  6307                                  mp3_decode_frame:
  6308 00003E5A 890D[8C190100]                          mov     [mp3_src_remain], ecx
  6309 00003E60 893D[70190100]                          mov     [mp3_samples_dst], edi
  6310                                  	
  6311                                  		; 16/02/2025
  6312                                  .no_rdtsc_supported@@@@:
  6313 00003E66 E899C4FFFF                              call    mp3_search_get_header
  6314 00003E6B 0F8275010000                            jc      .error
  6315 00003E71 A1[98C20000]                            mov     eax, [mp3_src_frame_size]
  6316 00003E76 83F800                                  cmp     eax, 0
  6317 00003E79 0F8E67010000                            jle     .error
  6318 00003E7F 3B05[8C190100]                          cmp     eax, [mp3_src_remain]
  6319 00003E85 0F875B010000                            ja      .error
  6320 00003E8B 8935[88190100]                          mov     [mp3_bitstream_start], esi
  6321                                  		; 11/01/2025
  6322                                  		;mov	eax, 32
  6323                                  
  6324                                  .mp3mac_bitstream_set_position:
  6325                                  		; 22/10/2024
  6326                                                  ;mov    esi, [mp3_bitstream_start]
  6327                                                  ;mov    cl, al
  6328                                                  ;shr    eax, 3
  6329                                                  ;and    cl, 7
  6330                                                  ;mov	eax, 4
  6331                                                  ;add    esi, eax
  6332 00003E91 83C604                                  add     esi, 4
  6333 00003E94 E80FC4FFFF                              call    mp3_recollect_bits
  6334                                  
  6335                                  .mp3mac_get_n_bits:
  6336                                                  ;mov    eax, ebp        ; mp3_col32
  6337                                                  ;shl    ebp, cl
  6338                                                  ;rol    eax, cl
  6339                                                  ;xor    eax, ebp        ; mp3_col32
  6340                                                  ;sub    ch, cl          ; sub mp3_colNN,num
  6341                                                  ;jns    short .cont
  6342                                                  ;mov    cl, ch          ; mov cl,mp3_colNN
  6343                                                  ;add    ch, 16
  6344                                                  ;rol    ebp, cl         ; rol mp3_col32,cl
  6345                                                  ;mov    bp, [esi]       ; mov mp3_col16,word ptr [esi]
  6346                                                  ;add    esi, 2
  6347                                                  ;ror    bp, 8           ; endianess
  6348                                                  ;ror    ebp, cl         ; ror mp3_col32,cl
  6349                                  
  6350                                  .cont:
  6351 00003E99 E8FFC5FFFF                              call	mp3_bitstream_read_header_extra
  6352 00003E9E E847C7FFFF                              call	mp3_bitstream_read_granules
  6353 00003EA3 0F823D010000                            jc	.error
  6354 00003EA9 E84AC4FFFF                              call	mp3_uncollect_bits
  6355 00003EAE 8935[94C20000]                          mov	[mp3_src_data_location], esi
  6356 00003EB4 833D[70190100]00                        cmp	dword [mp3_samples_dst], 0
  6357 00003EBB 0F840E010000                            jz	.skip_decoding
  6358 00003EC1 E8B4CBFFFF                              call	mp3_bitstream_append_to_main_data_pool
  6359 00003EC6 833D[74190100]00                        cmp	dword [mp3_samples_output_size], 0
  6360 00003ECD 0F84FC000000                            jz	.skip_decoding
  6361                                  
  6362 00003ED3 C705[80190100]0000-                     mov	dword [mp3_curr_granule], 0
  6362 00003EDB 0000               
  6363 00003EDD BB[A0190100]                            mov	ebx, mp3_granules
  6364                                  
  6365                                  .body_granule_lop:
  6366 00003EE2 891D[D4510500]                          mov	[_@@granule_addr], ebx
  6367 00003EE8 C705[7C190100]0000-                     mov	dword [mp3_curr_channel], 0
  6367 00003EF0 0000               
  6368                                  
  6369                                  .body_channel_lop:
  6370 00003EF2 8B4304                                  mov     eax, [ebx+4]    ; [ebx+$mp3gr_part2_3_start]
  6371 00003EF5 8B35[88190100]                          mov     esi, [mp3_bitstream_start]
  6372 00003EFB 88C1                                    mov     cl, al          ; mp3mac_bitstream_set_position
  6373 00003EFD C1E803                                  shr     eax, 3
  6374 00003F00 80E107                                  and     cl, 7
  6375 00003F03 01C6                                    add     esi, eax
  6376 00003F05 E89EC3FFFF                              call    mp3_recollect_bits
  6377 00003F0A 89E8                                    mov     eax, ebp        ; mp3mac_get_n_bits cl
  6378 00003F0C D3E5                                    shl     ebp, cl
  6379 00003F0E D3C0                                    rol     eax, cl
  6380 00003F10 31E8                                    xor     eax, ebp
  6381 00003F12 28CD                                    sub     ch, cl
  6382 00003F14 7913                                    jns     short .cont@
  6383 00003F16 88E9                                    mov     cl, ch          ; mp3mac_collect_more
  6384 00003F18 80C510                                  add     ch, 16
  6385 00003F1B D3C5                                    rol     ebp, cl
  6386 00003F1D 668B2E                                  mov     bp, [esi]
  6387 00003F20 83C602                                  add     esi, 2
  6388 00003F23 66C1CD08                                ror     bp, 8
  6389 00003F27 D3CD                                    ror     ebp, cl
  6390                                  
  6391                                  .cont@:
  6392 00003F29 E8B4CBFFFF                              call    mp3_bitstream_read_scalefacs
  6393 00003F2E E87ECDFFFF                              call    mp3_get_exponents_from_scale_factors
  6394 00003F33 E894CEFFFF                              call    mp3_huffman_decode ; reads up to $mp3gr_part2_3_end
  6395 00003F38 0F82A8000000                            jc      .error
  6396                                  
  6397                                  .body_channel_next:
  6398 00003F3E 81C340130000                            add	ebx, 4928       ; $mp3gr_entrysiz*2
  6399 00003F44 FF05[7C190100]                          inc	dword [mp3_curr_channel]
  6400 00003F4A A1[7C190100]                            mov	eax, [mp3_curr_channel]
  6401                                                  ; 16/02/2025
  6402 00003F4F 3B05[BCC20000]          		cmp	eax, [mp3_num_channels]
  6403 00003F55 729B                                    jb	short .body_channel_lop
  6404 00003F57 8B1D[D4510500]                          mov	ebx, [_@@granule_addr]
  6405                                  
  6406                                  .mp3mac_push_bitstream:
  6407 00003F5D 51                                      push	ecx
  6408 00003F5E 55                                      push	ebp
  6409 00003F5F 56                                      push	esi
  6410 00003F60 E836D3FFFF                              call	mp3_compute_stereo
  6411 00003F65 C705[7C190100]0000-                     mov	dword [mp3_curr_channel], 0
  6411 00003F6D 0000               
  6412                                  
  6413                                  .cast_channel_lop:
  6414 00003F6F E8A3D5FFFF                              call    mp3_reorder_block
  6415 00003F74 E80AD6FFFF                              call    mp3_compute_antialias
  6416 00003F79 E8C7DEFFFF                              call    mp3_compute_imdct
  6417 00003F7E 81C340130000                            add     ebx, 4928       ; $mp3gr_entrysiz*2
  6418 00003F84 FF05[7C190100]                          inc	dword [mp3_curr_channel]
  6419 00003F8A A1[7C190100]                            mov     eax, [mp3_curr_channel]
  6420                                                  ; 06/02/2025
  6421 00003F8F 3B05[BCC20000]          		cmp     eax, [mp3_num_channels]
  6422 00003F95 72D8                                    jc      short .cast_channel_lop
  6423                                  
  6424                                  .mp3mac_pop_bitstream:
  6425 00003F97 5E                                      pop	esi
  6426 00003F98 5D                                      pop	ebp
  6427 00003F99 59                                      pop	ecx
  6428 00003F9A 8B1D[D4510500]                          mov	ebx, [_@@granule_addr]
  6429 00003FA0 81C3A0090000                            add	ebx, 2464       ; $mp3gr_entrysiz
  6430 00003FA6 FF05[80190100]                          inc	dword [mp3_curr_granule]
  6431 00003FAC A1[80190100]                            mov	eax, [mp3_curr_granule]
  6432 00003FB1 3B05[9C190100]                          cmp	eax, [mp3_nb_granules]
  6433 00003FB7 0F8225FFFFFF                            jc	.body_granule_lop
  6434 00003FBD E836C3FFFF                              call	mp3_uncollect_bits
  6435 00003FC2 3B35[90C20000]                          cmp	esi, [main_data_pool_wr_ptr]
  6436 00003FC8 771C                                    ja	short .error
  6437                                                  ;call	dword [mp3_synth_filter_proc] ; synth maths
  6438                                  		; 16/02/2025
  6439 00003FCA E868F3FFFF              		call	mp3_synth_filter_proc
  6440                                  
  6441                                  .skip_decoding:
  6442 00003FCF A1[90190100]                            mov     eax, [mp3_extra_bytes]
  6443 00003FD4 0105[98C20000]                          add     [mp3_src_frame_size], eax
  6444 00003FDA A1[74190100]                            mov     eax, [mp3_samples_output_size]
  6445                                  		; 15/02/2025
  6446 00003FDF FF05[6C190100]                          inc     dword [mp3_num_frames_decoded]
  6447                                  .timelog_end:
  6448                                  		; 16/02/2025
  6449                                  .no_rdtsc_supported:
  6450                                                  ;clc
  6451 00003FE5 C3                                      retn
  6452                                  
  6453                                  .error:
  6454                                  		; 16/02/2025
  6455                                  		; 20/10/2024
  6456                                  .no_rdtsc_supported@:
  6457 00003FE6 A1[90190100]                            mov     eax, [mp3_extra_bytes]
  6458 00003FEB 0105[98C20000]                          add     [mp3_src_frame_size], eax
  6459 00003FF1 F9                                      stc
  6460 00003FF2 C3                                      retn
  6461                                  
  6462                                  
  6463                                  ; =============== S U B R O U T I N E =======================================
  6464                                  
  6465                                  		; 16/02/2025
  6466                                  		; 15/02/2025
  6467                                  mp3_init:
  6468 00003FF3 BF[90B20000]                            mov     edi, main_data_pool_start ; = mp3_context_start
  6469                                                  ;mov    ecx, 74916      ; (mp3_context_end-mp3_context_start)/4
  6470 00003FF8 B97F240100                              mov     ecx, (mp3_context_end-mp3_context_start)/4
  6471 00003FFD 31C0                                    xor     eax, eax        ; ERRIF @@len AND 03h
  6472 00003FFF F3AB                                    rep stosd               ; clear context
  6473 00004001 C705[90C20000]-                         mov	dword [main_data_pool_wr_ptr], main_data_pool_start
  6473 00004007 [90B20000]         
  6474 0000400B 833D[20A90000]00                        cmp     dword [mp3_initialized], 0
  6475 00004012 7537                                    jnz     short .already_initialized
  6476 00004014 E803F7FFFF                              call    mp3_integer_init_is_stereo_lsf
  6477 00004019 E85CF7FFFF                              call    mp3_integer_init_mdct_windows
  6478 0000401E E87FF7FFFF                              call    mp3_integer_init_table_4_3
  6479 00004023 E8D2F7FFFF                              call    mp3_integer_init_exponent
  6480 00004028 E85CF5FFFF                              call    mp3_any_init_synth_window
  6481 0000402D E80BF6FFFF                              call    mp3_any_init_band_indices
  6482 00004032 E830F6FFFF                              call    mp3_any_init_lsf_sf_expand
  6483 00004037 E879F6FFFF                              call    mp3_any_init_huff_tables
  6484 0000403C E8FEF8FFFF                              call    mp3_init_log_constants
  6485                                  		; 15/02/2025
  6486 00004041 C705[20A90000]0100-                     mov     dword [mp3_initialized], 1
  6486 00004049 0000               
  6487                                  
  6488                                  .already_initialized:
  6489                                  		; 17/02/2025
  6490                                  		; 16/02/2025
  6491                                  		;mov	dword [mp3_bytes_per_sample], 2
  6492                                  		; 15/02/2025
  6493 0000404B C3                                      retn
  6494                                  
  6495                                  
  6496                                  ; =============== S U B R O U T I N E =======================================
  6497                                  
  6498                                  		; 16/02/2025
  6499                                  mp3_check_1st_frame:
  6500 0000404C E8C4FAFFFF              		call	mp3_exclude_id3_and_tag
  6501 00004051 8B35[E0510500]          		mov	esi, [stream_pos]
  6502 00004057 8B0D[E4510500]          		mov	ecx, [bytes_left]
  6503 0000405D 31FF                    		xor	edi, edi
  6504 0000405F 31ED                    		xor	ebp, ebp
  6505 00004061 E8F4FDFFFF              		call	mp3_decode_frame
  6506 00004066 7206                    		jc	short .error
  6507 00004068 E82AFDFFFF              		call	mp3_check_xing_info
  6508                                  		
  6509                                  		; 16/02/2025
  6510 0000406D F8                      		clc
  6511                                  .error:
  6512 0000406E C3                      		retn
  6513                                  
  6514                                  ;.error:
  6515                                  		;stc
  6516                                  		;retn
  6517                                  
  6518                                  
  6519                                  ; =============== S U B R O U T I N E =======================================
  6520                                  
  6521                                  
  6522                                  mp3_plain_test_without_output:
  6523 0000406F 60                                      pusha
  6524 00004070 8B35[E0510500]                          mov     esi, [stream_pos]
  6525 00004076 8B0D[E4510500]                          mov     ecx, [bytes_left]
  6526 0000407C BF[00800500]                            mov     edi, sample_buffer
  6527 00004081 31ED                                    xor     ebp, ebp
  6528 00004083 E8D2FDFFFF                              call    mp3_decode_frame
  6529 00004088 61                                      popa
  6530 00004089 7218                                    jc      short .exit
  6531 0000408B A1[98C20000]                            mov     eax, [mp3_src_frame_size]
  6532 00004090 83F800                                  cmp     eax, 0
  6533 00004093 740E                                    jz      short .exit
  6534 00004095 0105[E0510500]                          add     [stream_pos], eax
  6535 0000409B 2905[E4510500]                          sub     [bytes_left], eax
  6536 000040A1 EBCC                                    jmp     short mp3_plain_test_without_output
  6537                                  .exit:
  6538 000040A3 C3                                      retn
  6539                                  
  6540                                  
  6541                                  ; =============== S U B R O U T I N E =======================================
  6542                                  
  6543                                  		; 20/10/2024
  6544                                  wrchr:
  6545                                  		; TRDOS 386 System Call
  6546                                  		; ebx = 2 -> write character onto STDOUT
  6547                                  		;push	ebx
  6548                                  		;push	ecx
  6549                                  		;push	eax
  6550 000040A4 60                      		pusha
  6551                                  		;;mov	dword [diskresult], 0
  6552                                  		sys	_stdio, 2, eax
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000040A5 BB02000000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 000040AA 89C1                <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000040AC B82E000000          <1>  mov eax, %1
   112                              <1> 
   113 000040B1 CD40                <1>  int 40h
  6553                                  		;jnc	short .ok ; if EOF, eax = 0
  6554                                  		;xor	eax, eax ; 0
  6555                                  ;.ok:
  6556                                  		;mov	[diskresult], eax ; written byte count
  6557 000040B3 61                      		popa
  6558                                  		;pop	eax
  6559                                  		;pop	ecx
  6560                                  		;pop	ebx
  6561 000040B4 C3                      		retn
  6562                                  
  6563                                  
  6564                                  ; =============== S U B R O U T I N E =======================================
  6565                                  
  6566                                  		; 14/02/2025 (mp3play6.s)
  6567                                  		; 01/02/2025 (mp3play4.s)
  6568                                  		; 21/10/2024 (mp3play1.s)
  6569                                  set_break:
  6570                                  		; set [u.break] -end of bss- address to
  6571                                  		; end_of_bss at first (mp3 file will be loaded
  6572                                  		; at the end of bss)
  6573                                  		; ([u.break] initially points to the end of PRG file
  6574                                  		; -code and data- except BSS section)
  6575                                  		;
  6576                                  		; TRDOS 386 system call
  6577                                  		; Set break address
  6578                                  		; ebx = new [u.break]
  6579                                  		;sys	_break, end_of_bss
  6580                                  		; eax = new break address (dword aligned)
  6581                                  
  6582                                  		; 10/01/2025
  6583                                  		sys	_break, 100000h ; end of 1st 1MB
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000040B5 BB00001000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000040BA B811000000          <1>  mov eax, %1
   112                              <1> 
   113 000040BF CD40                <1>  int 40h
  6584                                  
  6585 000040C1 A3[DC510500]                            mov	[stream_start], eax
  6586 000040C6 A3[E0510500]                            mov	[stream_pos], eax
  6587                                  
  6588 000040CB C3                      		retn
  6589                                  
  6590                                  
  6591                                  ; =============== S U B R O U T I N E =======================================
  6592                                  
  6593                                  		; 16/02/2025
  6594                                  		; 15/02/2025 (tmp3play.s)
  6595                                  		; 14/02/2025 (mp3play6.s)
  6596                                  		; 01/02/2025 (mp3play4.s)	
  6597                                  		; 20/10/2024 (mp3play1.s)
  6598                                  
  6599                                  open_and_mmap_the_file:
  6600                                  		; 21/10/2024
  6601                                  		; TRDOS 386 system call
  6602                                  		; Open File
  6603                                  		; ebx = pointer to filename
  6604                                  		; ecx = open mode, 0 = read
  6605                                  		; 15/02/2025
  6606                                               	sys	_open, mp3_file_name, 0
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000040CC BB[F05B0500]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 000040D1 B900000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000040D6 B805000000          <1>  mov eax, %1
   112                              <1> 
   113 000040DB CD40                <1>  int 40h
  6607 000040DD 7277                    		jc	short .not_found
  6608                                  
  6609 000040DF A3[D8510500]                            mov     [hFile], eax
  6610                                  
  6611                                                 	; get file size by using systell system call
  6612                                   		; (not applicable for TRDOS 386 Kernel v2.0.9 and earlier)
  6613                                  		; TRDOS 386 system call
  6614                                  		; Get current file (offset) pointer
  6615                                  		; ebx = file handle (file descriptor)
  6616                                  		; ecx = 0, offset
  6617                                  		; edx = 2, from the end of file
  6618                                  		;sys	_tell, eax, 0, 2
  6619                                                  ;mov     [mp3_file_size], eax
  6620                                  
  6621                                  		; *** get file size ***
  6622                                  		; TRDOS 386 system call
  6623                                  		; Set file (offset) pointer to file size 
  6624                                  		; (needed for TRDOS kernel v2.0.9 and earlier)
  6625                                  		; ebx = file handle (file descriptor)
  6626                                  		; ecx = 0, offset
  6627                                  		; edx = 2, from the end of file
  6628                                  		sys	_seek, eax, 0, 2
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000040E4 89C3                <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 000040E6 B900000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 000040EB BA02000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000040F0 B813000000          <1>  mov eax, %1
   112                              <1> 
   113 000040F5 CD40                <1>  int 40h
  6629                                  		; TRDOS 386 system call
  6630                                  		; Get current file (offset) pointer
  6631                                  		; (needed for TRDOS 386 kernel version 2.0.9 and earlier)
  6632 000040F7 31D2                    		xor	edx, edx ; 0
  6633                                  		; ecx = 0
  6634                                  		; ebx = file handle
  6635                                  		sys	_tell
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000040F9 B814000000          <1>  mov eax, %1
   112                              <1> 
   113 000040FE CD40                <1>  int 40h
  6636 00004100 A3[60190100]            		mov     [mp3_file_size], eax
  6637                                  
  6638                                  		; *** set file offset pointer to 0 again ***
  6639                                  		; TRDOS 386 system call
  6640                                  		; Set file (offset) pointer
  6641                                  		; ebx = file handle (file descriptor)
  6642                                  		; ecx = 0, offset
  6643                                  		; edx = 0, from the beginning/start of file
  6644 00004105 50                      		push	eax
  6645                                  		sys	_seek
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004106 B813000000          <1>  mov eax, %1
   112                              <1> 
   113 0000410B CD40                <1>  int 40h
  6646 0000410D 58                      		pop	eax
  6647                                  
  6648                                  		; now, set [u.break] address to the end of mp3 file
  6649                                  		; at memory -in BSS section-
  6650                                  		; (not necessary for TRDOS 386 PRG files)
  6651                                  		; (this system call will allocate user memory pages
  6652                                  		;  before sysread system call.. early)
  6653                                  		;add	eax, end_of_bss
  6654                                  		; 13/01/2025
  6655 0000410E 0500001000              		add	eax, 100000h ; + end of 1st 1MB
  6656                                  		; TRDOS 386 system call
  6657                                  		; Set break address
  6658                                  		; ebx = new [u.break]
  6659                                  		sys	_break, eax
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004113 89C3                <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004115 B811000000          <1>  mov eax, %1
   112                              <1> 
   113 0000411A CD40                <1>  int 40h
  6660                                  
  6661                                  		; TRDOS 386 system call
  6662                                  		; Read file
  6663                                  		; ebx = file handle (file descriptor)
  6664                                  		; ecx = buffer address
  6665                                  		; edx = byte count
  6666                                  		sys	_read, [hFile], [stream_start], [mp3_file_size]
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000411C 8B1D[D8510500]      <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00004122 8B0D[DC510500]      <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00004128 8B15[60190100]      <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000412E B803000000          <1>  mov eax, %1
   112                              <1> 
   113 00004133 CD40                <1>  int 40h
  6667 00004135 7204                    		jc	short .read_error
  6668 00004137 39D0                    		cmp	eax, edx
  6669 00004139 730E                    		jnb	short .ok
  6670                                  		;or	eax, eax
  6671                                  		;jnz	short .ok
  6672                                  .read_error:		
  6673                                  		; TRDOS 386 system call
  6674                                  		; Close file
  6675                                  		; ebx = file handle (file descriptor)
  6676                                  		;sys	_close, [hFile]
  6677                                  		sys	_close
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000413B B806000000          <1>  mov eax, %1
   112                              <1> 
   113 00004140 CD40                <1>  int 40h
  6678                                  
  6679                                  		; 16/02/2025
  6680 00004142 BE[60410000]            		mov	esi, txt_read_err
  6681 00004147 EB12                    		jmp	short .r_err_msg
  6682                                  .ok:
  6683 00004149 A3[E4510500]                            mov     [bytes_left], eax ; read count
  6684                                  		
  6685                                  		; 16/02/2025
  6686                                  		sys	_close
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000414E B806000000          <1>  mov eax, %1
   112                              <1> 
   113 00004153 CD40                <1>  int 40h
  6687 00004155 C3                      		retn
  6688                                  .not_found:
  6689                                  		; 16/02/2025
  6690 00004156 BE[0BB20000]                            mov     esi, txt_not_found ; ("Error: File not found !")
  6691                                  .r_err_msg:
  6692                                  		;call	print_err_msg
  6693                                  		;;stc
  6694                                  		;retn
  6695                                  		; 16/02/2025
  6696 0000415B E92D170000              		jmp	print_err_msg
  6697                                  
  6698                                  ; ---------------------------------------------------------------------------
  6699                                  
  6700                                  		; 16/02/2025
  6701                                  txt_read_err:
  6702 00004160 46696C652072656164-     		db 'File read error !', 0Dh, 0Ah, 0
  6702 00004169 206572726F7220210D-
  6702 00004172 0A00               
  6703                                  
  6704                                  
  6705                                  ; =============== E X I T ===================================================
  6706                                  
  6707                                  		; 25/01/2025
  6708                                  		; 20/10/2024
  6709                                  ExitProcess:
  6710 00004174 E809140000              		call	set_text_mode
  6711                                  ExitP@:
  6712 00004179 31DB                    		xor	ebx, ebx  ; mov ebx, 0  ; exit code
  6713                                  ExitProcess@:	; 13/01/2025
  6714                                  		sys	_exit
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000417B B801000000          <1>  mov eax, %1
   112                              <1> 
   113 00004180 CD40                <1>  int 40h
  6715                                  ;hang:
  6716                                  		;jmp	short hang
  6717                                  
  6718                                  
  6719                                  ; ---------------------------------------------------------------------------
  6720                                  ; TRDOS 386 Audio System Functions
  6721                                  ; ---------------------------------------------------------------------------
  6722                                  
  6723                                  ; =============== S U B R O U T I N E =======================================
  6724                                  
  6725                                  		; 10/01/2025
  6726                                  		; 20/10/2024
  6727                                  detect_enable_audio_device:
  6728                                  		; 24/01/2025
  6729                                  		;mov	word [max_frequency], 48000
  6730                                  		; 10/01/2025
  6731                                  		;mov	byte [blocks], 8
  6732                                  
  6733                                  		; check AC'97 hardware at first
  6734                                  		; (48kHz support)
  6735                                  		; TRDOS 386 system call
  6736                                  		; sysaudio
  6737                                  		; Detect (BH=1) AC'97 (BL=2) Audio Device
  6738                                  .ac97:
  6739                                          	sys	_audio, 0102h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004182 BB02010000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004187 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 0000418C CD40                <1>  int 40h
  6740 0000418E 7245                    		jc	short .sb16
  6741 00004190 C605[78B20000]02        		mov	byte [audio_hardware], 2 ; AC97
  6742                                  
  6743                                  		;;;;
  6744                                  		; 12/01/2025 (ref: playwav9.s, 18/12/2024)
  6745                                  		sys	_audio, 0E00h ; get audio controller info
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004197 BB000E0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000419C B820000000          <1>  mov eax, %1
   112                              <1> 
   113 000041A1 CD40                <1>  int 40h
  6746                                  		; EAX = IRQ Number in AL
  6747                                  		;	Audio Device Number in AH 
  6748                                  		; EBX = DEV/VENDOR ID
  6749                                  		;       (DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV)
  6750                                  		; ECX = BUS/DEV/FN 
  6751                                  		;       (00000000BBBBBBBBDDDDDFFF00000000)
  6752                                  		; EDX = NABMBAR/NAMBAR (for AC97)
  6753                                  		;      (Low word, DX = NAMBAR address)
  6754                                  		; EDX = Base IO Addr (DX) for SB16 & VT8233
  6755                                  
  6756 000041A3 891D[68B20000]          		mov	[dev_vendor], ebx
  6757 000041A9 890D[64B20000]          		mov	[bus_dev_fn], ecx
  6758                                  
  6759 000041AF 668915[6CB20000]                	mov     [NAMBAR], dx	; save audio mixer base addr
  6760                                  		;shr	edx, 16
  6761                                          	;mov    [NABMBAR], dx	; save bus master base addr
  6762 000041B6 8915[6CB20000]          		mov	dword [NAMBAR], edx
  6763                                  
  6764 000041BC A2[74B20000]            		mov	[ac97_int_ln_reg], al
  6765                                  		;;;;
  6766                                  		
  6767                                  		; TRDOS 386 system call
  6768                                  		; sysaudio
  6769                                  		; Get AC'97 Codec info
  6770                                  		; (Function 14, sub function 1)
  6771                                  		sys	_audio, 0E01h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000041C1 BB010E0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000041C6 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 000041CB CD40                <1>  int 40h
  6772                                  		; Save Variable Rate Audio support bit
  6773 000041CD 2401                    		and	al, 1
  6774 000041CF A2[79B20000]            		mov	[vra], al
  6775 000041D4 C3                      		retn
  6776                                  .sb16:
  6777                                  		; check Sound Blaster 16 card at second
  6778                                  		; (44100Hz support, but 24kHz will be used)
  6779                                  		; TRDOS 386 system call
  6780                                  		; sysaudio
  6781                                  		; Detect (BH=1) SB16 (BL=1) Audio Card
  6782                                          	sys	_audio, 0101h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000041D5 BB01010000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000041DA B820000000          <1>  mov eax, %1
   112                              <1> 
   113 000041DF CD40                <1>  int 40h
  6783 000041E1 721F                    		jc	short .vt8233
  6784 000041E3 C605[78B20000]01        		mov	byte [audio_hardware], 1 ; SB16
  6785                                  		; 24/01/2025
  6786                                  		;mov	word [max_frequency], 44100
  6787                                  		; 10/01/2025
  6788                                  		;;mov	byte [blocks], 7
  6789                                  		;dec	byte [blocks]
  6790                                  
  6791                                  		;;;;
  6792                                  		; 12/01/2025 (ref: sb16play.s, 20/12/2024)
  6793                                  		sys	_audio, 0E00h ; get audio controller info
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000041EA BB000E0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000041EF B820000000          <1>  mov eax, %1
   112                              <1> 
   113 000041F4 CD40                <1>  int 40h
  6794                                  	
  6795 000041F6 8915[70B20000]          		mov	[audio_io_base], edx
  6796 000041FC A2[74B20000]            		mov	[audio_intr], al
  6797                                  		;;;;
  6798                                  
  6799 00004201 C3                      		retn
  6800                                  .vt8233:
  6801                                  		; check VIA VT3237R (VT8233) hardware at third
  6802                                  		; (48kHz support)
  6803                                  		; TRDOS 386 system call
  6804                                  		; sysaudio
  6805                                  		; Detect (BH=1) VT8237R (BL=3) Audio Device
  6806                                  		sys	_audio, 0103h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004202 BB03010000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004207 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 0000420C CD40                <1>  int 40h
  6807 0000420E 7208                    		jc	short .hda
  6808 00004210 C605[78B20000]03        		mov	byte [audio_hardware], 3 ; VT8237R
  6809 00004217 C3                      		retn
  6810                                  .hda:	
  6811                                  		; check Intel HDA hardware at last
  6812                                  		; (48kHz support)
  6813                                  		; TRDOS 386 system call
  6814                                  		; sysaudio
  6815                                  		; Detect (BH=1) Intel HDA (BL=4) Audio Device
  6816                                  		sys	_audio, 0104h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004218 BB04010000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000421D B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004222 CD40                <1>  int 40h
  6817 00004224 7208                    		jc	short .err
  6818 00004226 C605[78B20000]04        		mov	byte [audio_hardware], 4 ; HDA
  6819 0000422D C3                      		retn
  6820                                  .err:
  6821                                  		; 16/02/2025
  6822 0000422E BE[38420000]            		mov	esi, txt_audio_nf_err
  6823                                  		;call	print_err_msg
  6824                                  		;;stc
  6825                                  		;retn
  6826 00004233 E955160000              		jmp	print_err_msg	
  6827                                  
  6828                                  ; ---------------------------------------------------------------------------
  6829                                  
  6830 00004238 50726F706572206175-     txt_audio_nf_err: db 'Proper audio hardware not found!',0Dh,0Ah,0
  6830 00004241 64696F206861726477-
  6830 0000424A 617265206E6F742066-
  6830 00004253 6F756E64210D0A00   
  6831                                  
  6832                                  
  6833                                  ; =============== CONSTANT ==================================================
  6834                                  
  6835                                  		; 21/10/2024
  6836                                  ;MP3_MAX_OUTPUT_SIZE equ 2*2*18*32*2
  6837                                      ; = 1200h = 4608 decimal = 2 channels, 2 granules, 18*32, 2 byte (16bit)
  6838                                  
  6839                                  
  6840                                  ; =============== S U B R O U T I N E =======================================
  6841                                  
  6842                                  		; 29/01/2025
  6843                                  		; 28/01/2025
  6844                                  		; 27/01/2025
  6845                                  		; 12/01/2025
  6846                                  audio_system_init:
  6847                                  		; 28/01/2025
  6848 0000425B A1[74190100]            		mov	eax, [mp3_samples_output_size]
  6849                                  
  6850                                  		; 29/01/2025
  6851 00004260 C605[7BB20000]01        		mov	byte [blocks], 1
  6852                                  		;
  6853 00004267 803D[78B20000]01        		cmp	byte [audio_hardware], 1
  6854 0000426E 750A                    		jne	short .bufaloc
  6855                                  
  6856                                  		;mov	eax, sample_buffer_size
  6857                                  		; 10/01/2025
  6858                                  		;mov	byte [blocks], 16
  6859                                  		; 12/01/2025
  6860                                  		;mov	byte [blocks], 8
  6861                                  		;;mov	eax, [mp3_samples_output_size]
  6862                                  		;shl	eax, 3 ; * 8
  6863                                  		;;shl	eax, 4 ; * 16
  6864                                  		
  6865                                  		; 29/01/2025
  6866 00004270 C025[7BB20000]02        		shl	byte [blocks], 2 ; 4
  6867 00004277 C1E002                  		shl	eax, 2 ; * 4
  6868                                  .asi@:		
  6869                                  		; 12/01/2025
  6870                                  		;cmp	eax, 65536
  6871                                  		;jna	short .asi@@
  6872                                  		;sub	eax, [mp3_samples_output_size]
  6873                                  		;dec	byte [blocks]
  6874                                  		;;;
  6875                                  		; 11/01/2025
  6876                                  		;test	byte [blocks], 1
  6877                                  		;jz	short .asi@
  6878                                  		;dec	byte [blocks] ; even number
  6879                                  		;sub	eax, [mp3_samples_output_size]
  6880                                  		;;;
  6881                                  		;jmp	short .asi@
  6882                                  .asi@@:
  6883                                  		; 29/01/2025
  6884                                  		;cmp	byte [audio_hardware], 1 ; SB16
  6885                                  		;jne	short .bufaloc
  6886                                  .bufaloc:
  6887                                  		; TRDOS 386 system call
  6888                                  		; sysaudio
  6889                                  		; Allocate audio buffer (for user)
  6890                                  		; ebx = 0200h (BH=2)
  6891                                  		; ecx = buffer size (in bytes)
  6892                                  		; edx = buffer address (virtual)
  6893 0000427A A3[7CB20000]            		mov	[buffer_size], eax
  6894                                  		sys	_audio, 0200h, eax, sample_buffer
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000427F BB00020000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00004284 89C1                <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00004286 BA[00800500]        <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000428B B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004290 CD40                <1>  int 40h
  6895 00004292 722E                    		jc	short .init_err
  6896                                  		
  6897                                  		; 12/01/2025
  6898                                  		; clear audio buffer (before playback)
  6899 00004294 BF[00800500]            		mov	edi, sample_buffer
  6900                                  		; ecx = buffer size in bytes
  6901 00004299 C1E902                  		shr	ecx, 2 ; double word
  6902 0000429C 31C0                    		xor	eax, eax
  6903 0000429E F3AB                    		rep	stosd
  6904                                  
  6905                                  		; TRDOS 386 system call
  6906                                  		; sysaudio
  6907                                  		; Initialize audio device (bh = 3)
  6908                                  		; bl = 01h -> CallBack method
  6909                                  		; edx = Callback service address (virtual)
  6910                                  		; ecx = 0 ; CL = srb value ; not used
  6911                                  		sys	_audio, 0301h, 0, audio_callback
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000042A0 BB01030000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 000042A5 B900000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 000042AA BA[F8420000]        <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000042AF B820000000          <1>  mov eax, %1
   112                              <1> 
   113 000042B4 CD40                <1>  int 40h
  6912                                  		; 12/01/2025
  6913                                  		; SRB method (faster than callback method)
  6914                                  		; bl = 0 -> Signal Response Byte method
  6915                                  		; cl = 1 -> SRB set value 
  6916                                  		;     (will be set by audio IRQ service of the kernel)
  6917                                  		; edx = SRB address -one byte data-
  6918                                  		;sys	_audio, 0300h, 1, srb	
  6919                                  		
  6920 000042B6 720A                    		jc	short .init_err
  6921                                  
  6922                                  		; 24/01/2025
  6923                                  		;retn
  6924                                  
  6925 000042B8 A0[B8B10000]            		mov	al, [volume_level]
  6926                                  		;call	SetMasterVolume@
  6927                                  		;retn
  6928 000042BD E9AE000000              		jmp	SetMasterVolume@
  6929                                  
  6930                                  .init_err:
  6931                                  init_error:	
  6932                                  		; 27/01/2025
  6933 000042C2 E8BB120000              		call	set_text_mode
  6934                                  
  6935                                  		; 16/02/2025
  6936 000042C7 BE[D1420000]            		mov	esi, txt_audio_init_err
  6937                                  		;call	print_err_msg
  6938                                  		;;stc
  6939                                  		;retn
  6940 000042CC E9BC150000              		jmp	print_err_msg
  6941                                  
  6942                                  ; ---------------------------------------------------------------------------
  6943                                  
  6944 000042D1 417564696F20686172-     txt_audio_init_err: db 'Audio hardware initialization error!',0Dh,0Ah,0
  6944 000042DA 647761726520696E69-
  6944 000042E3 7469616C697A617469-
  6944 000042EC 6F6E206572726F7221-
  6944 000042F5 0D0A00             
  6945                                  
  6946                                  
  6947                                  ; =============== S U B R O U T I N E =======================================
  6948                                  
  6949                                  		; 12/01/2025
  6950                                  		; 21/10/2024
  6951                                  audio_callback:
  6952                                  		; Operating system has directed CPU here because of
  6953                                  		; user (2nd) stage of the audio hardware interrupt service.
  6954                                  		; This procedure must be short and return to operating
  6955                                  		; system again via sysrelease system call
  6956                                  		; (or any system call here will be handled as sysrelease).
  6957                                  
  6958 000042F8 C605[7AB20000]01        		mov	byte [srb], 1
  6959                                  
  6960                                  		; 12/01/2025
  6961 000042FF E82E010000                              call	try_enqueue_all_blocks
  6962                                  .skip:
  6963                                  		sys	_rele ; return from callback service 
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004304 B827000000          <1>  mov eax, %1
   112                              <1> 
   113 00004309 CD40                <1>  int 40h
  6964                                  		
  6965                                  		; we must not come here !
  6966 0000430B BBFFFFFFFF              		mov	ebx, -1
  6967                                  		sys	_exit
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004310 B801000000          <1>  mov eax, %1
   112                              <1> 
   113 00004315 CD40                <1>  int 40h
  6968                                  		;jmp	short audio_callback
  6969                                  
  6970                                  
  6971                                  ; =============== S U B R O U T I N E =======================================
  6972                                  
  6973                                  		; 22/01/2025
  6974                                  audio_f_stop: 
  6975 00004317 C605[75B20000]02        		mov	byte [stopped], 2
  6976                                  
  6977                                  		; Stop playing
  6978                                  		sys	_audio, 0700h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000431E BB00070000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004323 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004328 CD40                <1>  int 40h
  6979                                  		; Cancel callback service (for user)
  6980                                  		sys	_audio, 0900h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000432A BB00090000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000432F B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004334 CD40                <1>  int 40h
  6981                                  		; Deallocate audio buffer (for user)
  6982                                  		sys	_audio, 0A00h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004336 BB000A0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000433B B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004340 CD40                <1>  int 40h
  6983 00004342 C3                      		retn
  6984                                  
  6985                                  		; 22/01/2025
  6986                                  audio_f_pause:
  6987 00004343 C605[75B20000]01        		mov	byte [stopped], 1 ; paused
  6988                                  
  6989                                  		sys	_audio, 0500h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000434A BB00050000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000434F B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004354 CD40                <1>  int 40h
  6990 00004356 C3                      		retn
  6991                                  
  6992                                  
  6993                                  		; 22/01/2025
  6994                                  audio_f_play:	; continue to play (after pause)
  6995                                  
  6996 00004357 C605[75B20000]00        		mov	byte [stopped], 0
  6997                                  	
  6998                                  		sys	_audio, 0600h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000435E BB00060000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004363 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004368 CD40                <1>  int 40h
  6999 0000436A C3                      		retn
  7000                                  
  7001                                  ; =============== S U B R O U T I N E =======================================
  7002                                  
  7003                                  	; 22/01/2025
  7004                                  SetMasterVolume:
  7005                                  	;cmp	al, 31
  7006                                  	;ja	short setvolume_ok
  7007 0000436B A2[B8B10000]            	mov	[volume_level], al  ; max = 0, min = 31
  7008                                  
  7009                                  	; 24/01/2025
  7010                                  SetMasterVolume@:
  7011 00004370 B41F                    	mov	ah, 31
  7012 00004372 28C4                    	sub	ah, al
  7013 00004374 88E0                    	mov	al, ah
  7014                                  
  7015                                  	; Set Master Volume Level (BL=0 or 80h)
  7016                                  	; 	for next playing (BL>=80h)
  7017                                  	;sys	_audio, 0B80h, eax
  7018                                  	sys	_audio, 0B00h, eax
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004376 BB000B0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 0000437B 89C1                <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000437D B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004382 CD40                <1>  int 40h
  7019                                  	
  7020                                  setvolume_ok:
  7021 00004384 C3                      	retn
  7022                                  
  7023                                  ; =============== S U B R O U T I N E =======================================
  7024                                  
  7025                                  		; 17/02/2025
  7026                                  		; 16/02/2025 (tmp3play.s)	
  7027                                  		; 13/02/2025 (mp3play6.s)
  7028                                  		; 26/01/2025
  7029                                  		; 23/01/2025
  7030                                  		; 22/01/2025
  7031                                  		; 13/01/2025
  7032                                  		; 12/01/2025
  7033                                  		; 10/01/2025
  7034                                  		; 21/10/2024
  7035                                  mp3_cast_to_speaker:
  7036                                  		; Start	to play
  7037                                  		; 17/02/2025
  7038                                  		;mov	eax, [mp3_bytes_per_sample]
  7039                                  		;;shr	al, 1 ; 8 -> 0, 16 -> 1
  7040                                  		;;shl	al, 1 ; 16 -> 2, 8 -> 0
  7041                                  		;and	al, 2 ; 22/10/2024
  7042                                  		; 16/02/2025
  7043 00004385 8B1D[BCC20000]          		mov	ebx, [mp3_num_channels]
  7044 0000438B 4B                      		dec	ebx
  7045                                  		;or	bl, al
  7046                                  		; 17/02/2025 ([mp3_bytes_per_sample] = 2)
  7047 0000438C 80CB02                  		or	bl, 2 ; 16bit
  7048 0000438F 8B0D[B0C20000]          		mov	ecx, [mp3_sample_rate]
  7049 00004395 B704                    		mov	bh, 4 ; start to play
  7050                                  
  7051                                  		; 13/01/2025
  7052                                  mp3_cast_to_speaker_@:
  7053 00004397 53                      		push	ebx
  7054 00004398 51                      		push	ecx
  7055                                  
  7056                                                  ; 12/01/2025
  7057                                  		;call	try_enqueue_all_blocks
  7058                                  	
  7059                                  		; 12/01/2025
  7060                                  		;cmp	dword [bytes_left],0
  7061                                  		;jz	short .playback
  7062                                  		
  7063                                  		; 12/01/2025
  7064                                  		; (here audio buffer -sample_buffer- is empty)
  7065                                  		; (clear dma half buffer 1)
  7066                                  		sys	_audio, 1001h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004399 BB01100000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000439E B820000000          <1>  mov eax, %1
   112                              <1> 
   113 000043A3 CD40                <1>  int 40h
  7067                                  		; (clear dma half buffer 2)
  7068                                  		;sys	_audio, 1002h
  7069                                  
  7070                                  		; TRDOS 386 system call
  7071                                  		; sysaudio
  7072                                  		; bh = 16 : update (current, first) dma half buffer
  7073                                  		; bl = 0  : then switch to the next (second) half buffer
  7074                                  		sys	_audio, 1000h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000043A5 BB00100000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000043AA B820000000          <1>  mov eax, %1
   112                              <1> 
   113 000043AF CD40                <1>  int 40h
  7075                                  
  7076                                  		; 12/01/2025
  7077                                  		; 22/10/2024
  7078                                  		;call	try_enqueue_all_blocks
  7079                                  .playback:
  7080 000043B1 59                      		pop	ecx ; sample rate (frequency)
  7081 000043B2 5B                      		pop	ebx ; play mode (bl)
  7082                                  
  7083                                  		; TRDOS 386 system call
  7084                                  		; sysaudio
  7085                                  		; bh = 4 -> start to play
  7086                                  		; bl = mode -> bit 0, 1 = stereo, 0 = mono
  7087                                  		;	       bit 1, 1 = 16 bit, 0 = 8 bit
  7088                                  		; cx = sample rate (hertz)
  7089                                  		sys	_audio
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000043B3 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 000043B8 CD40                <1>  int 40h
  7090                                  
  7091                                  		; 12/01/2025
  7092 000043BA C605[7AB20000]00        		mov	byte [srb], 0
  7093                                  		;;;
  7094                                  
  7095                                  .playback_lop:
  7096                                  		; 21/01/2025
  7097                                  		;;;; ---------------------
  7098 000043C1 803D[75B20000]00        		cmp	byte [stopped], 0
  7099 000043C8 7609                    		jna	short .pb_l_@
  7100 000043CA E808100000              		call	checkUpdateEvents
  7101 000043CF 7230                    		jc	short .playback_end
  7102                                  
  7103                                  		; 16/02/2025
  7104 000043D1 EBEE                    		jmp	short .playback_lop
  7105                                  .pb_l_@:
  7106                                  		;;;; ---------------------
  7107                                  
  7108 000043D3 31C0                    		xor	eax, eax
  7109 000043D5 3905[E4510500]          		cmp	[bytes_left], eax ; 0
  7110 000043DB 7508                    		jnz	short .playback_next
  7111                                  		; 22/10/2024
  7112 000043DD 3805[29A90000]          		cmp	byte [num_enqueued_frames], al ; 0
  7113 000043E3 741C                                    jz	short .playback_end
  7114                                  .playback_next:
  7115 000043E5 A2[29A90000]            		mov	[num_enqueued_frames], al ; 0
  7116 000043EA 803D[7AB20000]01        		cmp	byte [srb], 1	; audio interrupt status
  7117                                  		;jb	short .getchar
  7118                                  		; 21/01/2025
  7119 000043F1 7207                    		jb	short .pb_l_@@
  7120                                  
  7121                                  		;mov	byte [srb], 0	; reset
  7122 000043F3 A2[7AB20000]            		mov	[srb], al ; 0
  7123                                  
  7124                                  		; 12/01/2025
  7125                                  		;call	try_enqueue_all_blocks
  7126                                  
  7127                                  		; 16/02/2025
  7128 000043F8 EBC7                    		jmp	short .playback_lop
  7129                                  		
  7130                                  		; 21/01/2025
  7131                                  		;;;; ---------------------
  7132                                  .pb_l_@@:
  7133 000043FA E8D80F0000              		call	checkUpdateEvents
  7134                                  		;jc	short .playback_end
  7135                                  		;jmp	short .playback_lop
  7136                                  		; 16/02/2025
  7137 000043FF 73C0                    		jnc	short .playback_lop
  7138                                  
  7139                                  		;;;; ---------------------
  7140                                  
  7141                                  .playback_end:
  7142                                  		; 16/02/2025
  7143                                  
  7144                                  		; TRDOS 386 system call
  7145                                  		; sysaudio
  7146                                  		; Stop playing
  7147                                  		sys	_audio, 0700h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004401 BB00070000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004406 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 0000440B CD40                <1>  int 40h
  7148                                  		; Cancel callback service (for user)
  7149                                  		sys	_audio, 0900h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000440D BB00090000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004412 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004417 CD40                <1>  int 40h
  7150                                  		; Deallocate audio buffer (for user)
  7151                                  		sys	_audio, 0A00h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004419 BB000A0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000441E B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004423 CD40                <1>  int 40h
  7152                                  		; Disable audio device
  7153                                  		sys	_audio, 0C00h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004425 BB000C0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000442A B820000000          <1>  mov eax, %1
   112                              <1> 
   113 0000442F CD40                <1>  int 40h
  7154 00004431 C3                      		retn
  7155                                  
  7156                                  
  7157                                  ; =============== S U B R O U T I N E =======================================
  7158                                  
  7159                                  		; 29/01/2025
  7160                                  		; 23/01/2025
  7161                                  		; 13/01/2025
  7162                                  		; 12/01/2025
  7163                                  		; 09/01/2025
  7164                                  		; 21/10/2024
  7165                                  try_enqueue_all_blocks:
  7166                                  		; 12/01/2025
  7167 00004432 60                      		pusha
  7168 00004433 BF[00800500]             		mov	edi, sample_buffer
  7169                                  		; 10/01/2025
  7170                                  		;jmp	short .first_block
  7171                                  		; 13/01/2025
  7172 00004438 EB15                    		jmp	short try_enqueue_all_blocks_@
  7173                                  ;.next_block:
  7174                                  teab_next_block:
  7175 0000443A 833D[E4510500]00                        cmp	dword [bytes_left], 0
  7176                                                  ;jle	short .enqueue_done
  7177                                  		; 13/01/2025
  7178 00004441 7E54                    		jle	short teab_enqueue_done
  7179                                  		;
  7180 00004443 8B3D[70190100]          		mov	edi, [mp3_samples_dst]
  7181 00004449 033D[74190100]          		add	edi, [mp3_samples_output_size]
  7182                                  
  7183                                  try_enqueue_all_blocks_@:
  7184                                  ;.first_block:
  7185                                  		;pusha
  7186 0000444F 8B35[E0510500]          		mov	esi, [stream_pos]
  7187 00004455 8B0D[E4510500]          		mov	ecx, [bytes_left]
  7188 0000445B 31ED                    		xor	ebp, ebp
  7189 0000445D E8F8F9FFFF              		call	mp3_decode_frame
  7190                                  		;popa
  7191                                  		;;jc	short .enqueue_done
  7192                                  		; 23/01/2025 (ignore error) -forward/backward-
  7193                                  		; 13/01/2025
  7194                                  		;jc	short teab_enqueue_done
  7195 00004462 A1[98C20000]            		mov	eax, [mp3_src_frame_size]
  7196 00004467 83F800                  		cmp	eax, 0
  7197                                  		;jz	short .enqueue_done
  7198                                  		; 13/01/2025
  7199 0000446A 742B                    		jz	short teab_enqueue_done
  7200 0000446C 0105[E0510500]          		add	[stream_pos], eax
  7201 00004472 2905[E4510500]          		sub	[bytes_left], eax
  7202 00004478 A1[74190100]            		mov	eax, [mp3_samples_output_size]
  7203 0000447D 83F800                  		cmp	eax, 0
  7204                                  		;jz	short .next_block
  7205                                  		; 13/01/2025
  7206 00004480 74B8                    		jz	short teab_next_block
  7207                                  ;.no_error:
  7208 00004482 FE05[29A90000]          		inc	byte [num_enqueued_frames]
  7209                                  		;
  7210 00004488 A0[29A90000]            		mov	al, [num_enqueued_frames]
  7211 0000448D 3A05[7BB20000]          		cmp	al, [blocks]
  7212                                  		;jb	short .next_block
  7213                                  		; 13/01/2025
  7214 00004493 72A5                    		jb	short teab_next_block
  7215                                  teab_rtn:
  7216                                  ;.rtn:
  7217                                  		; 12/01/2025
  7218 00004495 61                      		popa
  7219 00004496 C3                      		retn
  7220                                  ;.enqueue_done:
  7221                                  teab_enqueue_done:
  7222 00004497 C705[E4510500]0000-                     mov	dword [bytes_left], 0
  7222 0000449F 0000               
  7223                                  		; 12/01/2025
  7224                                  		;jmp	short .rtn
  7225                                  		; 13/01/2025
  7226 000044A1 EBF2                    		jmp	short teab_rtn
  7227                                  
  7228                                  ; ---------------------------------------------------------------------------
  7229                                  ; 13/01/2025 - Interpolation procedures for non-VRA AC97 codecs
  7230                                  ; ---------------------------------------------------------------------------
  7231                                  
  7232                                  ; =============== S U B R O U T I N E =======================================
  7233                                  		
  7234                                  		; 18/02/2025
  7235                                  		; 17/02/2025
  7236                                  		; 16/02/2025
  7237                                  		; 30/01/2025
  7238                                  		; 27/01/2025
  7239                                  		; 26/01/2025
  7240                                  		; 15/01/2025
  7241                                  		; 14/01/2025
  7242                                  		; 13/01/2025
  7243                                  audio_system_init_x:
  7244 000044A3 8B0D[74190100]          		mov	ecx, [mp3_samples_output_size]
  7245                                  		;;;
  7246                                  		; 15/01/2025
  7247 000044A9 89C8                    		mov	eax, ecx
  7248                                  		;mov	[loadsize], ecx
  7249                                  		;;;
  7250                                  		; 15/01/2025
  7251                                  		;shl	ecx, 3 ; * 8 ; 8 blocks
  7252                                  		; 14/01/2025
  7253                                  		;mov	byte [blocks], 8
  7254                                  
  7255 000044AB 803D[8CB20000]02        		cmp	byte [interpolation], 2
  7256 000044B2 731F                    		jnb	short .chk_sample_rate	; interpolation needed
  7257                                  
  7258                                  		; 48 kHZ with 16 bit stereo conversion
  7259                                  		;
  7260                                  		; selected output is
  7261                                  		;	 8bit stereo or 16bit mono or 8bit mono
  7262                                  		; (but AC97 hardware needs 16bit stereo samples)
  7263                                  	
  7264                                  		; 15/01/2025
  7265                                  		;mov	eax, ecx
  7266 000044B4 D1E0                    		shl	eax, 1 ; * 2 (mono to stereo)
  7267                                  
  7268                                  		; 18/02/2025
  7269                                  		; 17/02/2025
  7270 000044B6 BB[4A470000]            		mov	ebx, convert_to_stereo
  7271                                  		
  7272                                  		; 17/02/2025
  7273                                  		;cmp	byte [mp3_bytes_per_sample], 2
  7274                                  		;je	short .set_sizes ; 16bit mono
  7275 000044BB EB00                    		jmp	.set_sizes
  7276                                  
  7277                                  		; 17/02/2025
  7278                                  		; [mp3_bytes_per_sample] = 2
  7279                                  		; 16bit mono or 16bit stereo 
  7280                                  		; (but 16bit stereo does not need conversion here)
  7281                                  
  7282                                  		;; 8bit output (16bit conversion is neeed)
  7283                                  		;mov	ebx, convert_to_16bit
  7284                                  		;; 16/02/2025
  7285                                  		;cmp	byte [mp3_num_channels], 2
  7286                                  		;je	short .set_sizes ; 8bit stereo
  7287                                  		;; 8bit mono output
  7288                                  		;;shr	ecx, 1 ; / 2 ; 4 blocks
  7289                                  		;; 14/01/2025
  7290                                  		;shl	eax, 1
  7291                                  		;; 14/01/2025
  7292                                  		;;shr	byte [blocks], 1
  7293                                  		;mov	ebx, convert_to_stereo_16bit
  7294                                  .set_sizes:
  7295                                  .set_sizes_@:
  7296                                  		; 18/02/2025
  7297 000044BD 891D[84B20000]          		mov	[conversion], ebx
  7298 000044C3 890D[88B20000]          		mov	[loadsize], ecx
  7299                                  		;;;
  7300                                  		; 14/01/2025
  7301                                  		; align to 16bit stereo (if there is a defect)
  7302                                  		; 15/01/2025
  7303                                  		;and	al, ~3
  7304 000044C9 A3[7CB20000]            		mov	[buffer_size], eax
  7305 000044CE E981010000              		jmp	.asix_@
  7306                                  		; 13/01/2025
  7307                                  		; ----------------------------
  7308                                  		; ref: playwav9.s - 18/12/2024
  7309                                  .chk_sample_rate:
  7310                                  		; set interpolation parameters
  7311                                  		; (for 8, 11.025, 16, 22.050, 24, 32, 44.1 kHZ)
  7312                                  		; 16/02/2025
  7313 000044D3 A1[B0C20000]            		mov	eax, [mp3_sample_rate]
  7314                                  		; ecx = 8 * [mp3_samples_output_size] ; 8 blocks
  7315                                  .chk_44khz:
  7316 000044D8 3D44AC0000              		cmp	eax, 44100
  7317 000044DD 7527                    		jne	short .chk_32khz
  7318                                  		; 30/01/2025
  7319 000044DF B819000000              		mov	eax, 25 ; *
  7320                                  		; 17/02/2025
  7321                                  		;cmp	byte [mp3_bytes_per_sample], 1
  7322                                  		;jna	short .chk_44khz_1
  7323 000044E4 BB[914D0000]            		mov	ebx, load_44khz_stereo_16_bit
  7324                                  		; 16/02/2025
  7325 000044E9 803D[BCC20000]01        		cmp	byte [mp3_num_channels], 1
  7326 000044F0 7509                    		jne	short .chk_44khz_2
  7327 000044F2 BB[454D0000]            		mov	ebx, load_44khz_mono_16_bit
  7328                                  		;jmp	short .chk_44khz_2
  7329                                  		; 30/01/2025
  7330 000044F7 EB00                    		jmp	short .chk_44khz_3
  7331                                  .chk_44khz_1:
  7332                                  		; 17/02/2025
  7333                                  		; 	[mp3_bytes_per_sample] = 2
  7334                                  		;; 30/01/2025
  7335                                  		;shl	eax, 1
  7336                                  		;mov	ebx, load_44khz_stereo_8_bit
  7337                                  		;; 16/02/2025
  7338                                  		;cmp	byte [mp3_num_channels], 1
  7339                                  		;jne	short .chk_44khz_2
  7340                                  		;mov	ebx, load_44khz_mono_8_bit
  7341                                  .chk_44khz_3:
  7342                                  		; 30/01/2025
  7343 000044F9 D1E0                    		shl	eax, 1
  7344                                  .chk_44khz_2:
  7345                                  		; 48000/44100 == 25/23
  7346 000044FB BD17000000              		mov	ebp, 23
  7347                                  		;mov	eax, 25 ; *
  7348 00004500 F7E1                    		mul	ecx  ; load (decoding buffer) size
  7349 00004502 F7F5                    		div	ebp
  7350                                  		;; eax = wav output buffer size
  7351                                  		; 15/01/2025
  7352                                  		; eax = 1 block output (converted) size
  7353 00004504 EBB7                    		jmp	short .set_sizes
  7354                                  
  7355                                  		; 15/01/2025
  7356                                  ;		;;;
  7357                                  ;		; 14/01/2025
  7358                                  ;.set_sizes_@:
  7359                                  ;		cmp	ecx, 4608
  7360                                  ;		;ja	short .set_sizes
  7361                                  ;		; 15/01/2025
  7362                                  ;		jnb	short .set_sizes
  7363                                  ;		;shl	ecx, 1
  7364                                  ;		; ecx = [mp3_samples_output_size]
  7365                                  ;		shl	byte [blocks], 1
  7366                                  ;		; 15/01/2025
  7367                                  ;		;shl	eax, 1
  7368                                  ;		;jmp	short .set_sizes_@
  7369                                  ;		jmp	.set_sizes
  7370                                  		;;;
  7371                                  .chk_32khz:
  7372 00004506 3D007D0000              		cmp	eax, 32000
  7373 0000450B 7522                    		jne	short .chk_24khz
  7374                                  		; 30/01/2025
  7375 0000450D B803000000              		mov	eax, 3 ; *
  7376                                  		; 17/02/2025
  7377                                  		;cmp	byte [mp3_bytes_per_sample], 1
  7378                                  		;jna	short .chk_32khz_1
  7379 00004512 BB[274B0000]            		mov	ebx, load_32khz_stereo_16_bit
  7380                                  		; 16/02/2025
  7381 00004517 803D[BCC20000]01        		cmp	byte [mp3_num_channels], 1
  7382 0000451E 7509                    		jne	short .chk_32khz_2
  7383 00004520 BB[E74A0000]            		mov	ebx, load_32khz_mono_16_bit
  7384                                  		;jmp	short .chk_32khz_2
  7385                                  		; 30/01/2025
  7386 00004525 EB00                    		jmp	short .chk_32khz_3
  7387                                  .chk_32khz_1:
  7388                                  		; 17/02/2025
  7389                                  		;	[mp3_bytes_per_sample] = 2
  7390                                  		;; 30/01/2025
  7391                                  		;shl	eax, 1
  7392                                  		;mov	ebx, load_32khz_stereo_8_bit
  7393                                  		;; 16/02/2025
  7394                                  		;cmp	byte [mp3_num_channels], 1
  7395                                  		;jne	short .chk_32khz_2
  7396                                  		;mov	ebx, load_32khz_mono_8_bit
  7397                                  .chk_32khz_3:
  7398                                  		; 30/01/2025
  7399 00004527 D1E0                    		shl	eax, 1
  7400                                  .chk_32khz_2:
  7401                                  		; 48000/32000 = 3/2
  7402                                  		;mov	eax, 3 ; *
  7403 00004529 F7E1                    		mul	ecx 	; *3
  7404                                  		;mov	eax, ecx
  7405                                  		;add	eax, eax
  7406                                  		;add	eax, ecx
  7407 0000452B D1E8                    		shr	eax, 1  ; /2
  7408 0000452D EB8E                    		jmp	.set_sizes
  7409                                  .chk_24khz:
  7410 0000452F 3DC05D0000              		cmp	eax, 24000
  7411 00004534 7520                    		jne	short .chk_22khz
  7412                                  		; 30/01/2025
  7413 00004536 89C8                    		mov	eax, ecx ; *
  7414                                  		; 17/02/2025
  7415                                  		;cmp	byte [mp3_bytes_per_sample], 1
  7416                                  		;jna	short .chk_24khz_1
  7417                                  		; 14/01/2025 
  7418                                  		; bx -> ebx
  7419                                  		; (BugFix, 'playwav9.s' has a bug here) 
  7420 00004538 BB[854A0000]            		mov	ebx, load_24khz_stereo_16_bit
  7421                                  		; 16/02/2025
  7422 0000453D 803D[BCC20000]01        		cmp	byte [mp3_num_channels], 1
  7423 00004544 7509                    		jne	short .chk_24khz_2
  7424 00004546 BB[494A0000]            		mov	ebx, load_24khz_mono_16_bit
  7425                                  		;jmp	short .chk_24khz_2
  7426                                  		; 30/01/2025
  7427 0000454B EB00                    		jmp	short .chk_24khz_3
  7428                                  .chk_24khz_1:
  7429                                  		; 17/02/2025
  7430                                  		;	[mp3_bytes_per_sample] = 2
  7431                                  		;; 30/01/2025
  7432                                  		;shl	eax, 1
  7433                                  		;mov	ebx, load_24khz_stereo_8_bit
  7434                                  		;; 16/02/2025
  7435                                  		;cmp	byte [mp3_num_channels], 1
  7436                                  		;jne	short .chk_24khz_2
  7437                                  		;mov	ebx, load_24khz_mono_8_bit
  7438                                  .chk_24khz_3:
  7439                                  		; 30/01/2025
  7440 0000454D D1E0                    		shl	eax, 1
  7441                                  .chk_24khz_2:
  7442                                  		; 48000/24000 = 2/1
  7443                                  		;mov	eax, ecx ; *
  7444 0000454F D1E0                    		shl	eax, 1
  7445 00004551 E967FFFFFF              		jmp	.set_sizes_@
  7446                                  .chk_22khz:
  7447 00004556 3D22560000              		cmp	eax, 22050
  7448 0000455B 752A                    		jne	short .chk_16khz
  7449                                  		; 30/01/2025
  7450 0000455D B825000000              		mov	eax, 37 ; *
  7451                                  		; 17/02/2025
  7452                                  		;cmp	byte [mp3_bytes_per_sample], 1
  7453                                  		;jna	short .chk_22khz_1
  7454 00004562 BB[F54B0000]            		mov	ebx, load_22khz_stereo_16_bit
  7455                                  		; 16/02/2025
  7456 00004567 803D[BCC20000]01        		cmp	byte [mp3_num_channels], 1
  7457 0000456E 7509                    		jne	short .chk_22khz_2
  7458 00004570 BB[924B0000]            		mov	ebx, load_22khz_mono_16_bit
  7459                                  		;jmp	short .chk_22khz_2
  7460                                  		; 30/01/2025
  7461 00004575 EB00                    		jmp	short .chk_22khz_3
  7462                                  .chk_22khz_1:
  7463                                  		; 17/02/2025
  7464                                  		;	[mp3_bytes_per_sample] = 2
  7465                                  		;; 30/01/2025
  7466                                  		;shl	eax, 1
  7467                                  		;mov	ebx, load_22khz_stereo_8_bit
  7468                                  		;; 16/02/2025
  7469                                  		;cmp	byte [mp3_num_channels], 1
  7470                                  		;jne	short .chk_22khz_2
  7471                                  		;mov	ebx, load_22khz_mono_8_bit
  7472                                  .chk_22khz_3:
  7473                                  		; 30/01/2025
  7474 00004577 D1E0                    		shl	eax, 1
  7475                                  .chk_22khz_2:
  7476                                  		; 48000/22050 == 37/17
  7477 00004579 BD11000000              		mov	ebp, 17
  7478                                  		;mov	eax, 37 ; *
  7479 0000457E F7E1                    		mul	ecx  ; load (decoding buffer) size
  7480 00004580 F7F5                    		div	ebp
  7481                                  		;; eax = wav output buffer size
  7482                                  		; 15/01/2025
  7483                                  		; eax = 1 block output (converted) size
  7484 00004582 E936FFFFFF              		jmp	.set_sizes_@
  7485                                  .chk_16khz:
  7486 00004587 3D803E0000              		cmp	eax, 16000
  7487 0000458C 7522                    		jne	short .chk_11khz
  7488                                  		; 30/01/2025
  7489 0000458E 89C8                    		mov	eax, ecx ; *
  7490 00004590 D1E0                    		shl	eax, 1
  7491 00004592 01C8                    		add	eax, ecx
  7492                                  		; 17/02/2025
  7493                                  		;cmp	byte [mp3_bytes_per_sample], 1
  7494                                  		;jna	short .chk_16khz_1
  7495 00004594 BB[98490000]            		mov	ebx, load_16khz_stereo_16_bit
  7496                                  		; 16/02/2025
  7497 00004599 803D[BCC20000]01        		cmp	byte [mp3_num_channels], 1
  7498 000045A0 7509                    		jne	short .chk_16khz_2
  7499 000045A2 BB[41490000]            		mov	ebx, load_16khz_mono_16_bit
  7500                                  		;jmp	short .chk_16khz_2
  7501                                  		; 30/01/2025
  7502 000045A7 EB00                    		jmp	short .chk_16khz_3
  7503                                  .chk_16khz_1:
  7504                                  		; 17/02/2025
  7505                                  		;	[mp3_bytes_per_sample] = 2
  7506                                  		;; 30/01/2025
  7507                                  		;shl	eax, 1
  7508                                  		;mov	ebx, load_16khz_stereo_8_bit
  7509                                  		;; 16/02/2025
  7510                                  		;cmp	byte [mp3_num_channels], 1
  7511                                  		;jne	short .chk_16khz_2
  7512                                  		;mov	ebx, load_16khz_mono_8_bit
  7513                                  .chk_16khz_3:
  7514                                  		; 30/01/2025
  7515 000045A9 D1E0                    		shl	eax, 1
  7516                                  .chk_16khz_2:
  7517                                  		; 48000/16000 = 3/1
  7518                                  		;mov	eax, ecx ; *
  7519                                  		;shl	eax, 1
  7520                                  		;;add	eax, eax
  7521                                  		;add	eax, ecx
  7522 000045AB E90DFFFFFF              		jmp	.set_sizes_@
  7523                                  .chk_11khz:
  7524 000045B0 3D112B0000              		cmp	eax, 11025
  7525 000045B5 752A                    		jne	short .chk_8khz
  7526                                  		; 30/01/2025
  7527 000045B7 B84A000000              		mov	eax, 74
  7528                                  		; 17/02/2025
  7529                                  		;cmp	byte [mp3_bytes_per_sample], 1
  7530                                  		;jna	short .chk_11khz_1
  7531 000045BC BB[D54C0000]            		mov	ebx, load_11khz_stereo_16_bit
  7532                                  		; 16/02/2025
  7533 000045C1 803D[BCC20000]01        		cmp	byte [mp3_num_channels], 1
  7534 000045C8 7509                    		jne	short .chk_11khz_2
  7535 000045CA BB[814C0000]            		mov	ebx, load_11khz_mono_16_bit
  7536                                  		;jmp	short .chk_11khz_2
  7537                                  		; 30/01/2025
  7538 000045CF EB00                    		jmp	short .chk_11khz_3
  7539                                  .chk_11khz_1:
  7540                                  		; 17/02/2025
  7541                                  		;	[mp3_bytes_per_sample] = 2
  7542                                  		;; 30/01/2025
  7543                                  		;shl	eax, 1
  7544                                  		;mov	ebx, load_11khz_stereo_8_bit
  7545                                  		;; 16/02/2025
  7546                                  		;cmp	byte [mp3_num_channels], 1
  7547                                  		;jne	short .chk_11khz_2
  7548                                  		;mov	ebx, load_11khz_mono_8_bit
  7549                                  .chk_11khz_3:
  7550                                  		; 30/01/2025
  7551 000045D1 D1E0                    		shl	eax, 1
  7552                                  .chk_11khz_2:
  7553                                  		; 48000/11025 == 74/17
  7554                                  		; 14/01/2025
  7555                                  		;shr	ecx, 1	; 4 blocks
  7556                                  		;shr	byte [blocks], 1
  7557 000045D3 BD11000000              		mov	ebp, 17
  7558                                  		;mov	eax, 74 ; *
  7559 000045D8 F7E1                    		mul	ecx  ; load (decoding buffer) size
  7560 000045DA F7F5                    		div	ebp
  7561                                  		;; eax = wav output buffer size
  7562                                  		; 15/01/2025
  7563                                  		; eax = 1 block output (converted) size
  7564 000045DC E9DCFEFFFF              		jmp	.set_sizes_@
  7565                                  .chk_8khz:
  7566 000045E1 3D401F0000              		cmp	eax, 8000
  7567                                  		;jne	short .vra_needed
  7568                                  		; 01/02/2025
  7569 000045E6 7523                    		jne	short .chk_12khz
  7570                                  		; 30/01/2025
  7571 000045E8 B806000000              		mov	eax, 6 ; *
  7572                                  		; 17/02/2025
  7573                                  		;cmp	byte [mp3_bytes_per_sample], 1
  7574                                  		;jna	short .chk_8khz_1
  7575 000045ED BB[1B480000]            		mov	ebx, load_8khz_stereo_16_bit
  7576                                  		; 16/02/2025
  7577 000045F2 803D[BCC20000]01        		cmp	byte [mp3_num_channels], 1
  7578 000045F9 7509                    		jne	short .chk_8khz_2
  7579 000045FB BB[79470000]            		mov	ebx, load_8khz_mono_16_bit
  7580                                  		;jmp	short .chk_8khz_2
  7581                                  		; 30/01/2025
  7582 00004600 EB00                    		jmp	short .chk_8khz_3
  7583                                  .chk_8khz_1:
  7584                                  		; 17/02/2025
  7585                                  		;	[mp3_bytes_per_sample] = 2
  7586                                  		;; 30/01/2025
  7587                                  		;shl	eax, 1
  7588                                  		;mov	ebx, load_8khz_stereo_8_bit
  7589                                  		;; 16/02/2025
  7590                                  		;cmp	byte [mp3_num_channels], 1
  7591                                  		;jne	short .chk_8khz_2
  7592                                  		;mov	ebx, load_8khz_mono_8_bit
  7593                                  .chk_8khz_3:
  7594                                  		; 30/01/2025
  7595 00004602 D1E0                    		shl	eax, 1
  7596                                  .chk_8khz_2:
  7597                                  		;mov	eax, 6 ; *
  7598 00004604 F7E1                    		mul	ecx
  7599 00004606 E9B2FEFFFF              		jmp	.set_sizes_@
  7600                                  
  7601                                  		;;;;
  7602                                  		; 01/02/2025
  7603                                  .chk_12khz:
  7604 0000460B 3DE02E0000              		cmp	eax, 12000
  7605 00004610 7521                    		jne	short .vra_needed
  7606 00004612 89C8                    		mov	eax, ecx ; *
  7607                                  		; 17/02/2025
  7608                                  		;cmp	byte [mp3_bytes_per_sample], 1
  7609                                  		;jna	short .chk_12khz_1
  7610 00004614 BB[2F4E0000]            		mov	ebx, load_12khz_stereo_16_bit
  7611                                  		; 16/02/2025
  7612 00004619 803D[BCC20000]01        		cmp	byte [mp3_num_channels], 1
  7613 00004620 7509                    		jne	short .chk_12khz_2
  7614 00004622 BB[054E0000]            		mov	ebx, load_12khz_mono_16_bit
  7615 00004627 EB00                    		jmp	short .chk_12khz_3
  7616                                  .chk_12khz_1:
  7617                                  		; 17/02/2025
  7618                                  		;	[mp3_bytes_per_sample] = 2
  7619                                  		;; 01/02/2025
  7620                                  		;shl	eax, 1
  7621                                  		;mov	ebx, load_12khz_stereo_8_bit
  7622                                  		;; 16/02/2025
  7623                                  		;cmp	byte [mp3_num_channels], 1
  7624                                  		;jne	short .chk_12khz_2
  7625                                  		;mov	ebx, load_12khz_mono_8_bit
  7626                                  .chk_12khz_3:
  7627 00004629 D1E0                    		shl	eax, 1
  7628                                  .chk_12khz_2:
  7629                                  		; 48000/12000 = 4/1
  7630                                  		;mov	eax, ecx ; *
  7631 0000462B C1E002                  		shl	eax, 2
  7632 0000462E E98AFEFFFF              		jmp	.set_sizes_@
  7633                                  		;;;;
  7634                                  
  7635                                  .vra_needed:
  7636 00004633 58                      		pop	eax ; discard return address to the caller
  7637                                  .vra_err:
  7638                                  		; 27/01/2025
  7639 00004634 E8490F0000              		call	set_text_mode
  7640                                  		;
  7641                                  		sys	_msg, msg_no_vra, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004639 BB[9E530000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 0000463E B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00004643 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004648 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000464D CD40                <1>  int 40h
  7642                                  		;jmp	ExitProcess
  7643                                  		; 27/01/2025
  7644 0000464F E927FBFFFF              		jmp	ExitProcess@
  7645                                  
  7646                                  .asix_@:
  7647                                  		; TRDOS 386 system call
  7648                                  		; sysaudio
  7649                                  		; Allocate audio buffer (for user)
  7650                                  		; ebx = 0200h (BH=2)
  7651                                  		; ecx = buffer size (in bytes)
  7652                                  		; edx = buffer address (virtual)
  7653                                  
  7654                                  		sys	_audio, 0200h, [buffer_size], sample_buffer
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00004654 BB00020000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00004659 8B0D[7CB20000]      <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 0000465F BA[00800500]        <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004664 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004669 CD40                <1>  int 40h
  7655 0000466B 7231                    		jc	short .init_err
  7656                                  
  7657                                  		; 12/01/2025
  7658                                  		; clear audio buffer (before playback)
  7659 0000466D BF[00800500]            		mov	edi, sample_buffer
  7660                                  		; ecx = buffer size in bytes
  7661 00004672 83C103                  		add	ecx, 3	; 13/01/2025
  7662 00004675 C1E902                  		shr	ecx, 2
  7663 00004678 31C0                    		xor	eax, eax
  7664 0000467A F3AB                    		rep	stosd
  7665                                  
  7666                                  		; TRDOS 386 system call
  7667                                  		; sysaudio
  7668                                  		; Initialize audio device (bh = 3)
  7669                                  		; bl = 01h -> CallBack method
  7670                                  		; edx = Callback service address (virtual)
  7671                                  		; ecx = 0 ; CL = srb value ; not used
  7672                                  		sys	_audio, 0301h, 0, audio_callback_x ; 13/01/2025
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000467C BB01030000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00004681 B900000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00004686 BA[2B470000]        <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000468B B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00004690 CD40                <1>  int 40h
  7673                                  		; 12/01/2025
  7674                                  		; SRB method (faster than callback method)
  7675                                  		; bl = 0 -> Signal Response Byte method
  7676                                  		; cl = 1 -> SRB set value 
  7677                                  		;     (will be set by audio IRQ service of the kernel)
  7678                                  		; edx = SRB address -one byte data-
  7679                                  		;sys	_audio, 0300h, 1, srb	
  7680 00004692 720A                    		jc	short .init_err
  7681                                  
  7682                                  ; 27/01/2025
  7683                                  ;		; 26/01/2025
  7684                                  ;		; Map system DMA buffer to user's memory space
  7685                                  ;		; (for -fast- sound data graphics display)
  7686                                  ;		mov	eax, [buffer_size]
  7687                                  ;		shl	eax, 1 ; dma buff size is 2 * user's buff size
  7688                                  ;		sys	_audio, 0D00h, eax, dmabuffer
  7689                                  
  7690                                  		; 24/01/2025
  7691                                  		;retn
  7692 00004694 A0[B8B10000]            		mov	al, [volume_level]
  7693                                  		;call	SetMasterVolume@
  7694                                  		;retn
  7695 00004699 E9D2FCFFFF              		jmp	SetMasterVolume@
  7696                                  
  7697                                  .init_err:
  7698 0000469E E91FFCFFFF              		jmp	init_error
  7699                                  
  7700                                  
  7701                                  ; =============== S U B R O U T I N E =======================================
  7702                                  
  7703                                  		; 15/02/2025
  7704                                  		; 14/01/2025
  7705                                  		; 13/01/2025
  7706                                  mp3_cast_to_speaker_x:
  7707                                  		; 48 kHZ, 16bit, stereo
  7708 000046A3 BB03040000              		mov	ebx, 0403h
  7709 000046A8 B980BB0000              		mov	ecx, 48000
  7710                                  		; 14/01/2025
  7711 000046AD 803D[79B20000]01        		cmp	byte [vra], 1
  7712 000046B4 7206                    		jb	short .jmpto@
  7713                                  		; 15/02/2025
  7714 000046B6 8B0D[B0C20000]          		mov	ecx, [mp3_sample_rate] 
  7715                                  .jmpto@:
  7716 000046BC E9D6FCFFFF              		jmp	mp3_cast_to_speaker_@
  7717                                  
  7718                                  
  7719                                  ; =============== S U B R O U T I N E =======================================
  7720                                  	
  7721                                  		; 18/02/2025
  7722                                  		; 17/02/2025	
  7723                                  		; 23/01/2025
  7724                                  		; 15/01/2025
  7725                                  		; 13/01/2025
  7726                                  try_enqueue_all_blocks_x:
  7727                                  		; 12/01/2025
  7728 000046C1 60                      		pusha
  7729 000046C2 BF[00600500]             		mov	edi, decoding_buffer
  7730                                  		; 15/01/2025
  7731                                  		;jmp	try_enqueue_all_blocks_@
  7732 000046C7 EB15                    		jmp	short .first_block
  7733                                  
  7734                                  		; 15/01/2025
  7735                                  .next_block:
  7736 000046C9 833D[E4510500]00                        cmp	dword [bytes_left], 0
  7737 000046D0 7E4D                                    jle	short .enqueue_done
  7738                                  		;
  7739 000046D2 8B3D[70190100]          		mov	edi, [mp3_samples_dst]
  7740 000046D8 033D[74190100]          		add	edi, [mp3_samples_output_size]
  7741                                  
  7742                                  ;try_enqueue_all_blocks_@:
  7743                                  .first_block:
  7744                                  		;;pusha
  7745 000046DE 8B35[E0510500]          		mov	esi, [stream_pos]
  7746 000046E4 8B0D[E4510500]          		mov	ecx, [bytes_left]
  7747 000046EA 31ED                    		xor	ebp, ebp
  7748 000046EC E869F7FFFF              		call	mp3_decode_frame
  7749                                  		;;popa
  7750                                  		; 23/01/2025 (ignore error) -forward/backward-
  7751                                  		;jc	short .enqueue_done
  7752                                  
  7753 000046F1 A1[98C20000]            		mov	eax, [mp3_src_frame_size]
  7754 000046F6 83F800                  		cmp	eax, 0
  7755 000046F9 7424                    		jz	short .enqueue_done
  7756 000046FB 0105[E0510500]          		add	[stream_pos], eax
  7757 00004701 2905[E4510500]          		sub	[bytes_left], eax
  7758                                  
  7759 00004707 A1[74190100]            		mov	eax, [mp3_samples_output_size]
  7760 0000470C 83F800                  		cmp	eax, 0
  7761 0000470F 74B8                    		jz	short .next_block
  7762                                  
  7763                                  		; 18/02/2025
  7764                                  		; 15/01/2025
  7765 00004711 FF15[84B20000]          		call	dword [conversion]
  7766                                  		; 17/02/2025 (only one option = 16bit mono)
  7767                                  		;call	convert_to_stereo
  7768                                  		
  7769                                  .no_error:
  7770                                  		; 15/01/2025
  7771 00004717 FE05[29A90000]          		inc	byte [num_enqueued_frames]
  7772                                  .rtn:
  7773                                  		; 12/01/2025
  7774 0000471D 61                      		popa
  7775 0000471E C3                      		retn
  7776                                  .enqueue_done:
  7777 0000471F C705[E4510500]0000-                     mov	dword [bytes_left], 0
  7777 00004727 0000               
  7778                                  		; 12/01/2025
  7779 00004729 EBF2                    		jmp	short .rtn
  7780                                  
  7781                                  
  7782                                  ; =============== S U B R O U T I N E =======================================
  7783                                  
  7784                                  		; 13/01/2025
  7785                                  audio_callback_x:
  7786                                  		; Operating system has directed CPU here because of
  7787                                  		; user (2nd) stage of the audio hardware interrupt service.
  7788                                  		; This procedure must be short and return to operating
  7789                                  		; system again via sysrelease system call
  7790                                  		; (or any system call here will be handled as sysrelease).
  7791                                  
  7792 0000472B C605[7AB20000]01        		mov	byte [srb], 1
  7793                                  
  7794 00004732 E88AFFFFFF              		call	try_enqueue_all_blocks_x
  7795                                  
  7796                                  		; 15/01/2025
  7797                                  		;call	dword [conversion]
  7798                                  
  7799                                  		sys	_rele ; return from callback service 
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004737 B827000000          <1>  mov eax, %1
   112                              <1> 
   113 0000473C CD40                <1>  int 40h
  7800                                  		
  7801                                  		; we must not come here !
  7802 0000473E BBFFFFFFFF              		mov	ebx, -1
  7803                                  		sys	_exit
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103                              <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00004743 B801000000          <1>  mov eax, %1
   112                              <1> 
   113 00004748 CD40                <1>  int 40h
  7804                                  		;jmp	short audio_callback
  7805                                  
  7806                                  
  7807                                  ; ---------------------------------------------------------------------------
  7808                                  ; 13/01/2025 - Interpolation procedures for non-VRA AC97 codecs
  7809                                  ; ---------------------------------------------------------------------------
  7810                                  ; ref: playwav9.s - 18/12/2025
  7811                                  
  7812                                  ; =============== S U B R O U T I N E =======================================
  7813                                  
  7814                                  ; 13/01/2025
  7815                                  ; --------------------------------------------------------
  7816                                  ; 48 kHZ conversion procedures
  7817                                  ; --------------------------------------------------------
  7818                                  ; convert_to_stereo: convert 16bit mono samples to 16bit stereo
  7819                                  ; convert_to_16bit: convert 8bit stereo samples to 16bit stereo	
  7820                                  ; convert_to_stereo_16bit: convert 8bit mono samples to 16bit & stereo
  7821                                  ; [loadsize] = decoding buffer size
  7822                                  ; [buffer_size] = wav output buffer size (<= 64KB)
  7823                                  
  7824                                  ; /////
  7825                                  
  7826                                  	; 13/01/2025
  7827                                  convert_to_stereo:
  7828 0000474A BE[00600500]            	mov	esi, decoding_buffer ; (contains 16bit mono samples)
  7829 0000474F BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  7830 00004754 8B0D[88B20000]          	mov	ecx, [loadsize]
  7831 0000475A D1E9                    	shr	ecx, 1 ; word count
  7832                                  cts_1:
  7833 0000475C 66AD                    	lodsw
  7834 0000475E 66AB                    	stosw	; left channel
  7835 00004760 66AB                    	stosw	; right channel
  7836 00004762 E2F8                    	loop	cts_1
  7837                                  cts_2:
  7838                                  	; padfill
  7839 00004764 8B0D[7CB20000]          	mov	ecx, [buffer_size] 
  7840 0000476A 81C1[00800500]          	add	ecx, sample_buffer
  7841 00004770 29F9                    	sub	ecx, edi
  7842 00004772 7604                    	jna	short cts_3
  7843 00004774 31C0                    	xor	eax, eax
  7844 00004776 F3AA                    	rep	stosb
  7845                                  cts_3:
  7846 00004778 C3                      	retn
  7847                                  
  7848                                  ; /////
  7849                                  
  7850                                  ; 17/02/2025
  7851                                  %if 0
  7852                                  
  7853                                  	; 13/01/2025
  7854                                  convert_to_16bit:
  7855                                  	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  7856                                  	mov	edi, sample_buffer ; wav output buffer
  7857                                  	mov	ecx, [loadsize]
  7858                                  ct16b_1:
  7859                                  	; stereo & 8 bit
  7860                                  	lodsb
  7861                                  	sub	al, 80h ; 08/11/2023
  7862                                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  7863                                  	stosw
  7864                                  	loop	ct16b_1
  7865                                  	jmp	short cts_2
  7866                                  
  7867                                  ; /////
  7868                                  
  7869                                  	; 13/01/2025
  7870                                  convert_to_stereo_16bit:
  7871                                  	mov	esi, decoding_buffer ; (contains 8bit mono samples)
  7872                                  	mov	edi, sample_buffer ; wav output buffer
  7873                                  	mov	ecx, [loadsize]
  7874                                  cts16b_1:
  7875                                  	; mono & 8 bit
  7876                                  	lodsb
  7877                                  	sub	al, 80h ; 08/11/2023
  7878                                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  7879                                  	stosw	; left channel
  7880                                  	stosw	; right channel
  7881                                  	loop	cts16b_1
  7882                                  	jmp	short cts_2
  7883                                  
  7884                                  ; /////
  7885                                  
  7886                                  %endif
  7887                                  
  7888                                  ; =============== S U B R O U T I N E =======================================
  7889                                  
  7890                                  ; --------------------------------------------------------
  7891                                  ; 13/01/2025
  7892                                  ; --------------------------------------------------------
  7893                                  
  7894                                  ; 17/02/2025 - tmp3play.s
  7895                                  ;	16bit stereo or 16bit mono playback	
  7896                                  ; 13/01/2025 - mp3player modifications (mp3play3.s)
  7897                                  ; 07/12/2024 - playwav9.s
  7898                                  ; 01/12/2024 - ac97play.s
  7899                                  ; 29/05/2024
  7900                                  ; 26/11/2023
  7901                                  ; 25/11/2023 - playwav6.s (32 bit registers, TRDOS 386 adaption)
  7902                                  ; 15/11/2023 - PLAYWAV5.COM, ich_wav5.asm
  7903                                  ; 14/11/2023
  7904                                  ; 13/11/2023 - Erdogan Tan - (VRA, sample rate conversion)
  7905                                  ; --------------------------------------------------------
  7906                                  
  7907                                  ;;Note:	At the end of every buffer load,
  7908                                  ;;	during buffer switch/swap, there will be discontinuity
  7909                                  ;;	between the last converted sample and the 1st sample
  7910                                  ;;	of the next buffer.
  7911                                  ;;	(like as a dot noises vaguely between normal sound samples)
  7912                                  ;;	-To avoid this defect, the 1st sample of
  7913                                  ;;	the next buffer may be read from the wav file but
  7914                                  ;;	the file pointer would need to be set to 1 sample back
  7915                                  ;;	again via seek system call. Time comsumption problem! -
  7916                                  ;;
  7917                                  ;;	Erdogan Tan - 15/11/2023
  7918                                  ;;
  7919                                  ;;	((If entire wav data would be loaded at once.. conversion
  7920                                  ;;	defect/noise would disappear.. but for DOS, to keep
  7921                                  ;;	64KB buffer limit is important also it is important
  7922                                  ;;	for running under 1MB barrier without HIMEM.SYS or DPMI.
  7923                                  ;;	I have tested this program by using 2-30MB wav files.))
  7924                                  ;;
  7925                                  ;;	Test Computer:	ASUS desktop/mainboard, M2N4-SLI, 2010.
  7926                                  ;;			AMD Athlon 64 X2 2200 MHZ CPU.
  7927                                  ;;		       	NFORCE4 (CK804) AC97 audio hardware.
  7928                                  ;;			Realtek ALC850 codec.
  7929                                  ;;		       	Retro DOS v4.2 (MSDOS 6.22) operating system.
  7930                                  
  7931                                  ; =============== S U B R O U T I N E =======================================
  7932                                  
  7933                                  load_8khz_mono_16_bit:
  7934                                  	; 13/01/2025 (mp3play3.s)
  7935 00004779 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  7936 0000477E BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  7937 00004783 8B0D[88B20000]          	mov	ecx, [loadsize]
  7938                                  	; 13/01/2025
  7939 00004789 D1E9                    	shr	ecx, 1	; word count
  7940                                  lff8m2_1:
  7941 0000478B 66AD                    	lodsw
  7942 0000478D 66AB                    	stosw		; original sample (left channel)
  7943 0000478F 66AB                    	stosw		; original sample (right channel)
  7944 00004791 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  7945 00004794 66A3[23510000]          	mov	[previous_val], ax
  7946 0000479A 31C0                    	xor	eax, eax
  7947 0000479C 49                      	dec	ecx
  7948 0000479D 7403                    	jz	short lff8m2_2
  7949 0000479F 668B06                  	mov	ax, [esi]
  7950                                  lff8m2_2:
  7951 000047A2 80C480                  	add	ah, 80h ; convert sound level to 0-65535 format
  7952 000047A5 89C5                    	mov	ebp, eax	; [next_val]
  7953 000047A7 660305[23510000]        	add	ax, [previous_val]
  7954 000047AE 66D1D8                  	rcr	ax, 1
  7955 000047B1 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample
  7956 000047B3 660305[23510000]        	add	ax, [previous_val]
  7957 000047BA 66D1D8                  	rcr	ax, 1	; this is temporary interpolation value
  7958 000047BD 89C3                    	mov	ebx, eax 		
  7959 000047BF 660305[23510000]        	add	ax, [previous_val]
  7960 000047C6 66D1D8                  	rcr	ax, 1
  7961 000047C9 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  7962 000047CC 66AB                    	stosw		; this is 1st interpolated sample (L)
  7963 000047CE 66AB                    	stosw		; this is 1st interpolated sample (R)
  7964 000047D0 89D8                    	mov	eax, ebx
  7965 000047D2 6601D0                  	add	ax, dx
  7966 000047D5 66D1D8                  	rcr	ax, 1
  7967 000047D8 80EC80                  	sub	ah, 80h
  7968 000047DB 66AB                    	stosw		; this is 2nd interpolated sample (L)
  7969 000047DD 66AB                    	stosw		; this is 2nd interpolated sample (R)
  7970 000047DF 89D0                    	mov	eax, edx
  7971 000047E1 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  7972 000047E4 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  7973 000047E6 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  7974 000047E8 89E8                    	mov	eax, ebp
  7975 000047EA 6601D0                  	add	ax, dx
  7976 000047ED 66D1D8                  	rcr	ax, 1
  7977 000047F0 89C3                    	mov	ebx, eax ; this is temporary interpolation value
  7978 000047F2 6601D0                  	add	ax, dx
  7979 000047F5 66D1D8                  	rcr	ax, 1
  7980 000047F8 80EC80                  	sub	ah, 80h
  7981 000047FB 66AB                    	stosw		; this is 4th interpolated sample (L)
  7982 000047FD 66AB                    	stosw		; this is 4th interpolated sample (R)
  7983 000047FF 89E8                    	mov	eax, ebp
  7984 00004801 6601D8                  	add	ax, bx
  7985 00004804 66D1D8                  	rcr	ax, 1
  7986 00004807 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  7987 0000480A 66AB                    	stosw		; this is 5th interpolated sample (L)
  7988 0000480C 66AB                    	stosw		; this is 5th interpolated sample (R)
  7989                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  7990 0000480E 09C9                    	or	ecx, ecx
  7991 00004810 0F8575FFFFFF            	jnz	lff8m2_1
  7992                                  	;jmp	lff8m2_3
  7993                                  	; 17/02/2025
  7994 00004816 E9D0050000              	jmp	lff8_3
  7995                                  
  7996                                  ; =============== S U B R O U T I N E =======================================
  7997                                  
  7998                                  load_8khz_stereo_16_bit:
  7999                                  	; 13/01/2025 (mp3play3.s)
  8000 0000481B BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8001 00004820 BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8002 00004825 8B0D[88B20000]          	mov	ecx, [loadsize]
  8003                                  	; 13/01/2025
  8004 0000482B C1E902                  	shr	ecx, 2	; dword count
  8005                                  lff8s2_1:
  8006 0000482E 66AD                    	lodsw
  8007 00004830 66AB                    	stosw		; original sample (L)
  8008                                  	; 15/11/2023
  8009 00004832 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  8010 00004835 66A3[23510000]          	mov	[previous_val_l], ax
  8011 0000483B 66AD                    	lodsw
  8012 0000483D 66AB                    	stosw		; original sample (R)
  8013 0000483F 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  8014 00004842 66A3[25510000]          	mov	[previous_val_r], ax
  8015 00004848 31D2                    	xor	edx, edx
  8016 0000484A 31C0                    	xor	eax, eax
  8017                                  	; 16/11/2023
  8018 0000484C 49                      	dec	ecx
  8019 0000484D 7407                    	jz	short lff8s2_2
  8020 0000484F 668B06                  	mov	ax, [esi]
  8021 00004852 668B5602                	mov	dx, [esi+2]
  8022                                  lff8s2_2:
  8023 00004856 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  8024 00004859 66A3[27510000]          	mov	[next_val_l], ax
  8025 0000485F 80C680                  	add	dh, 80h	; convert sound level to 0-65535 format
  8026 00004862 668915[29510000]        	mov	[next_val_r], dx
  8027 00004869 660305[23510000]        	add	ax, [previous_val_l]
  8028 00004870 66D1D8                  	rcr	ax, 1
  8029 00004873 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample (L)
  8030 00004875 660305[23510000]        	add	ax, [previous_val_l]
  8031 0000487C 66D1D8                  	rcr	ax, 1	
  8032 0000487F 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  8033 00004881 660305[23510000]        	add	ax, [previous_val_l]
  8034 00004888 66D1D8                  	rcr	ax, 1
  8035 0000488B 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8036 0000488E 66AB                    	stosw		; this is 1st interpolated sample (L)
  8037 00004890 66A1[29510000]          	mov	ax, [next_val_r]
  8038 00004896 660305[25510000]        	add	ax, [previous_val_r]
  8039 0000489D 66D1D8                  	rcr	ax, 1
  8040 000048A0 89C5                    	mov	ebp, eax ; this is interpolated middle (3th) sample (R)
  8041 000048A2 660305[25510000]        	add	ax, [previous_val_r]
  8042 000048A9 66D1D8                  	rcr	ax, 1
  8043 000048AC 50                      	push	eax ; *	; this is temporary interpolation value (R)
  8044 000048AD 660305[25510000]        	add	ax, [previous_val_r]
  8045 000048B4 66D1D8                  	rcr	ax, 1
  8046 000048B7 80EC80                  	sub	ah, 80h
  8047 000048BA 66AB                    	stosw		; this is 1st interpolated sample (R)
  8048 000048BC 89D8                    	mov	eax, ebx
  8049 000048BE 6601D0                  	add	ax, dx
  8050 000048C1 66D1D8                  	rcr	ax, 1
  8051 000048C4 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8052 000048C7 66AB                    	stosw		; this is 2nd interpolated sample (L)
  8053 000048C9 58                      	pop	eax ; *
  8054 000048CA 6601E8                  	add	ax, bp
  8055 000048CD 66D1D8                  	rcr	ax, 1
  8056 000048D0 80EC80                  	sub	ah, 80h
  8057 000048D3 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  8058 000048D5 89D0                    	mov	eax, edx
  8059 000048D7 80EC80                  	sub	ah, 80h
  8060 000048DA 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  8061 000048DC 89E8                    	mov	eax, ebp
  8062 000048DE 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8063 000048E1 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  8064 000048E3 66A1[27510000]          	mov	ax, [next_val_l]
  8065 000048E9 6601D0                  	add	ax, dx
  8066 000048EC 66D1D8                  	rcr	ax, 1
  8067 000048EF 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  8068 000048F1 6601D0                  	add	ax, dx
  8069 000048F4 66D1D8                  	rcr	ax, 1
  8070 000048F7 80EC80                  	sub	ah, 80h
  8071 000048FA 66AB                    	stosw		; this is 4th interpolated sample (L)
  8072 000048FC 66A1[29510000]          	mov	ax, [next_val_r]
  8073 00004902 6601E8                  	add	ax, bp
  8074 00004905 66D1D8                  	rcr	ax, 1
  8075 00004908 50                      	push	eax ; ** ; this is temporary interpolation value (R)
  8076 00004909 6601E8                  	add	ax, bp
  8077 0000490C 66D1D8                  	rcr	ax, 1
  8078 0000490F 80EC80                  	sub	ah, 80h
  8079 00004912 66AB                    	stosw		; this is 4th interpolated sample (R)
  8080 00004914 66A1[27510000]          	mov	ax, [next_val_l]
  8081 0000491A 6601D8                  	add	ax, bx
  8082 0000491D 66D1D8                  	rcr	ax, 1
  8083 00004920 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8084 00004923 66AB                    	stosw		; this is 5th interpolated sample (L)
  8085 00004925 58                      	pop	eax ; **
  8086 00004926 660305[29510000]        	add	ax, [next_val_r]
  8087 0000492D 66D1D8                  	rcr	ax, 1
  8088 00004930 80EC80                  	sub	ah, 80h
  8089 00004933 66AB                    	stosw		; this is 5th interpolated sample (R)
  8090                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  8091 00004935 E305                    	jecxz	lff8_s2_9
  8092 00004937 E9F2FEFFFF              	jmp	lff8s2_1
  8093                                  lff8_s2_9:
  8094                                  	;jmp	lff8s2_3
  8095                                  	; 17/02/2025
  8096 0000493C E9AA040000              	jmp	lff8_3
  8097                                  
  8098                                  ; =============== S U B R O U T I N E =======================================
  8099                                  
  8100                                  load_16khz_mono_16_bit:
  8101                                  	; 13/01/2025 (mp3play3.s)
  8102 00004941 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8103 00004946 BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8104 0000494B 8B0D[88B20000]          	mov	ecx, [loadsize]
  8105                                  	; 13/01/2025
  8106 00004951 D1E9                    	shr	ecx, 1	; word count
  8107                                  lff16m2_1:
  8108 00004953 66AD                    	lodsw
  8109 00004955 66AB                    	stosw		; original sample (left channel)
  8110 00004957 66AB                    	stosw		; original sample (right channel)
  8111 00004959 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  8112                                  	;mov	[previous_val], ax
  8113 0000495C 89C3                    	mov	ebx, eax
  8114 0000495E 31C0                    	xor	eax, eax
  8115 00004960 49                      	dec	ecx
  8116 00004961 7403                    	jz	short lff16m2_2
  8117 00004963 668B06                  	mov	ax, [esi]
  8118                                  lff16m2_2:
  8119 00004966 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  8120 00004969 89C5                    	mov	ebp, eax	; [next_val]
  8121                                  	;add	ax, [previous_val]
  8122 0000496B 6601D8                  	add	ax, bx
  8123 0000496E 66D1D8                  	rcr	ax, 1
  8124 00004971 89C2                    	mov	edx, eax ; this is temporary interpolation value
  8125                                  	;add	ax, [previous_val]
  8126 00004973 6601D8                  	add	ax, bx
  8127 00004976 66D1D8                  	rcr	ax, 1
  8128 00004979 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8129 0000497C 66AB                    	stosw		; this is 1st interpolated sample (L)
  8130 0000497E 66AB                    	stosw		; this is 1st interpolated sample (R)
  8131 00004980 89E8                    	mov	eax, ebp
  8132 00004982 6601D0                  	add	ax, dx
  8133 00004985 66D1D8                  	rcr	ax, 1
  8134 00004988 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8135 0000498B 66AB                    	stosw		; this is 2nd interpolated sample (L)
  8136 0000498D 66AB                    	stosw		; this is 2nd interpolated sample (R)
  8137                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  8138 0000498F 09C9                    	or	ecx, ecx
  8139 00004991 75C0                    	jnz	short lff16m2_1
  8140                                  	;jmp	lff16m2_3
  8141                                  	; 17/02/2025
  8142 00004993 E953040000              	jmp	lff16_3
  8143                                  
  8144                                  ; =============== S U B R O U T I N E =======================================
  8145                                  
  8146                                  load_16khz_stereo_16_bit:
  8147                                  	; 13/01/2025 (mp3play3.s)
  8148 00004998 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8149 0000499D BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8150 000049A2 8B0D[88B20000]          	mov	ecx, [loadsize]
  8151                                  	; 13/01/2025
  8152 000049A8 C1E902                  	shr	ecx, 2	; dword count
  8153                                  lff16s2_1:
  8154 000049AB 66AD                    	lodsw
  8155 000049AD 66AB                    	stosw		; original sample (L)
  8156 000049AF 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  8157 000049B2 66A3[23510000]          	mov	[previous_val_l], ax
  8158 000049B8 66AD                    	lodsw
  8159 000049BA 66AB                    	stosw		; original sample (R)
  8160 000049BC 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  8161 000049BF 66A3[25510000]          	mov	[previous_val_r], ax
  8162 000049C5 31D2                    	xor	edx, edx
  8163 000049C7 31C0                    	xor	eax, eax
  8164                                  	; 16/11/2023
  8165 000049C9 49                      	dec	ecx
  8166 000049CA 7407                    	jz	short lff16s2_2
  8167 000049CC 668B06                  	mov	ax, [esi]
  8168 000049CF 668B5602                	mov	dx, [esi+2]
  8169                                  lff16s2_2:
  8170 000049D3 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  8171                                  	;mov	[next_val_l], ax
  8172 000049D6 89C5                    	mov	ebp, eax
  8173 000049D8 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  8174 000049DB 668915[29510000]        	mov	[next_val_r], dx
  8175 000049E2 660305[23510000]        	add	ax, [previous_val_l]
  8176 000049E9 66D1D8                  	rcr	ax, 1
  8177 000049EC 89C2                    	mov	edx, eax ; this is temporary interpolation value (L)
  8178 000049EE 660305[23510000]        	add	ax, [previous_val_l]
  8179 000049F5 66D1D8                  	rcr	ax, 1
  8180 000049F8 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  8181 000049FB 66AB                    	stosw		; this is 1st interpolated sample (L)
  8182 000049FD 66A1[29510000]          	mov	ax, [next_val_r]
  8183 00004A03 660305[25510000]        	add	ax, [previous_val_r]
  8184 00004A0A 66D1D8                  	rcr	ax, 1
  8185 00004A0D 89C3                    	mov	ebx, eax ; this is temporary interpolation value (R)
  8186 00004A0F 660305[25510000]        	add	ax, [previous_val_r]
  8187 00004A16 66D1D8                  	rcr	ax, 1
  8188 00004A19 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8189 00004A1C 66AB                    	stosw		; this is 1st interpolated sample (R)
  8190                                  	;mov	ax, [next_val_l]
  8191 00004A1E 89E8                    	mov	eax, ebp
  8192 00004A20 6601D0                  	add	ax, dx
  8193 00004A23 66D1D8                  	rcr	ax, 1
  8194 00004A26 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8195 00004A29 66AB                    	stosw		; this is 2nd interpolated sample (L)
  8196 00004A2B 66A1[29510000]          	mov	ax, [next_val_r]
  8197 00004A31 6601D8                  	add	ax, bx
  8198 00004A34 66D1D8                  	rcr	ax, 1
  8199 00004A37 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8200 00004A3A 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  8201                                  	
  8202                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  8203 00004A3C 09C9                    	or	ecx, ecx
  8204 00004A3E 0F8567FFFFFF            	jnz	lff16s2_1
  8205                                  	;jmp	lff16s2_3
  8206                                  	; 17/02/2025
  8207 00004A44 E9A2030000              	jmp	lff16_3
  8208                                  
  8209                                  ; =============== S U B R O U T I N E =======================================
  8210                                  
  8211                                  load_24khz_mono_16_bit:
  8212                                  	; 30/01/2025
  8213                                  	; 13/01/2025 (mp3play3.s)
  8214 00004A49 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8215 00004A4E BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8216 00004A53 8B0D[88B20000]          	mov	ecx, [loadsize]
  8217                                  	; 13/01/2025
  8218 00004A59 D1E9                    	shr	ecx, 1	; word count
  8219                                  lff24m2_1:
  8220 00004A5B 66AD                    	lodsw
  8221 00004A5D 66AB                    	stosw		; original sample (left channel)
  8222 00004A5F 66AB                    	stosw		; original sample (right channel)
  8223 00004A61 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  8224                                  	;mov	[previous_val], ax
  8225                                  	;mov	ebx, eax
  8226                                  	;xor	eax, eax
  8227 00004A64 31DB                    	xor	ebx, ebx
  8228 00004A66 49                      	dec	ecx
  8229 00004A67 7403                    	jz	short lff24m2_2
  8230                                  	;mov	ax, [esi]
  8231 00004A69 668B1E                  	mov	bx, [esi]
  8232                                  lff24m2_2:
  8233                                  	; 30/01/2025
  8234 00004A6C 80C780                  	add	bh, 80h ; convert sound level 0 to 65535 format
  8235                                  	;add	ah, 80h
  8236                                  	;mov	ebp, eax	; [next_val]
  8237                                  	;add	ax, [previous_val]
  8238                                  	; ax = [previous_val]
  8239                                  	; bx = [next_val]
  8240 00004A6F 6601D8                  	add	ax, bx
  8241 00004A72 66D1D8                  	rcr	ax, 1
  8242 00004A75 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8243 00004A78 66AB                    	stosw		; this is interpolated sample (L)
  8244 00004A7A 66AB                    	stosw		; this is interpolated sample (R)
  8245                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  8246 00004A7C 09C9                    	or	ecx, ecx
  8247 00004A7E 75DB                    	jnz	short lff24m2_1
  8248 00004A80 E966030000              	jmp	lff24_3
  8249                                  
  8250                                  ; =============== S U B R O U T I N E =======================================
  8251                                  
  8252                                  load_24khz_stereo_16_bit:
  8253                                  	; 13/01/2025 (mp3play3.s)
  8254 00004A85 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8255 00004A8A BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8256 00004A8F 8B0D[88B20000]          	mov	ecx, [loadsize]
  8257                                  	; 13/01/2025
  8258 00004A95 C1E902                  	shr	ecx, 2	; dword count
  8259                                  lff24s2_1:
  8260 00004A98 66AD                    	lodsw
  8261 00004A9A 66AB                    	stosw		; original sample (L)
  8262 00004A9C 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  8263 00004A9F 66A3[23510000]          	mov	[previous_val_l], ax
  8264 00004AA5 66AD                    	lodsw
  8265 00004AA7 66AB                    	stosw		; original sample (R)
  8266 00004AA9 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  8267                                  	;mov	[previous_val_r], ax
  8268 00004AAC 89C3                    	mov	ebx, eax
  8269 00004AAE 31D2                    	xor	edx, edx
  8270 00004AB0 31C0                    	xor	eax, eax
  8271                                  	; 16/11/2023
  8272 00004AB2 49                      	dec	ecx
  8273 00004AB3 7407                    	jz	short lff24s2_2
  8274 00004AB5 668B06                  	mov	ax, [esi]
  8275 00004AB8 668B5602                	mov	dx, [esi+2]
  8276                                  lff24s2_2:
  8277 00004ABC 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  8278                                  	;;mov	[next_val_l], ax
  8279                                  	;mov	ebp, eax
  8280 00004ABF 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  8281                                  	;mov	[next_val_r], dx
  8282 00004AC2 660305[23510000]        	add	ax, [previous_val_l]
  8283 00004AC9 66D1D8                  	rcr	ax, 1
  8284 00004ACC 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  8285 00004ACF 66AB                    	stosw		; this is interpolated sample (L)
  8286                                  	;mov	ax, [next_val_r]
  8287 00004AD1 89D0                    	mov	eax, edx
  8288                                  	;add	ax, [previous_val_r]
  8289 00004AD3 6601D8                  	add	ax, bx
  8290 00004AD6 66D1D8                  	rcr	ax, 1
  8291 00004AD9 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8292 00004ADC 66AB                    	stosw		; this is interpolated sample (R)
  8293                                  	
  8294                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  8295 00004ADE 09C9                    	or	ecx, ecx
  8296 00004AE0 75B6                    	jnz	short lff24s2_1
  8297 00004AE2 E904030000              	jmp	lff24_3
  8298                                  
  8299                                  ; =============== S U B R O U T I N E =======================================
  8300                                  
  8301                                  load_32khz_mono_16_bit:
  8302                                  	; 13/01/2025 (mp3play3.s)
  8303 00004AE7 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8304 00004AEC BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8305 00004AF1 8B0D[88B20000]          	mov	ecx, [loadsize]
  8306                                  	; 13/01/2025
  8307 00004AF7 D1E9                    	shr	ecx, 1	; word count
  8308                                  lff32m2_1:
  8309 00004AF9 66AD                    	lodsw
  8310 00004AFB 66AB                    	stosw		; original sample (left channel)
  8311 00004AFD 66AB                    	stosw		; original sample (right channel)
  8312 00004AFF 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  8313                                  	;mov	[previous_val], ax
  8314                                  	;mov	ebx, eax
  8315                                  	;xor	eax, eax
  8316 00004B02 31DB                    	xor	ebx, ebx
  8317 00004B04 49                      	dec	ecx
  8318 00004B05 7403                    	jz	short lff32m2_2
  8319                                  	;mov	ax, [esi]
  8320 00004B07 668B1E                  	mov	bx, [esi]
  8321                                  lff32m2_2:
  8322                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  8323                                  	;mov	ebp, eax	; [next_val]
  8324                                  	;add	ax, [previous_val]
  8325                                  	; ax = [previous_val]
  8326                                  	; bx = [next_val]
  8327 00004B0A 6601D8                  	add	ax, bx
  8328 00004B0D 66D1D8                  	rcr	ax, 1
  8329 00004B10 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8330 00004B13 66AB                    	stosw		; this is interpolated sample (L)
  8331 00004B15 66AB                    	stosw		; this is interpolated sample (R)
  8332                                  
  8333                                  	; different than 8-16-24 kHZ !
  8334                                  	; 'original-interpolated-original' trio samples 
  8335 00004B17 E309                    	jecxz	lff32m2_3
  8336                                  
  8337 00004B19 66AD                    	lodsw
  8338 00004B1B 66AB                    	stosw		; original sample (left channel)
  8339 00004B1D 66AB                    	stosw		; original sample (right channel)
  8340                                  
  8341                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  8342 00004B1F 49                      	dec	ecx
  8343 00004B20 75D7                    	jnz	short lff32m2_1
  8344                                  lff32m2_3:
  8345 00004B22 E9C4020000              	jmp	lff32_3
  8346                                  
  8347                                  ; =============== S U B R O U T I N E =======================================
  8348                                  
  8349                                  load_32khz_stereo_16_bit:
  8350                                  	; 13/01/2025 (mp3play3.s)
  8351 00004B27 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8352 00004B2C BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8353 00004B31 8B0D[88B20000]          	mov	ecx, [loadsize]
  8354                                  	; 13/01/2025
  8355 00004B37 C1E902                  	shr	ecx, 2	; dword count
  8356                                  lff32s2_1:
  8357 00004B3A 66AD                    	lodsw
  8358 00004B3C 66AB                    	stosw		; original sample (L)
  8359 00004B3E 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  8360 00004B41 66A3[23510000]          	mov	[previous_val_l], ax
  8361 00004B47 66AD                    	lodsw
  8362 00004B49 66AB                    	stosw		; original sample (R)
  8363 00004B4B 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  8364                                  	;mov	[previous_val_r], ax
  8365 00004B4E 89C3                    	mov	ebx, eax
  8366 00004B50 31D2                    	xor	edx, edx
  8367 00004B52 31C0                    	xor	eax, eax
  8368                                  	; 16/11/2023
  8369 00004B54 49                      	dec	ecx
  8370 00004B55 7407                    	jz	short lff32s2_2
  8371 00004B57 668B06                  	mov	ax, [esi]
  8372 00004B5A 668B5602                	mov	dx, [esi+2]
  8373                                  lff32s2_2:
  8374 00004B5E 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  8375                                  	;;mov	[next_val_l], ax
  8376                                  	;mov	ebp, eax
  8377 00004B61 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  8378                                  	;mov	[next_val_r], dx
  8379 00004B64 660305[23510000]        	add	ax, [previous_val_l]
  8380 00004B6B 66D1D8                  	rcr	ax, 1
  8381 00004B6E 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  8382 00004B71 66AB                    	stosw		; this is interpolated sample (L)
  8383                                  	;mov	ax, [next_val_r]
  8384 00004B73 89D0                    	mov	eax, edx
  8385                                  	;add	ax, [previous_val_r]
  8386 00004B75 6601D8                  	add	ax, bx
  8387 00004B78 66D1D8                  	rcr	ax, 1
  8388 00004B7B 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8389 00004B7E 66AB                    	stosw		; this is interpolated sample (R)
  8390                                  
  8391                                  	; different than 8-16-24 kHZ !
  8392                                  	; 'original-interpolated-original' trio samples
  8393 00004B80 E30B                    	jecxz	lff32s2_3
  8394                                  
  8395 00004B82 66AD                    	lodsw
  8396 00004B84 66AB                    	stosw	; original sample (L)
  8397 00004B86 66AD                    	lodsw
  8398 00004B88 66AB                    	stosw	; original sample (R)
  8399                                  	
  8400                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  8401 00004B8A 49                      	dec	ecx
  8402 00004B8B 75AD                    	jnz	short lff32s2_1
  8403                                  lff32s2_3:
  8404 00004B8D E959020000              	jmp	lff32_3
  8405                                  
  8406                                  ; =============== S U B R O U T I N E =======================================
  8407                                  
  8408                                  load_22khz_mono_16_bit:
  8409                                  	; 13/01/2025 (mp3play3.s)
  8410 00004B92 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8411 00004B97 BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8412 00004B9C 8B0D[88B20000]          	mov	ecx, [loadsize]
  8413                                  	; 13/01/2025
  8414 00004BA2 D1E9                    	shr	ecx, 1	; word count
  8415                                  lff22m2_9:
  8416 00004BA4 BD05000000              	mov	ebp, 5	; interpolation (one step) loop count
  8417 00004BA9 C605[2B510000]03        	mov	byte [faz], 3  ; 3 steps/phases
  8418                                  lff22m2_1:
  8419                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  8420 00004BB0 66AD                    	lodsw
  8421 00004BB2 31D2                    	xor	edx, edx
  8422 00004BB4 49                      	dec	ecx
  8423 00004BB5 7403                    	jz	short lff22m2_2_1
  8424 00004BB7 668B16                  	mov	dx, [esi]
  8425                                  lff22m2_2_1:	
  8426                                  	; ax = [previous_val]
  8427                                  	; dx = [next_val]
  8428 00004BBA E8AA020000              	call	interpolating_3_16bit_mono ; 1 of 17
  8429 00004BBF E32F                    	jecxz	lff22m2_3
  8430                                  lff22m2_2_2:
  8431 00004BC1 66AD                    	lodsw
  8432 00004BC3 31D2                    	xor	edx, edx
  8433 00004BC5 49                      	dec	ecx
  8434 00004BC6 7403                    	jz	short lff22m2_2_3
  8435 00004BC8 668B16                  	mov	dx, [esi]
  8436                                  lff22m2_2_3:
  8437 00004BCB E82C030000               	call	interpolating_2_16bit_mono ; 2 of 17 .. 6 of 17
  8438 00004BD0 E31E                    	jecxz	lff22m2_3
  8439 00004BD2 4D                      	dec	ebp
  8440 00004BD3 75EC                    	jnz	short lff22m2_2_2
  8441                                  
  8442 00004BD5 A0[2B510000]            	mov	al, [faz]
  8443 00004BDA FEC8                    	dec	al
  8444 00004BDC 74C6                    	jz	short lff22m2_9
  8445 00004BDE FE0D[2B510000]          	dec	byte [faz]
  8446 00004BE4 BD04000000              	mov	ebp, 4
  8447 00004BE9 FEC8                    	dec	al
  8448 00004BEB 75C3                    	jnz	short lff22m2_1 ; 3:2:2:2:2 ; 7-11 of 17
  8449 00004BED 45                      	inc	ebp ; 5
  8450 00004BEE EBC0                    	jmp	short lff22m2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  8451                                  
  8452                                  lff22m2_3:
  8453                                  lff22s2_3:
  8454 00004BF0 E9F6010000              	jmp	lff22_3	; padfill
  8455                                  		; (put zeros in the remain words of the buffer)
  8456                                  
  8457                                  ; =============== S U B R O U T I N E =======================================
  8458                                  
  8459                                  load_22khz_stereo_16_bit:
  8460                                  	; 13/01/2025 (mp3play3.s)
  8461 00004BF5 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8462 00004BFA BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8463 00004BFF 8B0D[88B20000]          	mov	ecx, [loadsize]
  8464                                  	; 13/01/2025
  8465 00004C05 C1E902                  	shr	ecx, 2	; dword count
  8466                                  lff22s2_9:
  8467 00004C08 BD05000000              	mov	ebp, 5	; interpolation (one step) loop count
  8468 00004C0D C605[2B510000]03        	mov	byte [faz], 3  ; 3 steps/phase
  8469                                  lff22s2_1:
  8470                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  8471 00004C14 66AD                    	lodsw
  8472 00004C16 89C3                    	mov	ebx, eax
  8473 00004C18 66AD                    	lodsw
  8474 00004C1A 8B16                    	mov	edx, [esi]
  8475 00004C1C 668915[27510000]        	mov	[next_val_l], dx
  8476                                  	; 26/11/2023
  8477 00004C23 C1EA10                  	shr	edx, 16
  8478 00004C26 49                      	dec	ecx
  8479 00004C27 7509                    	jnz	short lff22s2_2_1
  8480 00004C29 31D2                    	xor	edx, edx ; 0
  8481 00004C2B 668915[27510000]        	mov	[next_val_l], dx
  8482                                  lff22s2_2_1:
  8483                                  	; bx = [previous_val_l]
  8484                                  	; ax = [previous_val_r]
  8485                                  	; [next_val_l]
  8486                                  	; dx = [next_val_r]
  8487 00004C32 E862020000              	call	interpolating_3_16bit_stereo ; 1 of 17 
  8488 00004C37 E3B7                    	jecxz	lff22s2_3
  8489                                  lff22s2_2_2:
  8490 00004C39 66AD                    	lodsw
  8491 00004C3B 89C3                    	mov	ebx, eax
  8492 00004C3D 66AD                    	lodsw
  8493 00004C3F 8B16                    	mov	edx, [esi]
  8494 00004C41 668915[27510000]        	mov	[next_val_l], dx
  8495                                  	; 26/11/2023
  8496 00004C48 C1EA10                  	shr	edx, 16
  8497 00004C4B 49                      	dec	ecx
  8498 00004C4C 7509                    	jnz	short lff22s2_2_3
  8499 00004C4E 31D2                    	xor	edx, edx ; 0
  8500 00004C50 668915[27510000]        	mov	[next_val_l], dx
  8501                                  lff22s2_2_3:
  8502 00004C57 E8B8020000               	call	interpolating_2_16bit_stereo ; 2 of 17 .. 6 of 17
  8503 00004C5C E31E                    	jecxz	lff22s2_2_4
  8504                                  
  8505 00004C5E 4D                      	dec	ebp
  8506 00004C5F 75D8                    	jnz	short lff22s2_2_2
  8507                                  
  8508 00004C61 A0[2B510000]            	mov	al, [faz]
  8509 00004C66 FEC8                    	dec	al
  8510 00004C68 749E                    	jz	short lff22s2_9
  8511 00004C6A FE0D[2B510000]          	dec	byte [faz]
  8512 00004C70 BD04000000              	mov	ebp, 4
  8513 00004C75 FEC8                    	dec	al
  8514 00004C77 759B                    	jnz	short lff22s2_1 ; 3:2:2:2:2 ; 7-11 of 17
  8515 00004C79 45                      	inc	ebp ; 5
  8516 00004C7A EB98                    	jmp	short lff22s2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  8517                                  
  8518                                  lff22s2_2_4:
  8519                                  	; 26/11/2023
  8520 00004C7C E96A010000              	jmp	lff22_3	; padfill
  8521                                  
  8522                                  ; =============== S U B R O U T I N E =======================================
  8523                                  
  8524                                  load_11khz_mono_16_bit:
  8525                                  	; 13/01/2025 (mp3play3.s)
  8526 00004C81 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8527 00004C86 BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8528 00004C8B 8B0D[88B20000]          	mov	ecx, [loadsize]
  8529                                  	; 13/01/2025
  8530 00004C91 D1E9                    	shr	ecx, 1	; word count
  8531                                  lff11m2_9:
  8532 00004C93 BD06000000              	mov	ebp, 6	; interpolation (one step) loop count
  8533                                  lff11m2_1:
  8534                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  8535 00004C98 66AD                    	lodsw
  8536 00004C9A 31D2                    	xor	edx, edx
  8537 00004C9C 49                      	dec	ecx
  8538 00004C9D 7403                    	jz	short lff11m2_2_1
  8539 00004C9F 668B16                  	mov	dx, [esi]
  8540                                  lff11m2_2_1:	
  8541                                  	; ax = [previous_val]
  8542                                  	; dx = [next_val]
  8543 00004CA2 E89C020000              	call	interpolating_5_16bit_mono
  8544 00004CA7 E327                    	jecxz	lff11m2_3
  8545                                  lff11m2_2_2:
  8546 00004CA9 66AD                    	lodsw
  8547 00004CAB 31D2                    	xor	edx, edx
  8548 00004CAD 49                      	dec	ecx
  8549 00004CAE 7403                    	jz	short lff11m2_2_3
  8550 00004CB0 668B16                  	mov	dx, [esi]
  8551                                  lff11m2_2_3:
  8552 00004CB3 E8B5030000               	call	interpolating_4_16bit_mono
  8553 00004CB8 E316                    	jecxz	lff11m2_3
  8554                                  
  8555 00004CBA 4D                      	dec	ebp
  8556 00004CBB 74D6                    	jz	short lff11m2_9
  8557                                  
  8558 00004CBD 66AD                    	lodsw
  8559 00004CBF 31D2                    	xor	edx, edx
  8560 00004CC1 49                      	dec	ecx
  8561 00004CC2 7403                    	jz	short lff11m2_2_4
  8562 00004CC4 668B16                  	mov	dx, [esi]
  8563                                  lff11m2_2_4:
  8564 00004CC7 E8A1030000               	call	interpolating_4_16bit_mono
  8565 00004CCC E302                    	jecxz	lff11m2_3
  8566 00004CCE EBC8                    	jmp	short lff11m2_1
  8567                                  
  8568                                  lff11m2_3:
  8569 00004CD0 E916010000              	jmp	lff11_3	; padfill
  8570                                  		; (put zeros in the remain words of the buffer)
  8571                                  
  8572                                  ; =============== S U B R O U T I N E =======================================
  8573                                  
  8574                                  load_11khz_stereo_16_bit:
  8575                                  	; 13/01/2025 (mp3play3.s)
  8576 00004CD5 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8577 00004CDA BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8578 00004CDF 8B0D[88B20000]          	mov	ecx, [loadsize]
  8579                                  	; 13/01/2025
  8580 00004CE5 C1E902                  	shr	ecx, 2	; dword count
  8581                                  lff11s2_9:
  8582 00004CE8 BD06000000              	mov	ebp, 6	; interpolation (one step) loop count
  8583                                  lff11s2_1:
  8584                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  8585 00004CED 66AD                    	lodsw
  8586 00004CEF 89C3                    	mov	ebx, eax
  8587 00004CF1 66AD                    	lodsw
  8588 00004CF3 8B16                    	mov	edx, [esi]
  8589                                  	; 15/01/2025
  8590                                  	;mov	[next_val_l], edx
  8591                                  	; 26/11/2023
  8592                                  	;shr	edx, 16
  8593                                  	;mov	[next_val_r], dx
  8594 00004CF5 49                      	dec	ecx
  8595 00004CF6 7502                    	jnz	short lff11s2_2_1
  8596 00004CF8 31D2                    	xor	edx, edx ; 0
  8597                                  	;mov	[next_val_l], dx
  8598                                  	;mov	[next_val_r], dx
  8599                                  lff11s2_2_1:
  8600                                  	; bx = [previous_val_l]
  8601                                  	; ax = [previous_val_r]
  8602                                  	; [next_val_l]
  8603                                  	; dx = [next_val_r]
  8604                                  	;;;
  8605                                  	; 15/01/2025 (BugFix)
  8606 00004CFA 8915[27510000]          	mov	[next_val_l], edx
  8607                                  	;;;
  8608 00004D00 E899020000              	call	interpolating_5_16bit_stereo
  8609 00004D05 E339                    	jecxz	lff11s2_3
  8610                                  lff11s2_2_2:
  8611 00004D07 66AD                    	lodsw
  8612 00004D09 89C3                    	mov	ebx, eax
  8613 00004D0B 66AD                    	lodsw
  8614 00004D0D 8B16                    	mov	edx, [esi]
  8615                                  	; 15/01/2025
  8616                                  	;mov	[next_val_l], dx
  8617                                  	; 26/11/2023
  8618                                  	;shr	edx, 16
  8619                                  	;mov	[next_val_r], dx
  8620 00004D0F 49                      	dec	ecx
  8621 00004D10 7502                    	jnz	short lff11s2_2_3
  8622 00004D12 31D2                    	xor	edx, edx ; 0
  8623                                  	;mov	[next_val_l], dx
  8624                                  	;mov	[next_val_r], dx
  8625                                  lff11s2_2_3:
  8626                                  	;;;
  8627                                  	; 15/01/2025 (BugFix)
  8628 00004D14 8915[27510000]          	mov	[next_val_l], edx
  8629                                  	;;;
  8630 00004D1A E887030000              	call	interpolating_4_16bit_stereo
  8631 00004D1F E31F                    	jecxz	lff11s2_3
  8632                                  	
  8633 00004D21 4D                      	dec	ebp
  8634 00004D22 74C4                    	jz	short lff11s2_9
  8635                                  
  8636 00004D24 66AD                    	lodsw
  8637 00004D26 89C3                    	mov	ebx, eax
  8638 00004D28 66AD                    	lodsw
  8639 00004D2A 8B16                    	mov	edx, [esi]
  8640                                  	; 15/01/2025
  8641                                  	;mov	[next_val_l], dx
  8642                                  	; 26/11/2023
  8643                                  	;shr	edx, 16
  8644                                  	;mov	[next_val_r], dx
  8645 00004D2C 49                      	dec	ecx
  8646 00004D2D 7502                    	jnz	short lff11s2_2_4
  8647 00004D2F 31D2                    	xor	edx, edx ; 0
  8648                                  	;mov	[next_val_l], dx
  8649                                  	;mov	[next_val_r], dx
  8650                                  lff11s2_2_4:
  8651                                  	;;;
  8652                                  	; 15/01/2025 (BugFix)
  8653 00004D31 8915[27510000]          	mov	[next_val_l], edx
  8654                                  	;;;
  8655 00004D37 E86A030000               	call	interpolating_4_16bit_stereo
  8656 00004D3C E302                    	jecxz	lff11s2_3
  8657 00004D3E EBAD                    	jmp	short lff11s2_1
  8658                                  
  8659                                  lff11s2_3:
  8660 00004D40 E9A6000000              	jmp	lff11_3	; padfill
  8661                                  		; (put zeros in the remain words of the buffer)
  8662                                  
  8663                                  ; =============== S U B R O U T I N E =======================================
  8664                                  
  8665                                  load_44khz_mono_16_bit:
  8666                                  	; 13/01/2025 (mp3play3.s)
  8667 00004D45 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8668 00004D4A BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8669 00004D4F 8B0D[88B20000]          	mov	ecx, [loadsize]
  8670                                  	; 13/01/2025
  8671 00004D55 D1E9                    	shr	ecx, 1	; word count
  8672                                  lff44m2_9:
  8673 00004D57 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  8674 00004D5C C605[2B510000]02        	mov	byte [faz], 2  ; 2 steps/phases
  8675                                  lff44m2_1:
  8676                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  8677                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  8678 00004D63 66AD                    	lodsw
  8679 00004D65 31D2                    	xor	edx, edx
  8680 00004D67 49                      	dec	ecx
  8681 00004D68 7403                    	jz	short lff44m2_2_1
  8682 00004D6A 668B16                  	mov	dx, [esi]
  8683                                  lff44m2_2_1:	
  8684                                  	; ax = [previous_val]
  8685                                  	; dx = [next_val]
  8686 00004D6D E88A010000              	call	interpolating_2_16bit_mono
  8687 00004D72 E31B                    	jecxz	lff44m2_3
  8688                                  lff44m2_2_2:
  8689 00004D74 66AD                    	lodsw
  8690 00004D76 66AB                    	stosw		; (L)eft Channel
  8691 00004D78 66AB                    	stosw		; (R)ight Channel
  8692                                  
  8693 00004D7A 49                      	dec	ecx
  8694 00004D7B 7412                    	jz	short lff44m2_3	
  8695 00004D7D 4D                      	dec	ebp
  8696 00004D7E 75F4                    	jnz	short lff44m2_2_2
  8697                                  	
  8698 00004D80 FE0D[2B510000]          	dec	byte [faz]
  8699 00004D86 74CF                    	jz	short lff44m2_9 
  8700 00004D88 BD0B000000              	mov	ebp, 11
  8701 00004D8D EBD4                    	jmp	short lff44m2_1
  8702                                  
  8703                                  lff44m2_3:
  8704                                  lff44s2_3:
  8705 00004D8F EB5A                    	jmp	short lff44_3 ; padfill
  8706                                  		; (put zeros in the remain words of the buffer)
  8707                                  
  8708                                  ; =============== S U B R O U T I N E =======================================
  8709                                  
  8710                                  load_44khz_stereo_16_bit:
  8711                                  	; 13/01/2025 (mp3play3.s)
  8712 00004D91 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8713 00004D96 BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8714 00004D9B 8B0D[88B20000]          	mov	ecx, [loadsize]
  8715                                  	; 13/01/2025
  8716 00004DA1 C1E902                  	shr	ecx, 2	; dword count
  8717                                  lff44s2_9:
  8718 00004DA4 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  8719 00004DA9 C605[2B510000]02        	mov	byte [faz], 2  ; 2 steps/phase
  8720                                  lff44s2_1:
  8721                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  8722                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  8723 00004DB0 66AD                    	lodsw
  8724 00004DB2 89C3                    	mov	ebx, eax
  8725 00004DB4 66AD                    	lodsw
  8726                                  	;mov	dx, [esi]
  8727                                  	;mov	[next_val_l], dx
  8728                                  	;mov	dx, [esi+2]
  8729                                  	; 26/11/2023
  8730 00004DB6 8B16                    	mov	edx, [esi]
  8731 00004DB8 668915[27510000]        	mov	[next_val_l], dx
  8732 00004DBF C1EA10                  	shr	edx, 16
  8733 00004DC2 49                      	dec	ecx
  8734 00004DC3 7509                    	jnz	short lff44s2_2_1
  8735 00004DC5 31D2                    	xor	edx, edx ; 0
  8736 00004DC7 668915[27510000]        	mov	[next_val_l], dx
  8737                                  lff44s2_2_1:
  8738                                  	; bx = [previous_val_l]
  8739                                  	; ax = [previous_val_r]
  8740                                  	; [next_val_l]
  8741                                  	; dx = [next_val_r]
  8742 00004DCE E841010000              	call	interpolating_2_16bit_stereo
  8743 00004DD3 E3BA                    	jecxz	lff44s2_3
  8744                                  lff44s2_2_2:
  8745                                  	;movsw		; (L)eft Channel
  8746                                  	;movsw		; (R)ight Channel
  8747 00004DD5 A5                      	movsd
  8748                                  
  8749 00004DD6 49                      	dec	ecx
  8750                                  	;jz	short lff44s2_3
  8751                                  	; 17/02/2025
  8752 00004DD7 7412                    	jz	short lff44_3
  8753 00004DD9 4D                      	dec	ebp
  8754 00004DDA 75F9                    	jnz	short lff44s2_2_2
  8755                                  	
  8756 00004DDC FE0D[2B510000]          	dec	byte [faz]
  8757 00004DE2 74C0                    	jz	short lff44s2_9 
  8758 00004DE4 BD0B000000              	mov	ebp, 11
  8759 00004DE9 EBC5                    	jmp	short lff44s2_1
  8760                                  
  8761                                  
  8762                                  ; ---------------------------------------------------------------------------
  8763                                  
  8764                                  	; 17/02/2025
  8765                                  ; padfill
  8766                                  	; (put zeros in the remain words of the buffer)
  8767                                  lff44_3:
  8768                                  lff32_3:
  8769                                  lff24_3:
  8770                                  lff22_3:
  8771                                  lff16_3:
  8772                                  lff12_3:
  8773                                  lff11_3:
  8774                                  lff8_3: 
  8775                                  	; 17/02/2025
  8776 00004DEB 8B0D[7CB20000]          	mov	ecx, [buffer_size] ; 16 bit (48 kHZ, stereo) samples
  8777 00004DF1 81C1[00800500]          	add	ecx, sample_buffer
  8778 00004DF7 29F9                    	sub	ecx, edi
  8779 00004DF9 7609                    	jna	short lff44_4 ; jbe
  8780 00004DFB 29F9                    	sub	ecx, edi
  8781                                  	;inc	ecx
  8782 00004DFD C1E902                  	shr	ecx, 2
  8783 00004E00 31C0                    	xor	eax, eax ; fill (remain part of) buffer with zeros
  8784 00004E02 F3AB                    	rep	stosd
  8785                                  lff44_4:
  8786 00004E04 C3                      	retn
  8787                                  
  8788                                  ; =============== S U B R O U T I N E =======================================
  8789                                  
  8790                                  	; 01/02/2025
  8791                                  load_12khz_mono_16_bit:
  8792 00004E05 BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8793 00004E0A BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8794 00004E0F 8B0D[88B20000]          	mov	ecx, [loadsize]
  8795 00004E15 D1E9                    	shr	ecx, 1	; word count
  8796                                  lff12m2_9:
  8797 00004E17 BD06000000              	mov	ebp, 6	; interpolation (one step) loop count
  8798                                  lff12m2_1:
  8799                                  	; original-interpolated-interpolated-interpolated
  8800 00004E1C 66AD                    	lodsw
  8801 00004E1E 31D2                    	xor	edx, edx
  8802 00004E20 49                      	dec	ecx
  8803 00004E21 7403                    	jz	short lff12m2_2
  8804 00004E23 668B16                  	mov	dx, [esi]
  8805                                  lff12m2_2:	
  8806                                  	; ax = [previous_val]
  8807                                  	; dx = [next_val]
  8808 00004E26 E842020000               	call	interpolating_4_16bit_mono
  8809 00004E2B E3BE                    	jecxz	lff12_3	; 17/02/2025
  8810 00004E2D EBED                    	jmp	short lff12m2_1
  8811                                  
  8812                                  ; =============== S U B R O U T I N E =======================================
  8813                                  
  8814                                  	; 01/02/2025
  8815                                  load_12khz_stereo_16_bit:
  8816 00004E2F BE[00600500]            	mov	esi, decoding_buffer ; (contains 8bit stereo samples)
  8817 00004E34 BF[00800500]            	mov	edi, sample_buffer ; wav output buffer
  8818 00004E39 8B0D[88B20000]          	mov	ecx, [loadsize]
  8819 00004E3F C1E902                  	shr	ecx, 2	; dword count
  8820                                  lff12s2_1:
  8821                                  	; original-interpolated-interpolated-interpolated
  8822 00004E42 66AD                    	lodsw
  8823 00004E44 89C3                    	mov	ebx, eax
  8824 00004E46 66AD                    	lodsw
  8825 00004E48 8B16                    	mov	edx, [esi]
  8826 00004E4A 49                      	dec	ecx
  8827 00004E4B 7502                    	jnz	short lff12s2_2
  8828 00004E4D 31D2                    	xor	edx, edx ; 0
  8829                                  lff12s2_2:
  8830 00004E4F 668915[27510000]        	mov	[next_val_l], dx
  8831 00004E56 C1EA10                  	shr	edx, 16
  8832 00004E59 668915[29510000]        	mov	[next_val_r], dx
  8833                                  	; bx = [previous_val_l]
  8834                                  	; ax = [previous_val_r]
  8835                                  	; [next_val_l]
  8836                                  	; [next_val_r]
  8837 00004E60 E841020000              	call	interpolating_4_16bit_stereo
  8838 00004E65 E384                    	jecxz	lff12_3	; 17/02/2025
  8839 00004E67 EBD9                    	jmp	short lff12s2_1
  8840                                  
  8841                                  ; =============== S U B R O U T I N E =======================================
  8842                                  
  8843                                  interpolating_3_16bit_mono:
  8844                                  	; 16/11/2023
  8845                                  	; ax = [previous_val]
  8846                                  	; dx = [next_val]
  8847                                  	; original-interpolated-interpolated
  8848                                  
  8849 00004E69 66AB                    	stosw		; original sample (L)
  8850 00004E6B 66AB                    	stosw		; original sample (R)
  8851 00004E6D 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  8852 00004E70 50                      	push	eax ; *	; [previous_val]
  8853 00004E71 80C680                  	add	dh, 80h
  8854 00004E74 6601D0                  	add	ax, dx
  8855 00004E77 66D1D8                  	rcr	ax, 1
  8856 00004E7A 5B                      	pop	ebx ; *
  8857 00004E7B 93                      	xchg	ebx, eax ; bx  = interpolated middle (temporary)
  8858 00004E7C 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  8859 00004E7F 66D1D8                  	rcr	ax, 1
  8860 00004E82 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8861 00004E85 66AB                    	stosw 		; interpolated sample 1 (L)
  8862 00004E87 66AB                    	stosw		; interpolated sample 1 (R)
  8863 00004E89 89D8                    	mov	eax, ebx
  8864 00004E8B 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  8865 00004E8E 66D1D8                  	rcr	ax, 1
  8866 00004E91 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8867 00004E94 66AB                    	stosw		; interpolated sample 2 (L)
  8868 00004E96 66AB                    	stosw		; interpolated sample 2 (R)
  8869 00004E98 C3                      	retn
  8870                                  
  8871                                  ; =============== S U B R O U T I N E =======================================
  8872                                  
  8873                                  interpolating_3_16bit_stereo:
  8874                                  	; 16/11/2023
  8875                                  	; bx = [previous_val_l]
  8876                                  	; ax = [previous_val_r]
  8877                                  	; [next_val_l]
  8878                                  	; dx = [next_val_r]
  8879                                  	; original-interpolated-interpolated
  8880                                  
  8881 00004E99 93                      	xchg	eax, ebx
  8882 00004E9A 66AB                    	stosw		; original sample (L)
  8883 00004E9C 93                      	xchg	eax, ebx
  8884 00004E9D 66AB                    	stosw		; original sample (R)
  8885 00004E9F 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  8886 00004EA2 50                      	push	eax ; *	; [previous_val_r]
  8887 00004EA3 80C780                  	add	bh, 80h
  8888 00004EA6 8005[28510000]80        	add	byte [next_val_l+1], 80h
  8889 00004EAD 66A1[27510000]          	mov	ax, [next_val_l]
  8890 00004EB3 6601D8                  	add	ax, bx	; [previous_val_l]
  8891 00004EB6 66D1D8                  	rcr	ax, 1
  8892 00004EB9 93                      	xchg	eax, ebx ; ax = [previous_val_l]
  8893 00004EBA 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  8894 00004EBD 66D1D8                  	rcr	ax, 1
  8895 00004EC0 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8896 00004EC3 66AB                    	stosw 		; interpolated sample 1 (L)
  8897 00004EC5 58                      	pop	eax  ; *
  8898 00004EC6 80C680                  	add	dh, 80h ; convert sound level 0 to 65535 format
  8899 00004EC9 52                      	push	edx  ; * ; [next_val_r]
  8900 00004ECA 92                      	xchg	eax, edx
  8901 00004ECB 6601D0                  	add	ax, dx	; [next_val_r] + [previous_val_r]
  8902 00004ECE 66D1D8                  	rcr	ax, 1	; / 2
  8903 00004ED1 50                      	push	eax ; ** ; interpolated middle (R)
  8904 00004ED2 6601D0                  	add	ax, dx	; + [previous_val_r]
  8905 00004ED5 66D1D8                  	rcr	ax, 1
  8906 00004ED8 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8907 00004EDB 66AB                    	stosw 		; interpolated sample 1 (R)
  8908 00004EDD 66A1[27510000]          	mov	ax, [next_val_l]
  8909 00004EE3 6601D8                  	add	ax, bx	; + interpolated middle (L)
  8910 00004EE6 66D1D8                  	rcr	ax, 1
  8911 00004EE9 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8912 00004EEC 66AB                    	stosw 		; interpolated sample 2 (L)
  8913 00004EEE 58                      	pop	eax ; **
  8914 00004EEF 5A                      	pop	edx ; *
  8915 00004EF0 6601D0                  	add	ax, dx	; interpolated middle + [next_val_r]
  8916 00004EF3 66D1D8                  	rcr	ax, 1	; / 2
  8917 00004EF6 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8918 00004EF9 66AB                    	stosw 		; interpolated sample 2 (L)
  8919 00004EFB C3                      	retn
  8920                                  
  8921                                  ; =============== S U B R O U T I N E =======================================
  8922                                  
  8923                                  interpolating_2_16bit_mono:
  8924                                  	; 16/11/2023
  8925                                  	; ax = [previous_val]
  8926                                  	; dx = [next_val]
  8927                                  	; original-interpolated
  8928                                  
  8929 00004EFC 66AB                    	stosw		; original sample (L)
  8930 00004EFE 66AB                    	stosw		; original sample (R)
  8931 00004F00 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  8932 00004F03 80C680                  	add	dh, 80h
  8933 00004F06 6601D0                  	add	ax, dx
  8934 00004F09 66D1D8                  	rcr	ax, 1
  8935 00004F0C 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8936 00004F0F 66AB                    	stosw		; interpolated sample (L)
  8937 00004F11 66AB                    	stosw		; interpolated sample (R)
  8938 00004F13 C3                      	retn
  8939                                  
  8940                                  ; =============== S U B R O U T I N E =======================================
  8941                                  
  8942                                  interpolating_2_16bit_stereo:
  8943                                  	; 16/11/2023
  8944                                  	; bx = [previous_val_l]
  8945                                  	; ax = [previous_val_r]
  8946                                  	; [next_val_l]
  8947                                  	; dx = [next_val_r]
  8948                                  	; original-interpolated
  8949                                  
  8950 00004F14 93                      	xchg	eax, ebx
  8951 00004F15 66AB                    	stosw		; original sample (L)
  8952 00004F17 93                      	xchg	eax, ebx
  8953 00004F18 66AB                    	stosw		; original sample (R)
  8954 00004F1A 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  8955 00004F1D 80C680                  	add	dh, 80h
  8956 00004F20 6601D0                  	add	ax, dx	; [previous_val_r] + [next_val_r]
  8957 00004F23 66D1D8                  	rcr	ax, 1	; / 2
  8958                                  	; 14/01/2025
  8959 00004F26 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8960                                  	;push	eax ; *	; interpolated sample (R)
  8961                                  	; 14/01/2025
  8962 00004F29 C1E010                  	shl	eax, 16
  8963 00004F2C 66A1[27510000]          	mov	ax, [next_val_l]
  8964 00004F32 80C480                  	add	ah, 80h
  8965 00004F35 80C780                  	add	bh, 80h
  8966 00004F38 6601D8                  	add	ax, bx	; [next_val_l] + [previous_val_l]
  8967 00004F3B 66D1D8                  	rcr	ax, 1	; / 2
  8968 00004F3E 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8969                                  	; 14/01/2025
  8970                                  	;stosw 		; interpolated sample (L)
  8971                                  	;pop	eax ; *	
  8972                                  	;sub	ah, 80h	; -32768 to +32767 format again
  8973                                  	;stosw 		; interpolated sample (R)
  8974                                  	; 14/01/2025
  8975 00004F41 AB                      	stosd
  8976 00004F42 C3                      	retn
  8977                                  
  8978                                  ; =============== S U B R O U T I N E =======================================
  8979                                  
  8980                                  interpolating_5_16bit_mono:
  8981                                  	; 18/11/2023
  8982                                  	; ax = [previous_val]
  8983                                  	; dx = [next_val]
  8984                                  	; original-interpltd-interpltd-interpltd-interpltd
  8985 00004F43 66AB                    	stosw		; original sample (L)
  8986 00004F45 66AB                    	stosw		; original sample (R)
  8987 00004F47 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  8988 00004F4A 89C3                    	mov	ebx, eax ; [previous_val]
  8989 00004F4C 80C680                  	add	dh, 80h
  8990 00004F4F 6601D0                  	add	ax, dx
  8991 00004F52 66D1D8                  	rcr	ax, 1
  8992 00004F55 50                      	push	eax ; *	; interpolated middle (temporary)
  8993 00004F56 6601D8                  	add	ax, bx	; interpolated middle + [previous_val] 
  8994 00004F59 66D1D8                  	rcr	ax, 1
  8995 00004F5C 50                      	push	eax ; **	; interpolated 1st quarter (temporary)
  8996 00004F5D 6601D8                  	add	ax, bx	; 1st quarter + [previous_val]
  8997 00004F60 66D1D8                  	rcr	ax, 1	
  8998 00004F63 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  8999 00004F66 66AB                    	stosw 		; interpolated sample 1 (L)
  9000 00004F68 66AB                    	stosw		; interpolated sample 1 (R)
  9001 00004F6A 58                      	pop	eax ; **
  9002 00004F6B 5B                      	pop	ebx ; *
  9003 00004F6C 6601D8                  	add	ax, bx	; 1st quarter + middle
  9004 00004F6F 66D1D8                  	rcr	ax, 1	; / 2
  9005 00004F72 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again	
  9006 00004F75 66AB                    	stosw		; interpolated sample 2 (L)
  9007 00004F77 66AB                    	stosw		; interpolated sample 2 (R)
  9008 00004F79 89D8                    	mov	eax, ebx
  9009 00004F7B 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  9010 00004F7E 66D1D8                  	rcr	ax, 1
  9011 00004F81 50                      	push	eax ; *	; interpolated 3rd quarter (temporary)
  9012 00004F82 6601D8                  	add	ax, bx	; + interpolated middle
  9013 00004F85 66D1D8                  	rcr	ax, 1
  9014 00004F88 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9015 00004F8B 66AB                    	stosw		; interpolated sample 3 (L)
  9016 00004F8D 66AB                    	stosw		; interpolated sample 3 (R)
  9017 00004F8F 58                      	pop	eax ; *	
  9018 00004F90 6601D0                  	add	ax, dx	; 3rd quarter + [next_val]
  9019 00004F93 66D1D8                  	rcr	ax, 1	; / 2
  9020 00004F96 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9021 00004F99 66AB                    	stosw		; interpolated sample 4 (L)
  9022 00004F9B 66AB                    	stosw		; interpolated sample 4 (R)
  9023 00004F9D C3                      	retn
  9024                                  
  9025                                  ; =============== S U B R O U T I N E =======================================
  9026                                  
  9027                                  interpolating_5_16bit_stereo:
  9028                                  	; 18/11/2023
  9029                                  	; bx = [previous_val_l]
  9030                                  	; ax = [previous_val_r]
  9031                                  	; [next_val_l]
  9032                                  	; [next_val_r]
  9033                                  	; original-interpltd-interpltd-interpltd-interpltd
  9034 00004F9E 51                      	push	ecx ; !
  9035 00004F9F 93                      	xchg	eax, ebx
  9036 00004FA0 66AB                    	stosw		; original sample (L)
  9037 00004FA2 93                      	xchg	eax, ebx
  9038 00004FA3 66AB                    	stosw		; original sample (R)
  9039 00004FA5 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  9040 00004FA8 50                      	push	eax ; *	; [previous_val_r]
  9041 00004FA9 80C780                  	add	bh, 80h
  9042 00004FAC 8005[28510000]80        	add	byte [next_val_l+1], 80h
  9043 00004FB3 66A1[27510000]          	mov	ax, [next_val_l]
  9044 00004FB9 6601D8                  	add	ax, bx	; [previous_val_l]
  9045 00004FBC 66D1D8                  	rcr	ax, 1
  9046 00004FBF 89C1                    	mov	ecx, eax ; interpolated middle (L)
  9047 00004FC1 6601D8                  	add	ax, bx	
  9048 00004FC4 66D1D8                  	rcr	ax, 1
  9049 00004FC7 89C2                    	mov	edx, eax ; interpolated 1st quarter (L)
  9050 00004FC9 6601D8                  	add	ax, bx	; [previous_val_l]
  9051 00004FCC 66D1D8                  	rcr	ax, 1
  9052 00004FCF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9053 00004FD2 66AB                    	stosw 		; interpolated sample 1 (L)
  9054 00004FD4 89C8                    	mov	eax, ecx
  9055 00004FD6 6601D0                  	add	ax, dx	; middle (L) + 1st quarter (L)
  9056 00004FD9 66D1D8                  	rcr	ax, 1	; / 2
  9057 00004FDC 89C3                    	mov	ebx, eax  ; interpolated sample 2 (L)
  9058 00004FDE 5A                      	pop	edx ; *	; [previous_val_r]
  9059 00004FDF 89D0                    	mov	eax, edx
  9060 00004FE1 8005[2A510000]80        	add	byte [next_val_r+1], 80h
  9061 00004FE8 660305[29510000]        	add	ax, [next_val_r]
  9062 00004FEF 66D1D8                  	rcr	ax, 1
  9063 00004FF2 50                      	push	eax ; *	; interpolated middle (R)
  9064 00004FF3 6601D0                  	add	ax, dx
  9065 00004FF6 66D1D8                  	rcr	ax, 1
  9066 00004FF9 50                      	push	eax ; ** ; interpolated 1st quarter (R)
  9067 00004FFA 6601D0                  	add	ax, dx	; [previous_val_r]
  9068 00004FFD 66D1D8                  	rcr	ax, 1
  9069 00005000 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9070 00005003 66AB                    	stosw 		; interpolated sample 1 (R)
  9071 00005005 89D8                    	mov	eax, ebx
  9072 00005007 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9073 0000500A 66AB                    	stosw 		; interpolated sample 2 (L)
  9074 0000500C 58                      	pop	eax ; **
  9075 0000500D 5A                      	pop	edx ; *
  9076 0000500E 6601D0                  	add	ax, dx	; 1st quarter (R) + middle (R)
  9077 00005011 66D1D8                  	rcr	ax, 1	; / 2
  9078 00005014 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9079 00005017 66AB                    	stosw 		; interpolated sample 2 (R)
  9080 00005019 89C8                    	mov	eax, ecx
  9081 0000501B 660305[27510000]        	add	ax, [next_val_l]
  9082 00005022 66D1D8                  	rcr	ax, 1
  9083 00005025 50                      	push	eax ; * ; interpolated 3rd quarter (L)
  9084 00005026 6601C8                  	add	ax, cx	; interpolated middle (L)
  9085 00005029 66D1D8                  	rcr	ax, 1
  9086 0000502C 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9087 0000502F 66AB                    	stosw 		; interpolated sample 3 (L)
  9088 00005031 89D0                    	mov	eax, edx
  9089 00005033 660305[29510000]        	add	ax, [next_val_r]
  9090 0000503A 66D1D8                  	rcr	ax, 1
  9091 0000503D 50                      	push	eax ; ** ; interpolated 3rd quarter (R)
  9092 0000503E 6601D0                  	add	ax, dx	; interpolated middle (R)
  9093 00005041 66D1D8                  	rcr	ax, 1
  9094 00005044 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9095 00005047 66AB                    	stosw 		; interpolated sample 3 (R)
  9096 00005049 5B                      	pop	ebx ; **
  9097 0000504A 58                      	pop	eax ; *
  9098 0000504B 660305[27510000]        	add	ax, [next_val_l]
  9099 00005052 66D1D8                  	rcr	ax, 1
  9100 00005055 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9101 00005058 66AB                    	stosw 		; interpolated sample 4 (L)
  9102 0000505A 89D8                    	mov	eax, ebx
  9103 0000505C 660305[29510000]        	add	ax, [next_val_r]
  9104 00005063 66D1D8                  	rcr	ax, 1
  9105 00005066 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9106 00005069 66AB                    	stosw 		; interpolated sample 4 (R)
  9107 0000506B 59                      	pop	ecx ; !
  9108 0000506C C3                      	retn
  9109                                  
  9110                                  ; =============== S U B R O U T I N E =======================================
  9111                                  
  9112                                  interpolating_4_16bit_mono:
  9113                                  	; 18/11/2023
  9114                                  	; ax = [previous_val]
  9115                                  	; dx = [next_val]
  9116                                  	; 01/02/2025
  9117                                  	; original-interpolated-interpolated-interpolated
  9118                                  
  9119 0000506D 66AB                    	stosw		; original sample (L)
  9120 0000506F 66AB                    	stosw		; original sample (R)
  9121 00005071 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  9122 00005074 89C3                    	mov	ebx, eax ; [previous_val]
  9123 00005076 80C680                  	add	dh, 80h
  9124 00005079 6601D0                  	add	ax, dx	; [previous_val] + [next_val]
  9125 0000507C 66D1D8                  	rcr	ax, 1
  9126 0000507F 93                      	xchg	eax, ebx
  9127 00005080 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  9128 00005083 66D1D8                  	rcr	ax, 1
  9129 00005086 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9130 00005089 66AB                    	stosw 		; interpolated sample 1 (L)
  9131 0000508B 66AB                    	stosw		; interpolated sample 1 (R)
  9132 0000508D 89D8                    	mov	eax, ebx ; interpolated middle
  9133 0000508F 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9134 00005092 66AB                    	stosw 		; interpolated sample 2 (L)
  9135 00005094 66AB                    	stosw		; interpolated sample 2 (R)
  9136 00005096 89D8                    	mov	eax, ebx
  9137 00005098 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  9138 0000509B 66D1D8                  	rcr	ax, 1
  9139 0000509E 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9140 000050A1 66AB                    	stosw		; interpolated sample 3 (L)
  9141 000050A3 66AB                    	stosw		; interpolated sample 3 (R)
  9142 000050A5 C3                      	retn
  9143                                  
  9144                                  ; =============== S U B R O U T I N E =======================================
  9145                                  
  9146                                  interpolating_4_16bit_stereo:
  9147                                  	; 18/11/2023
  9148                                  	; bx = [previous_val_l]
  9149                                  	; ax = [previous_val_r]
  9150                                  	; [next_val_l]
  9151                                  	; [next_val_r]
  9152                                  	; original-interpolated-interpolated-interpolated
  9153 000050A6 93                      	xchg	eax, ebx
  9154 000050A7 66AB                    	stosw		; original sample (L)
  9155 000050A9 93                      	xchg	eax, ebx
  9156 000050AA 66AB                    	stosw		; original sample (R)
  9157 000050AC 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  9158 000050AF 89C2                    	mov	edx, eax ; [previous_val_r]
  9159 000050B1 80C780                  	add	bh, 80h
  9160 000050B4 8005[28510000]80        	add	byte [next_val_l+1], 80h
  9161 000050BB 66A1[27510000]          	mov	ax, [next_val_l]
  9162 000050C1 6601D8                  	add	ax, bx	; [previous_val_l]
  9163 000050C4 66D1D8                  	rcr	ax, 1
  9164 000050C7 93                      	xchg	eax, ebx
  9165 000050C8 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  9166 000050CB 66D1D8                  	rcr	ax, 1
  9167 000050CE 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9168 000050D1 66AB                    	stosw 		; interpolated sample 1 (L)
  9169 000050D3 8005[2A510000]80        	add	byte [next_val_r+1], 80h
  9170 000050DA 89D0                    	mov	eax, edx ; [previous_val_r]
  9171 000050DC 660305[29510000]        	add	ax, [next_val_r]
  9172 000050E3 66D1D8                  	rcr	ax, 1
  9173 000050E6 92                      	xchg	eax, edx
  9174 000050E7 6601D0                  	add	ax, dx	; dx = interpolated middle (R)
  9175 000050EA 66D1D8                  	rcr	ax, 1
  9176 000050ED 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9177 000050F0 66AB                    	stosw 		; interpolated sample 1 (R)
  9178 000050F2 89D8                    	mov	eax, ebx
  9179 000050F4 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9180 000050F7 66AB                    	stosw 		; interpolated sample 2 (L)
  9181 000050F9 89D0                    	mov	eax, edx
  9182 000050FB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9183 000050FE 66AB                    	stosw 		; interpolated sample 2 (R)
  9184 00005100 89D8                    	mov	eax, ebx
  9185 00005102 660305[27510000]        	add	ax, [next_val_l]
  9186 00005109 66D1D8                  	rcr	ax, 1
  9187 0000510C 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9188 0000510F 66AB                    	stosw 		; interpolated sample 3 (L)
  9189 00005111 89D0                    	mov	eax, edx
  9190 00005113 660305[29510000]        	add	ax, [next_val_r]
  9191 0000511A 66D1D8                  	rcr	ax, 1
  9192 0000511D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  9193 00005120 66AB                    	stosw 		; interpolated sample 3 (R)
  9194 00005122 C3                      	retn
  9195                                  
  9196                                  ; ---------------------------------------------------------------------------
  9197                                  
  9198                                  ; 13/11/2023
  9199                                  previous_val:
  9200 00005123 0000                    previous_val_l: dw 0
  9201 00005125 0000                    previous_val_r: dw 0
  9202                                  next_val:
  9203 00005127 0000                    next_val_l: dw 0
  9204 00005129 0000                    next_val_r: dw 0
  9205                                  
  9206                                  ; 16/11/2023
  9207 0000512B 00                      faz:	db 0
  9208                                  
  9209                                  ; ---------------------------------------------------------------------------
  9210                                  ; 15/02/2025 - Hardware Info display/write procedures.
  9211                                  ; ---------------------------------------------------------------------------
  9212                                  ; ref: twavply3.s (10/02/2025
  9213                                  
  9214                                  ;=============================================================================
  9215                                  ;	Write AC'97 Hardware Information
  9216                                  ;=============================================================================
  9217                                  	
  9218                                  	; 09/02/2025
  9219                                  
  9220                                  write_audio_dev_info:
  9221 0000512C 31DB                    	xor	ebx, ebx
  9222 0000512E 803D[78B20000]01        	cmp	byte [audio_hardware], 1
  9223 00005135 7557                    	jne	short write_ac97_pci_dev_info
  9224                                  
  9225                                  ;-----------------------------------------------------------------------------
  9226                                  	
  9227                                  	; 09/02/2025
  9228                                  	; 05/02/2025 - sb16play.s
  9229                                  
  9230                                  write_sb16_dev_info:
  9231 00005137 A1[70B20000]            	mov	eax, [audio_io_base]
  9232                                  	;xor	ebx, ebx
  9233 0000513C 88C3                    	mov	bl, al
  9234 0000513E 88DA                    	mov	dl, bl
  9235 00005140 80E30F                  	and	bl, 0Fh
  9236 00005143 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9237 00005149 A2[B0B00000]            	mov	[msgBasePort+2], al
  9238 0000514E 88D3                    	mov	bl, dl
  9239 00005150 C0EB04                  	shr	bl, 4
  9240 00005153 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9241 00005159 A2[AFB00000]            	mov	[msgBasePort+1], al
  9242 0000515E 88E3                    	mov	bl, ah
  9243                                  	;and	bl, 0Fh
  9244 00005160 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9245 00005166 A2[AEB00000]            	mov	[msgBasePort], al
  9246                                  
  9247                                  	;xor	eax, eax
  9248 0000516B A0[74B20000]            	mov	al, [audio_intr]
  9249 00005170 0430                    	add	al, 30h
  9250 00005172 A2[C5B00000]            	mov	[msgSB16IRQ], al
  9251                                  
  9252                                  	sys	_msg, msgSB16Info, 255, 07h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00005177 BB[78B00000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 0000517C B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005181 BA07000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005186 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000518B CD40                <1>  int 40h
  9253                                  
  9254 0000518D C3                      	retn
  9255                                  
  9256                                  ;-----------------------------------------------------------------------------
  9257                                  
  9258                                  	; 09/02/2025
  9259                                  	; 05/02/2025 - ac97play.s
  9260                                  	
  9261                                  write_ac97_pci_dev_info:
  9262                                  	; BUS/DEV/FN
  9263                                  	;	00000000BBBBBBBBDDDDDFFF00000000
  9264                                  	; DEV/VENDOR
  9265                                  	;	DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV
  9266                                  
  9267 0000518E A1[68B20000]            	mov	eax, [dev_vendor]
  9268                                  	; 07/12/2024
  9269 00005193 31DB                    	xor	ebx, ebx
  9270 00005195 88C3                    	mov	bl, al
  9271 00005197 88DA                    	mov	dl, bl
  9272 00005199 80E30F                  	and	bl, 0Fh
  9273 0000519C 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9274 000051A2 A2[4BAF0000]            	mov	[msgVendorId+3], al
  9275 000051A7 88D3                    	mov	bl, dl
  9276 000051A9 C0EB04                  	shr	bl, 4
  9277 000051AC 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9278 000051B2 A2[4AAF0000]            	mov	[msgVendorId+2], al
  9279 000051B7 88E3                    	mov	bl, ah
  9280 000051B9 88DA                    	mov	dl, bl
  9281 000051BB 80E30F                  	and	bl, 0Fh
  9282 000051BE 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9283 000051C4 A2[49AF0000]            	mov	[msgVendorId+1], al
  9284 000051C9 88D3                    	mov	bl, dl
  9285 000051CB C0EB04                  	shr	bl, 4
  9286 000051CE 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9287 000051D4 A2[48AF0000]            	mov	[msgVendorId], al
  9288 000051D9 C1E810                  	shr	eax, 16
  9289 000051DC 88C3                    	mov	bl, al
  9290 000051DE 88DA                    	mov	dl, bl
  9291 000051E0 80E30F                  	and	bl, 0Fh
  9292 000051E3 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9293 000051E9 A2[5CAF0000]            	mov	[msgDevId+3], al
  9294 000051EE 88D3                    	mov	bl, dl
  9295 000051F0 C0EB04                  	shr	bl, 4
  9296 000051F3 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9297 000051F9 A2[5BAF0000]            	mov	[msgDevId+2], al
  9298 000051FE 88E3                    	mov	bl, ah
  9299 00005200 88DA                    	mov	dl, bl
  9300 00005202 80E30F                  	and	bl, 0Fh
  9301 00005205 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9302 0000520B A2[5AAF0000]            	mov	[msgDevId+1], al
  9303 00005210 88D3                    	mov	bl, dl
  9304 00005212 C0EB04                  	shr	bl, 4
  9305 00005215 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9306 0000521B A2[59AF0000]            	mov	[msgDevId], al
  9307                                  
  9308 00005220 A1[64B20000]            	mov	eax, [bus_dev_fn]
  9309 00005225 C1E808                  	shr	eax, 8
  9310 00005228 88C3                    	mov	bl, al
  9311 0000522A 88DA                    	mov	dl, bl
  9312 0000522C 80E307                  	and	bl, 7 ; bit 0,1,2
  9313 0000522F 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9314 00005235 A2[80AF0000]            	mov	[msgFncNo+1], al
  9315 0000523A 88D3                    	mov	bl, dl
  9316 0000523C C0EB03                  	shr	bl, 3
  9317 0000523F 88DA                    	mov	dl, bl
  9318 00005241 80E30F                  	and	bl, 0Fh
  9319 00005244 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9320 0000524A A2[72AF0000]            	mov	[msgDevNo+1], al
  9321 0000524F 88D3                    	mov	bl, dl
  9322 00005251 C0EB04                  	shr	bl, 4
  9323 00005254 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9324 0000525A A2[71AF0000]            	mov	[msgDevNo], al
  9325 0000525F 88E3                    	mov	bl, ah
  9326 00005261 88DA                    	mov	dl, bl
  9327 00005263 80E30F                  	and	bl, 0Fh
  9328 00005266 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9329 0000526C A2[66AF0000]            	mov	[msgBusNo+1], al
  9330 00005271 88D3                    	mov	bl, dl
  9331 00005273 C0EB04                  	shr	bl, 4
  9332 00005276 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9333 0000527C A2[65AF0000]            	mov	[msgBusNo], al
  9334                                  
  9335                                  	;mov	ax, [ac97_NamBar]
  9336 00005281 66A1[6CB20000]          	mov	ax, [NAMBAR]
  9337 00005287 88C3                    	mov	bl, al
  9338 00005289 88DA                    	mov	dl, bl
  9339 0000528B 80E30F                  	and	bl, 0Fh
  9340 0000528E 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9341 00005294 A2[8FAF0000]            	mov	[msgNamBar+3], al
  9342 00005299 88D3                    	mov	bl, dl
  9343 0000529B C0EB04                  	shr	bl, 4
  9344 0000529E 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9345 000052A4 A2[8EAF0000]            	mov	[msgNamBar+2], al
  9346 000052A9 88E3                    	mov	bl, ah
  9347 000052AB 88DA                    	mov	dl, bl
  9348 000052AD 80E30F                  	and	bl, 0Fh
  9349 000052B0 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9350 000052B6 A2[8DAF0000]            	mov	[msgNamBar+1], al
  9351 000052BB 88D3                    	mov	bl, dl
  9352 000052BD C0EB04                  	shr	bl, 4
  9353 000052C0 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9354 000052C6 A2[8CAF0000]            	mov	[msgNamBar], al
  9355                                  
  9356                                  	;mov	ax, [ac97_NabmBar]
  9357 000052CB 66A1[6EB20000]          	mov	ax, [NABMBAR]
  9358 000052D1 88C3                    	mov	bl, al
  9359 000052D3 88DA                    	mov	dl, bl
  9360 000052D5 80E30F                  	and	bl, 0Fh
  9361 000052D8 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9362 000052DE A2[9FAF0000]            	mov	[msgNabmBar+3], al
  9363 000052E3 88D3                    	mov	bl, dl
  9364 000052E5 C0EB04                  	shr	bl, 4
  9365 000052E8 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9366 000052EE A2[9EAF0000]            	mov	[msgNabmBar+2], al
  9367 000052F3 88E3                    	mov	bl, ah
  9368 000052F5 88DA                    	mov	dl, bl
  9369 000052F7 80E30F                  	and	bl, 0Fh
  9370 000052FA 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9371 00005300 A2[9DAF0000]            	mov	[msgNabmBar+1], al
  9372 00005305 88D3                    	mov	bl, dl
  9373 00005307 C0EB04                  	shr	bl, 4
  9374 0000530A 8A83[06AF0000]          	mov	al, [ebx+hex_chars]
  9375 00005310 A2[9CAF0000]            	mov	[msgNabmBar], al
  9376                                  
  9377 00005315 31C0                    	xor	eax, eax
  9378 00005317 A0[74B20000]            	mov	al, [ac97_int_ln_reg]
  9379 0000531C B10A                    	mov	cl, 10
  9380 0000531E F6F1                    	div	cl
  9381                                  	;add	[msgIRQ], ax
  9382 00005320 66053030                	add	ax, 3030h
  9383 00005324 66A3[A8AF0000]          	mov	[msgIRQ], ax
  9384                                  	;and	al, al
  9385 0000532A 3C30                    	cmp	al, 30h
  9386 0000532C 750D                    	jne	short _w_ac97imsg_
  9387 0000532E A0[A9AF0000]            	mov	al, [msgIRQ+1]
  9388 00005333 B420                    	mov	ah, ' '
  9389 00005335 66A3[A8AF0000]          	mov	[msgIRQ], ax
  9390                                  _w_ac97imsg_:
  9391                                  	sys	_msg, msgAC97Info, 255, 07h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000533B BB[17AF0000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00005340 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005345 BA07000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000534A B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000534F CD40                <1>  int 40h
  9392                                  
  9393                                          ;retn
  9394                                  
  9395                                  ;-----------------------------------------------------------------------------
  9396                                  
  9397                                  write_VRA_info:
  9398                                  	sys	_msg, msgVRAheader, 255, 07h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00005351 BB[33B00000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00005356 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 0000535B BA07000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005360 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00005365 CD40                <1>  int 40h
  9399 00005367 803D[79B20000]00        	cmp	byte [vra], 0
  9400 0000536E 7617                    	jna	short _w_VRAi_no
  9401                                  _w_VRAi_yes:
  9402                                  	sys	_msg, msgVRAyes, 255, 07h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00005370 BB[41B00000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00005375 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 0000537A BA07000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000537F B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00005384 CD40                <1>  int 40h
  9403 00005386 C3                      	retn
  9404                                  _w_VRAi_no:
  9405                                  	sys	_msg, msgVRAno, 255, 07h
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00005387 BB[47B00000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 0000538C B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005391 BA07000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005396 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000539B CD40                <1>  int 40h
  9406 0000539D C3                      	retn
  9407                                  
  9408                                  ; 13/01/2025
  9409                                  ; ---------------------------------------------------------------------------
  9410                                  ; 25/11/2023
  9411                                  msg_no_vra:
  9412 0000539E 0A0D                    		db 10, 13
  9413 000053A0 4E6F20565241207375-     		db "No VRA support ! Only 48 kHZ sample rate supported !"
  9413 000053A9 70706F72742021204F-
  9413 000053B2 6E6C79203438206B48-
  9413 000053BB 5A2073616D706C6520-
  9413 000053C4 726174652073757070-
  9413 000053CD 6F727465642021     
  9414 000053D4 0A0D00                  		db 10, 13, 0
  9415                                  
  9416                                  
  9417                                  ; ---------------------------------------------------------------------------
  9418                                  ; 22/01/2025 - Check Update Events
  9419                                  ; ---------------------------------------------------------------------------
  9420                                  ; ref: playwav9.s (17/01/2025)
  9421                                  
  9422                                  ; =============== S U B R O U T I N E =======================================
  9423                                  
  9424                                  		; 16/02/2025 (tmp3play.s)
  9425                                  		; 10/02/2025 (twavply3.s)
  9426                                  		; 13/02/2025 (mp3play6.s)
  9427                                  		; 26/01/2025 (mp3play5.s)
  9428                                  		; 24/12/2024 (vgaplay.s)
  9429                                  		; 23/01/2025 (mp3play4.s)
  9430                                  		; 07/12/2024 (playwav9.s)
  9431                                  
  9432                                  checkUpdateEvents:
  9433 000053D7 E8B4000000              		call	check4keyboardstop
  9434 000053DC 7259                    		jc	short .c4ue_ok
  9435                                  
  9436 000053DE 50                      		push	eax ; *
  9437 000053DF 09C0                    		or	eax, eax
  9438 000053E1 747F                    		jz	short .c4ue_cpt
  9439                                  
  9440 000053E3 3C20                    		cmp	al, 20h ; SPACE (spacebar) ; pause/play
  9441 000053E5 7551                    		jne	short .c4ue_chk_s
  9442 000053E7 803D[75B20000]00        		cmp	byte [stopped], 0
  9443 000053EE 7707                    		ja	short .c4ue_chk_ps
  9444                                  		; pause
  9445 000053F0 E84EEFFFFF              		call	audio_f_pause
  9446                                  
  9447 000053F5 EB6B                    		jmp	short .c4ue_cpt
  9448                                  .c4ue_chk_ps:
  9449 000053F7 803D[75B20000]01        		cmp	byte [stopped], 1
  9450 000053FE 7707                    		ja	short .c4ue_replay
  9451                                  		
  9452                                  		; continue to play (after a pause)
  9453 00005400 E852EFFFFF              		call	audio_f_play
  9454 00005405 EB5B                    		jmp	.c4ue_cpt
  9455                                  .c4ue_replay:
  9456 00005407 58                      		pop	eax ; *
  9457 00005408 58                      		pop	eax ; return address
  9458                                  	
  9459 00005409 C605[75B20000]00        		mov	byte [stopped], 0
  9460                                  
  9461                                  		; move to beginning
  9462                                  		;mov	eax, [stream_start]
  9463 00005410 A1[58B20000]            		mov	eax, [stream_begin] ; 1st [stream_pos] value
  9464 00005415 A3[E0510500]            		mov	[stream_pos], eax
  9465 0000541A A1[54B20000]            		mov	eax, [stream_size]
  9466 0000541F A3[E4510500]            		mov	[bytes_left], eax
  9467                                  
  9468 00005424 803D[8CB20000]00        		cmp	byte [interpolation], 0
  9469 0000542B 7705                    		ja	short .c4ue_rp_indr
  9470                                  		;jmp	start.direct
  9471                                  		; 16/02/2025
  9472 0000542D E919AEFFFF              		jmp	replay.direct
  9473                                  .c4ue_rp_indr:
  9474                                  		;jmp	start.indirect
  9475                                  		; 16/02/2025
  9476 00005432 E933AEFFFF              		jmp	replay.indirect
  9477                                  .c4ue_ok:
  9478 00005437 C3                      		retn
  9479                                  .c4ue_chk_s:
  9480 00005438 3C53                    		cmp	al, 'S'	; stop
  9481 0000543A 7510                    		jne	short .c4ue_chk_fb
  9482 0000543C 803D[75B20000]00        		cmp	byte [stopped], 0
  9483 00005443 771D                    		ja	short .c4ue_cpt ; Already stopped/paused
  9484                                  .c4ue_stop:
  9485 00005445 E8CDEEFFFF              		call	audio_f_stop
  9486 0000544A EB16                    		jmp	short .c4ue_cpt
  9487                                  .c4ue_chk_fb:
  9488 0000544C 3C46                    		cmp	al, 'F'
  9489 0000544E 7507                    		jne	short .c4ue_chk_b
  9490                                  		;call	Player_ProcessKey_Forwards
  9491                                  		; 16/02/2025
  9492 00005450 E89A000000              		call	move_forward
  9493 00005455 EB0B                    		jmp	short .c4ue_cpt
  9494                                  .c4ue_chk_b:
  9495 00005457 3C42                    		cmp	al, 'B'
  9496                                  		; 16/02/2025
  9497 00005459 7507                    		jne	short .c4ue_cpt
  9498                                  		;call 	Player_ProcessKey_Backwards
  9499                                  		; 16/02/2025
  9500 0000545B E8BC000000              		call	move_backward
  9501 00005460 EB00                    		jmp	short .c4ue_cpt
  9502                                  
  9503                                  		; 16/02/2025
  9504                                  .c4ue_cpt:
  9505                                  		sys	_time, 4 ; get timer ticks (18.2 ticks/second)
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00005462 BB04000000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105                              <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107                              <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005467 B80D000000          <1>  mov eax, %1
   112                              <1> 
   113 0000546C CD40                <1>  int 40h
  9506                                  		
  9507 0000546E 59                      		pop	ecx ; *
  9508 0000546F 3B05[80B20000]          		cmp	eax, [timerticks]
  9509 00005475 7407                    		je	short .c4ue_skip_utt
  9510                                  .c4ue_utt:	
  9511 00005477 A3[80B20000]            		mov	[timerticks], eax
  9512 0000547C EB04                    		jmp	short .c4ue_cpt_@
  9513                                  
  9514                                  .c4ue_skip_utt:
  9515 0000547E 21C9                    		and	ecx, ecx
  9516 00005480 74B5                    		jz	short .c4ue_ok
  9517                                  .c4ue_cpt_@:
  9518 00005482 803D[75B20000]00        		cmp	byte [stopped], 0
  9519 00005489 77AC                    		ja	short .c4ue_ok
  9520                                  	
  9521                                  		; 16/02/2025
  9522 0000548B E9D1020000              		jmp	drawscopes
  9523                                  
  9524                                  
  9525                                  ; =============== S U B R O U T I N E =======================================
  9526                                  
  9527                                  ; --------------------------------------------------------
  9528                                  ; 22/01/2025 - Check for Keyboard Stop (Request)
  9529                                  ; --------------------------------------------------------
  9530                                  
  9531                                  		; 16/02/2025
  9532                                  		; 23/01/2025
  9533                                  		; 22/01/2025
  9534                                  check4keyboardstop:
  9535 00005490 B411                    		mov	ah, 11h
  9536                                  		; (TRDOS 386 keyboard interrupt)
  9537 00005492 CD32                    		int	32h
  9538                                  		;clc
  9539 00005494 7438                    		jz	short .cksr
  9540                                  
  9541 00005496 B410                    		mov	ah, 10h
  9542 00005498 CD32                    		int	32h
  9543                                  
  9544                                  		; 13/02/2025
  9545                                  		; 23/01/2025
  9546                                  		;;;;
  9547                                  .clear_keyb_buf:
  9548 0000549A 50                      		push	eax ; *
  9549                                  		; clear keyboard buffer
  9550 0000549B B411                    		mov	ah, 11h
  9551 0000549D CD32                    		int	32h
  9552 0000549F 7407                    		jz	short .c4ks
  9553 000054A1 B410                    		mov	ah, 10h
  9554 000054A3 CD32                    		int	32h
  9555 000054A5 5A                      		pop	edx ; *
  9556 000054A6 EBF2                    		jmp	short .clear_keyb_buf
  9557                                  
  9558                                  		; TRDOS 386 system call
  9559                                  		; sysstdio
  9560                                  		; BL = 1 -> read a character on stdin (no wait)
  9561                                  		;sys	_stdio, 1
  9562                                  		;and	eax, eax
  9563                                  		;jz	short .cksr
  9564                                  
  9565                                  		; 23/01/2025
  9566                                  .c4ks:
  9567 000054A8 58                      		pop	eax ; *
  9568                                  		;;;;
  9569                                  
  9570                                  		;;;
  9571                                  		; (change PCM out volume)
  9572 000054A9 3C2B                    		cmp	al, '+'
  9573 000054AB 750D                    		jne	short .p_1
  9574                                  	
  9575 000054AD A0[B8B10000]            		mov	al, [volume_level]
  9576 000054B2 3C00                    		cmp	al, 0
  9577 000054B4 761A                    		jna	short .p_3
  9578 000054B6 FEC8                    		dec	al
  9579 000054B8 EB0F                    		jmp	short .p_2
  9580                                  .p_1:
  9581 000054BA 3C2D                    		cmp	al, '-'
  9582 000054BC 7513                    		jne	short .p_4
  9583                                  
  9584 000054BE A0[B8B10000]            		mov	al, [volume_level]
  9585 000054C3 3C1F                    		cmp	al, 31
  9586 000054C5 7309                    		jnb	short .p_3
  9587 000054C7 FEC0                    		inc	al
  9588                                  .p_2:
  9589                                  		; 16/02/2025
  9590 000054C9 E89DEEFFFF              		call	SetMasterVolume
  9591                                  .cksr:
  9592 000054CE 31C0                    		xor	eax, eax
  9593                                  .p_3:
  9594 000054D0 C3                      		retn
  9595                                  .p_4:
  9596                                  		;cmp	ah, 01 	; ESC
  9597 000054D1 663D1B01                		cmp	ax, 011Bh ; ESC
  9598 000054D5 7416                        		je	short .p_q
  9599                                  		;cmp	al, 03h	; CTRL+C
  9600 000054D7 663D032E                		cmp	ax, 2E03h ; CTRL+C
  9601 000054DB 7410                    		je	short .p_q
  9602                                  
  9603 000054DD 3C20                    		cmp	al, 20h
  9604 000054DF 740D                    		je	short .p_r
  9605                                  
  9606 000054E1 3C0D                    		cmp	al, 0Dh ; CR/ENTER
  9607 000054E3 7409                    		je	short .p_r
  9608                                  
  9609 000054E5 24DF                    		and	al, 0DFh
  9610                                  
  9611                                  		;cmp	al, 'B'
  9612                                  		;je	short .p_r
  9613                                  		;cmp	al, 'F'
  9614                                  		;je	short .p_r
  9615                                  
  9616 000054E7 3C51                    		cmp	al, 'Q'
  9617 000054E9 7402                    		je	short .p_q
  9618                                  
  9619 000054EB F8                      		clc
  9620 000054EC C3                      		retn
  9621                                  
  9622                                  .p_q:
  9623 000054ED F9                      		stc
  9624                                  .p_r:
  9625 000054EE C3                      		retn
  9626                                  
  9627                                  
  9628                                  ; --------------------------------------------------------
  9629                                  ; 22/01/2025 - Goto Forward approx. 5 seconds
  9630                                  ; --------------------------------------------------------
  9631                                  
  9632                                  		; 16/02/2025
  9633                                  move_forward:
  9634                                  		; 23/01/2025
  9635                                  		; 22/01/2025
  9636                                  ;Player_ProcessKey_Forwards:
  9637                                  		;; 5 seconds forward
  9638                                  		;;;;
  9639                                  		;xor	ebp, ebp ; 0
  9640                                  		;;;;
  9641 000054EF A0[7AB20000]            		mov	al, [srb]
  9642 000054F4 50                      		push	eax ; *
  9643 000054F5 A1[5CB20000]            		mov	eax, [fb_count]
  9644 000054FA 8B0D[54B20000]          		mov	ecx, [stream_size]
  9645 00005500 89CA                    		mov	edx, ecx
  9646 00005502 2B15[E4510500]          		sub	edx, [bytes_left]
  9647 00005508 01D0                    		add	eax, edx
  9648 0000550A 720C                    		jc	short .ppk_f@
  9649                                  		; 23/01/2025
  9650 0000550C 89CA                    		mov	edx, ecx
  9651 0000550E 2B15[5CB20000]          		sub	edx, [fb_count]
  9652 00005514 39D0                    		cmp	eax, edx
  9653                                  		;jna	short Player_ProcessKey_set_pos
  9654                                  		; 16/02/2025
  9655 00005516 7626                    		jna	short move_fwbw_set_pos
  9656                                  .ppk_f@:
  9657 00005518 89D0                    		mov	eax, edx ; offset
  9658                                  		;jmp	short Player_ProcessKey_set_pos
  9659                                  		; 16/02/2025
  9660 0000551A EB22                    		jmp 	short move_fwbw_set_pos
  9661                                  
  9662                                  ; --------------------------------------------------------
  9663                                  ; 22/01/2025 - Goto Backward approx. 5 seconds
  9664                                  ; --------------------------------------------------------
  9665                                  
  9666                                  		; 16/02/2025
  9667                                  move_backward:
  9668                                  		; 22/01/2025
  9669                                  ;Player_ProcessKey_Backwards:
  9670                                  		;; 5 seconds backward
  9671                                  		; 23/01/2025
  9672                                  		;;;;
  9673                                  		;xor	ebp, 1
  9674                                  		;;;;
  9675 0000551C A0[7AB20000]            		mov	al, [srb]
  9676 00005521 50                      		push	eax ; *
  9677 00005522 8B15[5CB20000]          		mov	edx, [fb_count]
  9678 00005528 8B0D[54B20000]          		mov	ecx, [stream_size]
  9679                                  			; the 1st/init value of [bytes_left]
  9680 0000552E 89C8                    		mov	eax, ecx
  9681 00005530 2B05[E4510500]          		sub	eax, [bytes_left]
  9682 00005536 7604                    		jna	short .ppk_bw@
  9683 00005538 29D0                    		sub	eax, edx
  9684                                  		;jnc	short Player_ProcessKey_set_pos
  9685                                  		; 16/02/2025
  9686 0000553A 7302                    		jnc	short move_fwbw_set_pos
  9687                                  .ppk_bw@:
  9688 0000553C 31C0                    		xor	eax, eax ; offset
  9689                                  
  9690                                  ; --------------------------------------------------------
  9691                                  
  9692                                  		; 16/02/2025
  9693                                  move_fwbw_set_pos:
  9694                                  		; 23/01/2025
  9695                                  		; 22/01/2025
  9696                                  ;Player_ProcessKey_set_pos:
  9697 0000553E 5B                      		pop	ebx ; *
  9698                                  		; skip position change if audio interrupt occurs
  9699                                  		; during this f/b procedure
  9700                                  		; (because [bytes_left] would be changed)
  9701 0000553F 803D[7AB20000]00        		cmp	byte [srb], 0
  9702 00005546 7605                    		jna	short .ppk_sp@ ; proper to change
  9703 00005548 80FB00                  		cmp	bl, 0
  9704 0000554B 7628                    		jna	short .ppk_sp@@@
  9705                                  		; [srb] was 1 when starting this f/b procedure
  9706                                  		; (so, there is not a conflict)	
  9707                                  .ppk_sp@:
  9708                                  		; pause playback, pause/start audio interrupt
  9709 0000554D 51                      		push	ecx
  9710 0000554E 50                      		push	eax
  9711 0000554F E8EFEDFFFF              		call	audio_f_pause
  9712 00005554 58                      		pop	eax
  9713 00005555 59                      		pop	ecx
  9714                                  
  9715 00005556 8B1D[58B20000]          		mov	ebx, [stream_begin] 
  9716                                  				; the 1st/init value of [stream_pos]
  9717 0000555C 01C3                    		add	ebx, eax
  9718 0000555E 891D[E0510500]          		mov	[stream_pos], ebx
  9719                                  		; ecx = [stream_size]
  9720                                  		; eax = offset
  9721 00005564 29C1                    		sub	ecx, eax
  9722 00005566 7302                    		jnc	short .ppk_sp@@
  9723 00005568 31C9                    		xor	ecx, ecx
  9724                                  .ppk_sp@@:
  9725                                  		; 23/01/2025
  9726 0000556A 890D[E4510500]          		mov	[bytes_left], ecx
  9727                                  
  9728                                  		;;;;
  9729                                  		; continue to playback
  9730 00005570 E8E2EDFFFF              		call	audio_f_play
  9731                                  .ppk_sp@@@:
  9732                                  		; clear keyboard buffer
  9733                                  		;call	clear_keyb_buf
  9734                                  ; 23/01/2025
  9735                                  .clear_keyb_buf:
  9736                                  		; clear keyboard buffer
  9737 00005575 B401                    		mov	ah, 1
  9738 00005577 CD32                    		int	32h
  9739 00005579 7406                    		jz	short .ppk_sp_ok
  9740 0000557B B400                    		mov	ah, 0
  9741 0000557D CD32                    		int	32h
  9742 0000557F EBF4                    		jmp	short .clear_keyb_buf
  9743                                  
  9744                                  .ppk_sp_ok:
  9745 00005581 C3                      		retn
  9746                                  
  9747                                  
  9748                                  ; =============== S U B R O U T I N E =======================================
  9749                                  
  9750                                  		; 25/01/2025
  9751                                  		; 21/12/2024
  9752                                  set_text_mode:
  9753 00005582 30E4                    		xor    ah, ah
  9754 00005584 B003                    		mov    al, 3
  9755                                   		;int   10h ; al = 03h text mode, int 10 video
  9756 00005586 CD31                    		int    31h ; TRDOS 386 - Video interrupt
  9757 00005588 C3                      		retn
  9758                                  
  9759                                  ; =============== S U B R O U T I N E =======================================
  9760                                  
  9761                                  		; 16/02/2025 (tmp3play.s)
  9762                                  		; 13/02/2025 (mp3play6.s)
  9763                                  		; 30/12/2024 (cgaplay.s)
  9764                                  		; 26/01/2025
  9765                                  		; 25/01/2025 (mp3play5.s) -graphics/VGA mode-
  9766                                  		; 21/12/2024 (vgaplay.s)
  9767                                  		; 22/01/2025 (mp3play4.s) -text mode-
  9768                                  		; 21/01/2025
  9769                                  SetTotalTime:
  9770                                  		;;;; 22/01/2025
  9771 00005589 8B1D[B8C20000]          		mov	ebx, [mp3_bit_rate] ; bit/s
  9772 0000558F 89D8                    		mov	eax, ebx
  9773 00005591 C1E803                  		shr	eax, 3 ; byte/s
  9774 00005594 BA05000000              		mov	edx, 5
  9775 00005599 F7E2                    		mul	edx
  9776                                  
  9777 0000559B F735[98C20000]          		div	dword [mp3_src_frame_size]
  9778                                  		; eax = count of frames per 5 seconds
  9779 000055A1 21D2                    		and	edx, edx
  9780 000055A3 7401                    		jz	short .skip@
  9781 000055A5 40                      		inc	eax
  9782                                  .skip@:
  9783 000055A6 F725[98C20000]          		mul	dword [mp3_src_frame_size]
  9784 000055AC A3[5CB20000]            		mov	[fb_count], eax  ; forward/backward count
  9785                                  		;;;;
  9786                                  
  9787 000055B1 A1[54B20000]            		mov	eax, [stream_size] ; bytes
  9788 000055B6 BA08000000              		mov	edx, 8 ; 1 byte = 8 bits
  9789 000055BB F7E2                     		mul	edx
  9790                                  		;div	dword [mp3_bit_rate] ; num of bits per sec
  9791 000055BD F7F3                    		div	ebx ; 22/01/2025
  9792                                  		; eax = total seconds
  9793                                  
  9794 000055BF B33C                    		mov	bl, 60
  9795 000055C1 F6F3                    		div	bl
  9796                                  
  9797                                  		; al = minutes, ah = seconds
  9798                                  	
  9799                                  		; 15/02/2025
  9800 000055C3 50                      		push	eax
  9801 000055C4 B30A                    		mov	bl, 10
  9802 000055C6 30E4                    		xor	ah, ah
  9803 000055C8 F6F3                    		div	bl
  9804 000055CA 80C430                  		add	ah, '0'
  9805 000055CD 8825[1CB00000]          		mov	[msgMinSec+1], ah
  9806 000055D3 20C0                    		and	al, al
  9807 000055D5 740D                    		jz	short .skip@@
  9808 000055D7 28E4                    		sub	ah, ah
  9809 000055D9 F6F3                    		div	bl
  9810 000055DB 80C430                  		add	ah, '0'
  9811 000055DE 8825[1BB00000]          		mov	[msgMinSec], ah
  9812                                  .skip@@:
  9813 000055E4 58                      		pop	eax
  9814 000055E5 88E0                    		mov	al, ah
  9815 000055E7 30E4                    		xor	ah, ah
  9816 000055E9 F6F3                    		div	bl
  9817 000055EB 80C430                  		add	ah, '0'
  9818 000055EE 8825[1FB00000]          		mov	[msgMinSec+4], ah
  9819 000055F4 08C0                    		or	al, al
  9820 000055F6 740D                    		jz	short .return
  9821 000055F8 28E4                    		sub	ah, ah
  9822 000055FA F6F3                    		div	bl
  9823 000055FC 80C430                  		add	ah, '0'
  9824 000055FF 8825[1EB00000]          		mov	[msgMinSec+3], ah
  9825                                  .return:
  9826 00005605 C3                      		retn
  9827                                  	
  9828                                  
  9829                                  ; =============== S U B R O U T I N E =======================================
  9830                                  
  9831                                  		; 15/02/2025
  9832                                  write_mp3_file_info:
  9833                                  		sys	_msg, msgFileName, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00005606 BB[ADAF0000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 0000560B B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005610 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005615 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000561A CD40                <1>  int 40h
  9834                                  		sys	_msg, mp3_file_name, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000561C BB[F05B0500]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00005621 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005626 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000562B B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00005630 CD40                <1>  int 40h
  9835                                  write_sample_rate:
  9836 00005632 A1[B0C20000]            		mov	eax, [mp3_sample_rate]
  9837                                  		; ax = sample rate (hertz)
  9838 00005637 31D2                    		xor	edx, edx
  9839 00005639 66B90A00                		mov	cx, 10
  9840 0000563D 66F7F1                  		div	cx
  9841 00005640 0015[CEAF0000]          		add	[msgHertz+4], dl
  9842 00005646 29D2                    		sub	edx, edx
  9843 00005648 66F7F1                  		div	cx
  9844 0000564B 0015[CDAF0000]          		add	[msgHertz+3], dl
  9845 00005651 29D2                    		sub	edx, edx
  9846 00005653 66F7F1                  		div	cx
  9847 00005656 0015[CCAF0000]          		add	[msgHertz+2], dl
  9848 0000565C 29D2                    		sub	edx, edx
  9849 0000565E 66F7F1                  		div	cx
  9850 00005661 0015[CBAF0000]          		add	[msgHertz+1], dl
  9851 00005667 0005[CAAF0000]          		add	[msgHertz], al
  9852                                  	
  9853                                  		sys	_msg, msgSampleRate, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000566D BB[BBAF0000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00005672 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005677 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000567C B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00005681 CD40                <1>  int 40h
  9854                                  
  9855 00005683 A1[B8C20000]            		mov     eax, [mp3_bit_rate]
  9856 00005688 31D2                                    xor     edx, edx
  9857 0000568A B9E8030000                              mov     ecx, 1000
  9858 0000568F F7F1                                    div     ecx
  9859 00005691 BF[445C0500]            		mov	edi, txtSize
  9860 00005696 89E5                    		mov	ebp, esp
  9861 00005698 B90A000000              		mov	ecx, 10
  9862                                  kbits_1:
  9863 0000569D 31D2                      		xor	edx, edx
  9864 0000569F F7F1                    		div	ecx
  9865 000056A1 80C230                  		add	dl, 30h ; '0'
  9866 000056A4 52                      		push	edx
  9867 000056A5 09C0                    		or	eax, eax
  9868 000056A7 75F4                    		jnz	short kbits_1
  9869                                  kbits_2:
  9870 000056A9 5A                      		pop	edx
  9871 000056AA 88D0                    		mov	al, dl
  9872 000056AC AA                      		stosb
  9873 000056AD 39EC                    		cmp	esp, ebp
  9874 000056AF 75F8                     		jne	short kbits_2
  9875 000056B1 B000                    		mov	al, 0
  9876 000056B3 AA                      		stosb
  9877                                  
  9878                                  		sys	_msg, msgKBitRate, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000056B4 BB[D3AF0000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 000056B9 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 000056BE BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000056C3 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 000056C8 CD40                <1>  int 40h
  9879                                  
  9880                                  		sys	_msg, txtSize, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000056CA BB[445C0500]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 000056CF B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 000056D4 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000056D9 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 000056DE CD40                <1>  int 40h
  9881                                  
  9882                                  		sys	_msg, msgKBits, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000056E0 BB[E0AF0000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 000056E5 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 000056EA BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 000056EF B823000000          <1>  mov eax, %1
   112                              <1> 
   113 000056F4 CD40                <1>  int 40h
  9883                                  
  9884                                  		sys	_msg, msgPlayback, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 000056F6 BB[E8AF0000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 000056FB B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005700 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005705 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000570A CD40                <1>  int 40h
  9885                                  
  9886 0000570C BE[FCAF0000]            		mov	esi, msg16Bits
  9887                                  		
  9888                                  		; 17/02/2025
  9889                                  		;	[mp3_bytes_per_sample] = 2
  9890                                  		;
  9891                                  		;cmp	byte [mp3_bytes_per_sample], 2
  9892                                  		;je	short wsr_1
  9893                                  		;mov	esi, msg8Bits
  9894                                  wsr_1:
  9895                                  		sys	_msg, esi, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00005711 89F3                <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00005713 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005718 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000571D B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00005722 CD40                <1>  int 40h
  9896                                  
  9897 00005724 BE[F5AF0000]            		mov	esi, msgMono
  9898 00005729 803D[BCC20000]01        		cmp	byte [mp3_num_channels], 1
  9899 00005730 7405                    		je	short wsr_2
  9900 00005732 BE[06B00000]            		mov	esi, msgStereo
  9901                                  wsr_2:
  9902                                  		sys	_msg, esi, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00005737 89F3                <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00005739 B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 0000573E BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005743 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 00005748 CD40                <1>  int 40h
  9903                                  
  9904                                  		sys	_msg, msgDuration, 255, 0Fh
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000574A BB[0FB00000]        <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 0000574F B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005754 BA0F000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005759 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000575E CD40                <1>  int 40h
  9905 00005760 C3                      		retn
  9906                                  
  9907                                  ;=============================================================================
  9908                                  ; drawscopes - draw wave/voice sample scopes
  9909                                  ;=============================================================================
  9910                                  
  9911                                  	; 15/02/2025	
  9912                                  	; 10/02/2025 - twavply3.s (32 bit)
  9913                                  	; 09/02/2025 - twavplay.asm (16bit)
  9914                                  	; 05/02/2025 - twavplay2.s
  9915                                  drawscopes:
  9916                                  	;call	get_current_sound_data
  9917                                  	; 15/02/2025
  9918 00005761 FF15[04100600]          	call	dword [get_sound_data]
  9919 00005767 BE[00200600]            	mov	esi, sounddata
  9920                                  
  9921 0000576C 31C9                    	xor     ecx, ecx
  9922 0000576E 31D2                    	xor     edx, edx
  9923 00005770 31FF                    	xor	edi, edi
  9924                                  drawscope0:
  9925 00005772 66AD                    	lodsw
  9926 00005774 80F480                  	xor	ah, 80h
  9927 00005777 0FB6DC                  	movzx	ebx, ah	; Left Channel
  9928 0000577A D1E3                    	shl	ebx, 1
  9929 0000577C 668B83[F0510500]        	mov	ax, [RowOfs+ebx]
  9930 00005783 668987[F0530500]        	mov	[NewScope_L+edi], ax
  9931 0000578A 30FF                    	xor	bh, bh
  9932 0000578C 66AD                    	lodsw
  9933 0000578E 80F480                  	xor	ah, 80h
  9934 00005791 88E3                    	mov	bl, ah	; Right Channel
  9935 00005793 D1E3                    	shl	ebx, 1
  9936 00005795 668B83[F0510500]        	mov	ax, [RowOfs+ebx]
  9937 0000579C 668987[F0550500]        	mov	[NewScope_R+edi], ax
  9938 000057A3 6683C702                	add	di, 2
  9939 000057A7 FEC1                    	inc	cl
  9940 000057A9 75C7                    	jnz	short drawscope0
  9941                                  
  9942 000057AB 66BAC403                	mov	dx, 3C4h
  9943                                  	;mov	ax, 0802h
  9944                                          ;out	dx, ax
  9945 000057AF 66BB0208                        mov	bx, 0802h
  9946 000057B3 B403                    	mov	ah, 3 ; outw
  9947 000057B5 CD34                    	int	34h
  9948                                  
  9949                                  	;mov	dx, 3CEh
  9950 000057B7 B2CE                    	mov	dl, 0CEh
  9951 000057B9 B008                    	mov	al, 08h
  9952                                         ;out	dx, al
  9953 000057BB B401                            mov	ah, 1 ; outb
  9954 000057BD CD34                    	int	34h
  9955                                  
  9956 000057BF 42                      	inc	edx
  9957                                  
  9958 000057C0 31F6                    	xor	esi, esi
  9959 000057C2 BB45060A00              	mov	ebx, 0A0645h
  9960                                  drawscopel4:
  9961 000057C7 B080                    	mov     al, 80h
  9962                                  drawscopel2:
  9963 000057C9 50                      	push	eax ; **
  9964 000057CA 52                      	push	edx ; *
  9965                                  	;out	dx, al
  9966 000057CB B401                    	mov	ah, 1 ; outb
  9967 000057CD CD34                    	int	34h
  9968                                  
  9969                                  	;mov	ecx, 32
  9970 000057CF B120                    	mov	cl, 32
  9971 000057D1 66B800FF                	mov	ax, 0FF00h
  9972                                  drawscopel3:
  9973 000057D5 668BBE[F0570500]                mov	di, [OldScope_L+esi]
  9974 000057DC 668B96[F0530500]        	mov	dx, [NewScope_L+esi]
  9975 000057E3 39D7                            cmp	edi, edx
  9976 000057E5 740D                            je	short drawscopef3
  9977 000057E7 88043B                  	mov	[ebx+edi], al ; L
  9978 000057EA 882413                  	mov	[ebx+edx], ah ; L
  9979 000057ED 668996[F0570500]                mov     [OldScope_L+esi], dx
  9980                                  drawscopef3:
  9981 000057F4 668BBE[F0590500]        	mov	di, [OldScope_R+esi]
  9982 000057FB 668B96[F0550500]        	mov	dx, [NewScope_R+esi]
  9983 00005802 39D7                    	cmp	edi, edx
  9984 00005804 740F                    	je	short drawscopef4
  9985 00005806 88443B26                	mov	[ebx+edi+38], al ; R
  9986 0000580A 88641326                	mov	[ebx+edx+38], ah ; R
  9987 0000580E 668996[F0590500]        	mov     [OldScope_R+esi], dx
  9988                                  drawscopef4:
  9989 00005815 83C610                  	add	esi, 2*8
  9990 00005818 43                      	inc	ebx
  9991 00005819 E2BA                    	loop    drawscopel3
  9992                                  
  9993 0000581B 5A                              pop     edx ; *
  9994 0000581C 58                              pop     eax ; **
  9995 0000581D 81EEFE010000            	sub	esi, 2*256-2
  9996 00005823 83EB20                  	sub	ebx, 32
  9997 00005826 D0E8                            shr     al, 1
  9998 00005828 759F                            jnz	short drawscopel2
  9999 0000582A F8                      	clc
 10000 0000582B C3                              retn
 10001                                  
 10002                                  
 10003                                  ; =============== S U B R O U T I N E =======================================
 10004                                  
 10005                                  ; --------------------------------------------------------
 10006                                  ; 15/02/2025 - Get Current Sound Data For Graphics
 10007                                  ; --------------------------------------------------------
 10008                                  
 10009                                  	; 15/02/2025 (tmp3play.s)
 10010                                  get_ac97_sound_data:
 10011                                  	; [sd_count] = 1024
 10012                                  	sys	_audio,	0F00h, [sd_count], sounddata
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000582C BB000F0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 00005831 8B0D[60B20000]      <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005837 BA[00200600]        <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 0000583C B820000000          <1>  mov eax, %1
   112                              <1> 
   113 00005841 CD40                <1>  int 40h
 10013 00005843 C3                      	retn
 10014                                  
 10015                                  ; --------------------------------------------------------
 10016                                  
 10017                                  	; 15/02/2025 (tmp3play.s)
 10018                                  get_sb16_sound_data:
 10019 00005844 BE[00240600]            	mov	esi, sounddata2
 10020                                  	sys	_audio,	0F00h, [sd_count], esi
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 00005849 BB000F0000          <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 0000584E 8B0D[60B20000]      <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005854 89F2                <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005856 B820000000          <1>  mov eax, %1
   112                              <1> 
   113 0000585B CD40                <1>  int 40h
 10021 0000585D BF[00200600]            	mov	edi, sounddata
 10022 00005862 FF25[00100600]          	jmp	dword [sounddata_copy]
 10023                                  
 10024                                  ; --------------------------------------------------------
 10025                                  
 10026                                  ;	; 15/02/2025
 10027                                  ;	; 10/02/2025 - twavply3.s (32bit)
 10028                                  ;	; 09/02/2025 - twavplay.asm (16bit)
 10029                                  ;sdc_16bit_stereo:
 10030                                  ;	; esi = source/dma sound data buffer address
 10031                                  ;	; ecx =	load (source) count = 1024
 10032                                  ;	; edi = target sound data buffer
 10033                                  ;	;shr	ecx, 1
 10034                                  ;	;rep	movsw
 10035                                  ;	shr	ecx, 2
 10036                                  ;	rep	movsd
 10037                                  ;	retn
 10038                                  
 10039                                  ; --------------------------------------------------------
 10040                                  
 10041                                  	; 15/02/2025
 10042                                  	; 10/02/2025 - twavply3.s (32bit)
 10043                                  	; 09/02/2025 - twavplay.asm (16bit)
 10044                                  sdc_16bit_mono:
 10045                                  	; esi = source/dma sound data buffer address
 10046                                  	; ecx = load (source) count = 512
 10047                                  	; edi = target sound data buffer
 10048 00005868 D1E9                    	shr	ecx, 1
 10049                                  sdc_16bm_loop:
 10050 0000586A 66AD                    	lodsw
 10051 0000586C 66AB                    	stosw
 10052 0000586E 66AB                    	stosw
 10053 00005870 E2F8                    	loop	sdc_16bm_loop
 10054 00005872 C3                      	retn
 10055                                  
 10056                                  ; --------------------------------------------------------
 10057                                  
 10058                                  	; 15/02/2025
 10059                                  	; 10/02/2025 - twavply3.s (32bit)
 10060                                  	; 09/02/2025 - twavplay.asm (16bit)
 10061                                  sdc_8bit_stereo:
 10062                                  	; esi = source/dma sound data buffer address
 10063                                  	; ecx = load (source) count = 512
 10064                                  	; edi = target sound data buffer
 10065                                  
 10066                                  	; convert to 16 bit sample
 10067                                  sdc_8bs_loop:
 10068 00005873 AC                      	lodsb
 10069 00005874 2C80                    	sub	al, 80h ; middle = 0, min = -128, max = 127
 10070 00005876 66C1E008                	shl	ax, 8
 10071 0000587A 66AB                    	stosw
 10072 0000587C E2F5                    	loop	sdc_8bs_loop
 10073 0000587E C3                      	retn
 10074                                  
 10075                                  ; --------------------------------------------------------
 10076                                  
 10077                                  	; 15/02/2025
 10078                                  	; 10/02/2025 - twavply3.s (32bit)
 10079                                  	; 09/02/2025 - twavplay.asm (16bit)
 10080                                  sdc_8bit_mono:
 10081                                  	; esi = source/dma sound data buffer
 10082                                  	; ecx = load (source) count = 256
 10083                                  	; edi = target sound data buffer
 10084                                  
 10085                                  	; convert to 16 bit sample
 10086                                  sdc_8bm_loop:
 10087 0000587F AC                      	lodsb
 10088 00005880 2C80                    	sub	al, 80h ; middle = 0, min = -128, max = 127
 10089 00005882 66C1E008                	shl	ax, 8
 10090 00005886 66AB                    	stosw	; L
 10091                                  	; convert to stereo
 10092 00005888 66AB                    	stosw	; R
 10093 0000588A E2F3                    	loop	sdc_8bm_loop
 10094 0000588C C3                      	retn
 10095                                  
 10096                                  ; =============== S U B R O U T I N E =======================================
 10097                                  
 10098                                  		; 16/02/2025
 10099                                  print_err_msg:
 10100                                  		sys	_msg, esi, 255, 0Ch
    98                              <1> 
    99                              <1> 
   100                              <1> 
   101                              <1> 
   102                              <1>  %if %0 >= 2
   103 0000588D 89F3                <1>  mov ebx, %2
   104                              <1>  %if %0 >= 3
   105 0000588F B9FF000000          <1>  mov ecx, %3
   106                              <1>  %if %0 = 4
   107 00005894 BA0C000000          <1>  mov edx, %4
   108                              <1>  %endif
   109                              <1>  %endif
   110                              <1>  %endif
   111 00005899 B823000000          <1>  mov eax, %1
   112                              <1> 
   113 0000589E CD40                <1>  int 40h
 10101 000058A0 F9                      		stc	; (needed)	
 10102 000058A1 C3                      		retn
 10103                                  
 10104                                  ;-----------------------------------------------------------------------------
 10105                                  
 10106                                  ; 16/02/2025
 10107                                  ; 10/02/2025 (twavply3.s)
 10108                                  ;=============================================================================
 10109                                  ;	Load IFF/ILBM files for VGA 640x480x16 graphics mode
 10110                                  ;=============================================================================
 10111                                  
 10112                                  ; EX1B.ASM (21/6/1994, Carlos Hasan; MSDOS, 'RUNME.EXE', 'TNYPL211')
 10113                                  
 10114                                  ; 21/10/2017 (TRDOS 386, 'tmodplay.s', Erdogan Tan, NASM syntax)
 10115                                  
 10116                                  ;-----------------------------------------------------------------------------
 10117                                  ; EQUATES AND STRUCTURES
 10118                                  ;-----------------------------------------------------------------------------
 10119                                  
 10120                                  ID_FORM equ 4D524F46h		; IFF/ILBM chunk IDs
 10121                                  ID_ILBM equ 4D424C49h
 10122                                  ID_BMHD equ 44484D42h
 10123                                  ID_CMAP equ 50414D43h
 10124                                  ID_BODY equ 59444F42h
 10125                                  
 10126                                  struc Form			; IFF/ILBM header file format
 10127 00000000 ????????                  .ID:		resd 1
 10128 00000004 ????????                  .Length:	resd 1
 10129 00000008 ????????                  .Type:	resd 1
 10130                                    .size:
 10131                                  endstruc
 10132                                  
 10133                                  struc Chunk			; IFF/ILBM header chunk format
 10134 00000000 ????????                  .ID:		resd 1
 10135 00000004 ????????                  .Length:	resd 1
 10136                                    .size:
 10137                                  endstruc
 10138                                  
 10139                                  struc BMHD			; IFF/ILBM BMHD chunk format
 10140 00000000 ????                      .Width: 	resw 1
 10141 00000002 ????                      .Height:	resw 1
 10142 00000004 ????                      .PosX:	resw 1
 10143 00000006 ????                      .PosY:	resw 1
 10144 00000008 ??                        .Planes:	resb 1
 10145 00000009 ??                        .Masking:	resb 1
 10146 0000000A ??                        .Compression:	resb 1
 10147 0000000B ??                        .Pad:		resb 1
 10148 0000000C ????                      .Transparent:	resw 1
 10149 0000000E ??                        .AspectX	resb 1
 10150 0000000F ??                        .AspectY:	resb 1
 10151 00000010 ????                      .PageWidth:	resw 1
 10152 00000012 ????                      .PageHeight:	resw 1
 10153                                    .size:
 10154                                  endstruc
 10155                                  
 10156                                  struc CMAP			; IFF/ILBM CMAP chunk format
 10157 00000000 <res 300h>                .Colors:	resb 768
 10158                                    .size:
 10159                                  endstruc
 10160                                  
 10161                                  ;------------------------------------------------------------------------------
 10162                                  ; bswap - macro to reverse the byte order of a 32-bit register, converting
 10163                                  ;         a value in little/big endian form to big/little endian form.
 10164                                  ;------------------------------------------------------------------------------
 10165                                  
 10166                                  %macro	bswap   1
 10167                                  	xchg    al, ah
 10168                                  	rol     eax, 16
 10169                                  	xchg    al, ah
 10170                                  %endmacro
 10171                                  
 10172                                  ; ---------------------------------------------------------------------------
 10173                                  ; 25/01/2025 - Player Window Display Functions
 10174                                  ; ---------------------------------------------------------------------------
 10175                                  ; ref: vgaplay2.s (18/01/2025)
 10176                                  
 10177                                  ; =============== S U B R O U T I N E =======================================
 10178                                  
 10179                                  		; 15/02/2025
 10180                                  drawplayingscreen:
 10181                                  		; 10/02/2025 - twavply3.s
 10182                                  		; 05/02/2025 - twavply2.s
 10183                                  putlbm:
 10184 000058A2 BE[B4590000]            		mov	esi, LOGO_ADDRESS
 10185                                  	
 10186                                  		;pushad
 10187                                  
 10188                                  ; check if this is a valid IFF/ILBM Deluxe Paint file
 10189                                  
 10190                                  		;cmp	dword [esi+Form.ID], ID_FORM
 10191                                  		;jne	short putlbmd0
 10192                                  		;cmp	dword [esi+Form.Type], ID_ILBM
 10193                                  		;jne	short putlbmd0
 10194                                  
 10195                                  ; get the IFF/ILBM file length in bytes
 10196                                  
 10197 000058A7 8B4604                  		mov	eax, [esi+Form.Length]
 10198                                  		bswap	eax
 10167 000058AA 86E0                <1>  xchg al, ah
 10168 000058AC C1C010              <1>  rol eax, 16
 10169 000058AF 86E0                <1>  xchg al, ah
 10199 000058B1 89C1                    		mov	ecx, eax
 10200                                  
 10201                                  ; decrease the file length and updates the file pointer
 10202                                  
 10203 000058B3 83E904                  		sub	ecx, 4
 10204 000058B6 83C60C                  		add	esi, Form.size
 10205                                  
 10206                                  ; IFF/ILBM main parser body loop
 10207                                  
 10208                                  putlbml0:
 10209 000058B9 85C9                    		test	ecx, ecx
 10210 000058BB 7E63                    		jle	short putlbmd1
 10211                                  
 10212                                  ; get the next chunk ID and length in bytes
 10213                                  
 10214 000058BD 8B1E                    		mov	ebx, [esi+Chunk.ID]
 10215 000058BF 8B4604                  		mov	eax, [esi+Chunk.Length]
 10216                                  		bswap	eax
 10167 000058C2 86E0                <1>  xchg al, ah
 10168 000058C4 C1C010              <1>  rol eax, 16
 10169 000058C7 86E0                <1>  xchg al, ah
 10217 000058C9 93                      		xchg	ebx, eax
 10218 000058CA 83C608                  		add	esi, Chunk.size
 10219                                  
 10220                                  ; word align the chunk length and decrease the file length counter
 10221                                  
 10222 000058CD 43                      		inc	ebx
 10223 000058CE 80E3FE                  		and	bl, 0FEh ; ~1
 10224 000058D1 83E908                  		sub	ecx, Chunk.size
 10225 000058D4 29D9                    		sub	ecx, ebx
 10226                                  
 10227                                  ; check for the BMHD/CMAP/BODY chunk headers
 10228                                  
 10229 000058D6 3D424D4844              		cmp	eax, ID_BMHD
 10230 000058DB 7414                    		je	short putlbmf0
 10231 000058DD 3D434D4150              		cmp	eax, ID_CMAP
 10232 000058E2 743E                    		je	short putlbmf1
 10233 000058E4 3D424F4459              		cmp	eax, ID_BODY
 10234 000058E9 7452                    		je	short putlbmf2
 10235                                  
 10236                                  ; advance to the next IFF/ILBM chunk structure
 10237                                  
 10238                                  putlbmc0:
 10239 000058EB 01DE                    		add	esi, ebx
 10240 000058ED EBCA                    		jmp	short putlbml0
 10241                                  
 10242                                  putlbmd0:
 10243 000058EF F9                      		stc
 10244                                  		;popad
 10245 000058F0 C3                      		retn
 10246                                  
 10247                                  ; process the BMHD bitmap header chunk
 10248                                  
 10249                                  putlbmf0:
 10250 000058F1 807E0804                		cmp	byte [esi+BMHD.Planes], 4
 10251 000058F5 75F8                    		jne	short putlbmd0
 10252 000058F7 807E0A01                		cmp	byte [esi+BMHD.Compression], 1
 10253 000058FB 75F2                    		jne	short putlbmd0
 10254 000058FD 807E0B00                		cmp	byte [esi+BMHD.Pad], 0
 10255 00005901 75EC                    		jne	short putlbmd0
 10256 00005903 0FB706                  		movzx	eax, word [esi+BMHD.Width]
 10257 00005906 86E0                    		xchg	al, ah
 10258 00005908 83C007                  		add	eax, 7
 10259 0000590B C1E803                  		shr	eax, 3
 10260 0000590E A3[4CB20000]            		mov	[picture.width], eax
 10261 00005913 0FB74602                		movzx	eax, word [esi+BMHD.Height]
 10262 00005917 86E0                    		xchg	al, ah
 10263 00005919 A3[50B20000]            		mov	[picture.height], eax
 10264 0000591E EBCB                    		jmp	short putlbmc0
 10265                                  
 10266                                  putlbmd1:
 10267 00005920 F8                      		clc
 10268                                  		;popad
 10269 00005921 C3                      		retn
 10270                                  
 10271                                  ; process the CMAP colormap chunk
 10272                                  
 10273                                  putlbmf1:
 10274 00005922 66BAC803                		mov	dx, 3C8h
 10275 00005926 30C0                    		xor	al, al
 10276                                  		;out	dx, al
 10277 00005928 B401                    		mov	ah, 1 ; outb
 10278 0000592A CD34                    		int	34h
 10279                                  		;inc	dx
 10280 0000592C 42                      		inc	edx
 10281                                  putlbml1:
 10282 0000592D 8A06                    		mov	al, [esi]
 10283 0000592F C0E802                  		shr	al, 2
 10284                                  		;out	dx, al
 10285                                  		;mov	ah, 1 ; outb
 10286 00005932 CD34                    		int	34h ; IOCTL interrupt (IN/OUT)
 10287 00005934 46                      		inc	esi
 10288 00005935 4B                      		dec	ebx
 10289 00005936 7FF5                    		jg	short putlbml1
 10290 00005938 E97CFFFFFF              		jmp	putlbml0
 10291                                  
 10292                                  ; process the BODY bitmap body chunk
 10293                                  
 10294                                  putlbmf2:
 10295 0000593D 60                      		pushad
 10296 0000593E BF00000A00              		mov	edi, 0A0000h
 10297                                  		;cld
 10298 00005943 66BACE03                		mov	dx, 3CEh
 10299                                  		;mov	ax, 0FF08h
 10300                                  		;out	dx, ax
 10301 00005947 66BB08FF                		mov	bx, 0FF08h
 10302 0000594B B403                    		mov	ah, 3 ; outw
 10303 0000594D CD34                    		int	34h ; IOCTL interrupt (IN/OUT)
 10304                                  		;mov	dx, 3C4h
 10305 0000594F B2C4                    		mov	dl, 0C4h
 10306 00005951 B002                    		mov	al, 02h
 10307                                  		;out	dx, al
 10308 00005953 B401                    		mov	ah, 1 ; outb
 10309 00005955 CD34                    		int	34h ; IOCTL interrupt (IN/OUT)
 10310                                  		;inc	dx
 10311 00005957 42                      		inc	edx
 10312 00005958 8B0D[50B20000]          		mov	ecx, [picture.height]
 10313                                  putlbml2:
 10314 0000595E 51                      		push	ecx
 10315 0000595F B011                    		mov	al, 11h
 10316                                  putlbml3:
 10317 00005961 50                      		push	eax
 10318 00005962 57                      		push	edi
 10319                                  		;out	dx, al
 10320 00005963 B401                    		mov	ah, 1 ; outb
 10321 00005965 CD34                    		int	34h ; IOCTL interrupt (IN/OUT)
 10322 00005967 8B1D[4CB20000]          		mov	ebx, [picture.width]
 10323                                  putlbml4:
 10324 0000596D AC                      		lodsb
 10325 0000596E 31C9                    		xor	ecx, ecx
 10326 00005970 84C0                    		test	al, al
 10327 00005972 7C09                    		jl	short putlbmf3
 10328                                  		;movzx	ecx, al
 10329 00005974 88C1                    		mov	cl, al
 10330 00005976 41                      		inc	ecx
 10331 00005977 29CB                    		sub	ebx, ecx
 10332 00005979 F3A4                    		rep	movsb
 10333 0000597B EB0A                    		jmp	short putlbmc4
 10334                                  putlbmf3:
 10335 0000597D F6D8                    		neg	al
 10336                                  		;movzx	ecx, al
 10337 0000597F 88C1                    		mov	cl, al
 10338 00005981 41                      		inc	ecx
 10339 00005982 29CB                    		sub	ebx, ecx
 10340 00005984 AC                      		lodsb
 10341 00005985 F3AA                    		rep	stosb
 10342                                  putlbmc4:
 10343 00005987 85DB                    		test	ebx, ebx
 10344 00005989 7FE2                    		jg	short putlbml4
 10345 0000598B 5F                      		pop	edi
 10346 0000598C 58                      		pop	eax
 10347 0000598D 00C0                    		add	al, al
 10348 0000598F 73D0                    		jnc	short putlbml3
 10349 00005991 83C750                  		add	edi, 80
 10350 00005994 59                      		pop	ecx
 10351 00005995 E2C7                    		loop	putlbml2
 10352 00005997 61                      		popad
 10353 00005998 E94EFFFFFF              		jmp	putlbmc0
 10354                                  
 10355                                  ; ---------------------------------------------------------------------------
 10356                                  ; 16/02/2025 - Tiny Player Logo (Screen Image)
 10357                                  ; ---------------------------------------------------------------------------
 10358                                  
 10359 0000599D 90<rep 3h>              align 4
 10360                                  
 10361 000059A0 00                      db 0
 10362 000059A1 54494E59504C41592E-     db 'TINYPLAY.LBM Start', 0
 10362 000059AA 4C424D205374617274-
 10362 000059B3 00                 
 10363                                  
 10364                                  LOGO_ADDRESS:
 10365 000059B4 <bin 4298h>             incbin "TINYPLAY.LBM"
 10366                                  
 10367 00009C4C 00                      db 0
 10368                                  
 10369 00009C4D 54494E59504C41592E-     db 'TINYPLAY.LBM End', 0
 10369 00009C56 4C424D20456E6400   
 10370                                  
 10371                                  ; ===========================================================================
 10372                                  ; end of TRDOS 386 specific procedures.
 10373                                  ; ---------------------------------------------------------------------------
 10374                                  
 10375                                  ; ===========================================================================
 10376                                  ; Initialized DATA
 10377                                  ; ===========================================================================
 10378                                  
 10379                                  ; 15/02/2025
 10380 00009C5E 90<rep 2h>              align 4
 10381                                                     
 10382                                  mp3_bitrate_tab:
 10383 00009C60 000020002800300038-     		dw  0,32,40,48,56,64,80,96,112,128,160,192,224,256,320, 0
 10383 00009C69 004000500060007000-
 10383 00009C72 8000A000C000E00000-
 10383 00009C7B 0140010000         
 10384 00009C80 000008001000180020-                     dw  0, 8,16,24,32,40,48,56,64,80,96,112,128,144,160, 0
 10384 00009C89 002800300038004000-
 10384 00009C92 500060007000800090-
 10384 00009C9B 00A0000000         
 10385                                  mp3_freq_tab:
 10386 00009CA0 44AC80BB007D            		dw 44100,48000,32000   
 10387                                  mp3_lsf_sf_expand_init_table:
 10388 00009CA6 000504040000            		db 0, 5, 4, 4, 0, 0
 10389 00009CAC 9001                                    dw 400                  ; 0..399 ; normal case
 10390 00009CAE 000504010C00                            db 0, 5, 4, 1, 0Ch, 0
 10391 00009CB4 F401                                    dw 500                  ; 400..499
 10392 00009CB6 000301011801                            db 0, 3, 1, 1, 18h, 1
 10393 00009CBC 0002                                    dw 512                  ; 500..511
 10394 00009CBE 010606012400                            db 1, 6, 6, 1, 24h, 0
 10395 00009CC4 6803                                    dw 872                  ; 512+360 ; 0..359 for 2nd channel of intensity stereo
 10396 00009CC6 010404013000                            db 1, 4, 4, 1, 30h, 0
 10397 00009CCC E803                                    dw 1000                 ; 512+488 ; 360..487
 10398 00009CCE 010301013C00                            db 1, 3, 1, 1, 3Ch, 0
 10399 00009CD4 0004                                    dw 1024                 ; 512+512 ; 488..511
 10400                                  mp3_synth_win_src:
 10401 00009CD6 010000000000000000-     		dw      1,     0,     0,     0,     0,     0,     1,     0
 10401 00009CDF 00000001000000     
 10402 00009CE6 000000000100000001-                     dw      0,     0,     1,     0,     1,     0,     1,     0
 10402 00009CEF 00000001000000     
 10403 00009CF6 010001000000010001-                     dw      1,     1,     0,     1,     1,     1,     1,     2
 10403 00009CFF 00010001000200     
 10404 00009D06 010002000100020002-                     dw      1,     2,     1,     2,     2,     3,     2,     3
 10404 00009D0F 00030002000300     
 10405 00009D16 020004000300030004-                     dw      2,     4,     3,     3,     4,     4,     4,     5
 10405 00009D1F 00040004000500     
 10406 00009D26 050005000500060006-                     dw      5,     5,     5,     6,     6,     6,     6,     7
 10406 00009D2F 00060006000700     
 10407 00009D36 070006000800070007-                     dw      7,     6,     8,     7,     7,     8,     7,     7
 10407 00009D3F 00080007000700     
 10408 00009D46 080007000700070006-                     dw      8,     7,     7,     7,     6,     6,     6,     5
 10408 00009D4F 00060006000500     
 10409 00009D56 51FEFCFFFDFFFEFFFF-                     dw 0FE51h,0FFFCh,0FFFDh,0FFFEh,0FFFFh,     0,     1,     3
 10409 00009D5F FF000001000300     
 10410 00009D66 03000600070008000B-                     dw      3,     6,     7,     8,   0Bh,   0Ch,   0Eh,   11h
 10410 00009D6F 000C000E001100     
 10411 00009D76 1300150017001A001C-                     dw    13h,   15h,   17h,   1Ah,   1Ch,   1Fh,   22h,   24h
 10411 00009D7F 001F0022002400     
 10412 00009D86 27002A002C002F0032-                     dw    27h,   2Ah,   2Ch,   2Fh,   32h,   35h,   36h,   3Ah
 10412 00009D8F 00350036003A00     
 10413 00009D96 3C003E004000420044-                     dw    3Ch,   3Eh,   40h,   42h,   44h,   45h,   47h,   48h
 10413 00009D9F 00450047004800     
 10414 00009DA6 490049004900490049-                     dw    49h,   49h,   49h,   49h,   49h,   48h,   46h,   45h
 10414 00009DAF 00480046004500     
 10415 00009DB6 430040003D003A0035-                     dw    43h,   40h,   3Dh,   3Ah,   35h,   31h,   2Bh,   27h
 10415 00009DBF 0031002B002700     
 10416 00009DC6 1F00190012000A0002-                     dw    1Fh,   19h,   12h,   0Ah,     2,0FFF9h,0FFEFh,0FFE6h
 10416 00009DCF 00F9FFEFFFE6FF     
 10417 00009DD6 3BF030003B00470053-                     dw 0F03Bh,   30h,   3Bh,   47h,   53h,   5Fh,   6Dh,   79h
 10417 00009DDF 005F006D007900     
 10418 00009DE6 86009500A100B000BD-                     dw    86h,   95h,  0A1h,  0B0h,  0BDh,  0CBh,  0D9h,  0E6h
 10418 00009DEF 00CB00D900E600     
 10419 00009DF6 F30001010D01190125-                     dw   0F3h,  101h,  10Dh,  119h,  125h,  130h,  13Ah,  144h
 10419 00009DFF 0130013A014401     
 10420 00009E06 4D0155015B01620166-                     dw   14Dh,  155h,  15Bh,  162h,  166h,  16Ah,  16Bh,  16Dh
 10420 00009E0F 016A016B016D01     
 10421 00009E16 6C016A01660160015A-                     dw   16Ch,  16Ah,  166h,  160h,  15Ah,  150h,  146h,  139h
 10421 00009E1F 01500146013901     
 10422 00009E26 2B011A010801F300DD-                     dw   12Bh,  11Ah,  108h,  0F3h,  0DDh,  0C5h,  0A9h,   8Eh
 10422 00009E2F 00C500A9008E00     
 10423 00009E36 6F004E002B000700E1-                     dw    6Fh,   4Eh,   2Bh,     7,0FFE1h,0FFB8h,0FF8Fh,0FF62h
 10423 00009E3F FFB8FF8FFF62FF     
 10424 00009E46 35FF06FFD5FEA4FE70-                     dw 0FF35h,0FF06h,0FED5h,0FEA4h,0FE70h,0FE3Ch,0FE06h,0FDD0h
 10424 00009E4F FE3CFE06FED0FD     
 10425 00009E56 0BCF9F02D702110349-                     dw 0CF0Bh,  29Fh,  2D7h,  311h,  349h,  382h,  3BBh,  3F4h
 10425 00009E5F 038203BB03F403     
 10426 00009E66 2C0464049A04D10405-                     dw   42Ch,  464h,  49Ah,  4D1h,  505h,  538h,  56Ah,  59Bh
 10426 00009E6F 0538056A059B05     
 10427 00009E76 C805F505200647066C-                     dw   5C8h,  5F5h,  620h,  647h,  66Ch,  68Fh,  6AFh,  6CCh
 10427 00009E7F 068F06AF06CC06     
 10428 00009E86 E506FC060F071F072B-                     dw   6E5h,  6FCh,  70Fh,  71Fh,  72Bh,  734h,  739h,  739h
 10428 00009E8F 07340739073907     
 10429 00009E96 370730072607170704-                     dw   737h,  730h,  726h,  717h,  704h,  6EDh,  6D3h,  6B4h
 10429 00009E9F 07ED06D306B406     
 10430 00009EA6 91066C0640061306E1-                     dw   691h,  66Ch,  640h,  613h,  5E1h,  5ABh,  573h,  537h
 10430 00009EAF 05AB0573053705     
 10431 00009EB6 F704B4046F042704DB-                     dw   4F7h,  4B4h,  46Fh,  427h,  3DBh,  38Fh,  33Eh,  2EDh
 10431 00009EBF 038F033E03ED02     
 10432 00009EC6 9A024402ED0195013D-                     dw   29Ah,  244h,  1EDh,  195h,  13Dh,  0E2h,   88h,   2Eh
 10432 00009ECF 01E20088002E00     
 10433 00009ED6 00                                      db    0
 10434 00009ED7 00                                      db    0
 10435                                  mp3_slen_table:
 10436 00009ED8 000000010002000303-     		dw  0000h, 0100h, 0200h, 0300h, 0003h, 0101h, 0201h, 0301h
 10436 00009EE1 00010101020103     
 10437 00009EE8 020102020203030103-                     dw  0102h, 0202h, 0302h, 0103h, 0203h, 0303h, 0204h, 0304h
 10437 00009EF1 02030304020403     
 10438                                  mp3_lsf_nsf_table:
 10439 00009EF8 060505050909090906-     		dd  05050506h, 09090909h, 09090906h
 10439 00009F01 090909             
 10440 00009F04 0605070309090C0606-                     dd  03070506h, 060C0909h, 060C0906h
 10440 00009F0D 090C06             
 10441 00009F10 0B0A0000121200000F-                     dd  00000A0Bh, 00001212h, 0000120Fh
 10441 00009F19 120000             
 10442 00009F1C 070707000C0C0C0006-                     dd  00070707h, 000C0C0Ch, 000C0F06h
 10442 00009F25 0F0C00             
 10443 00009F28 060606030C09090606-                     dd  03060606h, 0609090Ch, 06090C06h
 10443 00009F31 0C0906             
 10444 00009F34 080805000F0C090006-                     dd  00050808h, 00090C0Fh, 00091206h
 10444 00009F3D 120900             
 10445                                  huff_tree_list_data:
 10446 00009F40 1101100022021221        		db  11h,   1, 10h,   0, 22h,   2, 12h, 21h
 10447 00009F48 2011011000220212                        db  20h, 11h,   1, 10h,   0, 22h,   2, 12h
 10448 00009F50 2120101101003323                        db  21h, 20h, 10h, 11h,   1,   0, 33h, 23h
 10449 00009F58 3231130330221221                        db  32h, 31h, 13h,   3, 30h, 22h, 12h, 21h
 10450 00009F60 0220110110003303                        db    2, 20h, 11h,   1, 10h,   0, 33h,   3
 10451 00009F68 2332301331220212                        db  23h, 32h, 30h, 13h, 31h, 22h,   2, 12h
 10452 00009F70 2120011110005545                        db  21h, 20h,   1, 11h, 10h,   0, 55h, 45h
 10453 00009F78 5453354425521551                        db  54h, 53h, 35h, 44h, 25h, 52h, 15h, 51h
 10454 00009F80 0534504333244214                        db    5, 34h, 50h, 43h, 33h, 24h, 42h, 14h
 10455 00009F88 4140042332031331                        db  41h, 40h,   4, 23h, 32h,   3, 13h, 31h
 10456 00009F90 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10457 00009F98 1000555445533544                        db  10h,   0, 55h, 54h, 45h, 53h, 35h, 44h
 10458 00009FA0 2552051551344350                        db  25h, 52h,   5, 15h, 51h, 34h, 43h, 50h
 10459 00009FA8 3324421441044023                        db  33h, 24h, 42h, 14h, 41h,   4, 40h, 23h
 10460 00009FB0 3213310330220220                        db  32h, 13h, 31h,   3, 30h, 22h,   2, 20h
 10461 00009FB8 1221110110005545                        db  12h, 21h, 11h,   1, 10h,   0, 55h, 45h
 10462 00009FC0 3553540544255215                        db  35h, 53h, 54h,   5, 44h, 25h, 52h, 15h
 10463 00009FC8 5134435004244233                        db  51h, 34h, 43h, 50h,   4, 24h, 42h, 33h
 10464 00009FD0 4014412332133103                        db  40h, 14h, 41h, 23h, 32h, 13h, 31h,   3
 10465 00009FD8 3022021221201101                        db  30h, 22h,   2, 12h, 21h, 20h, 11h,   1
 10466 00009FE0 1000776776577566                        db  10h,   0, 77h, 67h, 76h, 57h, 75h, 66h
 10467 00009FE8 4774566537734655                        db  47h, 74h, 56h, 65h, 37h, 73h, 46h, 55h
 10468 00009FF0 5463277264077062                        db  54h, 63h, 27h, 72h, 64h,   7, 70h, 62h
 10469 00009FF8 4535065344177136                        db  45h, 35h,   6, 53h, 44h, 17h, 71h, 36h
 10470 0000A000 2625521551344316                        db  26h, 25h, 52h, 15h, 51h, 34h, 43h, 16h
 10471 0000A008 6160055024423304                        db  61h, 60h,   5, 50h, 24h, 42h, 33h,   4
 10472 0000A010 1441402332031331                        db  14h, 41h, 40h, 23h, 32h,   3, 13h, 31h
 10473 0000A018 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10474 0000A020 1000776776756647                        db  10h,   0, 77h, 67h, 76h, 75h, 66h, 47h
 10475 0000A028 7457555665377346                        db  74h, 57h, 55h, 56h, 65h, 37h, 73h, 46h
 10476 0000A030 4554355327726407                        db  45h, 54h, 35h, 53h, 27h, 72h, 64h,   7
 10477 0000A038 7117703663604425                        db  71h, 17h, 70h, 36h, 63h, 60h, 44h, 25h
 10478 0000A040 5205156226061661                        db  52h,   5, 15h, 62h, 26h,   6, 16h, 61h
 10479 0000A048 5134504333244214                        db  51h, 34h, 50h, 43h, 33h, 24h, 42h, 14h
 10480 0000A050 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 10481 0000A058 3022211202201101                        db  30h, 22h, 21h, 12h,   2, 20h, 11h,   1
 10482 0000A060 1000776776577566                        db  10h,   0, 77h, 67h, 76h, 57h, 75h, 66h
 10483 0000A068 4774655637735527                        db  47h, 74h, 65h, 56h, 37h, 73h, 55h, 27h
 10484 0000A070 7246641771077036                        db  72h, 46h, 64h, 17h, 71h,   7, 70h, 36h
 10485 0000A078 6345544406052662                        db  63h, 45h, 54h, 44h,   6,   5, 26h, 62h
 10486 0000A080 6116603553255215                        db  61h, 16h, 60h, 35h, 53h, 25h, 52h, 15h
 10487 0000A088 5134435004244214                        db  51h, 34h, 43h, 50h,   4, 24h, 42h, 14h
 10488 0000A090 3341233240033013                        db  33h, 41h, 23h, 32h, 40h,   3, 30h, 13h
 10489 0000A098 3122122102200011                        db  31h, 22h, 12h, 21h,   2, 20h,   0, 11h
 10490 0000A0A0 0110FEFCFDEDFFEF                        db    1, 10h,0FEh,0FCh,0FDh,0EDh,0FFh,0EFh
 10491 0000A0A8 DFEECFDEBFFBCEDC                        db 0DFh,0EEh,0CFh,0DEh,0BFh,0FBh,0CEh,0DCh
 10492 0000A0B0 AFE9ECDDFACDBEEB                        db 0AFh,0E9h,0ECh,0DDh,0FAh,0CDh,0BEh,0EBh
 10493 0000A0B8 9FF9EABDDB8FF8CC                        db  9Fh,0F9h,0EAh,0BDh,0DBh, 8Fh,0F8h,0CCh
 10494 0000A0C0 AE9E8E7F7EF7DAAD                        db 0AEh, 9Eh, 8Eh, 7Fh, 7Eh,0F7h,0DAh,0ADh
 10495 0000A0C8 BCCBF66FE85F9DD9                        db 0BCh,0CBh,0F6h, 6Fh,0E8h, 5Fh, 9Dh,0D9h
 10496 0000A0D0 F5E7ACBB4FF4CAE6                        db 0F5h,0E7h,0ACh,0BBh, 4Fh,0F4h,0CAh,0E6h
 10497 0000A0D8 F33F8DD82FF26E9C                        db 0F3h, 3Fh, 8Dh,0D8h, 2Fh,0F2h, 6Eh, 9Ch
 10498 0000A0E0 0FC95EAB7DD74EC8                        db  0Fh,0C9h, 5Eh,0ABh, 7Dh,0D7h, 4Eh,0C8h
 10499 0000A0E8 D63EB99BAA1FF1F0                        db 0D6h, 3Eh,0B9h, 9Bh,0AAh, 1Fh,0F1h,0F0h
 10500 0000A0F0 BAE5E48C6DE3E22E                        db 0BAh,0E5h,0E4h, 8Ch, 6Dh,0E3h,0E2h, 2Eh
 10501 0000A0F8 0E1EE1E05DD57CC7                        db  0Eh, 1Eh,0E1h,0E0h, 5Dh,0D5h, 7Ch,0C7h
 10502 0000A100 4D8BB8D49AA96CC6                        db  4Dh, 8Bh,0B8h,0D4h, 9Ah,0A9h, 6Ch,0C6h
 10503 0000A108 3DD37B2DD21DB75C                        db  3Dh,0D3h, 7Bh, 2Dh,0D2h, 1Dh,0B7h, 5Ch
 10504 0000A110 C5997AC3A7974BD1                        db 0C5h, 99h, 7Ah,0C3h,0A7h, 97h, 4Bh,0D1h
 10505 0000A118 0DD08AA84CC46BB6                        db  0Dh,0D0h, 8Ah,0A8h, 4Ch,0C4h, 6Bh,0B6h
 10506 0000A120 3C2CC25BB5891CC1                        db  3Ch, 2Ch,0C2h, 5Bh,0B5h, 89h, 1Ch,0C1h
 10507 0000A128 980CC0B46AA6793B                        db  98h, 0Ch,0C0h,0B4h, 6Ah,0A6h, 79h, 3Bh
 10508 0000A130 B3885A2BA569A478                        db 0B3h, 88h, 5Ah, 2Bh,0A5h, 69h,0A4h, 78h
 10509 0000A138 87947776B21BB10B                        db  87h, 94h, 77h, 76h,0B2h, 1Bh,0B1h, 0Bh
 10510 0000A140 B0964A3AA359952A                        db 0B0h, 96h, 4Ah, 3Ah,0A3h, 59h, 95h, 2Ah
 10511 0000A148 A21AA10A68A08649                        db 0A2h, 1Ah,0A1h, 0Ah, 68h,0A0h, 86h, 49h
 10512 0000A150 9339588567299257                        db  93h, 39h, 58h, 85h, 67h, 29h, 92h, 57h
 10513 0000A158 7538836647745665                        db  75h, 38h, 83h, 66h, 47h, 74h, 56h, 65h
 10514 0000A160 7319910990488472                        db  73h, 19h, 91h,   9, 90h, 48h, 84h, 72h
 10515 0000A168 4664288218372717                        db  46h, 64h, 28h, 82h, 18h, 37h, 27h, 17h
 10516 0000A170 7155077036634554                        db  71h, 55h,   7, 70h, 36h, 63h, 45h, 54h
 10517 0000A178 2662358108801661                        db  26h, 62h, 35h, 81h,   8, 80h, 16h, 61h
 10518 0000A180 0660534425520515                        db    6, 60h, 53h, 44h, 25h, 52h,   5, 15h
 10519 0000A188 5134435024423314                        db  51h, 34h, 43h, 50h, 24h, 42h, 33h, 14h
 10520 0000A190 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 10521 0000A198 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10522 0000A1A0 1000FFEFFEDFEEFD                        db  10h,   0,0FFh,0EFh,0FEh,0DFh,0EEh,0FDh
 10523 0000A1A8 CFFCDEEDBFFBCEEC                        db 0CFh,0FCh,0DEh,0EDh,0BFh,0FBh,0CEh,0ECh
 10524 0000A1B0 DDAFFABEEBCDDC9F                        db 0DDh,0AFh,0FAh,0BEh,0EBh,0CDh,0DCh, 9Fh
 10525 0000A1B8 F9EABDDB8FF8CC9E                        db 0F9h,0EAh,0BDh,0DBh, 8Fh,0F8h,0CCh, 9Eh
 10526 0000A1C0 E97FF7ADDABC6FAE                        db 0E9h, 7Fh,0F7h,0ADh,0DAh,0BCh, 6Fh,0AEh
 10527 0000A1C8 0FCBF68EE85F9DF5                        db  0Fh,0CBh,0F6h, 8Eh,0E8h, 5Fh, 9Dh,0F5h
 10528 0000A1D0 7EE7ACCABBD98D4F                        db  7Eh,0E7h,0ACh,0CAh,0BBh,0D9h, 8Dh, 4Fh
 10529 0000A1D8 F43FF3D8E62FF26E                        db 0F4h, 3Fh,0F3h,0D8h,0E6h, 2Fh,0F2h, 6Eh
 10530 0000A1E0 F01FF19CC95EABBA                        db 0F0h, 1Fh,0F1h, 9Ch,0C9h, 5Eh,0ABh,0BAh
 10531 0000A1E8 E57DD74EE48CC83E                        db 0E5h, 7Dh,0D7h, 4Eh,0E4h, 8Ch,0C8h, 3Eh
 10532 0000A1F0 6DD6E39BB92EAAE2                        db  6Dh,0D6h,0E3h, 9Bh,0B9h, 2Eh,0AAh,0E2h
 10533 0000A1F8 1EE10EE05DD57CC7                        db  1Eh,0E1h, 0Eh,0E0h, 5Dh,0D5h, 7Ch,0C7h
 10534 0000A200 4D8BD4B89AA96CC6                        db  4Dh, 8Bh,0D4h,0B8h, 9Ah,0A9h, 6Ch,0C6h
 10535 0000A208 3DD3D22D0D1D7BB7                        db  3Dh,0D3h,0D2h, 2Dh, 0Dh, 1Dh, 7Bh,0B7h
 10536 0000A210 D15CD0C58AA84CC4                        db 0D1h, 5Ch,0D0h,0C5h, 8Ah,0A8h, 4Ch,0C4h
 10537 0000A218 6BB6990C3CC37AA7                        db  6Bh,0B6h, 99h, 0Ch, 3Ch,0C3h, 7Ah,0A7h
 10538 0000A220 A6C00BC22C5BB51C                        db 0A6h,0C0h, 0Bh,0C2h, 2Ch, 5Bh,0B5h, 1Ch
 10539 0000A228 8998C14BB46A3B79                        db  89h, 98h,0C1h, 4Bh,0B4h, 6Ah, 3Bh, 79h
 10540 0000A230 B397882B5AB2A51B                        db 0B3h, 97h, 88h, 2Bh, 5Ah,0B2h,0A5h, 1Bh
 10541 0000A238 B1B069964AA47887                        db 0B1h,0B0h, 69h, 96h, 4Ah,0A4h, 78h, 87h
 10542 0000A240 3AA359952AA21AA1                        db  3Ah,0A3h, 59h, 95h, 2Ah,0A2h, 1Ah,0A1h
 10543 0000A248 0AA0688649943993                        db  0Ah,0A0h, 68h, 86h, 49h, 94h, 39h, 93h
 10544 0000A250 7709588529677692                        db  77h,   9, 58h, 85h, 29h, 67h, 76h, 92h
 10545 0000A258 9119904884577538                        db  91h, 19h, 90h, 48h, 84h, 57h, 75h, 38h
 10546 0000A260 8366472882188174                        db  83h, 66h, 47h, 28h, 82h, 18h, 81h, 74h
 10547 0000A268 0880566537734627                        db    8, 80h, 56h, 65h, 37h, 73h, 46h, 27h
 10548 0000A270 7264175571077036                        db  72h, 64h, 17h, 55h, 71h,   7, 70h, 36h
 10549 0000A278 6345542662160660                        db  63h, 45h, 54h, 26h, 62h, 16h,   6, 60h
 10550 0000A280 3561534425521551                        db  35h, 61h, 53h, 44h, 25h, 52h, 15h, 51h
 10551 0000A288 0550344324423341                        db    5, 50h, 34h, 43h, 24h, 42h, 33h, 41h
 10552 0000A290 1404233240031331                        db  14h,   4, 23h, 32h, 40h,   3, 13h, 31h
 10553 0000A298 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10554 0000A2A0 1000EFFEDFFDCFFC                        db  10h,   0,0EFh,0FEh,0DFh,0FDh,0CFh,0FCh
 10555 0000A2A8 BFFBAFFA9FF9F88F                        db 0BFh,0FBh,0AFh,0FAh, 9Fh,0F9h,0F8h, 8Fh
 10556 0000A2B0 7FF76FF6FF5FF54F                        db  7Fh,0F7h, 6Fh,0F6h,0FFh, 5Fh,0F5h, 4Fh
 10557 0000A2B8 F4F3F03FCEECDDDE                        db 0F4h,0F3h,0F0h, 3Fh,0CEh,0ECh,0DDh,0DEh
 10558 0000A2C0 E9EAD9EEEDEBBECD                        db 0E9h,0EAh,0D9h,0EEh,0EDh,0EBh,0BEh,0CDh
 10559 0000A2C8 DCDBAECCADDA7EAC                        db 0DCh,0DBh,0AEh,0CCh,0ADh,0DAh, 7Eh,0ACh
 10560 0000A2D0 CAC97D5EBDF22F0F                        db 0CAh,0C9h, 7Dh, 5Eh,0BDh,0F2h, 2Fh, 0Fh
 10561 0000A2D8 1FF19EBCCB8EE89D                        db  1Fh,0F1h, 9Eh,0BCh,0CBh, 8Eh,0E8h, 9Dh
 10562 0000A2E0 E7BB8DD86EE69CAB                        db 0E7h,0BBh, 8Dh,0D8h, 6Eh,0E6h, 9Ch,0ABh
 10563 0000A2E8 BAE5D74EE48CC83E                        db 0BAh,0E5h,0D7h, 4Eh,0E4h, 8Ch,0C8h, 3Eh
 10564 0000A2F0 6DD69BB9AAE1D4B8                        db  6Dh,0D6h, 9Bh,0B9h,0AAh,0E1h,0D4h,0B8h
 10565 0000A2F8 A97BB7D0E30EE05D                        db 0A9h, 7Bh,0B7h,0D0h,0E3h, 0Eh,0E0h, 5Dh
 10566 0000A300 D57CC74D8B9A6CC6                        db 0D5h, 7Ch,0C7h, 4Dh, 8Bh, 9Ah, 6Ch,0C6h
 10567 0000A308 3D5CC50D8AA8994C                        db  3Dh, 5Ch,0C5h, 0Dh, 8Ah,0A8h, 99h, 4Ch
 10568 0000A310 B67A3C5B891CC098                        db 0B6h, 7Ah, 3Ch, 5Bh, 89h, 1Ch,0C0h, 98h
 10569 0000A318 79E22E1ED32DD2D1                        db  79h,0E2h, 2Eh, 1Eh,0D3h, 2Dh,0D2h,0D1h
 10570 0000A320 3B97881DC46BC3A7                        db  3Bh, 97h, 88h, 1Dh,0C4h, 6Bh,0C3h,0A7h
 10571 0000A328 2CC2B5C10C4BB46A                        db  2Ch,0C2h,0B5h,0C1h, 0Ch, 4Bh,0B4h, 6Ah
 10572 0000A330 A6B35AA52BB21BB1                        db 0A6h,0B3h, 5Ah,0A5h, 2Bh,0B2h, 1Bh,0B1h
 10573 0000A338 0BB069964AA47887                        db  0Bh,0B0h, 69h, 96h, 4Ah,0A4h, 78h, 87h
 10574 0000A340 A33A592A9568A186                        db 0A3h, 3Ah, 59h, 2Ah, 95h, 68h,0A1h, 86h
 10575 0000A348 7794495767A21A0A                        db  77h, 94h, 49h, 57h, 67h,0A2h, 1Ah, 0Ah
 10576 0000A350 A039935885299276                        db 0A0h, 39h, 93h, 58h, 85h, 29h, 92h, 76h
 10577 0000A358 0919919048847538                        db    9, 19h, 91h, 90h, 48h, 84h, 75h, 38h
 10578 0000A360 8366288247741881                        db  83h, 66h, 28h, 82h, 47h, 74h, 18h, 81h
 10579 0000A368 8008563773654627                        db  80h,   8, 56h, 37h, 73h, 65h, 46h, 27h
 10580 0000A370 7264550717717036                        db  72h, 64h, 55h,   7, 17h, 71h, 70h, 36h
 10581 0000A378 6345542662166106                        db  63h, 45h, 54h, 26h, 62h, 16h, 61h,   6
 10582 0000A380 6053354425525115                        db  60h, 53h, 35h, 44h, 25h, 52h, 51h, 15h
 10583 0000A388 0534435024423314                        db    5, 34h, 43h, 50h, 24h, 42h, 33h, 14h
 10584 0000A390 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 10585 0000A398 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10586 0000A3A0 1000EFFEDFFDCFFC                        db  10h,   0,0EFh,0FEh,0DFh,0FDh,0CFh,0FCh
 10587 0000A3A8 BFFBFAAF9FF9F88F                        db 0BFh,0FBh,0FAh,0AFh, 9Fh,0F9h,0F8h, 8Fh
 10588 0000A3B0 7FF76FF65FF54FF4                        db  7Fh,0F7h, 6Fh,0F6h, 5Fh,0F5h, 4Fh,0F4h
 10589 0000A3B8 3FF32FF2F11FF00F                        db  3Fh,0F3h, 2Fh,0F2h,0F1h, 1Fh,0F0h, 0Fh
 10590 0000A3C0 EEDEEDCEECDDBEEB                        db 0EEh,0DEh,0EDh,0CEh,0ECh,0DDh,0BEh,0EBh
 10591 0000A3C8 CDDCAEEABDDBCC9E                        db 0CDh,0DCh,0AEh,0EAh,0BDh,0DBh,0CCh, 9Eh
 10592 0000A3D0 E9ADDABCCB8EE89D                        db 0E9h,0ADh,0DAh,0BCh,0CBh, 8Eh,0E8h, 9Dh
 10593 0000A3D8 D97EE7ACFFCABB8D                        db 0D9h, 7Eh,0E7h,0ACh,0FFh,0CAh,0BBh, 8Dh
 10594 0000A3E0 D80EE00DE66E9CC9                        db 0D8h, 0Eh,0E0h, 0Dh,0E6h, 6Eh, 9Ch,0C9h
 10595 0000A3E8 5EBAE5AB7DD7E48C                        db  5Eh,0BAh,0E5h,0ABh, 7Dh,0D7h,0E4h, 8Ch
 10596 0000A3F0 C84E2E3E6DD6E39B                        db 0C8h, 4Eh, 2Eh, 3Eh, 6Dh,0D6h,0E3h, 9Bh
 10597 0000A3F8 B9AAE21EE15DD57C                        db 0B9h,0AAh,0E2h, 1Eh,0E1h, 5Dh,0D5h, 7Ch
 10598 0000A400 C74D8BB8D49AA96C                        db 0C7h, 4Dh, 8Bh,0B8h,0D4h, 9Ah,0A9h, 6Ch
 10599 0000A408 C63DD32DD21D7BB7                        db 0C6h, 3Dh,0D3h, 2Dh,0D2h, 1Dh, 7Bh,0B7h
 10600 0000A410 D15CC58AA8994CC4                        db 0D1h, 5Ch,0C5h, 8Ah,0A8h, 99h, 4Ch,0C4h
 10601 0000A418 6BB6D00C3CC37AA7                        db  6Bh,0B6h,0D0h, 0Ch, 3Ch,0C3h, 7Ah,0A7h
 10602 0000A420 2CC25BB51C8998C1                        db  2Ch,0C2h, 5Bh,0B5h, 1Ch, 89h, 98h,0C1h
 10603 0000A428 4BC00B3BB00A1AB4                        db  4Bh,0C0h, 0Bh, 3Bh,0B0h, 0Ah, 1Ah,0B4h
 10604 0000A430 6AA67997A00990B3                        db  6Ah,0A6h, 79h, 97h,0A0h,   9, 90h,0B3h
 10605 0000A438 882B5AB2A51BB169                        db  88h, 2Bh, 5Ah,0B2h,0A5h, 1Bh,0B1h, 69h
 10606 0000A440 96A44A78873AA359                        db  96h,0A4h, 4Ah, 78h, 87h, 3Ah,0A3h, 59h
 10607 0000A448 952AA2A168867749                        db  95h, 2Ah,0A2h,0A1h, 68h, 86h, 77h, 49h
 10608 0000A450 9439935885296776                        db  94h, 39h, 93h, 58h, 85h, 29h, 67h, 76h
 10609 0000A458 9219914884577538                        db  92h, 19h, 91h, 48h, 84h, 57h, 75h, 38h
 10610 0000A460 8366288218477481                        db  83h, 66h, 28h, 82h, 18h, 47h, 74h, 81h
 10611 0000A468 0880566517077073                        db    8, 80h, 56h, 65h, 17h,   7, 70h, 73h
 10612 0000A470 3727724664557136                        db  37h, 27h, 72h, 46h, 64h, 55h, 71h, 36h
 10613 0000A478 6345542662166106                        db  63h, 45h, 54h, 26h, 62h, 16h, 61h,   6
 10614 0000A480 6035534425521505                        db  60h, 35h, 53h, 44h, 25h, 52h, 15h,   5
 10615 0000A488 5051344324423314                        db  50h, 51h, 34h, 43h, 24h, 42h, 33h, 14h
 10616 0000A490 4104402332133103                        db  41h,   4, 40h, 23h, 32h, 13h, 31h,   3
 10617 0000A498 3022122102201101                        db  30h, 22h, 12h, 21h,   2, 20h, 11h,   1
 10618 0000A4A0 10000B0F0D0E0705                        db  10h,   0, 0Bh, 0Fh, 0Dh, 0Eh,   7,   5
 10619 0000A4A8 0906030A0C020104                        db    9,   6,   3, 0Ah, 0Ch,   2,   1,   4
 10620 0000A4B0 08000F0E0D0C0B0A                        db    8,   0, 0Fh, 0Eh, 0Dh, 0Ch, 0Bh, 0Ah
 10621 0000A4B8 0908070605040302                        db    9,   8,   7,   6,   5,   4,   3,   2
 10622 0000A4C0 0100                                    db    1,   0
 10623 0000A4C2 000000000000                            db 6 dup(0)
 10624                                  mp3_huff_data:
 10625 0000A4C8 0000                    		db   0,  0             
 10626 0000A4CA 0100                                    db   1,  0              ; byte[32][2] ; table,linbits
 10627 0000A4CC 0200                                    db   2,  0
 10628 0000A4CE 0300                                    db   3,  0
 10629 0000A4D0 0000                                    db   0,  0
 10630 0000A4D2 0400                                    db   4,  0
 10631 0000A4D4 0500                                    db   5,  0
 10632 0000A4D6 0600                                    db   6,  0
 10633 0000A4D8 0700                                    db   7,  0
 10634 0000A4DA 0800                                    db   8,  0
 10635 0000A4DC 0900                                    db   9,  0
 10636 0000A4DE 0A00                                    db  10,  0
 10637 0000A4E0 0B00                                    db  11,  0
 10638 0000A4E2 0C00                                    db  12,  0
 10639 0000A4E4 0000                                    db   0,  0
 10640 0000A4E6 0D00                                    db  13,  0
 10641 0000A4E8 0E01                                    db  14,  1
 10642 0000A4EA 0E02                                    db  14,  2
 10643 0000A4EC 0E03                                    db  14,  3
 10644 0000A4EE 0E04                                    db  14,  4
 10645 0000A4F0 0E06                                    db  14,  6
 10646 0000A4F2 0E08                                    db  14,  8
 10647 0000A4F4 0E0A                                    db  14, 10
 10648 0000A4F6 0E0D                                    db  14, 13
 10649 0000A4F8 0F04                                    db  15,  4
 10650 0000A4FA 0F05                                    db  15,  5
 10651 0000A4FC 0F06                                    db  15,  6
 10652 0000A4FE 0F07                                    db  15,  7
 10653 0000A500 0F08                                    db  15,  8
 10654 0000A502 0F09                                    db  15,  9
 10655 0000A504 0F0B                                    db  15, 11
 10656 0000A506 0F0D                                    db  15, 13
 10657                                  mp3_band_size_long:
 10658 0000A508 040404040404060608-     		db    4,   4,   4,   4,   4,   4,   6,   6,   8,   8, 0Ah
 10658 0000A511 080A               
 10659 0000A513 0C1014181C222A3236-                     db  0Ch, 10h, 14h, 18h, 1Ch, 22h, 2Ah, 32h, 36h, 4Ch, 9Eh ; byte[9][22]
 10659 0000A51C 4C9E               
 10660 0000A51E 040404040404060606-                     db    4,   4,   4,   4,   4,   4,   6,   6,   6,   8, 0Ah
 10660 0000A527 080A               
 10661 0000A529 0C1012161C22282E36-                     db  0Ch, 10h, 12h, 16h, 1Ch, 22h, 28h, 2Eh, 36h, 36h,0C0h
 10661 0000A532 36C0               
 10662 0000A534 040404040404060608-                     db    4,   4,   4,   4,   4,   4,   6,   6,   8, 0Ah, 0Ch
 10662 0000A53D 0A0C               
 10663 0000A53F 1014181E262E384454-                     db  10h, 14h, 18h, 1Eh, 26h, 2Eh, 38h, 44h, 54h, 66h, 1Ah
 10663 0000A548 661A               
 10664 0000A54A 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 10664 0000A553 0E10               
 10665 0000A555 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 10665 0000A55E 3A36               
 10666 0000A560 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 10666 0000A569 0E10               
 10667 0000A56B 12161A20262E344046-                     db  12h, 16h, 1Ah, 20h, 26h, 2Eh, 34h, 40h, 46h, 4Ch, 24h
 10667 0000A574 4C24               
 10668 0000A576 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 10668 0000A57F 0E10               
 10669 0000A581 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 10669 0000A58A 3A36               
 10670 0000A58C 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 10670 0000A595 0E10               
 10671 0000A597 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 10671 0000A5A0 3A36               
 10672 0000A5A2 060606060606080A0C-                     db    6,   6,   6,   6,   6,   6,   8, 0Ah, 0Ch, 0Eh, 10h
 10672 0000A5AB 0E10               
 10673 0000A5AD 14181C20262E343C44-                     db  14h, 18h, 1Ch, 20h, 26h, 2Eh, 34h, 3Ch, 44h, 3Ah, 36h
 10673 0000A5B6 3A36               
 10674 0000A5B8 0C0C0C0C0C0C101418-                     db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 10h, 14h, 18h, 1Ch, 20h
 10674 0000A5C1 1C20               
 10675 0000A5C3 283038404C5A020202-                     db  28h, 30h, 38h, 40h, 4Ch, 5Ah,   2,   2,   2,   2,   2
 10675 0000A5CC 0202               
 10676 0000A5CE 000000000000000000-                     db 10 dup(0)            ; data align
 10676 0000A5D7 00                 
 10677                                  mp3_band_size_short:
 10678 0000A5D8 0404040406080A0C0E-     		db    4,   4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 16h, 1Eh, 38h
 10678 0000A5E1 12161E38           
 10679 0000A5E5 0404040406060A0C0E-                     db    4,   4,   4,   4,   6,   6, 0Ah, 0Ch, 0Eh, 10h, 14h, 1Ah, 42h ; byte[9][16] ? ; byte [9][13]
 10679 0000A5EE 10141A42           
 10680 0000A5F2 0404040406080C1014-                     db    4,   4,   4,   4,   6,   8, 0Ch, 10h, 14h, 1Ah, 22h, 2Ah, 0Ch
 10680 0000A5FB 1A222A0C           
 10681 0000A5FF 0404040606080A0E12-                     db    4,   4,   4,   6,   6,   8, 0Ah, 0Eh, 12h, 1Ah, 20h, 2Ah, 12h
 10681 0000A608 1A202A12           
 10682 0000A60C 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 20h, 2Ch, 0Ch
 10682 0000A615 18202C0C           
 10683 0000A619 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 1Eh, 28h, 12h
 10683 0000A622 181E2812           
 10684 0000A626 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 1Eh, 28h, 12h
 10684 0000A62F 181E2812           
 10685 0000A633 04040406080A0C0E12-                     db    4,   4,   4,   6,   8, 0Ah, 0Ch, 0Eh, 12h, 18h, 1Eh, 28h, 12h
 10685 0000A63C 181E2812           
 10686 0000A640 0808080C1014181C24-                     db    8,   8,   8, 0Ch, 10h, 14h, 18h, 1Ch, 24h,   2,   2,   2, 1Ah
 10686 0000A649 0202021A           
 10687 0000A64D 000000000000000000-                     db 11 dup(0)            ; data align
 10687 0000A656 0000               
 10688                                  mp3_pretab:
 10689 0000A658 000000000000000000-     		db    0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0
 10689 0000A661 0000               
 10690 0000A663 000000000000000000-                     db    0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0
 10690 0000A66C 0000               
 10691 0000A66E 000000000000000000-                     db    0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0
 10691 0000A677 0000               
 10692 0000A679 010101010202030303-                     db    1,   1,   1,   1,   2,   2,   3,   3,   3,   2,   0
 10692 0000A682 0200               
 10693 0000A684 00000000                                db 4 dup(0)             ; data align
 10694                                  mp3_mdct_win_src:
 10695 0000A688 4B1D4200028FDB0016-     		dd  00421D4Bh, 00DB8F02h, 019C7F16h, 029ADCC0h, 04000001h, 06246711h
 10695 0000A691 7F9C01C0DC9A020100-
 10695 0000A69A 000411672406       
 10696 0000A6A0 4506EE090CD6A71238-                     dd  09EE0645h, 12A7D60Ch, 3DF40538h,0BC63D32Fh,0E7B0025Bh,0F069D222h ; these are sine values divided by cosine values...
 10696 0000A6A9 05F43D2FD363BC5B02-
 10696 0000A6B2 B0E722D269F0       
 10697 0000A6B8 567133F467D857F6A8-                     dd 0F4337156h,0F657D867h,0F7BCFBA8h,0F8BB5952h,0F97C4965h,0FA15BB1Ch
 10697 0000A6C1 FBBCF75259BBF86549-
 10697 0000A6CA 7CF91CBB15FA       
 10698 0000A6D0 936D94FA8E5100FB70-                     dd 0FA946D93h,0FB00518Eh,0FB5EA270h,0FBB2FDEAh,0FC000000h,0FC479F38h
 10698 0000A6D9 A25EFBEAFDB2FB0000-
 10698 0000A6E2 00FC389F47FC       
 10699 0000A6E8 09668BFC9898CCFC0B-                     dd 0FC8B6609h,0FCCC9898h,0FD0C4F0Bh,0FD4B895Ch,0FD8B3FCFh,0FDCC725Eh
 10699 0000A6F1 4F0CFD5C894BFDCF3F-
 10699 0000A6FA 8BFD5E72CCFD       
 10700 0000A700 2F3910FE67D857FE7D-                     dd 0FE10392Fh,0FE57D867h,0FEA4DA7Dh,0FEF935F7h,0FF5786D9h,0FFC36AD5h
 10700 0000A709 DAA4FEF735F9FED986-
 10700 0000A712 57FFD56AC3FF       
 10701 0000A718 4B1D4200028FDB0016-                     dd  00421D4Bh, 00DB8F02h, 019C7F16h, 029ADCC0h, 04000001h, 06246711h
 10701 0000A721 7F9C01C0DC9A020100-
 10701 0000A72A 000411672406       
 10702 0000A730 4506EE090CD6A71238-                     dd  09EE0645h, 12A7D60Ch, 3DF40538h,0BC63D32Fh,0E7B0025Bh,0F069D222h
 10702 0000A739 05F43D2FD363BC5B02-
 10702 0000A742 B0E722D269F0       
 10703 0000A748 567133F467D857F6A8-                     dd 0F4337156h,0F657D867h,0F7BCFBA8h,0F8BB5952h,0F97C4965h,0FA15BB1Ch
 10703 0000A751 FBBCF75259BBF86549-
 10703 0000A75A 7CF91CBB15FA       
 10704 0000A760 291B93FAB946F5FABB-                     dd 0FA931B29h,0FAF546B9h,0FB41DABBh,0FB7D8F97h,0FBABA162h,0FBCE4E62h
 10704 0000A769 DA41FB978F7DFB62A1-
 10704 0000A772 ABFB624ECEFB       
 10705 0000A778 671CF0FBAFC845FC0D-                     dd 0FBF01C67h,0FC45C8AFh,0FCD2D50Dh,0FD9008D0h,0FE74C032h,0FF771894h
 10705 0000A781 D5D2FCD00890FD32C0-
 10705 0000A78A 74FE941877FF       
 10706 0000A790 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 10706 0000A799 000000000000000000-
 10706 0000A7A2 000000000000       
 10707 0000A7A8 028FDB00010000040C-                     dd  00DB8F02h, 04000001h, 12A7D60Ch,0E7B0025Bh,0F657D867h,0F97C4965h
 10707 0000A7B1 D6A7125B02B0E767D8-
 10707 0000A7BA 57F665497CF9       
 10708 0000A7C0 8E5100FB000000FC98-                     dd 0FB00518Eh,0FC000000h,0FCCC9898h,0FD8B3FCFh,0FE57D867h,0FF5786D9h
 10708 0000A7C9 98CCFCCF3F8BFD67D8-
 10708 0000A7D2 57FED98657FF       
 10709 0000A7D8 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 10709 0000A7E1 000000000000000000-
 10709 0000A7EA 000000000000       
 10710 0000A7F0 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 10710 0000A7F9 000000000000000000-
 10710 0000A802 000000000000       
 10711 0000A808 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 10711 0000A811 000000000000000000-
 10711 0000A81A 000000000000       
 10712 0000A820 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 10712 0000A829 000000000000000000-
 10712 0000A832 000000000000       
 10713 0000A838 000000000000000000-                     dd  00000000h, 00000000h, 00000000h, 00000000h, 00000000h, 00000000h
 10713 0000A841 000000000000000000-
 10713 0000A84A 000000000000       
 10714 0000A850 B58869025237BA0B4F-                     dd  026988B5h, 0BBA3752h, 37D3294Fh,0B73F655Bh,0E3B0025Bh,0EDAD5D13h
 10714 0000A859 29D3375B653FB75B02-
 10714 0000A862 B0E3135DADED       
 10715 0000A868 A2ADB2F2B8288CF5D6-                     dd 0F2B2ADA2h,0F58C28B8h,0F75657D6h,0F88E2C57h,0F96DE565h,0FA1449CDh
 10715 0000A871 5756F7572C8EF865E5-
 10715 0000A87A 6DF9CD4914FA       
 10716 0000A880 936D94FA8E5100FB70-                     dd 0FA946D93h,0FB00518Eh,0FB5EA270h,0FBB2FDEAh,0FC000000h,0FC479F38h
 10716 0000A889 A25EFBEAFDB2FB0000-
 10716 0000A892 00FC389F47FC       
 10717 0000A898 09668BFC9898CCFC0B-                     dd 0FC8B6609h,0FCCC9898h,0FD0C4F0Bh,0FD4B895Ch,0FD8B3FCFh,0FDCC725Eh
 10717 0000A8A1 4F0CFD5C894BFDCF3F-
 10717 0000A8AA 8BFD5E72CCFD       
 10718 0000A8B0 2F3910FE67D857FE7D-                     dd 0FE10392Fh,0FE57D867h,0FEA4DA7Dh,0FEF935F7h,0FF5786D9h,0FFC36AD5h
 10718 0000A8B9 DAA4FEF735F9FED986-
 10718 0000A8C2 57FFD56AC3FF       
 10719                                  mp3_is_table_normal:
 10720 0000A8C8 0000000000000040        		dd  00000000h, 40000000h
 10721 0000A8D0 BB58860D46A77932                        dd  0D8658BBh, 3279A746h
 10722 0000A8D8 D1F56C17300A9328                        dd  176CF5D1h, 28930A30h
 10723 0000A8E0 0000002000000020                        dd  20000000h, 20000000h
 10724 0000A8E8 300A9328D1F56C17                        dd  28930A30h, 176CF5D1h
 10725 0000A8F0 46A77932BB58860D                        dd  3279A746h, 0D8658BBh
 10726 0000A8F8 0000004000000000                        dd  40000000h, 00000000h
 10727                                  mp3_is_table_lsf_src:			; sqrt based constants...
 10728 0000A900 00000080                		dd 80000000h            ; 40000000h*2 ; 2.0   (2^1.00) aka 2
 10729 0000A904 667EA26B                                dd 6BA27E66h            ; 35D13F33h*2 ; 1.681 (2^0.75)
 10730 0000A908 9A79825A                                dd 5A82799Ah            ; 2D413CCDh*2 ; 1.414 (2^0.50) aka sqrt(2)
 10731 0000A90C 2AF81B4C                                dd 4C1BF82Ah            ; 260DFC15h*2 ; 1.189 (2^0.25) aka sqrt(sqrt(2))
 10732                                  mp3_pow2_quarters:
 10733 0000A910 00000080                		dd 80000000h            ; 40000000h*2 ; 2^(0/4)
 10734 0000A914 52F03798                                dd 9837F052h            ; 4C1BF829h*2 ; 2^(1/4)
 10735 0000A918 34F304B5                                dd 0B504F334h           ; 5A82799Ah*2 ; 2^(2/4)
 10736 0000A91C CCFC44D7                                dd 0D744FCCCh           ; 6BA27E66h*2 ; 2^(3/4)
 10737                                  mp3_initialized:
 10738 0000A920 00000000                		dd 0                   
 10739                                  mp3_huff_num_entries:
 10740 0000A924 12000000                		dd 12h            
 10741                                  wrchr_buf:
 10742 0000A928 00                      		db 0                   
 10743                                                  
 10744                                  num_enqueued_frames:
 10745 0000A929 00                      		db 0
 10746                                  
 10747                                  ; align 4
 10748                                  
 10749                                  ; 21/10/2024                   
 10750 0000A92A 00000000                zero		dd 0
 10751                                  
 10752                                  huff_tree_list_numbits:
 10753 0000A92E 0303020106060505        		db    3,   3,   2,   1,   6,   6,   5,   5
 10754 0000A936 0503030301060605                        db    5,   3,   3,   3,   1,   6,   6,   5
 10755 0000A93E 0505030202020808                        db    5,   5,   3,   2,   2,   2,   8,   8
 10756 0000A946 0706070707070606                        db    7,   6,   7,   7,   7,   7,   6,   6
 10757 0000A94E 0606030303010707                        db    6,   6,   3,   3,   3,   1,   7,   7
 10758 0000A956 0606060505050504                        db    6,   6,   6,   5,   5,   5,   5,   4
 10759 0000A95E 0404030203030A0A                        db    4,   4,   3,   2,   3,   3, 0Ah, 0Ah
 10760 0000A966 0A0A090909090808                        db  0Ah, 0Ah,   9,   9,   9,   9,   8,   8
 10761 0000A96E 0909080909080807                        db    9,   9,   8,   9,   9,   8,   8,   7
 10762 0000A976 0707080808080707                        db    7,   7,   8,   8,   8,   8,   7,   7
 10763 0000A97E 0707060506060403                        db    7,   7,   6,   5,   6,   6,   4,   3
 10764 0000A986 03010B0B0A090A0A                        db    3,   1, 0Bh, 0Bh, 0Ah,   9, 0Ah, 0Ah
 10765 0000A98E 0909090808090909                        db    9,   9,   9,   8,   8,   9,   9,   9
 10766 0000A996 0908080807080808                        db    9,   8,   8,   8,   7,   8,   8,   8
 10767 0000A99E 0808080808060606                        db    8,   8,   8,   8,   8,   6,   6,   6
 10768 0000A9A6 0404020303020909                        db    4,   4,   2,   3,   3,   2,   9,   9
 10769 0000A9AE 0808090908080808                        db    8,   8,   9,   9,   8,   8,   8,   8
 10770 0000A9B6 0707070808070707                        db    7,   7,   7,   8,   8,   7,   7,   7
 10771 0000A9BE 0706060606050506                        db    7,   6,   6,   6,   6,   5,   5,   6
 10772 0000A9C6 0605050404040303                        db    6,   5,   5,   4,   4,   4,   3,   3
 10773 0000A9CE 03030B0B0B0B0B0B                        db    3,   3, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10774 0000A9D6 0A0A0A0A0A0A0A0B                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Bh
 10775 0000A9DE 0B0A09090A0A0909                        db  0Bh, 0Ah,   9,   9, 0Ah, 0Ah,   9,   9
 10776 0000A9E6 0A0A090A0A080809                        db  0Ah, 0Ah,   9, 0Ah, 0Ah,   8,   8,   9
 10777 0000A9EE 090A0A09090A0A08                        db    9, 0Ah, 0Ah,   9,   9, 0Ah, 0Ah,   8
 10778 0000A9F6 0808090909090909                        db    8,   8,   9,   9,   9,   9,   9,   9
 10779 0000A9FE 0808080808080707                        db    8,   8,   8,   8,   8,   8,   7,   7
 10780 0000AA06 0707060606060403                        db    7,   7,   6,   6,   6,   6,   4,   3
 10781 0000AA0E 03010A0A0A0A0A0A                        db    3,   1, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10782 0000AA16 0A0B0B0A0A090909                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah,   9,   9,   9
 10783 0000AA1E 0A0A0A0A08080909                        db  0Ah, 0Ah, 0Ah, 0Ah,   8,   8,   9,   9
 10784 0000AA26 0708080808080909                        db    7,   8,   8,   8,   8,   8,   9,   9
 10785 0000AA2E 0909080708080707                        db    9,   9,   8,   7,   8,   8,   7,   7
 10786 0000AA36 0808080909080808                        db    8,   8,   8,   9,   9,   8,   8,   8
 10787 0000AA3E 0808080707060607                        db    8,   8,   8,   7,   7,   6,   6,   7
 10788 0000AA46 0706050405050303                        db    7,   6,   5,   4,   5,   5,   3,   3
 10789 0000AA4E 03020A0A09090909                        db    3,   2, 0Ah, 0Ah,   9,   9,   9,   9
 10790 0000AA56 0909090808090908                        db    9,   9,   9,   8,   8,   9,   9,   8
 10791 0000AA5E 0808080808090908                        db    8,   8,   8,   8,   8,   9,   9,   8
 10792 0000AA66 0808080809090707                        db    8,   8,   8,   8,   9,   9,   7,   7
 10793 0000AA6E 0708080808080807                        db    7,   8,   8,   8,   8,   8,   8,   7
 10794 0000AA76 0707070808070707                        db    7,   7,   7,   8,   8,   7,   7,   7
 10795 0000AA7E 0606060607070605                        db    6,   6,   6,   6,   7,   7,   6,   5
 10796 0000AA86 0505040405050403                        db    5,   5,   4,   4,   5,   5,   4,   3
 10797 0000AA8E 0303131312111010                        db    3,   3, 13h, 13h, 12h, 11h, 10h, 10h
 10798 0000AA96 1010101010101010                        db  10h, 10h, 10h, 10h, 10h, 10h, 10h, 10h
 10799 0000AA9E 11110F0F10100F0F                        db  11h, 11h, 0Fh, 0Fh, 10h, 10h, 0Fh, 0Fh
 10800 0000AAA6 0F0F0F0F0F0F0F0F                        db  0Fh, 0Fh, 0Fh, 0Fh, 0Fh, 0Fh, 0Fh, 0Fh
 10801 0000AAAE 10100F10100E0E0F                        db  10h, 10h, 0Fh, 10h, 10h, 0Eh, 0Eh, 0Fh
 10802 0000AAB6 0F0F0F0E0E0E0E0E                        db  0Fh, 0Fh, 0Fh, 0Eh, 0Eh, 0Eh, 0Eh, 0Eh
 10803 0000AABE 0E0E0E0E0E0E0F0F                        db  0Eh, 0Eh, 0Eh, 0Eh, 0Eh, 0Eh, 0Fh, 0Fh
 10804 0000AAC6 0E0D0E0E0D0D0E0E                        db  0Eh, 0Dh, 0Eh, 0Eh, 0Dh, 0Dh, 0Eh, 0Eh
 10805 0000AACE 0D0E0E0D0E0E0D0E                        db  0Dh, 0Eh, 0Eh, 0Dh, 0Eh, 0Eh, 0Dh, 0Eh
 10806 0000AAD6 0E0D0D0E0E0C0C0C                        db  0Eh, 0Dh, 0Dh, 0Eh, 0Eh, 0Ch, 0Ch, 0Ch
 10807 0000AADE 0D0D0D0D0D0D0C0D                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch, 0Dh
 10808 0000AAE6 0D0C0C0D0D0D0D0D                        db  0Dh, 0Ch, 0Ch, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh
 10809 0000AAEE 0D0D0D0D0D0D0D0C                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch
 10810 0000AAF6 0C0D0D0C0C0C0C0D                        db  0Ch, 0Dh, 0Dh, 0Ch, 0Ch, 0Ch, 0Ch, 0Dh
 10811 0000AAFE 0D0D0D0C0D0D0C0B                        db  0Dh, 0Dh, 0Dh, 0Ch, 0Dh, 0Dh, 0Ch, 0Bh
 10812 0000AB06 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 10813 0000AB0E 0B0B0B0B0C0C0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Ch, 0Ch, 0Bh, 0Bh
 10814 0000AB16 0C0C0B0C0C0C0C0B                        db  0Ch, 0Ch, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Bh
 10815 0000AB1E 0B0C0C0B0C0C0B0C                        db  0Bh, 0Ch, 0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Ch
 10816 0000AB26 0C0B0C0C0A0A0A0B                        db  0Ch, 0Bh, 0Ch, 0Ch, 0Ah, 0Ah, 0Ah, 0Bh
 10817 0000AB2E 0B0B0B0B0B0B0B0A                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah
 10818 0000AB36 0A0A0A0B0B0A0B0B                        db  0Ah, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Bh, 0Bh
 10819 0000AB3E 0A0B0B0B0B0A0A0B                        db  0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah, 0Ah, 0Bh
 10820 0000AB46 0B0A0A0B0B0B0B0B                        db  0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10821 0000AB4E 0B09090A0A0A0A0A                        db  0Bh,   9,   9, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10822 0000AB56 0B0B0909090A0A09                        db  0Bh, 0Bh,   9,   9,   9, 0Ah, 0Ah,   9
 10823 0000AB5E 090A0A0A0A0A0A0A                        db    9, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10824 0000AB66 0A0A0A0809090909                        db  0Ah, 0Ah, 0Ah,   8,   9,   9,   9,   9
 10825 0000AB6E 09090A0A09090908                        db    9,   9, 0Ah, 0Ah,   9,   9,   9,   8
 10826 0000AB76 0809090909090908                        db    8,   9,   9,   9,   9,   9,   9,   8
 10827 0000AB7E 0708080808070707                        db    7,   8,   8,   8,   8,   7,   7,   7
 10828 0000AB86 0707060606060404                        db    7,   7,   6,   6,   6,   6,   4,   4
 10829 0000AB8E 03010D0D0D0D0C0D                        db    3,   1, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch, 0Dh
 10830 0000AB96 0D0D0D0D0D0C0D0D                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Ch, 0Dh, 0Dh
 10831 0000AB9E 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 10832 0000ABA6 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 10833 0000ABAE 0C0C0C0C0C0C0C0D                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Dh
 10834 0000ABB6 0D0B0B0C0C0C0C0B                        db  0Dh, 0Bh, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Bh
 10835 0000ABBE 0B0B0B0B0B0C0C0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ch, 0Ch, 0Bh
 10836 0000ABC6 0B0B0B0B0B0B0B0C                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ch
 10837 0000ABCE 0C0B0B0B0B0B0B0B                        db  0Ch, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10838 0000ABD6 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10839 0000ABDE 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10840 0000ABE6 0B0B0C0C0B0B0B0B                        db  0Bh, 0Bh, 0Ch, 0Ch, 0Bh, 0Bh, 0Bh, 0Bh
 10841 0000ABEE 0B0B0A0B0B0B0B0B                        db  0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10842 0000ABF6 0B0A0A0B0B0A0A0A                        db  0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah
 10843 0000ABFE 0A0B0B0A0A0A0A0A                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10844 0000AC06 0A0A0B0B0A0A0A0A                        db  0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah
 10845 0000AC0E 0A0B0B090A0A0A0A                        db  0Ah, 0Bh, 0Bh,   9, 0Ah, 0Ah, 0Ah, 0Ah
 10846 0000AC16 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10847 0000AC1E 090A0A0A0A090A0A                        db    9, 0Ah, 0Ah, 0Ah, 0Ah,   9, 0Ah, 0Ah
 10848 0000AC26 090A0A0A0A0A0A0A                        db    9, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10849 0000AC2E 0A09090909090909                        db  0Ah,   9,   9,   9,   9,   9,   9,   9
 10850 0000AC36 0A0A090909090909                        db  0Ah, 0Ah,   9,   9,   9,   9,   9,   9
 10851 0000AC3E 0A0A090909090909                        db  0Ah, 0Ah,   9,   9,   9,   9,   9,   9
 10852 0000AC46 0809090909090909                        db    8,   9,   9,   9,   9,   9,   9,   9
 10853 0000AC4E 0909090808080809                        db    9,   9,   9,   8,   8,   8,   8,   9
 10854 0000AC56 0909090909090908                        db    9,   9,   9,   9,   9,   9,   9,   8
 10855 0000AC5E 0808080808090908                        db    8,   8,   8,   8,   8,   9,   9,   8
 10856 0000AC66 0808080808080909                        db    8,   8,   8,   8,   8,   8,   9,   9
 10857 0000AC6E 0807080807070707                        db    8,   7,   8,   8,   7,   7,   7,   7
 10858 0000AC76 0808070707070706                        db    8,   8,   7,   7,   7,   7,   7,   6
 10859 0000AC7E 0707060607070606                        db    7,   7,   6,   6,   7,   7,   6,   6
 10860 0000AC86 0605050505050304                        db    6,   5,   5,   5,   5,   5,   3,   4
 10861 0000AC8E 04030B0B0B0B0B0B                        db    4,   3, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10862 0000AC96 0B0B0A0B0B0B0B0A                        db  0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah
 10863 0000AC9E 0A0A0A0A080A0A09                        db  0Ah, 0Ah, 0Ah, 0Ah,   8, 0Ah, 0Ah,   9
 10864 0000ACA6 0909090A1011110F                        db    9,   9,   9, 0Ah, 10h, 11h, 11h, 0Fh
 10865 0000ACAE 0F10100E0F0F0E0E                        db  0Fh, 10h, 10h, 0Eh, 0Fh, 0Fh, 0Eh, 0Eh
 10866 0000ACB6 0F0F0E0E0F0F0F0F                        db  0Fh, 0Fh, 0Eh, 0Eh, 0Fh, 0Fh, 0Fh, 0Fh
 10867 0000ACBE 0E0F0F0E0D080909                        db  0Eh, 0Fh, 0Fh, 0Eh, 0Dh,   8,   9,   9
 10868 0000ACC6 08080D0E0E0E0E0E                        db    8,   8, 0Dh, 0Eh, 0Eh, 0Eh, 0Eh, 0Eh
 10869 0000ACCE 0E0E0E0E0E0D0D0E                        db  0Eh, 0Eh, 0Eh, 0Eh, 0Eh, 0Dh, 0Dh, 0Eh
 10870 0000ACD6 0E0E0E0D0E0E0D0D                        db  0Eh, 0Eh, 0Eh, 0Dh, 0Eh, 0Eh, 0Dh, 0Dh
 10871 0000ACDE 0D0E0E0E0E0D0D0E                        db  0Dh, 0Eh, 0Eh, 0Eh, 0Eh, 0Dh, 0Dh, 0Eh
 10872 0000ACE6 0E0D0E0E0C0D0D0D                        db  0Eh, 0Dh, 0Eh, 0Eh, 0Ch, 0Dh, 0Dh, 0Dh
 10873 0000ACEE 0D0D0D0D0D0D0D0D                        db  0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh, 0Dh
 10874 0000ACF6 0D0D0D0C0D0D0D0D                        db  0Dh, 0Dh, 0Dh, 0Ch, 0Dh, 0Dh, 0Dh, 0Dh
 10875 0000ACFE 0D0D0C0D0D0C0C0D                        db  0Dh, 0Dh, 0Ch, 0Dh, 0Dh, 0Ch, 0Ch, 0Dh
 10876 0000AD06 0D0B0C0C0C0C0C0C                        db  0Dh, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 10877 0000AD0E 0C0D0D0B0C0C0C0C                        db  0Ch, 0Dh, 0Dh, 0Bh, 0Ch, 0Ch, 0Ch, 0Ch
 10878 0000AD16 0B0C0C0C0C0C0C0C                        db  0Bh, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 10879 0000AD1E 0C0B0C0C0B0B0B0B                        db  0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Bh, 0Bh, 0Bh
 10880 0000AD26 0C0C0C0C0C0C0C0C                        db  0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch, 0Ch
 10881 0000AD2E 0B0C0C0B0C0C0B0C                        db  0Bh, 0Ch, 0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Ch
 10882 0000AD36 0C0B0C0C0B0A0A0B                        db  0Ch, 0Bh, 0Ch, 0Ch, 0Bh, 0Ah, 0Ah, 0Bh
 10883 0000AD3E 0B0B0B0B0B0A0A0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Ah, 0Ah, 0Bh
 10884 0000AD46 0B0A0A0B0B0B0B0B                        db  0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10885 0000AD4E 0B0B0B0A0B0B0A0A                        db  0Bh, 0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah
 10886 0000AD56 0A0B0B0A0A0B0B0A                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah
 10887 0000AD5E 0A0B0B0A09090A0A                        db  0Ah, 0Bh, 0Bh, 0Ah,   9,   9, 0Ah, 0Ah
 10888 0000AD66 0A0A0A0A0909090A                        db  0Ah, 0Ah, 0Ah, 0Ah,   9,   9,   9, 0Ah
 10889 0000AD6E 0A090A0A09090809                        db  0Ah,   9, 0Ah, 0Ah,   9,   9,   8,   9
 10890 0000AD76 0909090909090908                        db    9,   9,   9,   9,   9,   9,   9,   8
 10891 0000AD7E 0809090808070708                        db    8,   9,   9,   8,   8,   7,   7,   8
 10892 0000AD86 0807060606060404                        db    8,   7,   6,   6,   6,   6,   4,   4
 10893 0000AD8E 0301080808080808                        db    3,   1,   8,   8,   8,   8,   8,   8
 10894 0000AD96 0808070808070708                        db    8,   8,   7,   8,   8,   7,   7,   8
 10895 0000AD9E 0807070707070707                        db    8,   7,   7,   7,   7,   7,   7,   7
 10896 0000ADA6 0707070707080809                        db    7,   7,   7,   7,   7,   8,   8,   9
 10897 0000ADAE 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10898 0000ADB6 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10899 0000ADBE 0B0B0B0B0B0B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh, 0Bh
 10900 0000ADC6 0B0B0B0B040B0B0B                        db  0Bh, 0Bh, 0Bh, 0Bh,   4, 0Bh, 0Bh, 0Bh
 10901 0000ADCE 0B0C0C0B0A0B0B0A                        db  0Bh, 0Ch, 0Ch, 0Bh, 0Ah, 0Bh, 0Bh, 0Ah
 10902 0000ADD6 0A0A0A0B0B0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah
 10903 0000ADDE 0A0B0B0A0A0A0A0A                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10904 0000ADE6 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10905 0000ADEE 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10906 0000ADF6 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10907 0000ADFE 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10908 0000AE06 0A0A0B0B0A0A0A0A                        db  0Ah, 0Ah, 0Bh, 0Bh, 0Ah, 0Ah, 0Ah, 0Ah
 10909 0000AE0E 0A0A0A0A0A0A0A0A                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah, 0Ah
 10910 0000AE16 0A0B0B0A0B0B0A09                        db  0Ah, 0Bh, 0Bh, 0Ah, 0Bh, 0Bh, 0Ah,   9
 10911 0000AE1E 0A0A0A0A0B0B0A09                        db  0Ah, 0Ah, 0Ah, 0Ah, 0Bh, 0Bh, 0Ah,   9
 10912 0000AE26 090A0A090A0A0A0A                        db    9, 0Ah, 0Ah,   9, 0Ah, 0Ah, 0Ah, 0Ah
 10913 0000AE2E 09090A0A09090909                        db    9,   9, 0Ah, 0Ah,   9,   9,   9,   9
 10914 0000AE36 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 10915 0000AE3E 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 10916 0000AE46 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 10917 0000AE4E 0909090909090909                        db    9,   9,   9,   9,   9,   9,   9,   9
 10918 0000AE56 0A0A0909090A0A08                        db  0Ah, 0Ah,   9,   9,   9, 0Ah, 0Ah,   8
 10919 0000AE5E 0909080808080808                        db    9,   9,   8,   8,   8,   8,   8,   8
 10920 0000AE66 0808080808080809                        db    8,   8,   8,   8,   8,   8,   8,   9
 10921 0000AE6E 0908080808080809                        db    9,   8,   8,   8,   8,   8,   8,   9
 10922 0000AE76 0907080807070707                        db    9,   7,   8,   8,   7,   7,   7,   7
 10923 0000AE7E 0708080707060607                        db    7,   8,   8,   7,   7,   6,   6,   7
 10924 0000AE86 0706050506060404                        db    7,   6,   5,   5,   6,   6,   4,   4
 10925 0000AE8E 0404060606060606                        db    4,   4,   6,   6,   6,   6,   6,   6
 10926 0000AE96 0505050505040404                        db    5,   5,   5,   5,   5,   4,   4,   4
 10927 0000AE9E 0401040404040404                        db    4,   1,   4,   4,   4,   4,   4,   4
 10928 0000AEA6 0404040404040404                        db    4,   4,   4,   4,   4,   4,   4,   4
 10929 0000AEAE 0404                                    db    4,   4
 10930                                  _@@const_3:
 10931 0000AEB0 03                      		db 3
 10932 0000AEB1 000000                                  db 3 dup(0)
 10933                                  
 10934                                  		; 16/02/2025
 10935                                  ;mp3_synth_filter_procs:
 10936                                  		; 15/02/2025
 10937                                  		;dd synth_16bit_shift_0_slow ; SYNTH_MACRO 0,0,0
 10938                                  
 10939                                  ; Erdogan Tan - 17/10/2024
 10940                                  txt_hello:	
 10941 0000AEB4 0D0A                    		db 13,10
 10942                                  		;db 'NOCASH MP3 PLAYER v1.4 for Windows ',0
 10943                                  		; 09/01/2025
 10944                                  		;db 'NOCASH MP3 PLAYER v1.0 for TRDOS386 ',0
 10945                                  		; 15/02/2025
 10946 0000AEB6 54696E79204D503320-     		db 'Tiny MP3 PLAYER v1.0 for TRDOS386 by Erdogan Tan.',0
 10946 0000AEBF 504C41594552207631-
 10946 0000AEC8 2E3020666F72205452-
 10946 0000AED1 444F53333836206279-
 10946 0000AEDA 204572646F67616E20-
 10946 0000AEE3 54616E2E00         
 10947                                  txt_bdate:
 10948 0000AEE8 0D0A                    		db 13,10
 10949 0000AEEA 466562727561727920-     		db 'February 2025.',13,10,0
 10949 0000AEF3 323032352E0D0A00   
 10950                                  		
 10951 0000AEFB 32302F30322F323032-     		db "20/02/2025", 0
 10951 0000AF04 3500               
 10952                                  
 10953 0000AF06 303132333435363738-     hex_chars:	db "0123456789ABCDEF", 0
 10953 0000AF0F 3941424344454600   
 10954                                  
 10955 0000AF17 0D0A                    msgAC97Info:	db 0Dh, 0Ah
 10956 0000AF19 414339372041756469-     		db "AC97 Audio Controller & Codec Info", 0Dh, 0Ah
 10956 0000AF22 6F20436F6E74726F6C-
 10956 0000AF2B 6C6572202620436F64-
 10956 0000AF34 656320496E666F0D0A 
 10957 0000AF3D 56656E646F72204944-     		db "Vendor ID: "
 10957 0000AF46 3A20               
 10958 0000AF48 303030306820446576-     msgVendorId:	db "0000h Device ID: "
 10958 0000AF51 6963652049443A20   
 10959 0000AF59 30303030680D0A          msgDevId:	db "0000h", 0Dh, 0Ah
 10960 0000AF60 4275733A20              		db "Bus: "
 10961 0000AF65 303068204465766963-     msgBusNo:	db "00h Device: "
 10961 0000AF6E 653A20             
 10962 0000AF71 3030682046756E6374-     msgDevNo:	db "00h Function: "
 10962 0000AF7A 696F6E3A20         
 10963 0000AF7F 303068                  msgFncNo:	db "00h"
 10964 0000AF82 0D0A                    		db 0Dh, 0Ah
 10965                                  
 10966 0000AF84 4E414D4241523A20        		db "NAMBAR: "
 10967 0000AF8C 30303030682020          msgNamBar:	db "0000h  "
 10968 0000AF93 4E41424D4241523A20      		db "NABMBAR: "
 10969 0000AF9C 303030306820204952-     msgNabmBar:	db "0000h  IRQ: "
 10969 0000AFA5 513A20             
 10970 0000AFA8 3030                    msgIRQ:		dw 3030h
 10971 0000AFAA 0D0A00                  		db 0Dh, 0Ah, 0
 10972                                  
 10973 0000AFAD 0D0A46696C65204E61-     msgFileName:	db 0Dh, 0Ah, "File Name: ",0
 10973 0000AFB6 6D653A2000         
 10974 0000AFBB 0D0A53616D706C6520-     msgSampleRate:	db 0Dh, 0Ah, "Sample Rate: "
 10974 0000AFC4 526174653A20       
 10975 0000AFCA 303030303020487A00      msgHertz:	db "00000 Hz", 0 
 10976 0000AFD3 0D0A42697420526174-     msgKBitRate:	db 0Dh, 0Ah, "Bit Rate: ", 0
 10976 0000AFDC 653A2000           
 10977 0000AFE0 206B6269742F7300        msgKBits:	db " kbit/s", 0
 10978 0000AFE8 0D0A506C6179626163-     msgPlayback:	db 0Dh, 0Ah, "Playback: ", 0
 10978 0000AFF1 6B3A2000           
 10979                                  ; 17/02/2025
 10980                                  ;msg8Bits:	db "8 bits, ", 0 
 10981 0000AFF5 4D6F6E6F0D0A00          msgMono:	db "Mono", 0Dh, 0Ah, 0
 10982 0000AFFC 313620626974732C20-     msg16Bits:	db "16 bits, ", 0
 10982 0000B005 00                 
 10983 0000B006 53746572656F            msgStereo:	db "Stereo"
 10984 0000B00C 0D0A00                  nextline:	db 0Dh, 0Ah, 0
 10985                                  
 10986                                  ; 15/02/2025
 10987 0000B00F 0D0A                    msgDuration:	db 0Dh, 0Ah	
 10988 0000B011 4475726174696F6E3A-     		db "Duration: "
 10988 0000B01A 20                 
 10989 0000B01B 30303A303020286D69-     msgMinSec:	db "00:00 (minute:second)"
 10989 0000B024 6E7574653A7365636F-
 10989 0000B02D 6E6429             
 10990 0000B030 0D0A00                  		db 0Dh, 0Ah, 0	
 10991                                  
 10992 0000B033 56524120737570706F-     msgVRAheader:	db "VRA support: "
 10992 0000B03C 72743A20           
 10993 0000B040 00                      		db 0	
 10994 0000B041 5945530D0A00            msgVRAyes:	db "YES", 0Dh, 0Ah, 0
 10995 0000B047 4E4F200D0A              msgVRAno:	db "NO ", 0Dh, 0Ah
 10996 0000B04C 28496E746572706F6C-     		db "(Interpolated sample rate playing method)"
 10996 0000B055 617465642073616D70-
 10996 0000B05E 6C6520726174652070-
 10996 0000B067 6C6179696E67206D65-
 10996 0000B070 74686F6429         
 10997 0000B075 0D0A00                  		db 0Dh, 0Ah, 0
 10998                                  
 10999 0000B078 0D0A                    msgSB16Info:	db 0Dh, 0Ah
 11000 0000B07A 20417564696F204861-     		db " Audio Hardware: Sound Blaster 16", 0Dh, 0Ah
 11000 0000B083 7264776172653A2053-
 11000 0000B08C 6F756E6420426C6173-
 11000 0000B095 7465722031360D0A   
 11001 0000B09D 202020202020426173-     		db "      Base Port: "
 11001 0000B0A6 6520506F72743A20   
 11002                                  msgBasePort:
 11003 0000B0AE 303030680D0A            		db "000h", 0Dh, 0Ah
 11004 0000B0B4 202020202020202020-     		db "            IRQ: "
 11004 0000B0BD 2020204952513A20   
 11005                                  msgSB16IRQ:
 11006 0000B0C5 30                      		db 30h
 11007 0000B0C6 0D0A00                  		db 0Dh, 0Ah, 0
 11008                                  
 11009                                  		; 15/02/2025
 11010 0000B0C9 75736167653A20746D-     txt_help:	db 'usage: tmp3play filename.mp3',0Dh,0Ah,0
 11010 0000B0D2 7033706C6179206669-
 11010 0000B0DB 6C656E616D652E6D70-
 11010 0000B0E4 330D0A00           
 11011                                  
 11012 0000B0E8 0D0A                    txt_original:	db 13,10
 11013 0000B0EA 4F726967696E616C20-     		db 'Original code: ', 13,10
 11013 0000B0F3 636F64653A200D0A   
 11014 0000B0FB 202020202020202020-     		db '         Nocash MP3 Decoder/Player', 13,10
 11014 0000B104 4E6F63617368204D50-
 11014 0000B10D 33204465636F646572-
 11014 0000B116 2F506C617965720D0A 
 11015 0000B11F 202020202020202020-     		db '         MP3PLAYER.EXE v1.4 (20/09/2024)', 13,10
 11015 0000B128 4D5033504C41594552-
 11015 0000B131 2E4558452076312E34-
 11015 0000B13A 202832302F30392F32-
 11015 0000B143 303234290D0A       
 11016 0000B149 202020202020202020-     		db '         by Martin Korth (TASM source code)'
 11016 0000B152 6279204D617274696E-
 11016 0000B15B 204B6F727468202854-
 11016 0000B164 41534D20736F757263-
 11016 0000B16D 6520636F646529     
 11017 0000B174 0D0A00                  		db 13,10,0
 11018 0000B177 76312E342E30            		db 'v1.4.0'
 11019                                  ; 10/01/2025
 11020 0000B17D 00                      half_buffer:	db 0
 11021                                  
 11022                                  ; 13/02/2025
 11023 0000B17E 0D0A                    msgPressAKey:	db 0Dh, 0Ah
 11024 0000B180 202E2E2E2070726573-     		db ' ... press a key to continue ... '
 11024 0000B189 732061206B65792074-
 11024 0000B192 6F20636F6E74696E75-
 11024 0000B19B 65202E2E2E20       
 11025 0000B1A1 0D0A0D0A00              		db 0Dh, 0Ah, 0Dh, 0Ah, 0
 11026                                  
 11027                                  ; ---------------------------------------------------------------------------
 11028                                  
 11029                                  		; 13/02/2025 (mp3play6.s)
 11030                                  		; 30/12/2024 (cgaplay.s)
 11031 0000B1A6 FF<rep 8h>              fillblock:	times 8 db 0FFh
 11032 0000B1AE 0000                    		dw 0
 11033                                  
 11034                                  ; ---------------------------------------------------------------------------
 11035                                  
 11036                                  ; 13/02/2025
 11037                                  ; 23/11/2024
 11038 0000B1B0 0B0A0C0E090D0F          colors:		db 0Bh, 0Ah, 0Ch, 0Eh, 09h, 0Dh, 0Fh
 11039                                  			; cyan, green, red, yellow, blue, magenta, white
 11040 0000B1B7 0B                      ccolor:		db 0Bh	; cyan
 11041                                  
 11042                                  ; ---------------------------------------------------------------------------
 11043                                  
 11044                                  ; 24/01/2025
 11045 0000B1B8 03                      volume_level	db 3
 11046                                  
 11047                                  ; ---------------------------------------------------------------------------
 11048                                  
 11049                                  ; 26/01/2025
 11050                                  ; 07/12/2024
 11051                                  trdos386_err_msg:
 11052 0000B1B9 5452444F5320333836-     		db 'TRDOS 386 System call error !',10,13,0
 11052 0000B1C2 2053797374656D2063-
 11052 0000B1CB 616C6C206572726F72-
 11052 0000B1D4 20210A0D00         
 11053                                  
 11054                                  ; ---------------------------------------------------------------------------
 11055                                  
 11056                                  ; 15/02/2025
 11057 0000B1D9 0A0D                    noDevMsg:	db 10,13
 11058 0000B1DB 4572726F723A20556E-     		db 'Error: Unable to find a proper audio device !'
 11058 0000B1E4 61626C6520746F2066-
 11058 0000B1ED 696E6420612070726F-
 11058 0000B1F6 70657220617564696F-
 11058 0000B1FF 206465766963652021 
 11059 0000B208 0A0D00                  		db 10,13,0
 11060                                  
 11061                                  ; ---------------------------------------------------------------------------
 11062                                  
 11063                                  ; 15/02/2025
 11064                                  txt_not_found:
 11065 0000B20B 0A0D                    noFileErrMsg:	db 10,13
 11066 0000B20D 4572726F723A204669-     		db 'Error: File not found !',10,13,0
 11066 0000B216 6C65206E6F7420666F-
 11066 0000B21F 756E6420210A0D00   
 11067                                  
 11068                                  ; ---------------------------------------------------------------------------
 11069                                  
 11070                                  ; 15/02/2025
 11071 0000B227 0A0D                    not_valid_mp3f:	db 10,13
 11072 0000B229 4E6F7420612070726F-     		db 'Not a proper/valid MP3 file !',10,13,0
 11072 0000B232 7065722F76616C6964-
 11072 0000B23B 204D50332066696C65-
 11072 0000B244 20210A0D00         
 11073                                  
 11074                                  ; ---------------------------------------------------------------------------
 11075                                  
 11076                                  EOF:
 11077                                  
 11078                                  ; ===========================================================================
 11079                                  ; Uninitialized DATA (BSS)
 11080                                  ; ===========================================================================
 11081                                  
 11082 0000B249 90<rep 3h>              align 4
 11083                                  
 11084                                  ; 15/02/2025
 11085                                  bss_start:
 11086                                  
 11087                                  ABSOLUTE bss_start
 11088                                  
 11089                                  ;------------------------------------------------------------------------------
 11090                                  ; IFF/ILBM DATA
 11091                                  ;------------------------------------------------------------------------------
 11092                                  
 11093 0000B24C ????????                picture.width:	resd 1 	; current picture width and height
 11094 0000B250 ????????                picture.height:	resd 1
 11095                                  
 11096                                  ;------------------------------------------------------------------------------
 11097                                  
 11098                                  ; 16/02/2025 (tmp3play.s)
 11099                                  ; 13/02/2025
 11100                                  ; 12/02/2025 (mp3play6.s)
 11101                                  ; 05/02/2025 (cgaplay.s)
 11102                                  
 11103                                  alignb 4
 11104                                  
 11105                                  ; 25/01/2025
 11106 0000B254 ????????                stream_size	resd 1
 11107                                  ; 13/02/2025
 11108                                  ;turn_on_leds	resd 1
 11109                                  ; 22/01/2025
 11110 0000B258 ????????                stream_begin	resd 1
 11111 0000B25C ????????                fb_count	resd 1
 11112                                  
 11113                                  ; 26/01/2025
 11114 0000B260 ????????                sd_count	resd 1
 11115                                  
 11116                                  ; 12/01/2025
 11117                                  ;;;;
 11118                                  ; AC97 specific
 11119 0000B264 ????????                bus_dev_fn	resd 1
 11120 0000B268 ????????                dev_vendor	resd 1
 11121 0000B26C ????                    NAMBAR		resw 1
 11122 0000B26E ????                    NABMBAR		resw 1
 11123                                  ; SB16 specific
 11124 0000B270 ????????                audio_io_base	resd 1
 11125                                  ac97_int_ln_reg:
 11126 0000B274 ??                      audio_intr	resb 1
 11127                                  ;;;;
 11128                                  
 11129                                  ; 13/02/2025
 11130 0000B275 ??                      stopped		resb 1
 11131                                  
 11132 0000B276 ????                    alignb 4
 11133                                  
 11134                                  ;;;
 11135                                  ; 24/01/2025
 11136                                  ; 20/10/2024 (TRDOS 386 specific parameters)
 11137 0000B278 ??                      audio_hardware	resb 1
 11138 0000B279 ??                      vra		resb 1
 11139 0000B27A ??                      srb		resb 1
 11140 0000B27B ??                      blocks		resb 1
 11141 0000B27C ????????                buffer_size	resd 1
 11142                                  ;;;
 11143                                  
 11144                                  ; 23/05/2025
 11145 0000B280 ????????                timerticks	resd 1
 11146                                  
 11147                                  ; 15/01/2025 (FASM)
 11148                                  ;;;;
 11149                                  ; 13/01/2025 (Interpolation parameters)
 11150 0000B284 ????????                conversion	resd 1	; pointer to convers(t)ion
 11151                                  ;			; or interpolation proc address
 11152 0000B288 ????????                loadsize	resd 1	; decoding buffer size
 11153 0000B28C ??                      interpolation	resb 1	; interpolation status
 11154                                  
 11155                                  ;------------------------------------------------------------------------------
 11156                                  
 11157                                  ; 25/01/2025
 11158 0000B28D ??????                  alignb 4
 11159                                  
 11160                                  ; 15/02/2025
 11161                                  mp3_context_start:
 11162 0000B290 <res 1000h>             main_data_pool_start	resb 4096
 11163 0000C290 ????????                main_data_pool_wr_ptr	resd 1
 11164 0000C294 ????????                mp3_src_data_location	resd 1
 11165 0000C298 ????????                mp3_src_frame_size	resd 1
 11166 0000C29C ????????                mp3_src_frame_end	resd 1
 11167 0000C2A0 ????????                mp3_hdr_32bit_header	resd 1
 11168 0000C2A4 ????????                mp3_hdr_flag_crc	resd 1
 11169 0000C2A8 ????????                mp3_hdr_flag_mpeg25	resd 1
 11170 0000C2AC ????????                mp3_hdr_flag_padding	resd 1
 11171 0000C2B0 ????????                mp3_sample_rate		resd 1
 11172 0000C2B4 ????????                mp3_hdr_sample_rate_index resd 1
 11173 0000C2B8 ????????                mp3_bit_rate		resd 1
 11174 0000C2BC ????????                mp3_num_channels	resd 1
 11175                                  ; 17/02/2025
 11176                                  ;mp3_bytes_per_sample	resd 1
 11177 0000C2C0 ????????                mp3_curr_syn_index	resd 1
 11178 0000C2C4 ????????                mp3_curr_syn_dst	resd 1
 11179 0000C2C8 ????????                mp3_nb_frames		resd 1
 11180 0000C2CC ????????                mp3_hdr_mode_val	resd 1
 11181 0000C2D0 ????????                mp3_hdr_mode_ext	resd 1
 11182 0000C2D4 ????????                mp3_hdr_flag_lsf	resd 1
 11183                                  
 11184 0000C2D8 <res 2000h>             mp3_synth_buf   resd 2048
 11185 0000E2D8 ????????????????        mp3_synth_index resd 2
 11186 0000E2E0 <res 2400h>             mp3_sb_samples  resd 2304
 11187                                  				; MP3_MAX_CHANNELS*36*SBLIMIT
 11188 000106E0 <res 1200h>             mp3_mdct_buf    resd 1152
 11189                                  				; MP3_MAX_CHANNELS*SBLIMIT*18
 11190 000118E0 ????????                mp3_free_format_frame_size resd 1
 11191                                  
 11192 000118E4 ??                      mp3_curr_vfrac_bits resb 1
 11193                                  
 11194 000118E5 ??????                  alignb 4
 11195                                  
 11196 000118E8 ????????                mp3_xing_id     resd 1
 11197 000118EC ????????                mp3_xing_flags  resd 1
 11198 000118F0 ????????                mp3_xing_frames resd 1
 11199 000118F4 ????????                mp3_xing_filesize resd 1
 11200 000118F8 <res 64h>               mp3_xing_toc    resb 100
 11201 0001195C ????????                mp3_xing_vbr_scale resd 1
 11202 00011960 ????????                mp3_file_size   resd 1
 11203 00011964 ????????                mp3_id3_size    resd 1
 11204 00011968 ????????                mp3_tag_size    resd 1
 11205                                  
 11206 0001196C ????????                mp3_num_frames_decoded	resd 1
 11207 00011970 ????????                mp3_samples_dst		resd 1
 11208                                  ; DWORD mp3_samples_output_size
 11209 00011974 ????????                mp3_samples_output_size	resd 1
 11210 00011978 ????????                mp3_samples_dst_step	resd 1
 11211                                  
 11212 0001197C ????????                mp3_curr_channel	resd 1
 11213 00011980 ????????                mp3_curr_granule	resd 1
 11214 00011984 ????????                mp3_curr_frame		resd 1
 11215                                  
 11216 00011988 ????????                mp3_bitstream_start	resd 1
 11217 0001198C ????????                mp3_src_remain		resd 1
 11218 00011990 ????????                mp3_extra_bytes		resd 1
 11219 00011994 ????????                mp3_main_data_begin	resd 1
 11220 00011998 ????????                mp3_num_compress_bits	resd 1
 11221                                  
 11222 0001199C ????????                mp3_nb_granules resd 1
 11223                                  
 11224 000119A0 <res 2680h>             mp3_granules		resb 9856
 11225 00014020 <res 480h>              mp3_exponents		resw 576
 11226 000144A0 <res B800h>             huff_tree_buf		resb 0B800h
 11227 0001FCA0 <res 240h>              mp3_band_index_long	resw 288
 11228 0001FEE0 <res 803Ch>             mp3_table_4_3_exp	resb 32828
 11229                                  
 11230 00027F1C <res 200F0h>            mp3_table_4_3_value	resd 32828
 11231 0004800C <res 800h>              mp3_exp_table		resd 512
 11232 0004880C <res 8000h>             mp3_expval_table	resd 8192
 11233 0005080C <res 480h>              mp3_mdct_win		resd 288
 11234 00050C8C <res 800h>              mp3_is_table_lsf	resd 512
 11235 0005148C <res 1000h>             mp3_synth_win		resd 1024
 11236 0005248C <res 2000h>             mp3_lsf_sf_expand_exploded_table resb 8192
 11237                                  mp3_context_end:
 11238 0005448C ????????                _@@region_address0	resd 1
 11239 00054490 ????????                _@@region_address1	resd 1
 11240 00054494 ????????                _@@saved_sp		resd 1
 11241 00054498 ????????                mp3_main_data_siz	resd 1
 11242 0005449C ????????                _@@scfsi        resd 1
 11243 000544A0 <res Ch>                _@@gains        resd 3
 11244 000544AC ????????                _@@rle_point    resd 1
 11245 000544B0 ????????                _@@III          resd 1
 11246 000544B4 ????????                _@@JJJ          resd 1
 11247 000544B8 ????????                _@@linbits      resd 1
 11248 000544BC ????????                _@@vlc_table    resd 1
 11249 000544C0 ????????                _@@coarse_end   resd 1
 11250                                  
 11251 000544C4 ????????                _@rle_point     resd 1
 11252 000544C8 ????????                _@@rle_ptr      resd 1
 11253 000544CC ????????                _@@rle_val      resd 1
 11254 000544D0 ????????                _@@rle_val_x_40h resd 1
 11255 000544D4 ????????                _@@max_bands    resb 4
 11256 000544D8 ????????                _@@max_blocks   resd 1
 11257 000544DC ????????                _@@max_pos      resd 1
 11258 000544E0 <res 28h>               _@@sfb_array    resb 40
 11259 00054508 ????????                _@@is_tab       resd 1
 11260 0005450C ????????                _@@n_long_sfb   resd 1
 11261 00054510 ????????                _@@n_short_sfb  resd 1
 11262 00054514 ????????                _@@n_sfb        resd 1
 11263 00054518 <res 900h>              _@@tmp          resb 2304
 11264 00054E18 ????????                _@@s0           resd 1
 11265 00054E1C ????????                _@@s2           resd 1
 11266 00054E20 ????????                _@@s3           resd 1
 11267                                  
 11268 00054E24 <res 48h>               _@@@tmp         resd 18 ; resb 72
 11269 00054E6C ????????                _@@tmp0         resd 1
 11270 00054E70 ????????                _@@tmp1         resd 1
 11271 00054E74 ????????                _@@tmp2         resd 1
 11272 00054E78 ????????                _@@tmp3         resd 1
 11273 00054E7C ????????                _@@tmp4         resd 1
 11274 00054E80 ????????                _@@tmp5         resd 1
 11275 00054E84 ????????                mp3_out2_a0     resd 1
 11276 00054E88 ????????                mp3_out2_a1     resd 1
 11277 00054E8C ????????                mp3_out2_a2     resd 1
 11278 00054E90 ????????                mp3_out2_b0     resd 1
 11279 00054E94 ????????                mp3_out2_b1     resd 1
 11280 00054E98 ????????                mp3_out2_b2     resd 1
 11281 00054E9C ????????                                resd 1
 11282 00054EA0 ????????                                resd 1
 11283 00054EA4 ????????                _@@@JJJ         resd 1
 11284 00054EA8 ????????                _@@www          resd 1
 11285 00054EAC ????????                _@@mdct_long_end resd 1
 11286 00054EB0 ????????                _@@sblimit      resd 1
 11287 00054EB4 ????????                _@@switch_point resd 1
 11288 00054EB8 <res 100h>              mp3_huff_tmp_bits	resb 256
 11289 00054FB8 <res 200h>              mp3_huff_tmp_codes	resb 512
 11290 000551B8 ????????                _@@table_nb_bits	resd 1
 11291 000551BC ????????                _@@nb_codes		resd 1
 11292 000551C0 ????????                _@@prefix_numbits	resd 1
 11293 000551C4 ????????                _@@prefix_pattern	resd 1
 11294 000551C8 ????????                _@@curr_table_size	resd 1
 11295 000551CC ????????                _@@curr_table_mask	resd 1
 11296 000551D0 ????????                _@@curr_table_index	resd 1
 11297 000551D4 ????????                _@@granule_addr		resd 1
 11298                                  ; HANDLE hFile
 11299 000551D8 ????????                hFile           resd 1
 11300                                  ; HANDLE hMap
 11301                                  ;hMap           resd 1
 11302 000551DC ????????                stream_start    resd 1
 11303 000551E0 ????????                stream_pos      resd 1
 11304 000551E4 ????????                bytes_left      resd 1
 11305                                  
 11306                                  ; 17/02/2025
 11307                                  ;; 20/10/2024
 11308                                  ;; DWORD diskresult
 11309                                  ;;diskresult     resd 1
 11310                                  ;; HANDLE std_out
 11311                                  ;;std_out        resd 1
 11312                                  ;;cmdline_buf    resb 1024
 11313                                  ;cmdline_buf	resb 128
 11314                                  ;; HANDLE mp3_wav_handle
 11315                                  ;mp3_wav_handle  resd 1
 11316                                  ;; HANDLE mp3_pcm_handle
 11317                                  ;mp3_pcm_handle  resd 1
 11318                                  ;_@@max_diff     resd 1
 11319                                  ;_@@avg_diff     resd 2
 11320                                  ;pcm_filepos     resd 1
 11321                                  ;_@@mono_convert resd 1
 11322                                  ;_@@pcm_steps    resw 2
 11323                                  ;_@@worst_pcm_filepos resd 1
 11324                                  ;_@@worst_mp3_filepos resd 1
 11325                                  ;		resd 1
 11326                                  
 11327                                  ;------------------------------------------------------------------------------
 11328                                  
 11329                                  ; 15/02/2025
 11330                                  
 11331 000551E8 ????????????????        alignb 16
 11332                                  
 11333 000551F0 <res 200h>              RowOfs		resw 256
 11334                                  
 11335 000553F0 <res 200h>              NewScope_L	resw 256
 11336 000555F0 <res 200h>              NewScope_R	resw 256
 11337 000557F0 <res 200h>              OldScope_L	resw 256
 11338 000559F0 <res 200h>              OldScope_R	resw 256
 11339                                  
 11340                                  ;------------------------------------------------------------------------------
 11341                                  
 11342 00055BF0 <res 50h>               mp3_file_name	resb 80 ; wave file, path name (<= 80 bytes)
 11343                                  
 11344 00055C40 ????????                		resd 1
 11345 00055C44 ????????                txtSize		resd 1
 11346                                  
 11347                                  ;------------------------------------------------------------------------------
 11348                                  
 11349                                  ; 10/01/2025
 11350 00055C48 <res 3B8h>              alignb 4096
 11351                                  
 11352                                  ; 27/01/2025
 11353                                  ; 15/01/2025
 11354 00056000 <res 2000h>             decoding_buffer resb 8192  ; 2*4096 (max. 4608)
 11355 00058000 <res 9000h>             sample_buffer	resb 36864 ; 8*4608
 11356                                  
 11357                                  ;------------------------------------------------------------------------------
 11358                                  
 11359                                  ; 26/01/2025
 11360                                  ;alignb 4096
 11361                                  
 11362                                  ; 15/02/2025
 11363 00061000 ????????                sounddata_copy	resd 1	; address pointer for fast (conversion) copy
 11364 00061004 ????????                get_sound_data	resd 1	; procedure pointer
 11365                                  
 11366                                  ; 16/02/2025
 11367 00061008 <res FF8h>              alignb 4096
 11368                                  
 11369 00062000 <res 400h>              sounddata	resb 1024 ; 16 bit stereo samples for wave scope display
 11370 00062400 <res 200h>              sounddata2	resb 512 ; temporary buffer
 11371                                  
 11372                                  ; 26/01/2025
 11373 00062600 <res A00h>              alignb 4096
 11374                                  
 11375                                  end_of_bss:
 11376                                  
 11377                                  ; ===========================================================================
 11378                                  ; end
