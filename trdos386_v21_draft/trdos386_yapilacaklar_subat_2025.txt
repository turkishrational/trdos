06/02/2025 itibarý ile TRDOS 386 v2.0.9'da
olmayan özelliðin write string fonksiyonunu bozmasý...
****
þu düzeltilecek: *** (21/12/2025'de video.s'de yapýldý) ***
*****
PMI32 = enabled iken video modu VESA VBE3 PMI Video BIOS'a
geçilerek ayarlanýyordu. (Özellikle Video MODE 13h)
ama video modu kernel dýþýnda ayarlanýrken
[CHAR_HEIGHT] ve [CRT_COLS] video moduna göre deðiþtirilmemiþ oluyor
ve text modundaki (Video MODE 3 deki) haliyle kalýyor.
(Diðer parametreler de önemli olabilir).
*****
Böyle olunca, INT 31h 1300h fonksiyonu
(Int10h function 13h, sub function 0) grafik modunu algýlýyor ama
([current_mode]), [CHAR_HEIGHT] ve [CRT_COLS] deðerleri doðru olmadýðý
için ekrana bozuk yazýyor.
*****
Doðrusu "vga_params" tablosunda ilgili video modu kýsmýnýn ilk 3 byte'ý
columns, rows-1, char pixels deðerini veriyor (vidata.s).
Write string fonksiyonu bu deðerleri kullanýyorsa ekrana doðru yazabilir.
*****
Buna çözüm bulunacak.

cgaplay1.s (CGAPLAY1.PRG) INT31h write string fonksiyonunu kullanýyor.
PMI32=ENABLED iken ekran bozuk görünüyor.
(Tam ekran 24*80 ekrana yazýyor.)
Düzeltme yapýldýktan sonra ekran doðru oluþmalý.

Þimdilik PMI32=enabled iken INT 31h, karakter yazmayý iptal edip,
programa direkt video access ile karakter pixellerini yazdýrmak çözüm
olabilir. O þekilde çalýþan CGAPLAY.PRG düzgün görüntü veriyor.
(Program tarihleri: 05/02/2025)

Erdoðan Tan - 06/02/2025

; 14/02/2025
mp3play6.prg'da display indikatör (ekranýn sol üstündeki sayý)
0 iken sarý renk (font color), 1 pixel kolonu saða taþýp ilk 4 pixeli
sarý yapýyor... (7 pixel geniþlikteki karakterin hemen saðýnýn tepedeki
4 pixeli). Bunun sysvideo 010Fh (ebx), 0Eh (ecx) ve edx = 01??h 
çaðrýsýnda olduðunu tahmin ediyorum. (display_indicator prosedürü)
kernelin ilgili 8*8 karakter yazma prosedüründe hata olabilir.
(Video Mode 13h)

(28/12/2025 - Yukarýdaki kusur artýk yok. Nasýl düzeldi bilmiyorum.
Emülatörde ve gerçek bilgisayarda porblemsiz görüntü oluyor.) 

; 27/02/2025
VGA veya VESA modunda userfont vs yazdýrýlýrken
sys _video, 020Fh, [wcolor], 8001h
(mp3play8.s, write_character)
boþluk (20h) karakterleri yazýlmayýp pas geçilince,
o karakterin pozisyonundaki eski karakter silinmemiþ oluyor sanýyorum.
Bu durumda karakterin (background color ile) silinmiþ olmasý lazým.
Bu deðiþiklik gerekiyor.
(mmp3player8.s, drawplayingscreen, updatefileinfo prosedürleri)
nasýl bir kusur oluþuyor: potbori.mp3'den sonra alana kvp.mp3 yazýnca,
görüntü kvp.mp3.mp3 oluyor. Bu durum mp3_file_name string alanýndan
deðil, drawpplayingscreen esnasýnda önceki potbori.mp3 yazýsýnýn
silinmemesinden ileri geliyor çünkü burada boþluk karakteri var.

(28/12/2025 - Yukarýdaki kusurun background color yöntemi ile düzeltilmesi
için sysvideo sistem çaðrýsýnda yapýlacak deðiþiklik veya ekleme
piksel oerasyonlarýnda karýþýklýðý artýracaðý için, onun yerine
boþluk karakterinin tam dolu karakter (user font) olarak yazýlmasý daha
uygun görünüyor. mp3play8.s'de 28/02/2025 bu deðiþikliði yapmýþým.)

; mp3play8.s
;;;;;;;;;;;;;;;;;;;

		mov	ebp, PlayingScreen ; ((formatted text))
		; 26/01/2025
		mov	esi, 0 ; row 0, column 0
p_d_x:
		mov	byte [columns], 80
p_d_x_n:
		xor	edx, edx
		mov	dl, [ebp]
		and	dl, dl
		jz	short p_d_x_ok

		; 28/02/2025
		;;;;
		cmp	dl, 20h
		jne	short p_d_x_@

		; 28/02/2025 ; !!!!
		; clear previous character pixels
		mov	edi, fillblock
		sys	_video, 020Fh, 0, 8001h
		jmp	short p_d_x_@@
p_d_x_@:
		shl	edx, 4 ; * 16 (for 8x16 font)

		mov	edi, fontbuff2 ; start of user font data
		add	edi, edx

		; 26/12/2024
		sys	_video, 020Fh, 0Fh, 8001h ; 8x16 user font
p_d_x_@@:
		inc	ebp
		add	si, 8 ; next char pos
		dec	byte [columns]
		jnz	short p_d_x_n	; next column
		xor	si, si
		add	esi, 000E0000h	; next row ; 8*14
		jmp	short p_d_x
p_d_x_ok:
		retn

;;;;;;;;;;;;;;;;;;;